/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0],Array(1222).concat([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){window.history.pushState({},"",window.location.href)}function s(){if(!Store.Conn.connected)return!1;var e=n(1415),t=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),i=Store.Chat.some(function(e){return!!e.composeContents.text});return t||i||e.hasText}var r=n(2),o=i(r),c=n(86),l=i(c),u=n(106),d=i(u),p=n(103),h=i(p),f=n(6),m=n(38);_.defaults(window.Store,n(1609));var g=n(85),v=n(10),y=n(12),E=n(19),b=n(1483),M=n(1544),C=n(428),S=n(1624),T=n(1464),w=n(144),k=n(8),P=n(14),N=n(149),O=n(227),D=n(1623),x=n(1513),R=n(141),A=n(140),I=n(84),L=n(1628),U=n(1596),F=n(1581),G=n(0),j=n(1),B=n(220),H=B.parseCmd,q=B.Cmd,W=n(216),V=n(83),z=n(82),Y=n(67),K=n(66),Q=n(1555),X=n(26),Z=n(90);Z&&!function(){var e=n(226),t=n(225);Store.ProfilePicThumb.on("change:tag",function(n){n.tag||e.request(navigator.serviceWorker.controller,t.REMOVE_PP,n.id)["catch"](function(){})})}();var J=[[document,"mousemove"],[document,"scroll"],[document,"keydown"],[window,"focus"],[window,"blur"],[window,"resize"]],$=f.createClass({displayName:"Main",mixins:[w,A,I,R],propTypes:{apiCmd:f.PropTypes.array,apiCmdHandled:f.PropTypes.func.isRequired,animate:f.PropTypes.bool},statics:{hasPending:s},getInitialState:function(){return this.onBlur=this.safeDebounce(function(){if(document.activeElement===document.body){var e=V.Manager.top;e&&e.uie.requestFocus()}},10),{drawerActive:!1}},componentWillMount:function(){var e=this;d["default"].uiActive=!0,d["default"].markAvailable(),this.regNativeListener(window,"click",function(t){var n=t.target;if(n&&"A"===n.nodeName&&n.hasAttribute("href")){var i=H(n.getAttribute("href"));e.execApiCmd(i)&&t.preventDefault()}},!0)},componentWillReceiveProps:function(e){e.apiCmd&&this.execApiCmd(e.apiCmd)},componentWillUnmount:function(){this.onBlur=null,L.trigger(D.Event+":"+D.Events.LOGGED_OUT),Y.canMuckHistory()&&window.history.back(),d["default"].uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(L.trigger(D.Event+":"+D.Events.LOGGED_IN),this.props.apiCmd&&this.execApiCmd(this.props.apiCmd),Y.canMuckHistory()&&(window.history.pushState({},"",window.location.href),this.regNativeListener(window,"popstate",a)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),this.addObserverAndRun(Store.Conn,"change:tos",this.showTOS),z.focus(m.findDOMNode(this)),g.isSafari){var e=E.getNUX(v.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",v.BROWSER_LINK.CHROME).replace("__firefox_homepage__",v.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",v.BROWSER_LINK.OPERA);k.openModal(f.createElement(C,{onOK:k.closeModal.bind(k),okText:l10n.t("ok_got_it")},f.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),E.setNUX(v.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},execApiCmd:function(e){var t=(0,l["default"])(e,2),n=t[0],i=t[1];switch(j.log("main:execApiCmd:"+n)(i),this.props.apiCmdHandled(),n){case q.GROUP_INVITE:return k.openModal(f.createElement(F,{groupCode:i.code})),!0;case q.MSG_SEND:var a=i.text,s=i.phone;if(s){var r=X.numberToWid(s);K.queryExist(r).then(function(e){return 200===e.status?Store.Chat.find(e.jid):o["default"].reject("Invalid number")}).then(function(e){return e.active&&a?void k.pasteChatTextInput(e,a):(a&&e.setComposeContents({text:a}),k.openChatFromUnread(e).then(function(t){t&&k.focusChatTextInput(e)}))})["catch"](function(e){k.openModal(f.createElement(C,{onOK:k.closeModal.bind(k),okText:l10n.t("web_ok")},l10n.t("msg_send_error")))})}else k.openModal(f.createElement(Q,{msgText:a}),"modal-flow");return!0;default:return!1}},beginIdleMonitor:function(e){var t=this;e=e?v.IDLE_TIMEOUT:0,this.idleMonitor=o["default"].loop(function(){return o["default"].delay(e).addCancelControl().then(function(){d["default"].markUnavailable(3e4);var n=void 0,i=new o["default"](function(e){n=e});return J.forEach(function(e){var i=(0,l["default"])(e,2),a=i[0],s=i[1];t.regNativeListener(a,s,n)}),i.addCancelControl()["finally"](function(){J.forEach(function(e){var i=(0,l["default"])(e,2),a=i[0],s=i[1];t.unregNativeListener(a,s,n)})}).then(function(){d["default"].markAvailable(),e=v.IDLE_TIMEOUT})})})["finally"](function(){t.idleMonitor=null})["catch"](o["default"].CancellationError,_.noop).endWithControls("cancel")},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.control.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=N.setTimeout(function(){Store.Props.fetch()["catch"](P.WapDrop,_.noop),e.beginServerPropsQueryLoop()},G().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){N.clearTimeout(this.serverPropsQueryLoop)},calculateConversationPaneScale:function(){if(!(this.refs.chatlist&&this.refs.container&&this.refs.conversation))return null;var e=m.findDOMNode(this.refs.chatlist),t=m.findDOMNode(this.refs.conversation),n=m.findDOMNode(this.refs.container);return t.clientWidth/(n.clientWidth-e.clientWidth)},onRightDrawerIn:function(){this.rightDrawerOut=!1,k.onPanesWillChange(3),this.setState({drawerActive:!0},k.onPanesDidChange.bind(k,3));var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e)},onRightDrawerOut:function(){this.rightDrawerOut=!0;var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e),1!==e&&(k.onPanesWillChange(2),this.setState({drawerActive:!1},k.onPanesDidChange.bind(k,2)))},onRightDrawerAnimationComplete:function(){this.state.drawerActive&&this.rightDrawerOut&&this.setState({drawerActive:!1})},animateConversationPane:function(e){Velocity(m.findDOMNode(this.refs.conversation),{scaleX:[1,e]},{duration:300,easing:[.1,.82,.25,1]})},onRotateFocus:function(e){var t=this,n=1;e&&(e.stopPropagation(),e.preventDefault(),n=e.shiftKey?-1:1,h["default"].flashFocus=Date.now());var i=_.toArray(m.findDOMNode(this).querySelectorAll("[data-tab]"));if(k.existsDrawerLeft(function(e){if(e){var n=m.findDOMNode(t.refs.chatlist);i=_.reject(i,function(e){return n.contains(e)})}}),k.existsDrawerMid(function(e){if(e){var n=m.findDOMNode(t.refs.conversation);n&&(i=_.reject(i,function(e){return n.contains(e)}))}}),i.length){i=_.sortBy(i,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var a=0,s=document.activeElement;s&&(a=O.ring(_.findIndex(i,function(e){return e.contains(s)})+n,i));var r=i[a];h["default"].flashFocus=Date.now(),r.restoreFocus?r.restoreFocus():z.focus(r)}},showTOS:function(){switch(Store.Conn.tos){case 1:case 2:k.openModal(f.createElement(U,null),void 0,void 0,!0);break;case 3:y.logout()}},render:function(){var e=this.state.drawerActive?"app three":"app two";this.props.animate||(e+=" no-animation"),g.isSafari&&(e+=" safari-fix");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return f.createElement(W,{state:W.State.INACTIVE,ref:"container",displayName:"Main"},f.createElement(h["default"],{handlers:t,className:e,onBlur:this.onBlur},f.createElement(S,null),f.createElement(T,null),f.createElement("div",{className:"drawer-manager"},f.createElement(M,{direction:M.Dir.LEFT}),f.createElement(M,{direction:M.Dir.MID}),f.createElement(M,{direction:M.Dir.RIGHT,ref:"rightDrawer",onDrawerIn:this.onRightDrawerIn,onDrawerOut:this.onRightDrawerOut,onDrawerAnimationComplete:this.onRightDrawerAnimationComplete})),f.createElement(b,{ref:"chatlist"}),f.createElement(x,{ref:"conversation",animate:this.props.animate})))}});e.exports=$},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e){return e in L}function r(e){if(!e)return null;var t=new b({from:e.from,to:e.to,id:e.id,participant:e.participant,self:e.self,remote:e.remote}),n=Store.Msg.get(t);return n||(e.id=t,n=new A(e)),n}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgProxy=t["default"]=void 0;var o=n(2),c=a(o),l=n(145),u=a(l),d=n(1353),p=i(d),h=n(10),f=n(1),m=n(66),g=n(14),v=n(26),y=n(433),E=n(67),b=n(39),M=n(1445),C=n(139),S=n(1368),T=n(51),w=n(8),k=n(1331),P=n(150),N=n(1318),O=n(1327),D=h.MSG_TYPE,x=P.Message.VideoMessage.ATTRIBUTION,R=(0,l.defineState)("Msg",{Collection:"Msg",props:{id:"msgKey",body:"string",type:{type:"string",values:_.values(D)},subtype:"string",t:"number",notifyName:"string",from:"string",to:"string",author:"string",self:{type:"string",values:["in","out"],"default":"in"},ack:"number",invis:"boolean",isNewMsg:"boolean",star:["boolean",!0,!1],recvFresh:"boolean",caption:"string",clientUrl:"string",loc:"string",lat:"string",lng:"string",mimetype:"string",duration:"string",filehash:"string",size:"number",filename:"string",streamingSidecar:"object",mediaKey:"string",pageCount:"number",isGif:"boolean",gifAttribution:"number",streamable:"boolean",title:"string",description:"string",canonicalUrl:"string",matchedText:"string",thumbnail:"string",recipients:"array",broadcast:"boolean",quotedMsg:"object",quotedStanzaID:"string",quotedRemoteJid:"string",quotedParticipant:"string",mentionedJidList:"array",multicast:"boolean",urlText:"boolean",urlNumber:"boolean",vcardList:"array",protocolMessageKey:"msgKey"},session:{promises:{type:"object","default":function(){return{}}},local:"boolean",search:"boolean",msgChunk:"object",phoneUploading:"boolean",startOfDay:"number",startOfDaySkew:"number",_quotedMsgObj:"object",isQuotedMsgAvailable:{type:"boolean","default":!0},senderObj:"object",_mediaData:"object"},initialize:function(){u["default"].prototype.initialize.call(this),this.sender&&this.addChild("senderObj",Store.Contact.gadd(this.sender));var e;(e=Store.Msg.preAck[this.id])&&(f.log("Msg:initialize updating msg with out of order ack",e)(),this.updateAck(e.ack),delete Store.Msg.preAck[this.id]),this.type===D.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted),this._mediaObject=void 0,s(this.type)&&this.initializeMedia()},derived:{mediaData:{fn:function(){return this._mediaData?this._mediaData:s(this.type)?(this.initializeMedia(),this._mediaData):void 0},cache:!1},chat:{fn:function(){return Store.Chat.get(this.id.remote)}},isGroupMsg:{fn:function(){return v.isGroup(this.from)||v.isGroup(this.to)}},isStatusV3:{fn:function(){return v.isStatusV3(this.id.remote)}},isPSA:{fn:function(){return v.isPSA(this.id.remote)}},isSentByMe:{fn:function(){var e=this.id;return"in"!==e.self&&!this.isNotification&&this.from===Store.Conn.me}},isNotification:{deps:["type"],fn:function(){switch(this.type){case D.GROUP_NOTIFICATION:case D.GP2:case D.BROADCAST_NOTIFICATION:case D.NOTIFICATION:case D.E2E_NOTIFICATION:case D.CALL_LOG:return!0;default:return!1}}},isMedia:{deps:["type"],fn:function(){return["image","video","audio"].indexOf(this.type)>-1}},isLink:{deps:["type","subtype","title","description"],fn:function(){return"chat"===this.type&&"url"===this.subtype&&(this.title||this.description)}},isDoc:{deps:["type"],fn:function(){return"document"===this.type}},isMMS:{deps:["type"],fn:function(){return s(this.type)}},eventType:{deps:["type","invis","isNewMsg"],fn:function(){var e;return this.isNewMsg?(e=this.eventTypeFromMsgType(),this.invis?"i"===e?"i":"n":e):"i"}},sender:{fn:function(){return this.isSentByMe?this.from:this.isGroupMsg||this.isStatusV3?this.author:this.from}},containsEmoji:{deps:["body","caption"],fn:function(){switch(this.type){case D.CHAT:return this.body&&y.containsEmoji(this.body);case D.IMAGE:return this.caption&&y.containsEmoji(this.caption);default:return!1}}},isFailed:{deps:["isSentByMe","ack"],fn:function(){return this.isSentByMe&&this.ack<0}},vcard:{deps:["type","body"],fn:function(){if(this.type===D.VCARD)try{return k.parse(this.body)}catch(e){return}}},isUnsentMedia:{deps:["ack","isMMS","isSentByMe"],fn:function(){return this.ack<1&&this.isMMS&&this.isSentByMe}},dir:{deps:["type","body","subtype","caption"],fn:function(){switch(this.type){case D.CHAT:return S.dir(this.body);case D.VCARD:return this.subtype?S.dir(this.subtype):void 0;case D.IMAGE:return this.caption?S.dir(this.caption):void 0;default:return}}},rtl:{deps:["type","body","subtype","caption"],fn:function(){switch(this.type){case D.CHAT:return"rtl"===S.dir(this.body);case D.VCARD:return!!this.subtype&&"rtl"===S.dir(this.subtype);case D.IMAGE:return!!this.caption&&"rtl"===S.dir(this.caption);default:return!1}}},linkPreview:{deps:["matchedText","body","title","description"],fn:function(){return _.isString(this.matchedText)&&(!_.isEmpty(this.title)||!_.isEmpty(this.description))&&this.body.indexOf(this.matchedText)>-1}},isPersistent:{fn:function(){return this.type===D.E2E_NOTIFICATION&&"encrypt"===this.subtype}}},typeCanChange:function(){return this.type===D.CIPHERTEXT||this.isStatusV3&&C.supportsFeature(C.F.REVOKE)},hasSymbol:function(){return["image","video","audio","ptt","location","vcard","document","ciphertext","unknown","call_log"].indexOf(this.type)>-1},mayFail:function(){return this.isSentByMe&&this.ack<1},isUnsentPhoneMsg:function(){return!this.local&&this.isSentByMe&&this.ack<1},canReply:function(){return this.chat.canSend&&!this.mayFail()&&!this.isNotification&&this.type!==D.UNKNOWN&&this.type!==D.CIPHERTEXT&&this.type!==D.REVOKED&&C.supportsFeature(C.F.REPLIES_OUT)},mayBeForwardable:function(){if(this.type===D.CIPHERTEXT)return!1;if(this.type===D.REVOKED)return!1;if(this.type===D.UNKNOWN)return!1;if(this.isMMS){var e=this.mediaData;if(!e){var t=this.previousAttributes();return f.assert(e,"childless-media-msg","msg has no media data child {\n  id: "+this.id+",\n  type: "+this.type+",\n  prev: "+t.type+",\n  t: "+this.t+",\n  ack: "+this.ack+",\n  _mediaObject: "+this._mediaObject+",\n}")(),!1}if(!p.canSendType(e.type))return!1;if(e.mediaStage===N.STAGE.ERROR_MISSING)return!1;if(e.mediaStage===N.STAGE.ERROR_UNSUPPORTED)return!1}return!0},canForward:function(){if(!this.mayBeForwardable())return!1;if(this.isMMS){if(this.isUnsentMedia)return!1;if(this.canSendPlayed())return!1}return!0},isGroupLeave:function(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&_.head(this.recipients)===Store.Conn.me},msgText:function(e){return O.msgText(this,e)},isTrusted:function(){return this.sender===Store.Conn.me||(!(!this.senderObj||!this.senderObj.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():!!C.supportsFeature(C.F.SPAM)&&this.chat.notSpam))},getWAids:function(){return this.type!==D.VCARD?null:k.vcardWAids(this.vcard)},getVCardThumbnailWAid:function(){return this.type!==D.VCARD?null:k.thumbnailWAid(this.getWAids())},resumeRemoteUpload:function(){var e=this;return this.isUnsentPhoneMsg()&&!this.phoneUploading&&(Store.Msg.send(this).then(function(t){"success"!==t&&(e.phoneUploading=!1)}),this.phoneUploading=!0),this.downloadMedia(!0)},forceDownloadMedia:function(){return this.downloadMedia(!0)},forceRMR:function(){return c["default"].reject(new Error("unimplemented forceRMR"))},isForcingRMR:function(){return!1},cancelDownload:function(){p.cancelDownloadMsg(this)},resumeUpload:function(){f.assert(this.mediaData.mediaStage===N.STAGE.NEED_UPLOAD,"resume-non-need-upload","resumeUpload called while state was "+this.mediaData.mediaStage)(),p.resumeUploadMsg(this)},cancelUpload:function(){p.cancelUploadMsg(this)},initializeMedia:function(){this.addChild("_mediaData",new N,"mediaData"),p.registerMsg(this)},downloadMedia:function(){var e=this,t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];if(f.assert(this.isMMS,"media-fault","downloadMedia called on non-mms msg")(),this.isUnsentPhoneMsg()){var n=this.promises.waitForPhoneUpload;return n||(n=this.promises.waitForPhoneUpload=T.waitForBBEvent(this,"change:mediaData.mediaStage change:filehash",function(){return!!e.filehash&&!e.isUnsentPhoneMsg()}).then(function(){e.promises.waitForPhoneUpload=null})),n.then(function(){return e.downloadMedia(t)})}return p.downloadMsg(this,t)},waitForPrep:function(){return s(this.type)?p.prepareMsg(this):c["default"].resolve()},"delete":function(){s(this.type)&&p.deregisterMsg(this),this.decryptedMediaBlob&&this.unset("decryptedMediaBlob"),E.isBlob(this.url)&&URL.revokeObjectURL(this.url),Store.AllStarredMsgs.remove(this),u["default"].prototype["delete"].call(this),Store.Msg.remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id);var e=Store.Chat.get(this.id.remote);if(e&&(e.unreadMsgAnchor===this&&(e.unreadMsgAnchor=void 0),e.lastReceivedKey===this.id)){e.lastReceivedKey=void 0;var t=e.getLastReceivedMsg();t&&(e.lastReceivedKey=t.id)}},quotedMsgObj:function(){if(!this.quotedMsg)return null;if(this._quotedMsgObj){var e=Store.Msg.get(this._quotedMsgObj.id);return e?this._quotedMsgObj=e:this._quotedMsgObj}var t=!this.quotedParticipant||this.quotedParticipant===Store.Conn.me,n=t?"out":"in",i=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,a={id:this.quotedStanzaID,from:t?Store.Conn.me:i,to:t?i:Store.Conn.me,self:n,author:this.quotedParticipant,remote:i},s=v.isGroup(a.from)||v.isGroup(a.to);return s&&Store.Conn.me!==this.quotedParticipant&&(a.participant=this.quotedParticipant),_.assign(a,this.quotedMsg),this._quotedMsgObj=r(a)},contextInfo:function(e){var t,n=_.omit(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast"]);return e&&e!==this.id.remote&&(t=this.id.remote),{quotedMsg:n,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:t}},displayName:function(e,t){if(!this.sender)return"";if(this.sender===Store.Conn.me)return l10n.t("web_you");var n=this.senderObj,i=e?n.shortName:void 0;if(i)return i;if(n.name)return n.name;var a=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR(v.formattedUser(this.sender))+a:v.formattedUser(this.sender)+a},isQuoted:function(e){var t=this.quotedMsgObj();return!!t&&t.sender===e},isMentioned:function(e){return _.indexOf(this.mentionedJidList,e)>-1},mentionMap:function(){if(!C.supportsFeature(C.F.MENTIONS_IN))return null;if(!_.size(this.mentionedJidList))return null;var e={};return _.forEach(this.mentionedJidList,function(t){var n=v.user(t),i=void 0,a=Store.Contact.get(t);a&&(a.name?i=a.name:a.notifyName&&(i=a.notifyName)),i||t!==Store.Conn.me||(i=Store.Conn.pushname),i=i||v.formattedUser(t),e["@"+n]={jid:t,display:i}}),e},updateAck:function(e){var t=this.ack;_.isNumber(e)&&("undefined"==typeof t||e>t)?this.ack=e:e===-1&&0===this.ack&&(this.ack=-1,this.phoneUploading=!1)},canSendPlayed:function(){if(this.isSentByMe)return!1;if(this.ack>=h.ACK_PLAYED)return!1;if("ptt"!==this.type){if("video"!==this.type)return!1;if(this.isGif)return!1;if(!C.supportsFeature(C.F.VIDEO_PLAYED_STATUS))return!1}return!0},sendPlayed:function(){var e=this;this.canSendPlayed()?m.sendMessagePlayed(this.id).then(function(t){e.ack=h.ACK_PLAYED})["catch"](g.WapDrop,_.noop):f.log("Msg:msg should not call sendPlayed")()},avParams:function(){var e=this.mediaData;return{url:this.clientUrl,type:this.type,mimetype:this.mimetype,filehash:this.filehash,filename:this.filename,duration:this.duration,width:e.fullWidth,height:e.fullHeight}},resend:function(){return this.isFailed?(this.ack=0,this.isMMS?this.resumeRemoteUpload():Store.Msg.send(this)):c["default"].resolve()},onCiphertextDecrypted:function(){this.mediaData;var e=this.chat,t=e.msgs.length,n=e.msgs.indexOf(this);n!==-1&&t-n<=10&&w.alertNewMsg(this)},eventTypeFromMsgType:function(){var e,t,n=this.type,i=this.subtype;return n===D.GP2||n===D.GROUP_NOTIFICATION?"subject"===i?e="n":"add"===i||"invite"===i?(t=_.head(this.recipients),e=t===Store.Conn.me?"s":"i"):"remove"===i?(t=_.head(this.recipients),e=t===Store.Conn.me?"n":"i"):e="create"===i?"n":"i":e=n===D.BROADCAST_NOTIFICATION||n===D.NOTIFICATION||n===D.E2E_NOTIFICATION?"create"===i?"n":"i":n===D.CALL_LOG?"n":this.broadcast||n===D.REVOKED?"i":this.isPSA?2===this.ack?"d":"a":n===D.CIPHERTEXT?"a":"d",e},revoke:function(e){return this.id.fromMe?(s(this.type)&&p.deregisterMsg(this),this.decryptedMediaBlob&&this.unset("decryptedMediaBlob"),E.isBlob(this.url)&&URL.revokeObjectURL(this.url),void this.set({id:e,type:D.REVOKED,body:void 0,caption:void 0,clientUrl:void 0,loc:void 0,lat:void 0,lng:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mentionedJidList:void 0,vcardList:void 0})):void f.error("revoke: fromMe false "+this.id.toString())()},sendRevoke:function(){var e=this;if(!this.isStatusv3)return c["default"].reject("only statusv3 messages can be revoked");if(!C.supportsFeature(C.F.REVOKE))return c["default"].reject("revoke feature unsupported");if(!this.id.fromMe)return c["default"].reject("revoking received message");var t=new b({id:A.newTag(),remote:this.id.remote,fromMe:!0}),n={id:t,to:this.id.remote,t:this.t,type:D.PROTOCOL,subtype:"revoke",protocolMessageKey:this.id};return Store.Msg.send(new A(n)).then(function(n){"success"===n&&e.revoke(t)})["catch"](function(e){})}},M),A=R.Msg,I=R.MsgProxy,L={image:1,video:1,audio:1,ptt:1,document:1};A.TYPE=D,A.GIF_ATTRIBUTION=x,A.newTag=b.newTag,A.typeIsMMS=s,t["default"]=A,t.MsgProxy=I},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){switch(t){case"text":return e.type===u["default"].TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===u["default"].TYPE.IMAGE;case"video":return e.type===u["default"].TYPE.VIDEO&&!e.isGif;case"gif":return e.type===u["default"].TYPE.VIDEO&&e.isGif;case"audio":return e.type===u["default"].TYPE.AUDIO;case"ptt":return e.type===u["default"].TYPE.PTT;case"document":return e.type===u["default"].TYPE.DOCUMENT;case"location":return e.type===u["default"].TYPE.LOCATION;case"vcard":return e.type===u["default"].TYPE.VCARD||e.type===u["default"].TYPE.MULTI_VCARD;case"url":return e.type===u["default"].TYPE.CHAT&&"url"===e.subtype;case void 0:return!1;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProxy=void 0;var s=n(1223),r=i(s),o=n(2),c=i(o),l=n(1307),u=i(l),d=n(1353),p=n(452),h=i(p),f=n(106),m=i(f),g=n(448),v=i(g),y=n(6),E=n(10),b=n(1),M=n(1441),C=n(1347),S=n(1440),T=n(1439),w=n(1438),k=n(1391),P=n(139),N=n(8),O=n(66),D=n(19),x=n(143),R=n(14),A=n(39),I=n(26),L=n(443),U=n(105).ActionToast,F=n(105).ActionType,G=n(1331),j=3e5,B={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},H={Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean"},session:{createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeContents:{type:"object","default":function(){return{}}},popupPanels:"object",popupPositionChange:"number",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",trusted:"boolean",canSend:"boolean",promises:{type:"object","default":function(){return{}}},ftsCache:{type:"object","default":function(){return{}}},composeQuotedMsg:"object",groupMetadata:"object",presence:"object",mute:"object",contact:"object"},initialize:function(){if(M.prototype.initialize.call(this),this._addQueue=new h["default"],this._sendQueue=new h["default"],this.msgs.msgLoadState.contextLoaded=!0,this.isVisible||(this.msgs.msgLoadState.noEarlierMsgs=!0),this.addChild("presence",Store.Presence.gadd(this.id)),this.addChild("mute",Store.Mute.gadd({id:this.id,expiration:this.muteExpiration})),I.isPSA(this.id)&&this._updatePSAName(),this.addChild("contact",Store.Contact.gadd(this.id)),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"change:formattedName",this.updateTitle),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.addChild("groupMetadata",Store.GroupMetadata.gadd(this.id)),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Store.ProfilePicThumb.update(t)["catch"](R.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](R.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](R.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(Store.Blocklist,"add remove reset",this.updateCanSend);Store.Chat.notSpam[this.id]&&!this.notSpam&&this.sendNotSpam()["catch"](_.noop),Store.Chat.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"remove",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate),this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache)},derived:{kind:{fn:function(){return I.isGroup(this.id)?B.GROUP:I.isBroadcast(this.id)?B.BROADCAST:I.isUser(this.id)?B.CHAT:void 0}},isGroup:{fn:function(){return I.isGroup(this.id)}},isBroadcast:{fn:function(){return I.isBroadcast(this.id)}},isUser:{fn:function(){return I.isUser(this.id)}},isPSA:{fn:function(){return I.isPSA(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}},isVisible:{deps:["createdLocally","msgs","msgsLength"],fn:function(){return!!this._isVisibleLatched||!I.isStatusV3(this.id)&&(this._isVisibleLatched=!this.createdLocally||this.msgs.some(function(e){return e.type!==u["default"].TYPE.E2E_NOTIFICATION}),this._isVisibleLatched)}},previewMessage:{deps:["msgs","msgsChanged"],fn:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&t.type!==u["default"].TYPE.E2E_NOTIFICATION)return t}return this.msgs.last()}}},addAndSendMsg:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],i=c["default"].resolve(e),a=this._addQueue.enqueue(i).then(function(e){var n=window.Store.Msg.add(e);return n.waitForPrep().then(function(){return t.msgs.add(n)})}),s=n?a.then(n)["return"](a):a,r=this.sendMsg(s);return[a,r]},sendMsg:function(e){return this._sendQueue.enqueue(e).then(function(e){return window.Store.Msg.send(e)})},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(b.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},onNotSpamChange:function(){Store.Chat.notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")},hasMaybeSentMsgToChat:function(){return _.some(this.getAllMsgs(),function(e){return e.isSentByMe})},isTrusted:function(){var e=void 0;return this.isGroup?e=P.supportsFeature(P.F.SPAM)?this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=!P.supportsFeature(P.F.SPAM)||(this.notSpam||this.contact.isMyContact)),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.name||I.formattedUser(this.id):this.isGroup&&(this.formattedTitle=this.contact.name)},title:function(){return this.isGroup?this.formattedTitle||l10n.t("unknown_subject"):this.formattedTitle},sendExit:function(){var e=this;if(!this.isGroup)return c["default"].reject(new R.ActionError);if(this.promises.sendExit)return this.promises.sendExit;this.promises.sendExit=O.leaveGroup(this.id);var t=new F(l10n.t("action_group_exiting")),n=this.promises.sendExit.then(function(e){return 200===e.status?new F(l10n.t("action_group_exited")):e.status>=400?new F(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return b.error("models:chat:sendExit dropped")(e),new F(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return N.openToast(y.createElement(U,{id:U.genId(),initialAction:t,pendingAction:n})),this.promises.sendExit.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})["finally"](function(){e.promises.sendExit=null})},canExit:function(){return P.supportsFeature(P.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.msgs.last(),n=t?t.id:void 0;this.promises.sendDelete=O.sendConversationDelete(this.id,n);var i,a=this.kind;switch(a){case B.GROUP:i=l10n.t("action_group_deleting");break;case B.BROADCAST:i=l10n.t("action_broadcast_deleting");break;case B.CHAT:i=l10n.t("action_chat_deleting")}i=new F(i);var s=this.promises.sendDelete.bind(this).then(function(e){if(200===e.status)switch(a){case B.GROUP:return new F(l10n.t("action_group_deleted"));case B.BROADCAST:return new F(l10n.t("action_broadcast_deleted"));case B.CHAT:return new F(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(a){case B.GROUP:return new F(l10n.t("action_group_delete_failed"));case B.BROADCAST:return new F(l10n.t("action_broadcast_delete_failed"));case B.CHAT:return new F(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){b.error("models:chat:sendDelete dropped")(e);var t=void 0;switch(a){case B.GROUP:t=l10n.t("action_group_delete_failed");break;case B.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case B.CHAT:t=l10n.t("action_chat_delete_failed")}return new F(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return N.openToast(y.createElement(U,{id:U.genId(),initialAction:i,pendingAction:s})),this.promises.sendDelete.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var n=this.msgs.last();t===n?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})["finally"](function(){e.promises.sendDelete=null})},updateCanSend:function(){return this.isReadOnly?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isBlocked()||this.isPSA):this.canSend=!0},canDelete:function(){return P.supportsFeature(P.F.DELETE)},canClear:function(){return P.supportsFeature(P.F.CHAT_CLEAR)},sendClear:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var n=this.msgs.last(),i=n?n.id:void 0;this.promises.sendClear=O.sendConversationClear(this.id,i,!e);var a=new F(l10n.t("action_chat_clearing")),s=this.promises.sendClear.then(function(e){return 200===e.status?new F(l10n.t("action_chat_cleared")):e.status>=400?new F(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(n){return b.error("models:chat:sendClear dropped")(n),new F(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return N.openToast(y.createElement(U,{id:U.genId(),initialAction:a,pendingAction:s})),this.promises.sendClear.then(function(i){200!==i.status||i._duplicate||t.deleteMsgsBeforeMsgInclusive(n,e);
})["finally"](function(){t.promises.sendClear=null})},"delete":function(e){M.prototype["delete"].call(this),Store.Chat.remove(this.id),this.cancelPendingPromises(),this.presence["delete"](),this.mute["delete"](),this.deleteMsgs(),N.clearChat(this),this.groupMetadata&&this.groupMetadata["delete"](),this.mediaMsgs&&this.mediaMsgs["delete"](),this.linkMsgs&&this.linkMsgs["delete"](),this.docMsgs&&this.docMsgs["delete"](),this.starredMsgs&&(this.starredMsgs["delete"](),this.starredMsgs.stopListening(),this.starredMsgs.reset())},isDirty:function(){return 0!==this.unreadCount},resetMediaMsgs:function(){this.mediaMsgs&&(this.mediaMsgs["delete"](),this.mediaMsgs.queryMedia(this)),this.linkMsgs&&(this.linkMsgs["delete"](),this.linkMsgs.queryLinks(this)),this.docMsgs&&(this.docMsgs["delete"](),this.docMsgs.queryDocs(this))},addMediaMsgs:function(e,t){var n=_.isArray(e)?e:[e];if(this.mediaMsgs){var i=n.filter(function(e){return e.isMedia});i.length>0&&this.mediaMsgs.add(i,t)}if(this.linkMsgs){var a=n.filter(function(e){return e.isLink});a.length>0&&this.linkMsgs.add(a,t)}if(this.docMsgs){var s=n.filter(function(e){return e.isDoc});s.length>0&&this.docMsgs.add(s,t)}},onNewMsg:function(e){if(e&&"i"!==e.eventType&&(this.t=e.t,this.promises.updateSortTime&&this.promises.updateSortTime.cancel(),this.archive&&(this.archive=!1),e.isSentByMe||this.presence.handle({id:this.id,participant:e.author,type:"available"}),!e.isSentByMe))switch(e.eventType){case"d":case"a":this.unreadCount=this.unreadCount+1||1,"d"===e.eventType&&N.alertNewMsg(e),this.msgs.length<E.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs()["catch"](R.E404,_.noop);break;case"s":if("gp2"===e.type&&"add"===e.subtype&&_.head(e.recipients)===Store.Conn.me&&!this.contact.name)return;N.alertNewMsg(e)}},setArchive:function(e,t){var n=this;if(this.archive===e)return c["default"].reject(new R.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var i=this.lastReceivedKey,a=O.sendConversationArchive(this.id,e,i),s=new F(e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"));t=t||U.genId();var r=a.then(function(i){var a=void 0;return 200===i.status?(a=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new F(a,l10n.t("action_undo"),n.setArchive.bind(n,!e,t))):i.status>=400?new F(e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(i){b.error("models:chat:setArchive dropped")(i);var a=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new F(a,l10n.t("action_try_again"),n.setArchive.bind(n,e,t))});return N.openToast(y.createElement(U,{id:t,initialAction:s,pendingAction:r})),this.promises.setArchive=a.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})["finally"](function(){n.promises.setArchive=null})},canArchive:function(){return this.isBroadcast?P.supportsFeature(P.F.ARCHIVE_BROADCAST):P.supportsFeature(P.F.ARCHIVE)},sendSeen:function(){if(this.markedUnread||0===this.unreadCount)return c["default"].resolve();if(!m["default"].available)return this.listenTo(m["default"],"change:available",this.sendSeen),c["default"].resolve();this.stopListening(m["default"],"change:available",this.sendSeen);var e=this.unreadCount-this.pendingSeenCount,t=this.unreadCount===-1&&e===-1;if(e<=0&&!t)return c["default"].resolve();this.disableUnreadAnchor=!0,this.pendingSeenCount=this.unreadCount;var n=this,i=function(){n.pendingSeenCount=n.pendingSeenCount-e,n.pendingSeenCount<0&&(b.error("models:chat:sendSeen unread "+n.unreadCount+" pending: "+n.pendingSeenCount+" delta: "+e)(),n.pendingSeenCount=0)},a=this.lastReceivedKey;return P.gte([0,4])?O.sendConversationSeen(this.id,a,e).bind(this).then(function(t){return i(),200!==t.status||t._duplicate||this.markSeen(e),t})["catch"](R.WapDrop,function(e){i(),b.error("models:chat:sendConversationSeen dropped")()}):(i(),this.markSeen(e),O.sendConversationSeen(this.id,a,e).bind(this).then(function(e){return e})["catch"](R.WapDrop,function(e){b.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:e===-1&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1},markUnread:function(e,t){var n=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;this.promises.markUnread=e?this.sendUnseen():this.sendSeen();var i=new F(e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"));t=t||U.genId();var a=this.promises.markUnread.then(function(i){if(200===i.status){var a=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new F(a,l10n.t("action_undo"),n.markUnread.bind(n,!e,t))}if(i.status>=400)return new F(e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed"))})["catch"](function(i){var a=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new F(a,l10n.t("action_try_again"),n.markUnread.bind(n,e,t))});return N.openToast(y.createElement(U,{id:t,initialAction:i,pendingAction:a})),this.promises.markUnread["finally"](function(){n.promises.markUnread=null})},canMarkUnseen:function(){return P.supportsFeature(P.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),n=t?t.id:void 0;return O.sendConversationUnseen(this.id,n).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;O.sendChatstateRecording(e).then(function(t){t.status>=400&&b.error("models:chat send presence recording error "+e)()})["catch"](R.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),E.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;O.sendChatstateComposing(e).then(function(t){t.status>=400&&b.error("models:chat send presence composing error "+e)()})["catch"](R.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),E.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),E.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;O.sendChatstatePaused(e).then(function(t){t.status>=400&&b.error("models:chat send presence paused error "+e)()})["catch"](R.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)O.sendChatstateRecording(e).then(function(t){t.status>=400&&b.error("models:chat send presence resend recording error "+e)()})["catch"](R.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");O.sendChatstateComposing(e).then(function(t){t.status>=400&&b.error("models:chat send presence resend composing error "+e)()})["catch"](R.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),E.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,n){var i;switch(e){case"subject":return void(this.contact.name=n.subject);case"add":case"promote":case"demote":var a="promote"===e;return i=_.map(n.participants,function(e){return{id:e,isAdmin:a}}),void this.groupMetadata.participants.add(i,{merge:!0});case"remove":return i=this.groupMetadata.participants,void _.each(n.participants,function(e){i.remove(e)});case"modify":return;default:return}},setComposeContents:function(e){this.composeContents=e},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()["catch"](R.E404,_.noop)},onEmptyMRM:function(){b.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()["catch"](R.E404,_.noop)},loadEarlierMsgs:function(e){return e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?c["default"].resolve():e.msgLoadState.isLoadingEarlierMsgs?e.loadEarlierPromise:this._loadMsgs("before",e).then(function(t){return _.isArray(t)&&t.length<E.PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})},isMostRecentCMC:function(e){return this.msgs===e},loadRecentMsgs:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?c["default"].resolve():e.msgLoadState.isLoadingRecentMsgs?e.loadRecentPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var n;n="after"===e?t.last():t.head();var i={};return n?i=n.id.clone():i.remote=this.id,i.count=E.PAGE_SIZE,i.direction=e,this._loadMsgsPromise(n,t,Store.Msg.findQuery(i),e)},_loadMsgsPromise:function(e,t,n,i){"after"===i?t.msgLoadState.isLoadingRecentMsgs=!0:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!0:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!0);var a=this.regCancellablePromise(n)["finally"](function(){var n=e&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,n&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===i?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!1)})["catch"](function(e){return b.error("chat:loadMsgs:error "+e)(),404===e?c["default"].reject(new R.E404):c["default"].reject(e)});return"after"===i?t.loadRecentPromise=a:"before"===i?t.loadEarlierPromise=a:"around"===i&&(t.loadAroundPromise=a),a},getSearchContext:function(e,t){var n=this,i=void 0,a=void 0;e instanceof u["default"]?i=e:e instanceof A&&(a=e);var s=i?i.msgChunk:void 0,o=(0,r["default"])(E.PAGE_SIZE/3*2);if(!s||!s.msgLoadState.contextLoaded){s||(s=new C,this.msgChunks.push(s),i&&s.add(i));var c=i?i.id.clone():a.clone();c.count=o;var l=function(){if(i)return i.msgChunk;var e=Store.Msg.get(a);return e&&e.msgChunk?e.msgChunk:s};this._loadMsgsPromise(i,s,Store.Msg.getContext(c,l),"around").then(function(e){var t=l();t!==s&&n.notifyMsgCollectionMerge(t,s,t);var r=e[0],c=a?Store.Msg.get(a):i;c&&_.isArray(r)&&r.length<o&&(c.msgChunk.msgLoadState.noEarlierMsgs=!0,c.msgChunk!==s&&(s.msgLoadState.noEarlierMsgs=!0))})["catch"](function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:s,msg:i,key:a,highlightMsg:!0}},sendStarMsgs:function(e,t,n){var i=this;if(!e)return c["default"].reject(new R.ActionError);if(_.some(e,function(e){return!e.id}))return c["default"].reject(new R.ActionError);if(this.promises.sendStarMsgs)return this.promises.sendStarMsgs;this.promises.sendStarMsgs=O.sendMessageStarred(this.id,_.map(e,function(e){return e.id}),t);var a=_.size(e),s={count:a,_plural:a},r=new F(t?l10n.t("action_message_starring",s):l10n.t("action_message_unstarring",s));n=n||U.genId();var o=this.promises.sendStarMsgs.then(function(a){if(200===a.status){var r=t?l10n.t("action_message_starred",s):l10n.t("action_message_unstarred",s);return new F(r,l10n.t("action_undo"),i.sendStarMsgs.bind(i,e,!t,n))}if(a.status>=400)return new F(t?l10n.t("action_message_star_failed",s):l10n.t("action_message_unstar_failed",s))})["catch"](function(a){b.error("models:chat:sendStarMsgs dropped")(a);var r=t?l10n.t("action_message_star_failed",s):l10n.t("action_message_unstar_failed",s);return new F(r,l10n.t("action_try_again"),i.sendStarMsgs.bind(i,e,t,n))});return N.openToast(y.createElement(U,{id:n,initialAction:r,pendingAction:o})),this.promises.sendStarMsgs.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",t)}),t?Store.AllStarredMsgs.add(e):Store.AllStarredMsgs.remove(e))})["finally"](function(){i.promises.sendStarMsgs=null})},sendNotSpam:function(e,t){var n=this;if(!P.supportsFeature(P.F.SPAM))return c["default"].resolve();if(this.notSpam)return c["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;if(this.promises.sendNotSpam=O.sendConversationNotSpam(this.id),e){var i=new F(l10n.t("action_mark_as_not_spam"));t=t||U.genId();var a=this.promises.sendNotSpam.then(function(e){return 200===e.status?new F(l10n.t("action_marked_as_not_spam")):e.status>=400?new F(l10n.t("action_mark_as_not_spam_failed")):void 0})["catch"](function(i){return b.error("models:chat:sendNotSpam dropped")(i),new F(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),n.sendNotSpam(e,t))});N.openToast(y.createElement(U,{id:t,initialAction:i,pendingAction:a}))}return this.promises.sendNotSpam["finally"](function(){n.promises.sendNotSpam=null})},sendSpamReport:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;this.promises.sendSpamReport=O.sendSpamReport(this.id);var n=new F(l10n.t("action_spam_report"));e=e||U.genId();var i=this.promises.sendSpamReport.then(function(e){return 200===e.status?new F(l10n.t("action_spam_reported")):e.status>=400?new F(l10n.t("action_spam_report_failed")):void 0})["catch"](function(n){return b.error("models:chat:sendSpamReport dropped")(n),new F(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return N.openToast(y.createElement(U,{id:e,initialAction:n,pendingAction:i})),this.promises.sendSpamReport["finally"](function(){t.promises.sendSpamReport=null})},sendDeleteMsgs:function(e,t){var n=this;if(!e)return c["default"].reject(new R.ActionError);if(_.some(e,function(e){return!e.id}))return c["default"].reject(new R.ActionError);if(this.promises.sendDeleteMsgs)return this.promises.sendDeleteMsgs;this.promises.sendDeleteMsgs=O.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0);var i=_.size(e),a={count:i,_plural:i},s=new F(l10n.t("action_message_deleting",a));t=t||U.genId();var r=this.promises.sendDeleteMsgs.then(function(e){return 200===e.status?new F(l10n.t("action_message_deleted",a)):e.status>=400?new F(l10n.t("action_message_delete_failed",a)):void 0})["catch"](function(i){return b.error("models:chat:sendDeleteMsgs dropped")(i),new F(l10n.t("action_message_delete_failed",a),l10n.t("action_try_again"),n.sendDeleteMsgs.bind(n,e,t))});return N.openToast(y.createElement(U,{id:t,initialAction:s,pendingAction:r})),this.promises.sendDeleteMsgs.then(function(t){200===t.status&&_.forEach(e,function(e){e["delete"]()})})["finally"](function(){n.promises.sendDeleteMsgs=null})},deleteMsgs:function(e,t){var n=this;this.getAllCMCs().forEach(function(i){i.filter(function(e){return!t||a(e,t)}).filter(function(t){return(e||!t.star)&&!t.isPersistent}).forEach(function(e){e["delete"]()}),0===i.length&&i!==n.msgs&&n.removeMsgsCollection(i)}),this.unreadCount=0},deleteMsgsOlderThan:function(e,t,n){var i=this.msgs,s=_.head(i.models);if(s&&!(s.t>=e)){if(s=_.last(i.models),s.t<e)return void this.deleteMsgs(t,n);var r=function(i){return i&&(n&&!a(i,n)||i.star&&!t||i.t>=e||i.isPersistent)};this.deleteMsgsPartial(r)}},deleteMsgsBeforeMsgInclusive:function(e,t){if(e&&this.msgs.get(e.id)){var n=this.msgs.indexOf(e),i=function(e,i){return e.msgChunk===this.msgs&&i>n||t&&e.star||e.isPersistent};this.deleteMsgsPartial(i)}},deleteMsgsPartial:function(e){var t=this,n=this.unreadCount,i=_.flatten(this.getAllCMCs().map(function(n){return n.filter(function(n,i,a){return!e.apply(t,[n,i,a])})}));if(i.forEach(function(e){e["delete"]()}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var a=n>this.msgs.length?this.msgs.length:n;this.unreadCount=a,this.msgs.msgLoadState.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===u["default"].TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},getLastReceivedMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}},getLastTimestampMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}},createMessageFromText:function(e){if(e=_.trim(e),""===e)return null;var t=this.id,n=Store.Conn.me,i=new A({from:n,to:t,id:u["default"].newTag(),participant:void 0,selfDir:"out"}),a={id:i,body:e,type:"chat",subtype:null,t:x.globalUnixTime(),from:n,to:t,self:"out",local:!0,ack:0};return new u["default"](a)},sendMessage:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],i=arguments[3];if(e=_.trim(e),""===e)return c["default"].resolve();this._messageSent();var a=this.id,s=Store.Conn.me,r=new A({from:s,to:a,id:u["default"].newTag(),participant:void 0,selfDir:"out"}),o=n&&n.contextInfo(),l=_.defaults({id:r,body:e,type:"chat",subtype:t&&!_.isEmpty(t)?"url":null,t:x.globalUnixTime(),from:s,to:a,self:"out",local:!0,ack:0},t,o,{mentionedJidList:i}),d=new u["default"](l),p=Store.Msg.send(d);return this.msgs.add(d),p},sendContact:function(e){var t=G.cleanValue(e.formattedName),n="BEGIN:VCARD\nVERSION:3.0\nN:"+G.getName(e)+"\nFN:"+t+"\nTEL;type=CELL;waid="+e.userid+":"+I.formattedUser(e.userid)+"\nEND:VCARD",i={ack:0,body:n,from:Store.Conn.me,id:new A({from:Store.Conn.me,to:this.id,id:u["default"].newTag(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:x.globalUnixTime(),to:this.id,type:"vcard",isNewMsg:!0};this.addAndSendMsg(i)},forwardMessages:function(e){var t=this,n=this.id,i=this.contact;if(i.isUser&&i.isBlocked())return c["default"].reject(new R.ContactBlocked("Forwarded to contact is blocked",i));var a=[];return c["default"].each(e,function(e){if(e.isMMS)return(0,d.forwardMediaMsg)(e,t);var i=_.omit(e.toJSON(),"quotedMsg"),a=new A({from:Store.Conn.me,to:n,id:u["default"].newTag(),participant:void 0,selfDir:"out"});return _.assign(i,{id:a,from:Store.Conn.me,t:x.globalUnixTime(),to:n,ack:0,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1}),t.addAndSendMsg(i)})["return"](a)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},sortMsgs:function(e){var t=_.map(e,function(e){var t=e.msgChunk;return{msg:e,chunkT:t.models[0].t,index:t.indexOf(e)}});return _(t).orderBy(["chunkT","index"]).map("msg").value()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,n=_.difference(_.keys(t),e.map("id").map(L));n.forEach(function(e){delete t[e]}),n.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),D.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&D.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,n=this,i=this.colors||(this.colors=this.loadAssignedColors()),a=L(e);if(t=i[a])return t;var s=function(){var e={};_.forEach(i,function(t,n){e[t]?e[t].push(n):e[t]=[n]});for(var s=Number.POSITIVE_INFINITY,r=1;r<E.NUM_COLORS;r++){if(!e[r]){t=r;break}e[r].length<s&&(s=e[r].length,t=r)}return i[a]=t,n._saveAssignedColors(),{v:t}}();return"object"==typeof s?s.v:void 0},setSubject:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return c["default"].reject(new R.ActionError);if(t===this.contact.name)return c["default"].reject(new R.ActionError);var i=O.changeSubject(this.id,t),a=this.contact.name,s=new F(l10n.t("action_group_renaming"));n=n||U.genId();var r=i.then(function(i){return 200===i.status?new F(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,a,n)):i.status>=400?new F(l10n.t("action_group_rename_failed")):void 0})["catch"](function(i){return b.error("models:chat:setSubject dropped")(i),new F(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,n))});return N.openToast(y.createElement(U,{id:n,initialAction:s,pendingAction:r})),i.then(function(n){200!==n.status||n._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)}),Store.AllStarredMsgs.remove(this.getAllMsgs())},constructMediaMsgs:function(e){if(!e)return this.getMediaMsgs();var t=void 0;return this.getMediaMsgs().contains(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new S,t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),t},fts:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?1:arguments[1],i=arguments[2];if(1===n){var a=this.ftsCache[e];if(a)return a;var s=Store.Msg.search(e,n,i,this.id);this.ftsCache[e]=s;var r=function(){t.ftsCache[e]=null};return _.delay(r,j),s["catch"](r),s}return Store.Msg.search(e,n,i,this.id)},_clearFtsCache:function(){this.ftsCache={}},_updatePSAName:function(){this.name=l10n.t("whatsapp_psa_contact_name")},updateSortTime:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=c["default"].delay(0).cancellable().then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,c["default"].resolve()):e.msgs.msgLoadState.noEarlierMsgs?(e.t=void 0,c["default"].resolve()):e.pendingMsgs?c["default"].resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var n=e.getLastTimestampMsg();e.t=n?n.t:void 0}})["catch"](_.noop)["finally"](function(){e.promises.updateSortTime=void 0}),this.regCancellablePromise(this.promises.updateSortTime))},removeFromCollection:function(e){e.star&&this.starredMsgs&&this.starredMsgs.remove(e),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.isLink&&this.linkMsgs?this.linkMsgs.remove(e):e.isDoc&&this.docMsgs&&this.docMsgs.remove(e)},getMediaMsgs:function(){return this.mediaMsgs||(this.mediaMsgs=new S),this.mediaMsgs},getLinkMsgs:function(){return this.linkMsgs||(this.linkMsgs=new T),this.linkMsgs},getDocMsgs:function(){return this.docMsgs||(this.docMsgs=new w),this.docMsgs},getStarredMsgs:function(){var e=this;return this.starredMsgs||(this.starredMsgs=new k,this.starredMsgs.parent=this,this.starredMsgs.add(Store.AllStarredMsgs.filter(function(t){return t.chat===e}))),this.starredMsgs}},q=M.extend(H);q.KIND=B;t.ChatProxy=(0,v["default"])(H);t["default"]=q},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=arguments.length<=2||void 0===arguments[2]?{found:!1}:arguments[2];if(e===t)return n.found=!0,"";if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;for(var i=x.formatDelim(e)||"",s="",r=0;r<e.childNodes.length&&(s+=a(e.childNodes[r],t,n),!n.found);)r++;return i?""+i+s+i:s}function s(e,t,n,i,a,r){if(i<n)return-1;var o,c=Math.round((n+i)/2),l=e[c],u=l.offsetLeft-a;if(u>=t)o=r;else{if(u+l.clientWidth>t)return c;o=!r}return o?s(e,t,n,c-1,a,r):s(e,t,c+1,i,a,r)}function r(e,t){for(var n=0,i=e.childNodes,a=0;a<i.length;a++){var s=i[a];if(s===t)break;n+=s.clientWidth}return n}var o=n(1217),c=i(o),l=n(6),u=n(38),d=n(433),p=n(85),h=n(141),f=n(140),m=n(84),g=n(144),v=n(45),y=n(1216),E=n(139),b=n(1459),M=n(1630),C=n(1373),S=n(1457),T=n(1393),w=n(1394),k=n(1397),P=n(1398),N=n(1458),O=n(1395),D=n(1633),x=n(1369),R=4096,A={SMALL:"small",LARGE:"large"},I=l.createClass({displayName:"EmojiText",mixins:[m,f,h,g,y],statics:{EMOJI_SIZE:A},propTypes:{text:l.PropTypes.string,highlight:l.PropTypes.array,highlightBounary:l.PropTypes.bool,mention:l.PropTypes.object,emojiSize:l.PropTypes.oneOf(_.values(A)),element:l.PropTypes.string,className:l.PropTypes.oneOfType([l.PropTypes.string,l.PropTypes.arrayOf(l.PropTypes.string),l.PropTypes.objectOf(l.PropTypes.bool)]),direction:l.PropTypes.string,linkify:l.PropTypes.bool,titlify:l.PropTypes.bool,ellipsify:l.PropTypes.bool,selectable:l.PropTypes.bool,format:l.PropTypes.bool,wbr:l.PropTypes.number,dirMismatch:l.PropTypes.bool},getInitialState:function(){var e=this.props.text;return this.debouncedRecompute=this.safeDebounce(this.recompute,20),this.reged=!1,{ellipsified:null,text:d.removeFEOF(e)}},getDefaultProps:function(){return{emojiSize:A.SMALL,element:"span"}},componentWillMount:function(){p.isWebkit&&this.props.ellipsify&&this.containsEmoji()&&this.regResizeListener()},componentWillReceiveProps:function(e){var t=d.removeFEOF(e.text);if(p.isWebkit&&this.props.ellipsify&&t!==this.state.text){var n=(t||"").substring(0,R);d.containsEmoji(n)?(this.recompute(),this.regResizeListener()):(this.setState({ellipsified:null}),this.unregResizeListener())}this.setState({text:t})},containsEmoji:function(){var e=(this.state.text||"").substring(0,R);return d.containsEmoji(e)},regResizeListener:function(){this.reged||(this.regNativeListener(window,"resize",this.debouncedRecompute),this.regCmd("resize",this.debouncedRecompute),this.reged=!0)},unregResizeListener:function(){this.reged&&(this.unregNativeListener(window,"resize",this.debouncedRecompute),this.unregCmd("resize",this.debouncedRecompute),this.reged=!1)},recompute:function(){this.setState({ellipsified:null},this.ellipsify)},ellipsifyCheck:function(){this.isMounted()&&this.containsEmoji()&&this.ellipsify()},componentDidMount:function(){p.isWebkit&&this.props.ellipsify&&this.uiIdle(this.ellipsifyCheck)},ellipsify:function(){var e=u.findDOMNode(this);if(e){var t=e.querySelectorAll("img");if(0!==t.length){var n,i=0;if(n=e.clientWidth){if(n===e.scrollWidth)return;i=0}else{var o=e.parentNode;if(i=r(o,e),n=o.clientWidth-i,o.clientWidth===o.scrollWidth)return}var c=l10n.isRTL()===this.props.dirMismatch,l=s(t,c?n:0,0,t.length-1,c?i:0,c);if(!(l<0)){var d=t[l],p=10;p-=Math.floor(p/4);var h=s(t,c?n-p:p,0,l,c?i:0,c);h>-1&&(d=t[h]),this.setState({ellipsified:a(e,d)})}}}},render:function(){if(!this.state.text)return null;var e=this.state.ellipsified;e||(e=this.props.ellipsify?(this.state.text||"").substring(0,R):this.state.text);var t=this.props.selectable?"selectable-text":void 0,n=new c["default"];n.set("default",{className:t}),n.set(S,{size:this.props.emojiSize});var i=[],a=E.supportsFeature(E.F.RICH_TEXT)&&this.props.format;a&&i.push(new C),this.props.linkify&&i.push(new w),a&&(i.push(new P),i.push(new T),i.push(new k)),this.props.wbr&&i.push(new M(this.props.wbr)),i.push(new S);var s=this.props.highlight;s&&s.length>0&&i.push(new N(s,this.props.highlightBounary)),this.props.mention&&i.push(new O(this.props.mention));var r=b.parse(e,i),o=b.serialize(r,new D(n)),u=v(this.props.className,{emojitext:!this.props.className,ellipsify:this.props.ellipsify,"inverse-text-direction":this.props.dirMismatch,"selectable-text":this.props.selectable}),d={className:u,dir:this.props.direction};this.props.titlify&&(d.title=this.state.text);var p=this.props.element;return l.createElement(p,d,o,this.state.ellipsified?"…":null)}});e.exports=I},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(32),s=i(a),r=n(147),o=i(r),c=n(431),l=i(c),u=n(1218),d=i(u),p=n(86),h=i(p),f=n(1),m=n(14),g=n(8),v=n(31),y={async:function(e,t){var n=e.split(".").slice(-1),i=(0,h["default"])(n,1),a=i[0];return this._asyncKey(a,e,t)},asyncState:function(e,t){var n=this,i=v.mapValues(e,function(e,t){return n._asyncKey(t,e)});for(var a in t)void 0===i[a]&&(i[a]=t[a]);return i},_asyncKey:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?this.props:arguments[2],i=t.split("."),a=this._getAsyncIndex(i),s=i.slice(0,a),r=(0,d["default"])(s),o=r[0],c=r.slice(1),l=i.slice(a+1),u=n[i[0]];return a&&(u=this._getObservable(e,o,c,n,i[a])),u?v.isFunction(u.on)||v.isFunction(u.off)?this._asyncObserver(e,i,c,u,l):f.trace("asyncMixin path resolved to non-observable: "+t):f.trace("asyncMixin path resolved to nonexistent state! path: "+t)},_getObservable:function(e,t,n,i,a){var s=n.length?i[t].getp(n):i[t];return s?Store[a].get(s):null},_asyncObserver:function(e,t,n,i,a){var s=this;i.stale&&this._loadStale(i);var r="change:"+a.join("."),o=function(){return s.setOrQueueState((0,l["default"])({},e,i.getp(a)))};return i.on(r,o),i.isState&&i._uiObservers++,this._asyncs=this._asyncs||{},this._asyncs[e]={key:e,splitPath:t,basePath:n,observable:i,callback:o,eventKey:r},i.getp(a)},_loadStale:function(e){var t=this;g.uiBusy?!function(){var n=t._waAsyncIdle||(t._waAsyncIdle=[]),i=function a(){e.getCollection().find(e.id)["catch"](m.WapDrop,v.noop),t._waAsyncIdle&&(v.pull(t._waAsyncIdle,a),0===t._waAsyncIdle.length&&(t._waAsyncIdle=null))};g.once("ui_idle",i),n.push(i)}():e.getCollection().find(e.id)["catch"](m.WapDrop,v.noop)},componentWillMount:function(){this.__willMount=!0,this.__stateQueue&&(this.setState(v.assign.apply(v,[{}].concat((0,o["default"])(this.__stateQueue)))),this.__stateQueue=void 0)},setOrQueueState:function(e){this.__willMount?this.setState(e):(this.__stateQueue=this.__stateQueue||[],this.__stateQueue.push(e))},_observersMatch:function(e,t,n,i){return n[e]===i[e]&&(!t.length||n[e].getp(t)===i[e].getp(t))},componentWillReceiveProps:function(e){var t=this;if(this._asyncs){var n={};v.forIn(this._asyncs,function(i,a){var s=i.splitPath,r=i.basePath,o=(0,h["default"])(s,1),c=o[0];if(!t._observersMatch(c,r,t.props,e)){var l=i.observable,u=i.callback,d=i.eventKey;l.off(d,u),l.isState&&l._uiObservers--,n[a]=t._asyncKey(a,s.join("."),e)}}),(0,s["default"])(n).length&&this.setOrQueueState(n)}},componentWillUnmount:function(){this._waAsyncUnmount=!0,this._waAsyncIdle&&v.forIn(this._waAsyncIdle,function(e){g.off("ui_idle",e)}),this._asyncs&&v.forIn(this._asyncs,function(e){var t=e.observable,n=e.callback,i=e.eventKey;t.off(i,n),t.isState&&t._uiObservers--})},_getAsyncIndex:function(e){for(var t=1;t<e.length;++t)if(e[t].charAt(0).toLowerCase()!==e[t].charAt(0))return t;return 0}};e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}var s=n(431),r=i(s),o=n(6),c=n(45),l={LEFT:"left",MID:"mid",RIGHT:"right"},u=o.createClass({displayName:"Drawer",propTypes:{children:o.PropTypes.node.isRequired,id:o.PropTypes.string,variant:o.PropTypes.string,noContainer:o.PropTypes.bool,position:o.PropTypes.oneOf(_.values(l)),onDragLeave:o.PropTypes.func,onDrop:o.PropTypes.func,onDragOver:o.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left",MID:"mid"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&(a(e),this.state.isDragging||(this.props.onDragOver(e),this.setState({isDragging:!0})))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,n=c(this.props.className,"drawer",(0,r["default"])({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var i=this.state.isDragging?{}:{display:"none"};e=o.createElement("div",{key:"mask",className:"drag-drop-mask",style:i,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}return o.createElement("div",{className:n,onDragOver:this.onDragOver},e,t.children)}});u.Position=l,e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e
}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(45),u=c.createClass({displayName:"DrawerBody",propTypes:{classes:c.PropTypes.string,info:c.PropTypes.bool,wide:c.PropTypes.bool},getDefaultProps:function(){return{info:!1,wide:!1}},render:function(){var e=this.props,t=e.classes,n=e.info,i=e.wide,a=(0,o["default"])(e,["classes","info","wide"]),r=l("drawer-body",t,{"drawer-body-info":n,"drawer-body-wide":i});return c.createElement("div",(0,s["default"])({className:r},a),this.props.children)}});e.exports=u},function(e,t,n){"use strict";var i=n(6),a=n(435),s=n(45),r=n(1358),o=r.MenuBar,c=n(104),l={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},u=i.createClass({displayName:"DrawerHeader",propTypes:{children:i.PropTypes.node,title:i.PropTypes.string,onBack:i.PropTypes.func,onCancel:i.PropTypes.func,a8n:i.PropTypes.string,type:i.PropTypes.oneOf(_.values(l)).isRequired,menu:i.PropTypes.element},render:function(){var e=this.props,t=e.title,n=e.onBack,r=e.onCancel,u=e.type,d=e.children,p=null;if(t){var h=void 0,f=null,m={textAlign:"initial"};u===l.SMALL?(h={fontWeight:400,fontSize:16,lineHeight:"21px"},m.width=54):u===l.LARGE?(h={fontWeight:500,fontSize:19,lineHeight:"normal"},f={backgroundColor:"transparent",padding:"0px"},m.width=54):(h={fontWeight:500,fontSize:19,lineHeight:"19px"},m.width=48,m.opacity=.7);var g=s("icon btn-close-drawer",{"icon-back":u===l.SMALL,"icon-back-light":u!==l.SMALL}),v=n?i.createElement("span",{className:g,"data-a8n":a.key("btn-closer-drawer"),onClick:n}):null,y=s("icon btn-close-drawer",{"icon-x":u===l.SMALL,"icon-x-light":u!==l.SMALL}),E=r?i.createElement("span",{className:y,"data-a8n":a.key("btn-closer-drawer"),onClick:r}):null,_=s({"pane-header":u===l.LARGE},"drawer-title"),b=this.props.menu?i.createElement("span",{className:"pane-list-controls"},i.createElement(o,{key:"drawer-header"},i.createElement(c,{transitionName:"btn"},this.props.menu))):null;p=i.createElement("div",{className:_,style:f},i.createElement("div",{style:m,className:"drawer-title-action"},v,E),i.createElement("span",{"data-a8n":a.key(this.props.a8n),className:"drawer-title-body",style:h},t),b)}var M=s({"drawer-header":u===l.LARGE,"drawer-header-small":u===l.SMALL,"drawer-header-offset":u===l.OFFSET,"drawer-header-popup":u===l.POPUP});return i.createElement("header",{className:M},p,d)}});u.Type=l,e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(14),o={rejectOnUnmount:function(){var e=this;return this._reject?this._reject:(this._reject=new s["default"](function(t,n){e._rejectFn=n}),this._reject["catch"](_.noop),this._isMounted===!1&&this._rejectFn(new r.Unmount),this._reject)},componentWillUnmount:function(){this._isMounted=!1,this._rejectFn&&this._rejectFn(new r.Unmount)}};e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1333),m=i(f),g=n(1390),v=(i(g),n(1326)),y=i(v),E=n(45),_=n(6),b=n(142),M=n(26),C=n(14),S=n(1330),T={SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",AUTO:"AUTO",NONE:"NONE"},w={LOW:"LOW",HIGH:"HIGH"},k=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));n.state={loading:!0},n.onLoad=function(e){n.state.loading&&n.setState({loading:!1}),n.props.onLoad&&n.props.onLoad()},n.onError=function(e){e instanceof C.ServerStatusError&&n.props.profilePicThumb.onError(e.status),n.state.loading&&n.setState({loading:!1})};var i=e.profilePicThumb.imgFull;return i&&S.isCached(i)&&(n.state={loading:!1}),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,n=e.loader,i=this.state.loading,a=E("avatar-image",{"is-loaded":!i}),s=void 0;return n&&i&&(t.stale||t.imgFull)&&(s=_.createElement("div",{className:"avatar-spinner-container"},_.createElement(b,{size:50,stroke:3}))),_.createElement("div",{className:"avatar-body"},_.createElement(m["default"],{src:t.imgFull,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}),s)}}]),t}(_.PureComponent);k.CONCERNS={profilePicThumb:["imgFull","stale"]};var P=(0,y["default"])(k),N=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));n.state={loading:!0},n.onLoad=function(e){n.state.loading&&n.setState({loading:!1}),n.props.onLoad&&n.props.onLoad()},n.onError=function(e){e instanceof C.ServerStatusError&&n.props.profilePicThumb.onError(e.status),n.state.loading&&n.setState({loading:!1})};var i=e.profilePicThumb.img;return i&&S.isCached(i)&&(n.state={loading:!1}),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,n=e.loader,i=this.state.loading,a=E("avatar-image",{"is-loaded":!i}),s=void 0;return n&&i&&(t.stale||t.img)&&(s=_.createElement("div",{className:"avatar-spinner-container"},_.createElement(b,{size:50,stroke:3}))),_.createElement("div",{className:"avatar-body"},_.createElement(m["default"],{src:t.img,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}),s)}}]),t}(_.PureComponent);N.CONCERNS={profilePicThumb:["img","stale"]};var O=(0,y["default"])(N),D=function(e){switch(e){case T.SMALL:return 49;case T.MEDIUM:return 100;case T.LARGE:return 200;case T.NONE:return;default:return e}},x=function(e){var t=e.id,n=e.size,i=e.quality,a=e.className,s=e.loader,r=e.onClick,o=e.onLoad,c=e.quoted;n=n||T.SMALL,i=i||w.LOW;var l={height:D(n),width:D(n)};r&&(l.cursor="pointer");var u=E("avatar",a,{"icon-user-default":M.isUser(t),"icon-user-default-square":M.isUser(t)&&c,"icon-group-default":M.isGroup(t),"icon-broadcast-default":M.isBroadcast(t),"icon-psa-default":M.isPSA(t)}),d=null,p=Store.ProfilePicThumb.get(t);return p&&(d=i===w.HIGH?_.createElement(P,{profilePicThumb:p,loader:s,onLoad:o}):_.createElement(O,{profilePicThumb:p,loader:s,onLoad:o})),_.createElement("div",{className:u,style:l,onClick:r},d)};e.exports=x,e.exports.Size=T,e.exports.Quality=w},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1328),c=n(1309),l=n(8),u=n(26),d=n(45),p=function(e){var t=e.msg,n=e.chat,i=e.displaySelf,a=e.className,s=e.disableClick,p=(n||t.chat).assignedColor(t.sender),h=t.senderObj,f=d("message-author color-"+p,a,{"title-number":!h.name}),m=s?_.noop:function(){Store.Chat.find(t.author).then(function(e){l.openChatFromUnread(e).then(function(t){t&&l.focusChatTextInput(e)})})},g=s?null:"text-clickable",v=void 0;return v=i?r.createElement(c,{text:l10n.t("web_you")}):h.name?r.createElement("span",{className:g,onClick:m},r.createElement(c,{text:h.name})):[r.createElement("span",{className:d("number",g),key:t.id+"-number",onClick:m},u.formattedUser(h.id)),r.createElement("span",{className:d("ellipsify","screen-name",g),key:t.id+"-push-name",onClick:m},r.createElement(c,{className:"screen-name-text",direction:"auto",text:h.notifyName}))],r.createElement("h3",{className:f},r.createElement(o,null,v))};p.shouldRender=function(e){return!e.isSentByMe&&e.isGroupMsg},p.propTypes={msg:r.PropTypes.instanceOf(s["default"]).isRequired,displaySelf:r.PropTypes.bool,disableClick:r.PropTypes.bool,className:r.PropTypes.string},e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1328),c=n(1533),l=n(45),u=n(143),d=n(8),p=n(139),h=r.createClass({displayName:"Meta",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},openInfoDrawer:function(){d.msgInfoDrawer(this.props.msg)},render:function(){var e,t,n=this.props.msg,i=n.broadcast||n.star?(n.type===s["default"].TYPE.IMAGE||n.type===s["default"].TYPE.VIDEO||n.type===s["default"].TYPE.AUDIO)&&!n.caption:null;if(n.broadcast){var a=l("icon-s",{"icon-broadcast-light":i,"icon-broadcast":!i});e=r.createElement("span",{className:a})}if(n.star){var d=l("icon-s",{"icon-star-light":i,"icon-star":!i&&n.isSentByMe,"icon-star-in":!i&&!n.isSentByMe});t=r.createElement("span",{className:d})}var h=n.isSentByMe?r.createElement(c,{msg:this.props.msg}):null,f=n.isSentByMe&&p.supportsFeature(p.F.MESSAGE_INFO);return r.createElement("div",{className:f?"message-meta text-clickable":"message-meta",onClick:f?this.openInfoDrawer:null},t,e,r.createElement(o,null,r.createElement("span",{className:"message-datetime"},n.t?u.timestampStr(n.t):null)),h)}});e.exports=h},function(e,t,n){"use strict";var i=n(145),a=n(1386),s=(0,i.defineState)("Media",{extraProperties:"reject",props:{type:{type:"string",values:_.values(a.OUTWARD_TYPES),"default":a.OUTWARD_TYPES.UNKNOWN},mmsUrl:"string",mediaBlob:"object",encryptionKey:"string",uploadHash:"string",mediaStage:{type:"string",values:_.values(a.STAGE),"default":a.STAGE.INIT},size:"number",filehash:"string",mimetype:"string",renderableUrl:"string",thumbHeight:"number",thumbWidth:"number",fullHeight:"number",fullWidth:"number",preview:"string",sidecar:"object",duration:"string",isGif:"boolean",gifAttribution:"number",streamable:{type:"boolean","default":!1},filename:"string",pageCount:"number"}}),r=s.Media,o=s.MediaProxy;r.Proxy=o,r.TYPE=a.OUTWARD_TYPES,r.STAGE=a.STAGE,r.FIELDS_TO_MSG_PROPS=a.FIELDS_TO_MSG_PROPS,e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(6),o=n(38),c=n(435),l=n(141),u=n(45),d=n(83),p=r.createClass({displayName:"MenuItem",mixins:[l],propTypes:{children:r.PropTypes.node.isRequired,a8n:r.PropTypes.string.isRequired,action:r.PropTypes.func,tooltip:r.PropTypes.node,filePickerMimes:r.PropTypes.string,onFilePick:r.PropTypes.func},getInitialState:function(){return{hover:!1,focus:!1}},componentWillMount:function(){this.props.filePickerMimes&&this.regNativeListener(window,"focus",this.onWindowFocus)},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},onFocus:function(){this.setState({focus:!0})},onBlur:function(){this.setState({focus:!1})},preventDefault:function(e){e.preventDefault()},onAction:function(e){if(e.isTrusted&&!e.repeat){var t=this.props,n=t.action,i=t.filePickerMimes;if(n){var a=n(e);if(i)return void(this.active=!0);var s=this.context.uim;s&&(a===!1&&s.pop(!1,!1),s.uie.requestDismiss())}}},triggerInput:function(){o.findDOMNode(this.refs.filePicker).click()},onWindowFocus:function(e){this.active&&this.onFilePick()},onFilePick:function(e){if(this.props.onFilePick){this.props.onFilePick(e);var t=this.context.uim;t&&t.uie.requestDismiss()}},render:function(){var e=this.props,t=e.children,n=e.tooltip,i=e.filePickerMimes,a=this.state,o=a.hover,l=a.focus;n=(o||l)&&n?n:null;var d={enter:this.onAction},p=u("menu-item menu-shortcut",{"highlighted-menu-item":o||l}),f=void 0;return i&&(f=r.createElement(h,{mime:i,ref:"filePicker",onPick:this.onFilePick})),_.isString(t)&&(t=r.createElement("a",{className:"ellipsify",title:t},t)),r.createElement(s["default"],{component:"li",className:p,handlers:d,"data-a8n":c.key(this.props.a8n),onContextMenu:this.preventDefault,onMouseDown:this.preventDefault,onClick:this.onAction,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur},t,n,f)}});p.contextTypes={uim:r.PropTypes.instanceOf(d)};var h=r.createClass({displayName:"FilePicker",propTypes:{mime:r.PropTypes.string.isRequired,multiple:r.PropTypes.bool,onPick:r.PropTypes.func.isRequired},getDefaultProps:function(){return{multiple:!0}},render:function(){return r.createElement("input",{accept:this.props.mime,type:"file",multiple:this.props.multiple,style:{display:"none"},onClick:function(e){return e.stopPropagation()},onChange:this.props.onPick})}});e.exports=p},function(e,t,n){"use strict";function i(e,t){this.list=e,this.selected=_.reduce(e,function(e,t,n){return e[n]=!1,e},{}),this.getter=t||function(e){return e}}var a=n(53);_.assign(i.prototype,a,{init:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];if(!_.isEmpty(this.selected)){if(_.isEmpty(t))return void this.unsetAll();var n=_.reduce(t,function(t,n,i){var a=e.list.indexOf(n);t[i]=a>-1&&e.selected[a]},{});this.selected=n,this.list=t}},unsetAll:function(){var e=this;_.forEach(this.selected,function(t,n){t&&e.set(n,!1)})},reset:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]||arguments[0];_.forEach(this.selected,function(n,i){n&&e.trigger(e.getter(e.list[i]),!0,!0,t)})},set:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];if(this.list.length){var i=Math.min(Math.max(e,-1),this.list.length-1),a=i>-1?this.list[i]:void 0;a&&(this.selected[i]&&!t||!this.selected[i]&&t)&&(this.selected[i]=t,this.trigger(this.getter(a),t,n))}},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2],i=_.indexOf(this.list,e);i===-1&&(i=this.list.length,this.list.push(e),this.selected[i]=!1),this.set(i,t,n)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(0,!0,e)},setLast:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.list.length-1,!0,e)},getSelected:function(){var e=this;return _.reduce(this.list,function(t,n,i){return e.selected[i]&&t.push(n),t},[])},isSelected:function(e){return!!this.selected[this.list.indexOf(e)]}}),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(142),u=n(45),d=n(1309),p=function(e){var t=e.className,n=u("empty-icon",t);return c.createElement("div",{className:"empty-icon-container"},c.createElement("span",{className:n}))},h=function(e){var t=e.icon,n=e.title,i=e.text,a=e.className,r=e.children,l=(0,o["default"])(e,["icon","title","text","className","children"]),p=n?c.createElement("div",{className:"empty-title"},n):null,h=i?c.createElement(d,{element:"div",className:"empty-text",text:i}):null,f=u("empty",a);return c.createElement("div",(0,s["default"])({className:f},l),t,p,h,r)},f=function(){var e=c.createElement(p,{className:"icon-empty-blocked"});return c.createElement(h,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},m=function(){var e=c.createElement(p,{className:"icon-empty-archived"});return c.createElement(h,{icon:e,title:l10n.t("archived_empty")})},g=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},v=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("searching_chats_contacts_messages")})},y=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("searching_messages")})},E=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_contacts")})},_=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_groups")})},b=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_messages")})},M=function(){return c.createElement(h,{text:l10n.t("no_chats")})},C=function(){return c.createElement(h,{text:l10n.t("no_contacts")})},S=function(){return c.createElement(h,{text:l10n.t("no_groups")})},T=function(e){return c.createElement(h,{className:"empty-top",text:l10n.t("chat_search_prompt",{chatName:e})})},w=function(){return c.createElement(h,{text:l10n.t("all_chats_archived")})},k=function(){return c.createElement(h,{text:l10n.t("no_starred_messages")})},P=function(){return c.createElement(h,{text:l10n.t("no_media")})},N=function(){return c.createElement(h,{text:l10n.t("no_links")})},O=function(){return c.createElement(h,{text:l10n.t("no_docs")})},D=function(){return c.createElement(h,null,c.createElement(l,{size:50,stroke:4}))};e.exports={Blocked:f,Archived:m,Search:g,SearchContacts:E,SearchGroups:_,SearchMessages:b,ListChats:M,ListContacts:C,ListGroups:S,AllArchived:w,StarredMsgs:k,MediaMsgs:P,LinkMsgs:N,DocMsgs:O,Loading:D,Searching:v,SearchingMessages:y,BeforeSearchMessages:T}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1640),m=i(f),g=n(6),v=n(38),y=n(45),E=n(8),_=n(31),b=n(1329),M=n(1492),C=72,S="data-list-scroll-container",T="data-list-scroll-offset",w=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));return e.scrollTop=0,e.offsetTop=0,e.bodyHeight=0,e.pointerEvents=!0,e.enablePointerEvents=_.debounce(function(){E.setUiBusy(!1),e.pointerEvents=!1,v.findDOMNode(e.refs.viewport).style.pointerEvents="auto",e.props.onPointerEventsOn&&e.props.onPointerEventsOn()},150),e.onScroll=function(){e.animationFrame||(e.animationFrame=window.requestAnimationFrame(e._onScroll))},e._onScroll=function(){var t=e.state.scrollTarget;e.disablePointerEvents(),t&&(e.scrollTop=t.scrollTop);var n=e.getPhysicalIndexes(e.props),i=n.firstPhysicalIndex,a=n.lastPhysicalIndex,s=void 0;for(s=i;s<a;s++){var r=e.props.data[s].key;if(!e.renderedItems[r])break}return s===a?e.animationFrame=void 0:void e.setState({firstPhysicalIndex:i,lastPhysicalIndex:a,renderVisible:!1},function(){e.animationFrame=void 0})},e.state={scrollTarget:void 0,firstVisibleIndex:0,firstPhysicalIndex:0,lastPhysicalIndex:0,renderVisible:!0},e}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillReceiveProps",value:function(e){_.isNumber(e.scrollTop)&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget===e.scrollTarget&&this.props.height===e.height&&this.props.data.length===e.data.length||this.initialize(e)}},{key:"componentDidMount",value:function(){var e=this;this.props.addListenerAndRun(window,"resize",function(){return e.initialize()})}},{key:"componentWillUnmount",value:function(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame),this.enablePointerEvents.cancel()}},{key:"initialize",value:function(e){var t=e?e:this.props;if(this.state.scrollTarget){var n=m["default"]?{passive:!0}:void 0;this.props.removeListener(this.state.scrollTarget,"scroll",this.onScroll,n)}for(var i=v.findDOMNode(this),a=void 0,s=i,r=0;r<5;r++){if(s.hasAttribute(S)){a=s;break}s=s.parentNode}var o=void 0;s=i;for(var c=0;c<r;c++){if(s.hasAttribute(T)){o=s;break}s=s.parentNode}if(!a)throw new Error("list scroll container not found");var l=m["default"]?{passive:!0}:void 0;this.props.addListener(a,"scroll",this.onScroll,l),this.scrollTop=a.scrollTop,this.offsetTop=o?o.offsetTop:0,this.bodyHeight=a.clientHeight;var u=this.getPhysicalIndexes(t),d=u.firstPhysicalIndex,p=u.lastPhysicalIndex;return this.setState({scrollTarget:a,firstPhysicalIndex:d,lastPhysicalIndex:p,renderVisible:!0}),this.renderedItems={},a}},{key:"getFirstVisibleIndex",value:function(e){return Math.floor(Math.max(this.scrollTop-this.offsetTop,0)/e)}},{key:"getPhysicalIndexes",value:function(e){var t=this.getFirstVisibleIndex(e.height),n=Math.max(this.offsetTop-this.scrollTop,0),i=Math.max(this.bodyHeight-n,0),a=Math.min(Math.ceil(i/e.height),e.data.length),s=Math.max(t-e.extraItems,0),r=Math.min(t+a+e.extraItems,e.data.length);return{firstPhysicalIndex:s,lastPhysicalIndex:r}}},{key:"disablePointerEvents",value:function(){this.enablePointerEvents(),this.pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),v.findDOMNode(this.refs.viewport).style.pointerEvents="none",E.setUiBusy(!0),this.pointerEvents=!0)}},{key:"getComponents",value:function(){var e=this,t=this.props,n=t.height,i=t.data,a=this.state,s=a.firstPhysicalIndex,r=a.lastPhysicalIndex,o={},c=_.chain(i).forEach(function(e,t){o[e.key]=t}).slice(s,r).forEach(function(t){e.renderedItems[t.key]=t}).value(),l=this.state.renderVisible?c:this.renderedItems;return _.sortBy(l,"key").map(function(e){return g.createElement(M,{key:e.key,rowHeight:n,className:0===o[e.key]?"first":void 0,zIndex:i.length-o[e.key]-1,rowNumber:o[e.key]},e)})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.height,i=e.className,a=e.animate,s={container:{},viewport:{height:t.length*n}},r={container:y("infinite-list",i,{"infinite-list-animate":a&&!this.animationFrame}),viewport:"infinite-list-viewport"};return g.createElement("div",{className:r.container,style:s.container},g.createElement("div",{className:r.viewport,ref:"viewport",style:s.viewport},this.getComponents()))}}]),t}(g.Component);w.defaultProps={scrollTarget:null,data:null,height:C,extraItems:30},w.DEFAULT_HEIGHT=C,w.SCROLL_ATTR=S,w.SCROLL_OFFSET_ATTR=T;t.Component=w;t["default"]=b(w)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return++m}var s=n(431),r=i(s),o=n(1),c=n(6),l=n(45),u=n(104),d=n(83),p=n(216),h={DEFAULT_PUSH:"flow-transition-drawer-push",DEFAULT_POP:"flow-transition-drawer-pop",NONE:"none"},f={PUSH:"push",POP:"pop"},m=0,g={getInitialState:function(){return{_stack:[],_activeKey:void 0,_transition:void 0}},defaultTransition:function(e){var t,n=_.isFunction(this.getDefaultTransition)?this.getDefaultTransition():{};return _.assign((t={},(0,r["default"])(t,f.PUSH,h.DEFAULT_PUSH),(0,r["default"])(t,f.POP,h.DEFAULT_POP),t),n)[e]},push:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.defaultTransition(f.PUSH):arguments[1],n=this.state._stack.concat(e),i=a();this.setState({_stack:n,_transition:t,_activeKey:i})},pop:function(){var e=arguments.length<=0||void 0===arguments[0]?this.defaultTransition(f.POP):arguments[0],t=_.dropRight(this.state._stack);if(t.length){var n=a();this.setState({_stack:t,_transition:e,_activeKey:n})}else this.endFlow()},endFlow:function(e){this.context.uim.uie.requestDismiss(e)},render:function(){var e=this,t=this.state,n=t._stack,i=t._transition,a=t._activeKey,s=_.last(n);o.assert(!!s,"empty-flow",s)(),s=c.createElement(p,{displayName:"FlowDrawer"+a,key:a,escapable:!0,requestDismiss:function(){return e.pop()}},s);var r=l("flow-drawer-container");return c.createElement(u,{transitionName:i,className:r},s)}};g.Transition=h,g.Dir=f,g.contextTypes={uim:c.PropTypes.instanceOf(d)},e.exports=g},function(e,t,n){"use strict";function i(e,t){this.list=e,this.index=-1,this.value=void 0,this.getter=t||function(e){return e}}var a=n(53);_.assign(i.prototype,a,{init:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=void 0,i=void 0;if(this.list=e,this.value){if(_.isEmpty(e))return void this.unset();if(n=_.indexOf(e,this.value),n>-1){if(n===this.index)return;i=!0,t=!1}else n=t&&this.index>-1?Math.min(Math.max(this.index,0),e.length-1):-1,i=n>-1;this.set(n,t,i)}},unset:function(){this.value&&this.trigger(this.getter(this.value),!1),this.value=void 0,this.index=-1},reset:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];this.index<0||this.value&&this.trigger(this.getter(this.value),"focus",e)},set:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];if(this.list.length){var i=Math.min(Math.max(e,-1),this.list.length-1),a=this.value,s=i>-1?this.list[i]:void 0;s?(this.trigger(this.getter(s),t?"focus":"select"),this.value=s):n&&(this.value=void 0),n&&a&&a!==s&&this.trigger(this.getter(a),!1),this.index=i}},getVal:function(){return this.value},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=_.indexOf(this.list,e);n>-1?this.set(n,t):(this.unset(),this.value=e)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(0,e)},setLast:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.list.length-1,e)},setPrev:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:this.index===-1?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){n?"function"==typeof n._getComponent?t[e]=n._getComponent():t[e]=n:t[e]=void 0}}Object.defineProperty(t,"__esModule",{value:!0}),t.HOCRef=void 0;var s=n(37),r=i(s),o=n(23),c=i(o),l=n(25),u=i(l),d=n(81),p=i(d),h=n(80),f=i(h);t.GetRef=a;var m=n(6),g=(t.HOCRef="component",function(e){function t(){return(0,c["default"])(this,t),(0,p["default"])(this,(0,r["default"])(t).apply(this,arguments))}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"_getComponent",value:function(){var e=this.refs.component;return"function"==typeof e._getComponent?e._getComponent():e}}]),t}(m.Component));t["default"]=g},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){var n={};return(0,k["default"])(e).forEach(function(i){function a(e){s.call(this,e)}var s=r(i);if(!s)throw new Error("Attempting to generate whitelisted proxy for: "+i+". Check the ProxyStates file for definitions.");var o={};e[i].forEach(function(e){o[e]={enumerable:!0,get:function(){return this._ProxyState$state.get(e)},set:function(t){this._ProxyState$state.set(e,t)}}}),o._ProxyState$ComponentName={get:function(){return t}},a.prototype=(0,T["default"])(s.prototype,o),a.prototype.constructor=a,n[i]=a}),n}function r(e){return I[""+e[0].toUpperCase()+e.slice(1)+"Proxy"]}function o(e,t){return t instanceof r(e)?t._ProxyState$state:t}Object.defineProperty(t,"__esModule",{value:!0});var c=n(431),l=a(c),u=n(430),d=a(u),p=n(37),h=a(p),f=n(23),m=a(f),g=n(25),v=a(g),y=n(81),E=a(y),_=n(80),b=a(_),M=n(221),C=a(M),S=n(68),T=a(S),w=n(32),k=a(w),P=n(6),N=a(P),O=n(1325),D=a(O),x=n(145),R=a(x),A=n(1616),I=i(A);t["default"]=function(e){var t,n,i,a=e.CONCERNS,r=e.WEAK_CONCERNS,c=(0,C["default"])({},r,a),u=e.name,p=s(c,u);return n=t=function(t){function n(e){(0,m["default"])(this,n);var t=(0,E["default"])(this,(0,h["default"])(n).call(this,e));return i.call(t),(0,k["default"])(c).forEach(function(e){t.state[e]=t.createConcern(e,t.props)}),t}return(0,b["default"])(n,t),(0,v["default"])(n,[{key:"componentWillReceiveProps",value:function(e){var t=this,n={};(0,k["default"])(c).forEach(function(i){t.props[i]!==e[i]&&(t.destroyConcern(i,t.props),n[i]=t.createConcern(i,e))}),(0,k["default"])(n).length&&this.setState(n)}},{key:"componentWillUnmount",value:function(){var e=this;(0,k["default"])(c).forEach(function(t){e.destroyConcern(t)})}},{key:"createConcern",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?this.props:arguments[1],i=o(e,n[e]),s=c[e];if(!i)throw new Error("Attempting to create ProxyState: "+e+" without the backing model. Check the props of "+u+".");if(!(i instanceof R["default"]))throw new Error("Attempting to create ProxyState: "+e+" with an invlaid object: "+i+". Check the props of "+u+".");var l=!a[e]&&!!r[e];return i.incObservers(l),this.concerns[e]=this.rr.bind(this,e),s.forEach(function(n){i.on("change:"+n,t.concerns[e])}),new p[e](i)}},{key:"render",value:function(){return N["default"].createElement(e,(0,d["default"])({ref:O.HOCRef},this.props,this.state))}}]),n}(D["default"]),i=function(){var e=this;this.state={},this.concerns={},this.rr=function(t,n){e.setState((0,l["default"])({},t,new p[t](n)))},this.destroyConcern=function(t){var n=arguments.length<=1||void 0===arguments[1]?e.props:arguments[1],i=o(t,n[t]),a=c[t];if(!i)throw new Error("Attempting to destroy ProxyState: "+t+" without the backing model. Check the props of "+u+".");if(!(i instanceof R["default"]))throw new Error("Attempting to destroy ProxyState: "+t+" with an invlaid object: "+i+". Check the props of "+u+".");i.decObservers(),a.forEach(function(n){i.off("change:"+n,e.concerns[t]),delete e.concerns[t]})}},n}},function(e,t,n){"use strict";function i(e){var t,n,i="";switch(e.subtype){case"identity":t=Store.Contact.get(e.body),n=t?t.formattedName:m.formattedUser(e.body),i=l10n.t("web_security_code_change",{name:n});break;case"encrypt":var a=e.id.remote;i=m.isGroup(a)?l10n.t("web_group_info_encrypted"):m.isBroadcast(a)?l10n.t("web_broadcast_info_encrypted"):l10n.t("web_contact_info_encrypted")}return i}function a(e,t){var n="";switch(e.subtype){case"miss":n=t?l10n.t("web_missed_voice_call_system_message",{time:f.timestampStr(e.t)}):l10n.t("web_missed_voice_call_chatlist");break;case"miss_video":n=t?l10n.t("web_missed_video_call_system_message",{time:f.timestampStr(e.t)}):l10n.t("web_missed_video_call_chatlist")}return n}function s(e,t){var n,i,a="";if("create"===e){var s=parseInt(t,10);a=l10n.t("web_you_created_list_unnamed",{count:s,_plural:s})}else"add"===e?(n=Store.Contact.get(t),i=n?n.get("name"):"",i=i?i:m.formattedUser(t),a=l10n.t("web_list_recipient_added",{name:i})):"remove"===e&&(n=Store.Contact.get(t),i=n?n.get("name"):"",i=i?i:m.formattedUser(t),a=l10n.t("web_list_recipient_removed",{name:i}));return a}function r(e){var t,n,i="",a=e.get("type"),s=e.get("subtype"),r=e.displayName(),o=e.get("author"),c=e.get("body");if("group_notification"===a)switch(s){case"add":i=o===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:r});break;case"remove":i=o===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:r});break;case"leave":i=o===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:r});break;case"picture":i="remove"===c?o===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:r}):o===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:r});break;case"subject":i=o===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:c}):l10n.t("web_group_subject_changed_by_name",{name:r,subject:c});break;case"modify":t=m.formattedUser(e.get("author")),n=m.formattedUser(c),i=t===r?l10n.t("web_group_participant_changed_number_unknown_name",{name:r,new_number:n}):l10n.t("web_group_participant_changed_number",{name:r,old_number:t,new_number:n});break;default:p.log("wa:formatGroupNotification:unknown message subtype: "+s)()}else if("gp2"===a){var l,u=e.recipients,d=u?u.map(function(e){var t=Store.Contact.get(e);return t?t.get("formattedName"):m.formattedUser(e)}).join(l10n.t("enumeration_comma")):"",h=u?_.head(u):"",f=Store.Contact.get(h),g=f?f.get("formattedName"):h?m.formattedUser(h):"";switch(s){case"add":i=o?o===Store.Conn.me?l10n.t("web_group_participants_you_added_names",{participants:d}):h===Store.Conn.me?l10n.t("web_group_participants_name_added_you",{name:r}):l10n.t("web_group_participants_name_added_names",{name:r,participants:d}):h===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:g});break;case"remove":i=o?o===Store.Conn.me?l10n.t("web_group_participants_you_removed_names",{participants:d}):h===Store.Conn.me?l10n.t("web_group_participants_name_removed_you",{name:r}):l10n.t("web_group_participants_name_removed_names",{name:r,participants:d}):h===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:g});break;case"leave":i=h===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:d});break;case"picture":i="remove"===c?o===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:r}):o===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{
name:r});break;case"subject":i=o===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:c}):l10n.t("web_group_subject_changed_by_name",{name:r,subject:c});break;case"modify":t=m.formattedUser(o),n=m.formattedUser(h),i=t===r?l10n.t("web_group_participant_changed_number_unknown_name",{name:r,new_number:n}):l10n.t("web_group_participant_changed_number",{name:r,old_number:t,new_number:n});break;case"create":i=o===Store.Conn.me?c?l10n.t("web_group_created_by_you",{subject:c}):l10n.t("web_group_created_by_you_no_subject"):c?l10n.t("web_group_created_by_name",{name:r,subject:c}):l10n.t("web_group_created_by_name_no_subject",{name:r});break;case"delete":i=o===Store.Conn.me?l10n.t("web_group_ended_you"):l10n.t("web_group_ended_name",{name:r});break;case"promote":l=u.length,i=1===l&&h===Store.Conn.me?l10n.t("web_group_participant_promoted_you"):l10n.t("web_group_participant_promoted_names",{count:l,participants:d,_plural:l});break;case"demote":l=u.length,i=1===l&&h===Store.Conn.me?l10n.t("web_group_participant_demoted_you"):l10n.t("web_group_participant_demoted_names",{count:l,participants:d,_plural:l});break;case"invite":i=h===Store.Conn.me?l10n.t("web_group_participant_join_via_invite_you"):l10n.t("web_group_participant_join_via_invite_name",{name:g});break;default:p.log("wa:formatGroupNotification:unknown message subtype: "+s)()}}return l10n.isRTL()&&(i=l10n.forceRTL(i)),i}function o(e,t){var n=e.mentionMap();if(n){var i=d.supportsFeature(d.F.RICH_TEXT)?[].concat(N,[new T(n)]):[new T(n)],a=g.parse(t,i);return g.serialize(a,new v)}return c(t)}function c(e){if(!d.supportsFeature(d.F.RICH_TEXT))return e;var t=g.parse(e,N);return g.serialize(t,new v)}var l=n(10),u=n(1368),d=n(139),p=n(1),h=n(85),f=n(143),m=n(26),g=n(1459),v=n(1635),y=n(1373),E=n(1394),b=n(1398),M=n(1393),C=n(1397),S=n(1632),T=n(1395),w=n(1634),k=n(1456),P=l.MSG_TYPE,N=[new y,new E,new b,new M,new C];e.exports={formatBroadcastNotification:s,formatGroupNotification:r,formatE2ENotification:i,formatCallLog:a,asDesktopNotification:function(e){var t,n,c,l,d="",m=e.dir,g=Store.Mute.getGlobalPreviews();switch(e.from!==Store.Conn.me&&e.isGroupMsg&&(d=e.displayName()),e.type){case P.CHAT:if(g)t=o(e,e.body);else if(e.isGroupMsg)t=d?l10n.t("hidden_group_message_text_with_author",{author:d}):l10n.t("hidden_group_message_text"),d="";else{var v=e.chat;t=l10n.t("hidden_message_text",{unreadCount:l10n.n(v.unreadCount),_plural:v.unreadCount})}break;case P.IMAGE:c=h.hasEmoji?"📷 ":"",t=c+(g&&e.caption||l10n.t("web_conversations_most_recent_image"));break;case P.VIDEO:e.isGif?(c=h.hasEmoji?"👾 ":"",l=g&&e.caption||"GIF"):(c=h.hasEmoji?"🎥 ":"",l=g&&e.caption||l10n.t("web_conversations_most_recent_video"),l=l+" ("+f.durationStr(e.duration)+")"),t=c+" "+l;break;case P.PTT:c=h.hasEmoji?"🎤 ":"",t=c+" "+l10n.t("web_conversations_most_recent_voice")+" ("+f.durationStr(e.duration)+")";break;case P.AUDIO:c=h.hasEmoji?"🎵 ":"",t=c+" "+l10n.t("web_conversations_most_recent_audio")+" ("+f.durationStr(e.duration)+")";break;case P.LOCATION:c=h.hasEmoji?"📍 ":"",t=c+(g&&e.loc||l10n.t("web_conversations_most_recent_location"));break;case P.GROUP_NOTIFICATION:case P.GP2:t=r(e),d="";break;case P.BROADCAST_NOTIFICATION:n=e.subtype;var y=e.body;t=s(n,y);break;case P.NOTIFICATION:t=e.body;break;case P.VCARD:c=h.hasEmoji?"👤 ":"",t=c+(e.subtype||l10n.t("web_conversations_most_recent_contact"));break;case P.MULTI_VCARD:c=h.hasEmoji?"👥 ":"",t=c+k.getNameString(e.vcardList);break;case P.DOCUMENT:c=h.hasEmoji?"📄 ":"",t=c+(e.subtype||l10n.t("web_conversations_most_recent_file"));break;case P.E2E_NOTIFICATION:t=i(e);break;case P.CALL_LOG:t=a(e,!1);break;case P.CIPHERTEXT:t=l10n.t("placeholder_msg");break;case P.REVOKED:t=l10n.t("revoked_msg");break;case P.UNKNOWN:t=l10n.t("unsupported_msg");break;default:return p.error("asDesktopNotification: Unrecognized type "+e.type)(),""}var E=l10n.isRTL()?"rtl":"ltr",_="";if(_=f.relativeStr(e.t),d){var b=u.dir(d);return"ltr"!==E||m&&"ltr"!==m||b&&"ltr"!==b?"ltr"!==E||m&&"ltr"!==m?"ltr"!==E||b&&"ltr"!==b?"ltr"===E?(_&&(_="- ‪"+_+"‬‬"),"‫"+d+"‏: "+t+"‏"+_):m&&"rtl"!==m||b&&"rtl"!==b?m&&"rtl"!==m?b&&"rtl"!==b?(_&&(_="- ‪"+_+"‬‬"),"‪"+d+"‎: "+t+"‎"+_):(_&&(_=" - "+_),d+"‏: ‪"+t+"‬‏"):(_&&(_=" - "+_),"‏‪"+d+"‬: "+t+"‏"):(_&&(_=" - "+_),d+"‏: "+t+"‏"):(_&&(_=" - "+_),d+"‎: ‫"+t+"‬‎"):(_&&(_=" - "+_),"‎‫"+d+"‬: "+t+"‎"):(_&&(_=" - "+_),d+"‎: "+t+"‎")}return _?"ltr"===E?t+"‎‏ - ‪"+_+"‬":t+"‏‎ - ‫"+_+"‬":t},msgText:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1];switch(e.type){case P.CIPHERTEXT:return l10n.t("placeholder_msg");case P.REVOKED:return l10n.t("revoked_msg");case P.CHAT:return t?o(e,e.body):e.body;case P.IMAGE:return e.caption?t?o(e,e.caption):e.caption:l10n.t("web_conversations_most_recent_image");case P.VIDEO:return e.caption?t?o(e,e.caption):e.caption:e.isGif?"GIF":l10n.t("web_conversations_most_recent_video");case P.PTT:var n=f.durationStr(e.duration);return n?n:l10n.t("web_conversations_most_recent_voice");case P.AUDIO:return l10n.t("web_conversations_most_recent_audio");case P.LOCATION:return e.loc||l10n.t("web_conversations_most_recent_location");case P.GROUP_NOTIFICATION:case P.GP2:return r(e);case P.BROADCAST_NOTIFICATION:return s(e.subtype,e.body);case P.NOTIFICATION:return e.body;case P.VCARD:return e.subtype||l10n.t("web_conversations_most_recent_contact");case P.MULTI_VCARD:return k.getNameString(e.vcardList);case P.DOCUMENT:var c=e.pageCount>0?l10n.t("web_conversations_most_recent_document",{count:e.pageCount+"",_plural:e.pageCount}):null;return _.compact([e.caption||e.filename||l10n.t("web_conversations_most_recent_file"),c]).join(" • ");case P.E2E_NOTIFICATION:return i(e);case P.CALL_LOG:return a(e,!1);case P.UNKNOWN:return l10n.t("unsupported_msg");default:return""}},emojify:function(e){if(!d.supportsFeature(d.F.RICH_TEXT))return e;var t=[new y,new S((!0))],n=g.parse(e,t);return g.serialize(n,new w)}}},function(e,t,n){"use strict";var i=n(6),a=i.createClass({displayName:"HiddenToken",propTypes:{children:i.PropTypes.node.isRequired},render:function(){return i.createElement("span",{className:"hidden-token"},"⁠⁠⁠⁠",this.props.children,"⁠⁠⁠⁠⁠")}});e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(6),v=i(g),y=n(1325),E=i(y),_=n(31),b=i(_),M=n(219),C=i(M),S=n(1),T=i(S),w=n(8),k=i(w);e.exports=function(e){var t,n,i;return n=t=function(t){function n(){var e,t,a,s;(0,l["default"])(this,n);for(var r=arguments.length,c=Array(r),u=0;u<r;u++)c[u]=arguments[u];return t=a=(0,h["default"])(this,(e=(0,o["default"])(n)).call.apply(e,[this].concat(c))),i.call(a),s=t,(0,h["default"])(a,s)}return(0,m["default"])(n,t),(0,d["default"])(n,[{key:"componentDidMount",value:function(){var e=this;this.mounted=!0;var t=this.listeners;this.listeners=[],t.forEach(function(t){e._addListener(t.source,t.event,t.cb,t.capture,t.wrapped)})}},{key:"componentWillUnmount",value:function(){var e=this;this.mounted=!1,this.listeners.forEach(function(t){e._removeListener(t.source,t.event,t.cb,t.capture,t.wrapped)}),this.listeners=[]}},{key:"render",value:function(){return v["default"].createElement(e,(0,s["default"])({ref:y.HOCRef,addListener:this.addListener,addListenerOnce:this.addListenerOnce,addListenerAndRun:this.addListenerAndRun,removeListener:this.removeListener,uiIdle:this.uiIdle},this.props))}},{key:"listeners",get:function(){return this._listeners||(this._listeners=[]),this._listeners},set:function(e){this._listeners=e}}]),n}(E["default"]),i=function(){var e=this;this.mounted=!1,this.rr=function(){e.setState({})},this._addListener=function(t,n){var i=arguments.length<=2||void 0===arguments[2]?e.rr:arguments[2],a=arguments[3],s=arguments[4];if(e.listeners.push({source:t,event:n,cb:i,capture:a,wrapped:s}),e.mounted){var r=s||i;if("function"==typeof t.on)t.on(n,r),"function"==typeof t.incObservers&&t.incObservers();else{var o=C["default"].prefix(n,t);t.addEventListener(o,r,a)}}},this.addListener=this._addListener,this.addListenerAndRun=function(t,n){var i=arguments.length<=2||void 0===arguments[2]?e.rr:arguments[2],a=arguments[3];e.addListener(t,n,i,a),i()},this.addListenerOnce=function(t,n){var i=arguments.length<=2||void 0===arguments[2]?e.rr:arguments[2],a=arguments[3],s=function(){i.apply(void 0,arguments),e.removeListener(t,n,i,a)};e._addListener(t,n,i,a,s)},this.uiIdle=function(t){k["default"].uiBusy?e.addListenerOnce(k["default"],"ui_idle",function(){t()}):t()},this.removeListener=function(t,n){var i=arguments.length<=2||void 0===arguments[2]?e.rr:arguments[2],a=arguments[3],s=b["default"].find(e.listeners,{source:t,event:n,cb:i,capture:a});s?(e.listeners=b["default"].reject(e.listeners,s),e._removeListener(t,n,i,a,s.wrapped)):T["default"].error("ListenerHOC:removeListener could not find event: "+n)()},this._removeListener=function(t,n){var i=arguments.length<=2||void 0===arguments[2]?e.rr:arguments[2],a=arguments[3],s=arguments[4],r=s||i;if("function"==typeof t.off)t.off(n,r),"function"==typeof t.decObservers&&t.decObservers();else{var o=C["default"].prefix(n,t);t.removeEventListener(o,r,a)}}},n}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=t.x||0,i=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180)),e.translate(n,i),e.rotate(t.radians),e.translate(-n,-i)}function s(e,t,n){var i=e.getContext("2d"),a=i.getImageData(0,0,t,n);e.width=t,e.height=n,i.putImageData(a,0,0)}function r(e){var t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)}function o(e,t,n){var i=p.boundHeightWidth(e.height,e.width,n,t),a=i.width,s=i.height;if(a>e.width&&s>e.height)return e;var r=document.createElement("canvas"),o=r.getContext("2d");return r.width=a,r.height=s,o.drawImage(e,0,0,a,s),r}function c(e){var t=new g;return t.writeBytes(255,216,255,224,0,16,74,70,73,70,0),t.writeUint16(e.version),t.writeUint8(e.densityUnits),t.writeUint16(e.xDensity),t.writeUint16(e.yDensity),t.writeBytes(0,0),t.readByteArray()}function l(e,t,n,i,a){if(t>i||n>a)throw new Error("Image is too big and must be resized.");var s=new g(e),r=new g(e),o=new g,l=2,u=2,d=!1,p=!1,h=!1,f=!1,m=void 0,v={version:257,densityUnits:0,xDensity:1,yDensity:1};if(s.readUint8()!==E||s.readUint8()!==b.SOI)throw new Error("SOI marker not at the start of the file.");r.advance(l);for(var y=void 0;y||s.size();){if(void 0===y){var C=s.readUint8();if(C!==E)throw new Error("0x"+C.toString(16)+" is not a marker prefix.");y=s.readUint8()}switch(y){case b.APP0:if(p)m=s.readUint16(),r.advance(m+l),s.advance(s.size()-r.size());else{if(m=s.readUint16(),"JFIF\0"!==s.readString(5))throw new Error("APP0 marker missing 'JFIF' magic bytes.");f=!0,v.version=s.readUint16(),v.densityUnits=s.readUint8(),v.xDensity=s.readUint16(),v.yDensity=s.readUint16(),r.advance(m+l),s.advance(s.size()-r.size()),p=!0}break;case b.SOS:if(!h&&!f)throw new Error("Missing magic bytes marker.");s.advance(s.readUint16()-u);for(var S=void 0,T=void 0,w=s.readUint8();s.size();){if(T=s.readUint8(),S=w===E&&_.indexOf(M,T)===-1){y=T;break}w=T}o.writeByteArray(r.readByteArray(r.size()-s.size()-l));continue;case b.APP1:if(m=s.readUint16(),!h&&"Exif\0\0"!==s.readString(6))throw new Error("APP1 marker missing 'EXIF' magic bytes.");h=!0,r.advance(m+l),s.advance(s.size()-r.size());break;case b.APP13:case b.COM:if(!h&&!f)throw new Error("Missing magic bytes marker.");m=s.readUint16(),r.advance(m+l),s.advance(s.size()-r.size());break;case b.EOI:if(!h&&!f)throw new Error("Missing magic bytes marker.");d=!0,o.writeByteArray(r.readByteArray(l));break;case b.SOF0:case b.SOF1:case b.SOF2:case b.SOF3:case b.SOF5:case b.SOF6:case b.SOF7:case b.SOF9:case b.SOF10:case b.SOF11:case b.SOF13:case b.SOF14:case b.SOF15:case b.DQT:case b.DHT:case b.DRI:if(!h&&!f)throw new Error("Missing magic bytes marker.");m=s.readUint16(),o.writeByteArray(r.readByteArray(l+m)),s.advance(s.size()-r.size());break;case b.APP2:case b.APP3:case b.APP4:case b.APP5:case b.APP6:case b.APP7:case b.APP8:case b.APP9:case b.APP10:case b.APP11:case b.APP12:case b.APP14:case b.APP15:throw new Error("Received unexpected APP marker 0x"+y.toString(16));default:throw new Error("Did not understand marker: 0x"+y.toString(16))}if(y=void 0,d)break}if(!d)throw new Error("No EOI tag found.");var k=c(v);return new Blob([k,o.readByteArray()],{type:"image/jpeg"})}var u=n(2),d=i(u),p=n(1453),h=n(1224),f=n(436),m=n(14),g=n(13),v=n(1),y=n(1455),E=255,b={SOF0:192,SOF1:193,SOF2:194,SOF3:195,DHT:196,SOF5:197,SOF6:198,SOF7:199,SOF9:201,SOF10:202,SOF11:203,SOF13:205,SOF14:206,SOF15:207,RST0:208,RST1:209,RST2:210,RST3:211,RST4:212,RST5:213,RST6:214,RST7:215,SOI:216,EOI:217,SOS:218,DQT:219,DRI:221,APP0:224,APP1:225,APP2:226,APP3:227,APP4:228,APP5:229,APP6:230,APP7:231,APP8:232,APP9:233,APP10:234,APP11:235,APP12:236,APP13:237,APP14:238,APP15:239,COM:254},M=[0,b.RST0,b.RST1,b.RST2,b.RST3,b.RST4,b.RST5,b.RST6,b.RST7],C={DATA_URL:1,BLOB:2,CANVAS:4,generateVideoThumbAndDuration:function(e,t,n){return y.video(e,!0).then(function(e){var i=e.video,a=e.fullWidth,s=e.fullHeight,r=document.createElement("canvas"),o=p.boundHeightWidth(s,a,n,t);r.width=o.width,r.height=o.height;var c=r.getContext("2d");return c.drawImage(i,0,0,o.width,o.height),{duration:~~i.seekable.end(0),thumb:{url:r.toDataURL("image/jpeg"),width:o.width,height:o.height,fullWidth:a,fullHeight:s}}})},crop:function(e,t,n,i,a,s,r){var o=this,c=arguments.length<=7||void 0===arguments[7]?C.DATA_URL:arguments[7],l=e instanceof HTMLCanvasElement?d["default"].resolve(e):y.loadImage(e);return l.then(function(e){var l=document.createElement("canvas"),u=l.getContext("2d");s&&r?(l.height=r,l.width=s,u.drawImage(e,t,n,i,a,0,0,s,r)):(l.height=a,l.width=i,u.drawImage(e,t,n,i,a));var p={};return o.getImagePromises(p,l,c),d["default"].props(p).then(function(e){return{images:e,width:i,height:a}})})},generateLinkPreview:function(e){return y.loadImage(e).then(function(e){var t=100,n=140;if(e.width<t||e.height<t)return null;var i=document.createElement("canvas"),a=i.getContext("2d");i.height=n,i.width=n;var s=Math.min(e.width,e.height),r=(e.width-s)/2,o=(e.height-s)/2;return a.drawImage(e,r,o,s,s,0,0,n,n),i.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")})["catch"](function(){return null})},resizeDataURI:function(e,t,n){return y.loadImage(e).then(function(e){var i=document.createElement("canvas"),a=p.boundHeightWidth(e.height,e.width,n,t);i.width=a.width,i.height=a.height;var s=i.getContext("2d");return s.drawImage(e,0,0,a.width,a.height),i.toDataURL("image/jpeg")})},getImagePromises:function(e,t,n){!e.blob&&n&this.BLOB&&(e.blob=this.canvasToBlob(t)),!e.dataUrl&&n&this.DATA_URL&&(e.dataUrl=d["default"].resolve(t.toDataURL("image/jpeg"))),!e.canvas&&n&this.CANVAS&&(e.canvas=d["default"].resolve(t))},rotateAndResize:function(e,t,n){var i=this,c=arguments.length<=3||void 0===arguments[3]?C.BLOB:arguments[3],u=e instanceof HTMLCanvasElement,m=void 0,g=void 0,E=void 0;return u?(g=d["default"].resolve(e),E=d["default"].resolve(null)):(m=window.URL.createObjectURL(e),g=y.loadImage(m),E=f.blobToArrayBuffer(e)),d["default"].props({buffer:E,image:g}).then(function(e){var u=e.buffer,f=e.image,m={};try{m=h(u)}catch(g){}var y=0;switch(m.orientation||"UNKNOWN"){case"right-top":y=1;break;case"left-bottom":y=-1;break;case"bottom-right":y=2}var E=document.createElement("canvas"),_=f.naturalWidth||f.width,b=f.naturalHeight||f.height,M=E.getContext("2d"),S={};if(y)switch(y){case 1:case-1:var T=Math.max(_,b),w=T/2;E.width=E.height=T,r(E),a(M,{x:w,y:w,degrees:90*y}),1===y?M.drawImage(f,0,T-b):M.drawImage(f,T-_,0),a(M,{x:w,y:w,degrees:y*-90}),s(E,b,_);var k=o(E,t,n);return i.getImagePromises(S,k,c),d["default"].props(S).then(function(e){return{width:k.width,height:k.height,images:e}});case 2:var P=p.boundHeightWidth(b,_,n,t),_=E.width=P.width,b=E.height=P.height;return r(E),a(M,{x:_/2,y:b/2,degrees:90*y}),M.drawImage(f,0,0,_,b),a(M,{x:_/2,y:b/2,degrees:y*-90}),i.getImagePromises(S,E,c),d["default"].props(S).then(function(e){return{width:E.width,height:E.height,images:e}})}else{var N=function(){var e=void 0,a=void 0,s=c&C.BLOB;if(u&&s)try{var o=l(u,_,b,t,n);S.blob=o,s=!1,e=_,a=b}catch(h){v.log("Could not parse JPEG: "+h.message)()}if(s||c&~C.BLOB){var m=p.boundHeightWidth(b,_,n,t);E.width=m.width,E.height=m.height,e=E.width,a=E.height,r(E),M.drawImage(f,0,0,e,a),i.getImagePromises(S,E,c)}return{v:d["default"].props(S).then(function(t){return{width:e,height:a,images:t}})}}();if("object"==typeof N)return N.v}})["finally"](function(){m&&window.URL.revokeObjectURL(m)})},canvasToBlob:function(e){arguments.length<=1||void 0===arguments[1]?"image/jpeg":arguments[1];return e.toBlob?new d["default"](function(t){e.toBlob(t,"image/jpeg")}):d["default"].resolve(window.dataURLtoBlob(e.toDataURL("image/jpeg")))},urlToFile:function(e){var t=this;return y.loadImage(e).then(function(e){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight;var i=n.getContext("2d");return r(n),i.drawImage(e,0,0),t.canvasToBlob(n)})["catch"](function(){return d["default"].reject(new m.MediaDragDropError("unable to render image",e))})},isCached:function(e){if(!e)return!1;var t=new Image;return t.src=e,!!t.complete},loadImage:y.loadImage};e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i){this.type=e,this.index=t,this.value=i,this.properties=n}function s(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function r(e){var t={};return e?(e.split(";").forEach(function(e){var n=e.split(/=/);if(1===n.length){var i=n[0];s(t,i.toLowerCase(),!0)}else if(2===n.length){var a=(0,p["default"])(n,2),r=a[0],o=a[1];s(t,r.toLowerCase(),o.toLowerCase())}}),t):t}function o(e){if(e)return e.replace(/^_\$!<([^>]*)>!\$_$/,"$1").replace(/\\,/,",").replace(/\\;/,";").replace(/\\\\/,"\\")}function c(e){var t={};return _.forEach(e,function(e,n){t[n]=_.sortBy(e,function(e){return e.index})}),t}var l=n(1218),u=i(l),d=n(86),p=i(d),h=n(0),f=n(26),m=/X-([^;:]+)(?:;[^:]+)*:(.+)/,g={"X-ABLabel":[/X-ABLabel(?:;([^:]+))*:(.+)/,1],ADR:[/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/,5],"X-ABADR":[/X-ABADR(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.*)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1],TEL:[/TEL(?:;([^:]+))*:(.+)/,1]},v={N:[/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/,5],FN:[/FN(?:;([^:]+))*:(.*)/,1],NICKNAME:[/NICKNAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-FIRST-NAME":[/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-LAST-NAME":[/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/,1],ORG:[/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/,2],TITLE:[/TITLE(?:;([^:]+))*:(.*)/,1],TEL:[/TEL(?:;([^:]+))*:(.*)/,1],PHOTO:[/PHOTO(?:;([^:]+))*:(.*)/,1],BDAY:[/BDAY(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.+)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1]},y={getDate:function(e){var t=[/-([^-]*)-([^-]*)-([^-]*)/,/([^-]*)-([^-]*)-([^-]*)/],n=e;return _.forEach(t,function(t){var i=e.match(t);if(i){var a=!i[1].length||"1604"===i[1],s=a?"0000":i[1];return n=h(s+"-"+i[2]+"-"+i[3]).format("l"),a&&(n=n.replace(/[.,-\/\s]*0000[.,-\/\s]*/,"")),!1}}),n},getOrganizationString:function(e){var t=_.first(e.ORG),n=_.first(e.TITLE);if(t&&_.isArray(t.value)&&t.value.length>0){var i=null;n&&n.value&&(i=(""+n.value).trim());var a=(0,u["default"])(t.value),s=a[0],r=a.slice(1);r.push(s);var o=r.map(function(e){return _.isString(e)?e.trim():""}).filter(function(e){return e.length}).join(l10n.t("enumeration_comma"));return(i||"")+(i&&i.length&&o.length?" - ":"")+o}return""},getType:function(e){var t={jabber:l10n.t("vcard_jabber"),"skype-username":l10n.t("vcard_skype"),skype:l10n.t("vcard_skype"),msn:l10n.t("vcard_msn"),aim:l10n.t("vcard_aim"),yahoo:l10n.t("vcard_yahoo"),icq:l10n.t("vcard_icq")},n=e.properties["X-ABLabel"]||t[e.type.toLowerCase()];if(n)return o(n);var i={TEL:[[["cell"],l10n.t("vcard_cell")],[["iphone"],l10n.t("vcard_iphone")],[["main"],l10n.t("vcard_main")],[["home","fax"],l10n.t("vcard_home_fax")],[["work","fax"],l10n.t("vcard_work_fax")],[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")],[["pager"],l10n.t("vcard_pager")],[[],l10n.t("vcard_home")]],EMAIL:[[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")],[["internet"],l10n.t("vcard_email")]],URL:[[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")]],ADR:[[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")]]};return n=e.type,_.forEach(i[e.type],function(t){if(t){var i=(0,p["default"])(t,2),a=i[0],s=i[1];if(0===_.difference(a,_.map(e.properties.type,function(e){return e.toLowerCase()})).length)return n=s,!1}}),n},vcardWAids:function(e){var t=[];return e&&e.TEL&&_.forEach(e.TEL,function(e){e.properties&&e.properties.waid&&e.properties.waid.length>0&&(t=t.concat(_.map(e.properties.waid,f.numberToWid)))}),t},thumbnailWAid:function(e){return _.find(e,function(e){return(Store.ProfilePicThumb.get(e)||{}).img})},parse:function(e){e=e.replace(/\n^[ \t]/gm,"").trim();var t=e.split(/\n/),n={},i={};if("BEGIN:VCARD"===t[0].trim()&&"VERSION:3.0"===t[1].trim()&&"END:VCARD"===_.last(t).trim()){for(var o=2;o<t.length-1;o++){var l=t[o],u=l.match(/item(\d+)\.(.*)/),d=u?u[2]:l,h=d.match(/([^:;]*)[:;].*/)[1],f=u?g:v,y=h,E=h,b=void 0,M=void 0;if(f[y]){var C=(0,p["default"])(f[y],2),S=C[0],T=C[1],w=d.match(S);w&&(b=r(w[1]),M=1===T?M=w[2]:w.slice(2,2+T))}else{var k=d.match(m);k&&(E="SERVICE",y=k[1],M=k[2],b={})}if(M)if(u){var P=u[1];i[P]?i[P].fields.push(new a(y,null,b,M)):i[P]={type:y,index:o,key:E,properties:b,value:M,fields:[]}}else s(n,E,new a(y,o,b,M))}return _.forEach(_.keys(i),function(e){var t=i[e],r=t.key,o=t.index,c=t.type,l=t.value,u=t.properties,d=t.fields;_.forEach(d,function(e){u[e.type]=e.value}),s(n,r,new a(c,o,u,l))}),c(n)}},vCardSerialize:function(e){return e.map(function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")}).join("\n")},thumbnail:function(e){if(e){e=e.replace(/\n^ /gm,"");var t=e.match(/^PHOTO;(BASE64|ENCODING=b;TYPE=image\/jpeg):(.*)$/m);return t?t[2]:void 0}},getName:function(e){var t=_.filter(e.formattedName.split(e.formattedShortName)),n=t.length?_.trim(t[0]):void 0,i=n?e.formattedShortName:e.formattedName;return this.cleanValue(n)+";"+this.cleanValue(i)+";;;"},cleanValue:function(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,"):""}};e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(218),s=i(a),r=n(103),o=i(r),c=n(6),l=n(38),u=n(1340),d=n(1315),p=n(1477),h=n(1310),f=n(140),m=n(45),g=n(1309),v=n(1348),y=n(82),E=n(10),b={SMALL:"small",DEFAULT:"default"},M=c.createClass({displayName:"Contact",mixins:[h,f],propTypes:{contact:c.PropTypes.instanceOf(s["default"]).isRequired,onClick:c.PropTypes.func,mouseDownAsClick:c.PropTypes.bool,onDelete:c.PropTypes.func,onContext:c.PropTypes.func,contextEnabled:c.PropTypes.func,contextMenu:c.PropTypes.bool,admin:c.PropTypes.bool,active:c.PropTypes.object,className:c.PropTypes.string,secondary:c.PropTypes.node,type:c.PropTypes.oneOf(_.values(b)),showNotifyName:c.PropTypes.bool,searchText:c.PropTypes.string},getInitialState:function(){var e=this.props.contact,t=this.props.active,n={formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),active:!!t&&t.value===e,contextMenu:!1};return this.props.showNotifyName&&(n.notifyName=this.async("contact.notifyName")),n},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.contact.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=l.findDOMNode(this);y.focus(n),t&&v.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),this.onClick(e)},onContext:function(e){return this.state.contextMenu?void this.setState({contextMenu:!1}):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},indicateFocus:function(e){if(!(Date.now()-(o["default"].flashFocus||0)>200)){var t=l.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=l.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this.props,t=e.contact,n=e.secondary,i=e.onContext,a=e.onDelete,s=e.contextEnabled,r=e.contextMenu,l=e.admin,h=e.showNotifyName,f=e.className;f=m("contact",f,{active:!!this.state.active});var v=void 0,y=void 0,_=void 0;if(!t.name&&h&&this.state.notifyName&&(_=c.createElement("span",{className:"ellipsify screen-name"},c.createElement(g,{className:"screen-name-text",direction:"auto",text:this.state.notifyName}))),l&&(y=c.createElement("div",{className:"chat-meta"},c.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),a){var M=m("icon",{"icon-x-alt-small":this.props.type===b.SMALL,"icon-x-alt":this.props.type!==b.SMALL});v=c.createElement("div",{className:"chat-controls"},c.createElement("button",{className:M,onClick:this.onDelete}))}n||(n=E.STATUS_V3?null:c.createElement(p,{status:t.status})),i&&(i=this.onContext);var C=this.props.type===b.SMALL?26:d.Size.DEFAULT,S=c.createElement("div",{className:"chat-avatar"},c.createElement(d,{id:t.id,size:C})),T={enter:this.onEnter},w=this.props.mouseDownAsClick;return c.createElement(o["default"],{handlers:T,onFocus:this.indicateFocus,onBlur:this.onBlur},c.createElement(u,{id:t.id,ref:"cell",className:f,contextEnabled:s||this.contextEnabled,contextMenu:r,pendingAction:this.state.pendingAction,detail:v,image:S,primary:this.state.formattedName,searchText:this.props.searchText,primaryDetail:y,secondary:n,secondaryDetail:_,onClick:w?null:this.onClick,onMouseDown:w?this.onMouseDown:null,onContext:i}))}});M.Type=b,e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i){this.key=e,this.src=t,this.crossOrigin=n,this.noXHR=i,this.isHttp="/"===t[0]||N.isHttp(t),this.hasPrivacyChecks=!0,this.promise=null,this.retainCount=0,this.generation=0}function s(e){var t=e.src,n=e.crossOrigin,i=e.noXHR,s=e.hasPrivacyChecks;n=!!n,i=!!i;var r="CO:"+(n?"y":"n")+",XHR:"+(i?"y":"n")+","+t,c=I[r];if(c)return c.retainCount++,c.generation=0,s||(c.hasPrivacyChecks=!1),c;var u=new a(r,t,n,i);return I[r]=u,u.retainCount++,u.promise=l["default"].loop(function(e){var n=u.generation++;if(n>A)throw new P.GaveUpRetry("Too many image retries "+u.src);return l["default"].delay(Math.floor(1e3*O.expBackoff(n,60,0))).then(function(){return u.hasPrivacyChecks&&!b["default"].phoneActive&&n>0?w.waitForBBEvent(b["default"],"change:phoneActive",R.matches({phoneActive:!0})):T.waitForOnline}).cancellable().then(function(){return!(0!==n&&u.isHttp&&!u.noXHR)||k.get(t).timeout(3e4,"imageTagRetryTimeout").then(function(e){var t=e.status;if(t>=200&&t<400)return!0;if(t>=500)return!1;throw new P.ServerStatusError(null,u.src,t)},function(){return!1})}).then(function(t){if(t)return x.loadImage(u.src,u.crossOrigin).then(e)["catch"](function(){if(!u.isHttp)throw new P.ImageError("Invalid Data URI",u.src)})})}).cancellable()["finally"](function(){o(u)}),u}function r(e){--e.retainCount<=0&&(o(e),e.promise.cancel())}function o(e){e===I[e.key]&&delete I[e.key]}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var c=n(2),l=i(c),u=n(37),d=i(u),p=n(23),h=i(p),f=n(25),m=i(f),g=n(81),v=i(g),y=n(80),E=i(y),_=n(106),b=i(_),M=n(1560),C=i(M),S=n(6),T=n(89),w=n(51),k=n(148),P=n(14),N=n(67),O=n(88),D=n(10),x=n(1330),R=n(31),A=10,I={},L=function(e){function t(e){(0,h["default"])(this,t);var n=(0,v["default"])(this,(0,d["default"])(t).call(this,e));return n.state=n._initSrc(e),n}return(0,E["default"])(t,e),(0,m["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.setState(this._initSrc(e))}},{key:"_initSrc",value:function(e){var t=e.src;if(t){if(x.isCached(t))return{src:t};this.ensureLoaded(e)}return{src:null}}},{key:"componentWillUnmount",value:function(){this.ensureLoadedQuery&&r(this.ensureLoadedQuery)}},{key:"ensureLoaded",value:function(e){var t=this,n=this.ensureLoadedQuery,i=this.ensureLoadedQuery=s(e);n&&r(n),n!==i&&i.promise.checkpoint(this.props.rejectOnUnmount()).then(function(){i===t.ensureLoadedQuery&&(t.setState({src:t.props.src}),t.props.onLoaded&&t.props.onLoaded())})["catch"](P.ImageError,P.ServerStatusError,P.GaveUpRetry,function(e){i===t.ensureLoadedQuery&&(t.props.rejectOnUnmount().isRejected()||t.props.onError&&t.props.onError(e))})["catch"](P.Unmount,l["default"].CancellationError,R.noop)}},{key:"render",value:function(){var e=this.state.src,t=this.props,n=t.onLoad,i=t.alt,a=t.onClick,s=t.onMouseMove,r=t.style,o=t.className,c=t.draggable;return e||(e=D.ONE_BY_ONE_TRANS_GIF,n=void 0),c=!!c,S.createElement("img",{src:e,alt:i,onLoad:n,onClick:a,onMouseMove:s,style:r,draggable:c,className:o})}}]),t}(S.Component);L.defaultProps={crossOrigin:!0};t.Component=L;t["default"]=(0,C["default"])(L)},function(e,t,n){"use strict";var i=n(6),a=n(38),s=n(141),r=n(45),o={CONTAIN:"contain",COVER:"cover",SCALE_DOWN:"scaleDown",ZOOM_IN:"zoomIn"},c=i.createClass({displayName:"ObjectFit",mixins:[s],propTypes:{children:i.PropTypes.node.isRequired,type:i.PropTypes.oneOf(_.values(o)).isRequired,size:i.PropTypes.shape({width:i.PropTypes.number.isRequired,height:i.PropTypes.number.isRequired}),style:i.PropTypes.object,zoomIn:i.PropTypes.shape({factor:i.PropTypes.number,translateX:i.PropTypes.number,translateY:i.PropTypes.number}),onObjectLoad:i.PropTypes.func},statics:{TYPES:o},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){var t=this;this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height,e.zoomIn),function(){_.isFunction(t.props.onObjectLoad)&&t.props.onObjectLoad(t.refs.object.firstChild)}))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=e,o=t,c=0,l=0;return r!==i&&(o*=i/r,r=i,o>s&&(c=s/2-o/2)),o<s&&(r*=s/o,o=s,r>i&&(l=i/2-r/2)),{style:{width:r,height:o,top:c,left:l,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},contain:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=e,o=t,c=0,l=0,u=r/i,d=o/s;return u>d?(o*=i/r,r=i,o<s&&(c=s/2-o/2)):(r*=s/o,o=s,r<i&&(l=i/2-r/2)),{style:{width:r,height:o,top:c,left:l,position:"absolute"},className:"object-fit object-fit-contain",computed:!0}},scaleDown:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=t,o=e;return r>s&&(r=s,o=e*(s/t)),o>i&&(o=i,r=t*(i/e)),{style:{width:o,height:r},className:"object-fit object-fit-scaledown",computed:!0}},zoomIn:function(e,t,n){var i=this.scaleDown(e,t);return i.className+=" object-fit-zoomin",i.style.transition="transform 300ms cubic-bezier(.1,.82,.25,1)",n&&(i.style.transform="translateX("+n.translateX+"px) translateY("+n.translateY+"px) scale("+n.factor+")"),i},render:function(){if(this.shouldUseNativeObjectFit())return i.createElement("div",{className:"native-scale-down"},this.props.children);var e=this.state.computed?this.state.style:{visibility:"hidden"};return i.createElement("div",{style:this.props.style,className:r(this.state.className)},i.createElement("div",{style:e,ref:"object"},this.props.children));
}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(435),u=n(1380),d=n(45),p=c.createClass({displayName:"DrawerSection",propTypes:{children:c.PropTypes.node.isRequired,title:c.PropTypes.node,subtitle:c.PropTypes.node,titleOnClick:c.PropTypes.func,footer:c.PropTypes.node,classes:c.PropTypes.string,onMouseDown:c.PropTypes.func,noContainer:c.PropTypes.bool,a8n:c.PropTypes.string},getDefaultProps:function(){return{noContainer:!1}},render:function(){var e=this.props,t=e.children,n=e.title,i=e.subtitle,a=e.footer,r=e.classes,p=e.onMouseDown,h=e.noContainer,f=e.titleOnClick,m=e.a8n,g=(0,o["default"])(e,["children","title","subtitle","footer","classes","onMouseDown","noContainer","titleOnClick","a8n"]),v=d(r,"drawer-section",{well:!!n});if(!n)return c.createElement("div",{className:v},t);var y=i?i:null,E=t;return!h&&E&&(E=c.createElement("div",{className:"drawer-section-body"},t)),c.createElement("div",(0,s["default"])({className:v,onMouseDown:p},g),c.createElement(u,{classes:"drawer-section-title",side:y,ellipsify:!0,"data-a8n":l.key(m),onClick:f},n),E,a)}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(8),c=n(428),l=r.createClass({displayName:"MediaMissingModal",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=void 0,t=void 0;switch(this.props.msg.type){case s["default"].TYPE.VIDEO:e=l10n.t("missing_video_title"),t=l10n.t("missing_video_text");break;case s["default"].TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_text");break;case s["default"].TYPE.IMAGE:e=l10n.t("missing_photo_title"),t=l10n.t("missing_photo_text");break;case s["default"].TYPE.DOCUMENT:e=l10n.t("missing_document_title"),t=l10n.t("missing_document_text")}return r.createElement(c,{title:e,onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},t)}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(428),c=n(8),l=r.createClass({displayName:"RemoteUpload",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e,t;switch(this.props.msg.type){case s["default"].TYPE.IMAGE:e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case s["default"].TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case s["default"].TYPE.AUDIO:case s["default"].TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text");break;case s["default"].TYPE.DOCUMENT:e=l10n.t("retry_upload_doc_title"),t=l10n.t("retry_upload_doc_text");break;default:e=l10n.t("retry_upload_media_title"),t=l10n.t("retry_upload_media_text")}return r.createElement(o,{title:e,onOK:c.closeModal.bind(c),okText:l10n.t("web_ok")},t)}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(221),s=i(a),r=n(1217),o=i(r),c=n(430),l=i(c);e.exports={},e.exports.matchAll=function(e,t,n){for(var i=[],a=void 0;a=e.exec(t);){var s=n?n(a,e):a;s&&i.push(s)}return i};var u=n(45),d=n(6),p=d.createElement,h=0,f=function(e){return function(t,n,i){return p(e,(0,l["default"])({key:"k-"+h++},i),n)}},m=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.filter(function(e){return!!e});return function(){var e=arguments.length<=0||void 0===arguments[0]?new o["default"]:arguments[0],t=arguments[1],n=arguments[2];return i.reduce(function(i,a){var r=a(e,t,n)||{},o=u(i.className,r.className);return(0,s["default"])(i,r,o?{className:o}:{})},{})}},g=function(e,t){return function(n,i,a){return e(n,i,t(a,n,i))}},v=function(e,t){return m(function(e){return e.get("default")},function(t){return t.get(e)},t)},y=function(e,t,n){return g(f(e),v(t,n))};e.exports.jsx={make:y}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(23),s=i(a),r=n(25),o=i(r),c=n(1219),l=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,[{key:"match",value:function(e){c(!1,"Subclasses of `Mutator` must implement `match(text)`")}},{key:"mutate",value:function(e,t){return e}},{key:"group",get:function(){return 0}},{key:"isFragment",get:function(){return!1}},{key:"isFormatter",get:function(){return!1}},{key:"alwaysApply",get:function(){return!1}},{key:"formatResult",get:function(){return!0}},{key:"mutates",get:function(){return this.mutate!==e.prototype.mutate}}]),e}();e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=n(1309),g=n(142),v=n(104),y=n(45),E=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));return n.state={hover:!1,contextMenu:!1},n.onMenuClick=function(e){var t=n.props,i=t.contextEnabled,a=t.onContext;i()&&(e.stopPropagation(),e.preventDefault(),a&&a({anchor:e.target}))},n.onContextMenu=function(e){var t=n.props,i=t.contextEnabled,a=t.onContext;i()&&(e.stopPropagation(),e.preventDefault(),a&&a({event:e}))},n.openContextMenu=function(){n.props.contextEnabled()&&n.setState({contextMenu:!0},function(){n.refs.context.click()})},n.mouseOver=function(){n.state.hover||n.props.contextMenu||!n.props.contextEnabled()||n.setState({hover:!0})},n.mouseEnter=function(){n.state.hover||n.props.contextMenu||!n.props.contextEnabled()||n.setState({hover:!0})},n.mouseLeave=function(){n.state.hover&&n.setState({hover:!1})},n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillUpdate",value:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})}},{key:"onMenuMouseDown",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this.props.contextMenu||this.state.contextMenu,t=e||this.state.hover,n=y(this.props.className,{chat:!0,hover:t}),i=null,a=null;this.props.pendingAction?a=f.createElement("div",{className:"btn-context icon-spinner"},f.createElement(g,{size:18,stroke:6})):t&&(i=f.createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context",onMouseDown:this.onMenuMouseDown,onClick:this.onMenuClick}));var s=this.props.detail?f.createElement("div",{className:"chat-body chat-detail"},this.props.detail):null,r=null,o="chat-title";this.props.isVerified&&(r=f.createElement("span",{className:"icon-psa-verified"}),o+=" chat-title-verified");var c=this.props.primary?f.createElement("div",{className:o},f.createElement(m,{text:this.props.primary,direction:"auto",highlight:this.props.searchText?[this.props.searchText]:null,titlify:!0,ellipsify:!0}),r):null;return f.createElement("div",{className:n,style:this.props.style,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onContextMenu:this.props.contextEnabled()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},this.props.image,f.createElement("div",{className:"chat-body"},f.createElement("div",{className:"chat-main"},c,this.props.primaryDetail),f.createElement("div",{className:"chat-secondary"},this.props.secondary,f.createElement("div",{className:"chat-meta"},this.props.secondaryDetail,f.createElement(v,{transitionName:"pop"},a),f.createElement(v,{transitionName:"pop-fast-chat"},t?i:null)))),s)}}]),t}(f.PureComponent);e.exports=E},function(e,t,n){"use strict";var i=n(6),a=n(141),s=n(45),r=i.createClass({displayName:"CheckBox",mixins:[a],propTypes:{checked:i.PropTypes.bool.isRequired,onChange:i.PropTypes.func.isRequired,disabled:i.PropTypes.bool},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=s("checkbox",{checked:this.props.checked,unchecked:!this.props.checked,disabled:this.props.disabled});return i.createElement("div",{className:"checkbox-container",onClick:this.onToggle},i.createElement("div",{className:e,ref:"checkbox"},i.createElement("div",{className:"checkmark"})))}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(6),o=n(1545),c=n(1422),l=c.EmojiPanel,u=n(104),d=n(437),p=n(45),h=n(142),f=n(1374),m=n(216),g=n(1343),v=r.createClass({displayName:"TextInput",propTypes:{placeholder:r.PropTypes.string,value:r.PropTypes.string,error:r.PropTypes.string,lowProfile:r.PropTypes.bool,multiline:r.PropTypes.bool,supportsEmoji:r.PropTypes.bool,onChange:r.PropTypes.func.isRequired,onBlur:r.PropTypes.func,onFocus:r.PropTypes.func,onEnter:r.PropTypes.func,onFiles:r.PropTypes.func,maxLength:r.PropTypes.number,showRemaining:r.PropTypes.bool,editable:r.PropTypes.bool,spellCheck:r.PropTypes.bool,focusOnMount:r.PropTypes.bool,className:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.arrayOf(r.PropTypes.string),r.PropTypes.objectOf(r.PropTypes.bool)]),lockable:r.PropTypes.bool,pending:r.PropTypes.bool,onCancel:r.PropTypes.func,onSave:r.PropTypes.func,onError:r.PropTypes.func,validate:r.PropTypes.func},getDefaultProps:function(){return{maxLength:25,editable:!0}},getInitialState:function(){return{active:!1,locked:this.props.lockable,emojiPicker:!1}},componentDidMount:function(){this.props.focusOnMount&&this.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=r.createElement(l,{onEmoji:this.onEmoji,onFocusRelease:this.restoreFocus});this.setState({emojiPicker:{menu:t,menuDirection:{y:d.Direction.Y.TOP},type:d.Type.EMOJI_PICKER,anchor:e.target}}),this.restoreFocus()},emojiPickerClose:function(){this.setState({emojiPicker:!1})},restoreEmojiPickerFocus:function(){this.refs.emojiPickerUIE&&this.refs.emojiPickerUIE.getRef()&&this.refs.emojiPickerUIE.getRef().getElement()&&this.refs.emojiPickerUIE.getRef().getElement().restoreFocus()},onEmoji:function(e){this.refs.inputLine.restoreFocus(!1),this.refs.inputLine.replaceSelection(e)},onEnter:function(){this.props.lockable&&this.onSaveAndLock(),this.props.onEnter&&!this.props.multiline&&this.props.onEnter()},onChange:function(e){this.props.onChange&&this.props.onChange(e)},restoreFocus:function(){this.refs.inputLine&&this.refs.inputLine.restoreFocus()},onBlur:function(e){this.state.active&&this.setState({active:!1}),this.props.onBlur&&this.props.onBlur(e)},onFocus:function(e){e.stopPropagation(),this.state.active||this.setState({active:!0}),this.props.onFocus&&this.props.onFocus(e);var t=this.refs.uiTextInput;t&&t.raiseToTop()},onUnlock:function(e){this.setState({locked:!1})},onSaveAndLock:function(e){var t=!(!this.props.lowProfile&&this.props.error);this.props.validate&&t&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({locked:!0})):this.props.onError&&this.props.onError()},onCancel:function(){this.props.onCancel&&this.props.onCancel(),this.setState({locked:!0})},render:function(){var e=this.props.editable&&!this.state.locked,t=e&&!!this.props.error&&!this.props.lowProfile,n=f.multibyteLength(this.props.value||""),i=this.props.maxLength-n<50&&e,a={container:p("text-input",this.props.className,{"no-placeholder":!this.props.placeholder,active:e}),label:p("label-text",{"label-text-float":!!this.props.value}),inputWrapper:p("input-wrapper",{"input-text-error":t,"input-text-active":this.state.active,locked:this.state.locked}),infoWrapper:p("input-info-strip",{"input-text-error":t,"input-text-active":this.state.active})},c=this.props.showRemaining?r.createElement("div",{className:"control-button-container char-counter"},r.createElement("div",{className:"char-counter"},i?this.props.maxLength-n:null)):null,l=e&&this.props.supportsEmoji?r.createElement("button",{className:"icon icon-emoji icon-emoji-input",onClick:this.onEmojiPicker}):void 0,d=void 0;this.props.lockable&&(this.props.pending?d=r.createElement("div",{className:"icon icon-spinner"},r.createElement(h,{size:18,stroke:6})):this.state.locked?this.props.editable&&(d=r.createElement("span",{className:"lock-icon icon icon-pencil",onClick:this.onUnlock,key:"btn-edit",title:l10n.t("edit_button")})):d=r.createElement("span",{className:"lock-icon icon icon-checkmark",onClick:this.onSaveAndLock,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")}),d=r.createElement(u,{transitionName:"pop",component:"div",className:"control-button-container"},d));var v=this.props.lowProfile?null:r.createElement("div",{className:a.infoWrapper},r.createElement("div",{className:"error-text"},t?this.props.error:null)),y=void 0;if(this.props.lockable&&!this.state.locked){var E=void 0;this.state.emojiPicker&&(E=r.createElement(m,{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},r.createElement(g,{contextMenu:this.state.emojiPicker}))),y=r.createElement(m,{displayName:"TextInput",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.onCancel},r.createElement("div",null,E))}else!this.props.lockable&&this.state.emojiPicker&&(y=r.createElement(m,{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},r.createElement(g,{contextMenu:this.state.emojiPicker})));return r.createElement(s["default"],{className:a.container,onFocus:this.restoreFocus},r.createElement("span",{className:a.label},this.props.placeholder),r.createElement("div",{className:"input-spacer"}),r.createElement("div",{className:a.inputWrapper,"data-trump-dominateparent":"click"},r.createElement(o,{ref:"inputLine",value:this.props.value,className:"input-text",multiline:this.props.multiline,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onEnter:this.onEnter,onFiles:this.props.onFiles,focusOnChange:!1,spellCheck:this.props.spellCheck,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,editable:this.props.editable&&!this.state.locked}),r.createElement("div",{className:"textinput-controls"},d,r.createElement(u,{transitionName:"pop",component:"div",className:"control-button-container"},l),c)),v,y)}});e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(8),u=n(83),d=c.createClass({displayName:"UIEMenu",propTypes:{contextMenu:c.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.contextMenu,n=t.menu,i=(0,o["default"])(t,["menu"]);l.openContextMenu(n,(0,s["default"])({},i),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){l.closeContextMenu(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:c.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";var i=n(6),a=n(45),s=n(435),r=i.createClass({displayName:"DrawerListItem",propTypes:{onClick:i.PropTypes.func,iconClass:i.PropTypes.string,className:i.PropTypes.string,a8n:i.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.onClick,n=e.iconClass,r=e.className,o=e.children,c=n?i.createElement("div",{className:"chat-avatar"},i.createElement("div",{className:"avatar"},i.createElement("span",{className:a("icon",n)}))):null;return i.createElement("div",{className:a("chat",r),"data-ignore-capture":"any"},i.createElement("div",{className:"chat-cell",onClick:t,"data-a8n":s.key(this.props.a8n)},c,i.createElement("div",{className:"chat-body"},i.createElement("div",{className:"chat-main"},i.createElement("div",{className:"chat-title"},i.createElement("span",{className:"emojitext ellipsify",dir:"auto"},o))))))}});e.exports=r},function(e,t,n){"use strict";var i=n(6),a=n(10),s=n(428),r=n(8),o=n(85),c={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},l={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},u=i.createClass({displayName:"GuidePopup",propTypes:{title:i.PropTypes.string.isRequired,desc:i.PropTypes.string.isRequired,browserPrefixDesc:i.PropTypes.bool.isRequired,type:i.PropTypes.oneOf(_.values(c)).isRequired,onConfirm:i.PropTypes.func,onCancel:i.PropTypes.func},statics:{TYPE:c},getDefaultProps:function(){return{browserPrefixDesc:!0,type:c.GUIDE_NONE,onConfirm:r.closeModal.bind(r)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(l.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(l.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(l.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(l.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(l.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(l.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+o.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(o.browser===a.BROWSER_TYPE.CHROME)switch(o.os){case a.OS_TYPE.MAC:e+=" popup-guide-mac";break;case a.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case a.OS_TYPE.WINDOWS:}var t=null;this.props.type!==c.GUIDE_NONE&&o.browser===a.BROWSER_TYPE.CHROME&&(t=i.createElement("div",{className:"round"},i.createElement("div",{className:"round-body "+this.props.type})));var n=this.props.onCancel?l10n.t("learn_more"):void 0;return i.createElement(s,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:n},t,i.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(6),o=n(45),c=r.createClass({displayName:"Modal",propTypes:{type:r.PropTypes.oneOf(["compact","box","tower"]),classes:r.PropTypes.string,title:r.PropTypes.string,children:r.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?r.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=o("popup",this.props.classes,(0,s["default"])({},"popup-"+this.props.type,this.props.type!==c.COMPACT));return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:t},r.createElement("div",{className:"popup-body"},e,r.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(145),o=n(429),c=(0,r.defineState)("MsgLoad",{props:{noEarlierMsgs:"boolean",isLoadingEarlierMsgs:"boolean",isLoadingRecentMsgs:"boolean",isLoadingAroundMsgs:"boolean",contextLoaded:"boolean"}}),l=c.MsgLoad,u=o.extend({model:s["default"],initialize:function(){o.prototype.initialize.call(this),this.msgLoadState=new l({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)},"delete":function(){this.stopListening(),o.prototype["delete"].call(this),this.msgLoadState["delete"]()},triggerChangeLast:function(){var e=this.last();this._last!==e&&(this._last=e,this.trigger("change:last",e))},add:function(){var e=this,t=o.prototype.add.apply(this,arguments),n=Store.Msg.add(t,arguments[1]);return _.isArray(n)?n.forEach(function(t){e.isModel(t)&&(t.msgChunk=e)}):this.isModel(n)&&(n.msgChunk=this),this.trigger("bulk_add",t,arguments[1]),t},replace:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise,this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r={scrollIntoViewIfNeeded:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments[2];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);n=n||e.parentNode;var i=window.getComputedStyle(n,null),a=parseInt(i.getPropertyValue("border-top-width")),s=e.offsetTop-n.offsetTop<n.scrollTop,r=e.offsetTop-n.offsetTop+e.clientHeight-a>n.scrollTop+n.clientHeight,o=s&&!r;return(s||r)&&t&&(n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-a+e.clientHeight/2),!s&&!r||t||e.scrollIntoView(o),!(s||r)},scrollIntoView:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments[2];n=n||e.parentNode;var i=window.getComputedStyle(n,null),a=parseInt(i.getPropertyValue("border-top-width")),s=e.offsetTop-n.offsetTop<n.scrollTop,r=e.offsetTop-n.offsetTop+e.clientHeight-a>n.scrollTop+n.clientHeight,o=s&&!r;return t?n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-a+e.clientHeight/2:e.scrollIntoView(o),!(s||r)},scrollAt:function(e,t,n){n=n||{};var i=n.pos||"center",a=n.duration||1e3;switch(t=t||e.offsetParent,i){case"top":return t.scrollTop=e.offsetTop,s["default"].resolve();case"bottom":return t.scrollTop=e.offsetTop+e.clientHeight-t.clientHeight,s["default"].resolve();case"center":return n.animate?(Velocity(e,"stop"),Velocity(t,"stop"),Velocity(e,"scroll",{duration:a,container:t,offset:(e.clientHeight-t.clientHeight)/2,easing:n.easing})):(t.scrollTop=e.offsetTop+e.clientHeight/2-t.clientHeight/2,s["default"].resolve());case"offset":var r=n.offset||0;return t.scrollTop=e.offsetTop-r,s["default"].resolve()}return s["default"].resolve()}};e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(1307),d=i(u),p=n(434),h=n(46),f=n(1641),m=n(1),g=n(143),v=n(0),y=function(){function e(){(0,o["default"])(this,e)}return(0,l["default"])(e,[{key:"_getDefaultName",value:function(e){var t=p.getExtension(e.mimetype);switch(e.type){case d["default"].TYPE.DOCUMENT:return e.caption||e.filename||l10n.t("untitled_document")+t;case d["default"].TYPE.IMAGE:case d["default"].TYPE.VIDEO:case d["default"].TYPE.AUDIO:default:var n=v.unix(e.t).locale("en");return e.filename||"WhatsApp "+_.capitalize(e.type)+" "+(n.format("YYYY-MM-DD")+" at ")+(""+n.format(g.getIs24Hour()?"HH.mm.ss":"h.mm.ss A"))+t}}},{key:"_getDownloadData",value:function(e){var t=this,n=_.isArray(e)?e:[e];return s["default"].map(n,function(e){return e.isGif?t._mp4ToGif(e):{name:t._getDefaultName(e),url:e.mediaData.renderableUrl,blob:e.mediaData.mediaBlob}}).then(function(e){return e.length>1?f(e).then(function(e){var n={t:Math.round(Date.now()/1e3),type:"zip",mimetype:"application/zip"};return{blob:e,name:t._getDefaultName(n)}}):_.head(e)})["catch"](function(e){m.error("Failed to get download data!")(e)})}},{key:"_mp4ToGif",value:function(e){var t=this;return new s["default"](function(e,t){throw new Error("unimplemented")}).then(function(t,n){return{url:t,blob:n,name:"WhatsApp-Image-"+v.unix(e.t).format("YYYYMMDD")+".gif"}})["catch"](function(){return{url:e.mediaData.renderableUrl,blob:e.mediaData.mediaBlob,name:t._getDefaultName(e)}})}},{key:"initDownload",value:function(e){h.startDownloading();var t=document.createElement("a");this._getDownloadData(e).then(function(n){t.href=n.url||window.URL.createObjectURL(n.blob),t.download=n.name,t.target="_blank",t.style.display="none",_.isArray(e)&&1===e.length&&(e=_.head(e)),m.assert(t.href,"no-download-url",_.isArray(e)?"download a zip file":"download "+e.id+" type "+e.type+" with state "+e.mediaData.mediaStage)(),document.body.appendChild(t),t.click(),document.body.removeChild(t),n.url||window.URL.revokeObjectURL(t.href)})["catch"](function(e){m.error("Download failed, error: "+e)()})}}]),e}();e.exports=new y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=void 0;var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1308),m=(i(f),n(1381)),g=i(m),v=n(1474),y=i(v),E=n(1326),b=i(E),M=n(1329),C=i(M),S=n(103),T=i(S),w=n(1401),k=i(w),P=n(1470),N=i(P),O=n(1325),D=n(6),x=n(38),R=n(1340),A=n(1315),I=n(1407),L=n(1485),U=n(1404),F=n(1493),G=n(1405),j=n(10),B=n(8),H=n(45),q=n(1348),W=n(1451),V=n(14),z=n(1343),Y=n(216),K=n(82),Q=n(438),X=n(217),Z=t.Mode={LAST:"last",INFO:"info"},J=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));$.call(n);var i=e.active,a=e.chat;return n.state={active:!!i&&i.value===a,dragging:!1,contextMenu:void 0},n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.active,n=e.chat;t&&this.props.addListener(t,n.id,this.onActiveChange)}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.mode,i=e.secondary,a=e.className;a=H(a,{unread:t.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var s=void 0,r=void 0,o=void 0;switch(n){case Z.LAST:s=D.createElement(k["default"],{chat:t}),i||(i=D.createElement(N["default"],{chat:t}),r=D.createElement(y["default"],{chat:t,mute:t.mute})),o={enter:this.onEnter},o[X.LR("right","left")]=this.openContextMenu;break;case Z.INFO:i||(i=t.isGroup?D.createElement(G,{presence:t.presence,groupMetadata:t.groupMetadata,location:"list"}):D.createElement(g["default"],{presence:t.presence,chatstate:t.presence.chatstate,location:m.Location.LIST})),o={enter:this.onEnter}}var c=D.createElement("div",{className:"chat-avatar"},D.createElement(A,{id:t.id,size:A.Size.NONE})),l=this.props.mouseDownAsClick,u=void 0;this.state.contextMenu&&(u=D.createElement(Y,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.removeContext},D.createElement(z,{contextMenu:this.state.contextMenu})));var d=t.contact&&t.contact.isVerified;return D.createElement(T["default"],{handlers:o,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},D.createElement(R,{id:t.id,ref:(0,O.GetRef)("cell",this),className:a,contextEnabled:this.contextEnabled,pendingAction:t.pendingAction,contextMenu:!!this.state.contextMenu,image:c,primary:t.title(),searchText:this.props.searchText,primaryDetail:s,secondary:i,secondaryDetail:r,isVerified:t.isPSA||d,onClick:l?void 0:this.onClick,onMouseDown:l?this.onMouseDown:void 0,onContext:this.onMenu}),u)}}]),t}(D.PureComponent);J.CONCERNS={chat:["id","formattedTitle","hasUnread","isReadOnly","isGroup","pendingAction","canSend","isPSA","contact","presence","groupMetadata","mute"]},J.defaultProps={mode:Z.LAST};var $=function(){var e=this;this.hoverCounter=0,this.onActiveChange=function(t,n){if("focus"===t){var i=x.findDOMNode(e);K.focus(i),n&&q.scrollIntoViewIfNeeded(i)}e.setState({active:!!t})},this.contextEnabled=function(){var t=e.props,n=t.chat,i=t.noContext;return!i&&(n.mute.canMute()||n.canArchive()||n.canDelete()||n.canExit())},this.onMenu=function(t){if(e.state.contextMenu)return void e.setState({contextMenu:void 0});var n=e.props.chat,i=[];n.canArchive()&&i.push(D.createElement(L,{key:"archive",onArchive:e.onArchive,chat:Store.Chat.get(n.id)})),n.mute.canMute()&&i.push(D.createElement(I,{key:"mute",onMute:e.onMute,chat:Store.Chat.get(n.id)})),n.canDelete()&&i.push(D.createElement(U,{key:"delete",onDeleteOrExit:e.onDeleteOrExit,chat:Store.Chat.get(n.id)})),n.canMarkUnseen()&&i.push(D.createElement(F,{key:"mark_unread",onMarkUnread:e.onMarkUnread,chat:Store.Chat.get(n.id)})),t.event&&t.event.persist(),e.setState({contextMenu:{menu:i,event:t.event,anchor:t.anchor}})},this.removeContext=function(){e.setState({contextMenu:void 0})},this.onMute=function(t){B.muteChat(Store.Chat.get(e.props.chat.id),t,e)},this.onArchive=function(t){B.archiveChat(Store.Chat.get(e.props.chat.id),t)},this.onDeleteOrExit=function(){B.deleteOrExitChat(Store.Chat.get(e.props.chat.id),e)},this.onMarkUnread=function(t){B.markChatUnread(Store.Chat.get(e.props.chat.id),t)},this.onClick=function(t){_.isFunction(e.props.onClick)&&e.props.onClick(t,Store.Chat.get(e.props.chat.id))},this.onMouseDown=function(t){0===t.button&&e.onClick(t)},this.onEnter=function(t){t.preventDefault(),t.stopPropagation(),T["default"].flashFocus=Date.now(),e.onClick(t)},this.onDragEnter=function(t){if(e.props.chat.canSend){var n=t.dataTransfer;_.includes(n.types,j.DRAG_TYPE_FILE)&&(0===e.hoverCounter&&e.setState({dragging:!0}),e.hoverCounter+=1)}},this.onDragLeave=function(t){if(e.props.chat.canSend){var n=t.dataTransfer;_.includes(n.types,j.DRAG_TYPE_FILE)&&(e.hoverCounter-=1,0===e.hoverCounter&&e.setState({dragging:!1}))}},this.onDrop=function(t){var n=e.props.chat;if(n.canSend){e.setState({dragging:!1});var i=t.dataTransfer;(_.includes(i.types,j.DRAG_TYPE_FILE)||_.includes(i.types,"text/uri-list")||_.includes(i.types,"text/html"))&&W.getFiles(t,0).then(function(e){B.openChatFromUnread(Store.Chat.get(n.id)).then(function(t){t&&B.attachMediaDrawer(Store.Chat.get(n.id),e)})})["catch"](V.MediaDragDropError,function(e){B.openChatFromUnread(Store.Chat.get(n.id)).then(function(t){t&&B.pasteChatTextInput(Store.Chat.get(n.id),e.src)})})}},this.indicateFocus=function(t){if(!(Date.now()-(T["default"].flashFocus||0)>200)){var n=x.findDOMNode(e.cell);Q(n,"stop"),Q(n,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:e.onBlur})}},this.onBlur=function(t){var n=x.findDOMNode(e.cell);n&&(Q(n,"stop"),n.style.backgroundColor="")},this.openContextMenu=function(){e.cell.openContextMenu()}};t["default"]=(0,C["default"])((0,b["default"])(J))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=n(38),g=n(1561),v=n(142),y=n(216),E=n(82),_=n(217),b=n(45),M=n(104),C=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.state={searchText:"",isSearching:!1},i.onBlur=function(){return i.props.setTimeout(function(){i.state.searchText||i.onCancel()},0)},i.onChange=function(e){e.target instanceof HTMLInputElement&&!function(){var t=e.target.value;i.setState({searchText:t},function(){i.props.onSearch(t)})}()},i.onCancel=function(){i.refs.input.blur(),i.setState({searchText:"",isSearching:!1}),i.props.onSearch("")},i.onReset=function(e){e.stopPropagation(),i.focus(),i.setState({searchText:""}),i.props.onSearch("")},i.onSearchOn=function(){i.setState({isSearching:!0}),i.props.setTimeout(i.focus,0)},i.focus=function(){E.focus(i.refs.input)},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.state.isSearching&&!this.state.searchText&&(m.findDOMNode(this).contains(document.activeElement)||this.onCancel())}},{key:"componentWillUnmount",value:function(){this.onCancel()}},{key:"isAtBeginning",value:function(){var e=this.refs.input;return 0===e.selectionStart&&0===e.selectionEnd}},{key:"isAtEnd",value:function(){var e=this.refs.input,t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t}},{key:"render",value:function(){var e=this.props,t=e.loading,n=e.placeholder,i=e.spellCheck,a=this.state,s=a.isSearching,r=a.searchText,o=null;s&&(t?o=f.createElement("button",{className:"btn-context icon-spinner icon-x-alt",key:"icon-clear-search",onClick:this.onReset},f.createElement(v,{size:20,stroke:5})):r.length&&(o=f.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var c=void 0;s&&(c=f.createElement(y,{displayName:"ListSearch",escapable:!0,requestDismiss:this.onCancel,requestFocus:this.focus
}));var l=s?this.onCancel:this.onSearchOn,u=b("pane-subheader","pane-list-subheader","subheader-search",{active:s});return f.createElement("div",{className:u},f.createElement("button",{className:"icon icon-search-morph",onMouseDown:l},f.createElement("div",{className:"icon icon-back-blue"}),f.createElement("div",{className:"icon icon-search"})),f.createElement(M,{transitionName:"pop"},o),f.createElement("div",{className:"input-placeholder"},r?null:n),f.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},f.createElement("input",{type:"text",ref:"input",className:"input input-search","data-tab":2,dir:"auto",spellCheck:i,title:n,value:r,onBlur:this.onBlur,onFocus:s?null:this.onSearchOn,onChange:s?this.onChange:null})),c)}}]),t}(f.Component);C.defaultProps={placeholder:_.t("search_or_start_new_chat")};t.Component=C;t["default"]=g(C)},function(e,t){"use strict";e.exports=function(e){return!e.getModifierState("Shift")&&!e.getModifierState("Alt")&&!e.getModifierState("Control")}},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e){switch(e){case K.OUTWARD_TYPES.IMAGE:return G["default"].supportsFeature(G["default"].F.ENC_IMAGE);case K.OUTWARD_TYPES.VIDEO:return G["default"].supportsFeature(G["default"].F.ENC_VIDEO);case K.OUTWARD_TYPES.PTT:case K.OUTWARD_TYPES.AUDIO:return G["default"].supportsFeature(G["default"].F.ENC_AUDIO);case K.OUTWARD_TYPES.DOCUMENT:return G["default"].supportsFeature(G["default"].F.ENC_DOC);default:return!0}}function r(e,t){return q["default"].assert(e._mediaObject,"media-fault","msg has no _mediaObject")(e),Y.downloadMedia(e._mediaObject,t)}function o(e){return q["default"].assert(e._mediaObject,"media-fault","msg.cancel with no _mediaObject")(e),Y.cancelDownloadMedia(e._mediaObject)}function c(e,t){q["default"].info("Prepping raw media")(e,t);var n=void 0;return n=t.isPtt?K.OUTWARD_TYPES.PTT:t.asDocument?K.OUTWARD_TYPES.DOCUMENT:K.OUTWARD_TYPES.UNKNOWN,new ne(n,Y.processRawMedia(e,t))}function l(e,t){q["default"].info("Prepping media msg")(e);var n=e._mediaObject;q["default"].assert(n,"media-fault","fwding media msg without mediaObject")();var i=e.mediaData.toJSON();return i.type===K.OUTWARD_TYPES.PTT&&(i.type=K.OUTWARD_TYPES.AUDIO),new ne(i.type,b["default"].resolve(i)).sendToChat(t,{caption:i.type===K.OUTWARD_TYPES.DOCUMENT?e.caption:void 0})}function u(e){return q["default"].assert(e._mediaObject,"media-fault","msg.cancelUpload with no _mediaObject")(e),Y.cancelUploadMedia(e._mediaObject)}function d(e){var t=e._mediaObject;q["default"].assert(t,"media-fault","msg.resumeUpload with no _mediaObject")(e),t.addUploadTargets([window.Store.Conn.me]);var n=e.chat,i=Y.uploadMediaForChat(t,n.id).then(function(n){return e.set({clientUrl:n.mmsUrl,mediaKey:n.encryptionKey,filehash:t.filehash,size:t.size}),e}),a=e.chat.sendMsg(i);return a["catch"](function(){e.ack=-1}),Y.cancelUploadMedia(e._mediaObject)}function p(e){var t=e._mediaObject;if(t){var n=t.previewWidthHeightPromise;return n?n["catch"](function(){}).then(function(){return t.resolveWhenConsolidated()}):t.resolveWhenConsolidated()}var i=e.mediaData,a=i.preview;return!a||void 0!==i.thumbWidth&&void 0!==i.thumbHeight?b["default"].resolve():B["default"].loadImage("data:image/jpeg;base64,"+a).then(function(t){e._mediaObject||e.mediaData.set({thumbWidth:t.width,thumbHeight:t.height})})}function h(e){e.mimetype||e.type!==K.OUTWARD_TYPES.IMAGE||(e.mimetype="image/jpeg"),e.on(ee,m),m(e)}function f(e){e.off(null,m);var t=e._mediaObject;t&&(e._mediaObject=null,t.removeMsg(e),t.hasAssociatedMsgs()||(t.filehash&&delete te[t.filehash],t["delete"]()))}function m(e){for(var t={},n=0;n<$.length;n++){var i=$[n];t[J[i]]=e[i]}if(e.isUnsentPhoneMsg())return q["default"].assert(!e._mediaObject,"media-fault","Managing unsent message")(),t.mediaStage=e.phoneUploading?K.STAGE.REMOTE_UPLOADING:K.STAGE.REMOTE_NEED_UPLOAD,void e.mediaData.set(t);var a=e._mediaObject,s=e.filehash;if(a)s&&s!==a.filehash&&(a.removeMsg(e),a.hasAssociatedMsgs()||(a.filehash&&delete te[a.filehash],a["delete"]()),a=g(s),e._mediaObject=a,a.addMsg(e));else{a=s?g(s):new Q["default"];var r=e.mediaData;r.thumbWidth&&(t.thumbWidth=r.thumbWidth),r.thumbHeight&&(t.thumbHeight=r.thumbHeight),e._mediaObject=a,a.addMsg(e)}var o=!1;if(e.clientUrl){o=!a.entries.knowsUrl(e.clientUrl);var c=a.entries.addEntry(e.clientUrl,e.mediaKey,e.uploadhash,e.streamingSidecar);c||(o=!1),o&&a.downloadStage===K.DOWNLOAD_STAGE.ERROR_MISSING&&(t.downloadStage=K.STAGE.INIT)}a.consolidate(t)||a.notifyMsgsAsync(),o&&a.downloadStage===K.DOWNLOAD_STAGE.NEED_POKE&&Y.downloadMedia(a,!1)}function g(e){return te.hasOwnProperty(e)?te[e]:te[e]=new Q["default"]}function v(e,t,n){function i(e){l=e;var n=e._mediaObject;return q["default"].assert(n,"media-fault","incorrect media object for created msg")(),n.addUploadTargets([window.Store.Conn.me]),Y.uploadMediaForChat(n,t.id).then(function(e){l.set({clientUrl:e.mmsUrl,mediaKey:e.encryptionKey,filehash:n.filehash,size:n.size,streamingSidecar:e.sidecar})})}var a=n.caption,s=n.quotedMsg?n.quotedMsg.contextInfo():{},r=window.Store.Conn.me,o={t:D["default"].globalUnixTime(),from:r,isNewMsg:!0,to:t.id,self:"out",type:e._baseType,ack:0,local:!0,id:new V["default"]({from:r,to:t.id,id:V["default"].newTag(),participant:void 0,selfDir:"out"}),caption:a,quotedMsg:s.quotedMsg,quotedParticipant:s.quotedParticipant,quotedStanzaID:s.quotedStanzaID,quotedRemoteJid:s.quotedRemoteJid},c=e.waitForPrep().then(function(e){var t=e.filehash;q["default"].assert(t,"media-fault","filehash undefined for send")();var n=g(t);n.mediaBlob&&(e.mediaBlob=n.mediaBlob),!e.mediaBlob||n.specifics&&n.specifics.renderableUrl||(e.renderableUrl=window.URL.createObjectURL(e.mediaBlob)),n.consolidate(e.toJSON()),Y.downloadMedia(n,!0);var i=n.msgProps(e);return a||e.type!==K.OUTWARD_TYPES.DOCUMENT||(i.caption=e.filename),i}),l=void 0,u=void 0;if(n.addEvenWhilePreparing)u=t.addAndSendMsg(o,function(e){return l=e,c.then(function(e){return l.set(e),i(l)})})[1];else{var d=c.then(function(e){return(0,E["default"])({},o,e)});u=t.addAndSendMsg(d,i)[1]}u["catch"](function(){l&&(l.ack=-1)})}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPrep=void 0;var y=n(430),E=a(y),_=n(2),b=a(_),M=n(23),C=a(M),S=n(25),T=a(S),w=n(32),k=a(w);t.canSendType=s,t.downloadMsg=r,t.cancelDownloadMsg=o,t.prepRawMedia=c,t.forwardMediaMsg=l,t.cancelUploadMsg=u,t.resumeUploadMsg=d,t.prepareMsg=p,t.registerMsg=h,t.deregisterMsg=f;var P=n(31),N=a(P),O=n(143),D=a(O),x=n(8),R=a(x),A=n(14),I=a(A),L=n(436),U=a(L),F=n(139),G=a(F),j=n(1330),B=a(j),H=n(1),q=a(H),W=n(39),V=a(W),z=n(1563),Y=i(z),K=n(1386),Q=a(K),X=n(1318),Z=a(X),J=N["default"].invert(K.FIELDS_TO_MSG_PROPS),$=(0,k["default"])(J),ee="change:phoneUploading change:clientUrl change:mediaKey change:filehash change:ack "+$.map(function(e){return"change:"+e}).join(" "),te={},ne=t.MediaPrep=function(){function e(t,n){var i=this;(0,C["default"])(this,e),this._baseType=t,this._mediaData=new Z["default"]({mediaStage:K.STAGE.PREPARING}),this._prepwork=n.then(function(e){if(i._mediaData.set(e),!e.filehash)return q["default"].assert(e.mediaBlob,"media-fault","no hash or blob")(),U["default"].getHash(e.mediaBlob).then(function(e){var t=e.hash;i._mediaData.filehash=t})},function(e){return i._mediaData.stage=K.STAGE.ERROR_UNSUPPORTED,b["default"].reject(e)})}return(0,T["default"])(e,[{key:"sendToChat",value:function(e,t){b["default"].callSynchronously(v,null,this,e,t)}},{key:"waitForPrep",value:function(){var e=this;return this._prepwork.then(function(){var t=e._mediaData;return s(t.type)?t:b["default"].reject(new I["default"].CapabilityUnsupported)})}}]),e}();R["default"].on("logout",function(){var e=te;te={};for(var t in e)e[t]["delete"]()})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceProxy=t["default"]=t.ChatstateProxy=t.Chatstate=void 0;var a=n(2),s=i(a),r=n(145),o=i(r),c=n(10),l=n(1),u=n(26),d=n(439),p=n(66),h=n(143),f=1500,m=2e3,g=(0,r.defineState)("Chatstate",{props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:["number",!1,0]}}),v=g.Chatstate,y=g.ChatstateProxy;t.Chatstate=v,t.ChatstateProxy=y;var E=d.extend({model:v}),b=(0,r.defineState)("Presence",{Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:v},collections:{chatstates:E},derived:{isGroup:{fn:function(){return u.isGroup(this.id)}},isUser:{fn:function(){return u.isUser(this.id)}}},initialize:function(){o["default"].prototype.initialize.call(this),this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",_.debounce(function(){var e,t=!1;this.chatstates.forEach(function(n){"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})}))):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){o["default"].prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,c.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var n=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:n})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":l.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var n=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:n}):l10n.t("web_conversation_name_is_recording",{participant:n})}if(!this.isUser)return null;var i=this.chatstate;switch(i.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return i.deny||!i.t?null:h.lastSeenStr(i.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},f,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},m,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?s["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,s["default"].all([this.update(),p.presenceSubscribe(this.id)]).bind(this)["catch"](function(e){return this.isSubscribed=!1,s["default"].reject(e)})):s["default"].resolve()}}),M=b.Presence,C=b.PresenceProxy;t["default"]=M,t.PresenceProxy=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=i(f),g=n(1),v=i(g),y=n(1307),E=i(y),_=n(1326),b=i(_),M=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"getClasses",value:function(){var e=this.props.msg;switch(e.type){case"location":case"video":case"audio":case"vcard":case"document":case"ciphertext":case"unknown":case"image":return"icon icon-status icon-status-"+(e.isGif?"gif":e.type);case E["default"].TYPE.CALL_LOG:return"miss_video"===e.subtype?"icon icon-status icon-status-miss_video":"icon icon-status icon-status-miss";case"ptt":var t=4===e.ack?"blue":e.isSentByMe?"gray":"green";return"icon icon-status icon-status-"+e.type+"-"+t;default:v["default"].log('chat:getClasses Invalid msg type:"'+e.type+'"')()}return""}},{key:"render",value:function(){return m["default"].createElement("span",{className:this.getClasses()})}}]),t}(m["default"].PureComponent);M.CONCERNS={msg:["ack","isGif","type","subtype","isSentByMe"]},t["default"]=(0,b["default"])(M)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1308),m=(i(f),n(1307)),g=(i(m),n(1440)),v=(i(g),n(6)),y=n(10),E=n(1329),_=n(31),b=n(45),M=n(1318),C=n(8),S=n(1336),T=n(142),w=n(1406),k=n(1321),P=(n(1320),n(217)),N=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=_.throttle(function(e){var t=i.props.mediaMsgs;t.hasMediaBefore&&e.scrollTop+y.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryMedia(_.head(t.models))},100),a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillMount",value:function(){this.props.mediaMsgs.hasMediaBefore&&this.queryMedia()}},{key:"componentDidMount",value:function(){this.props.addListener(this.props.mediaMsgs,"add remove reset"),this.props.addListener(this.props.mediaMsgs,"query_media_before")}},{key:"queryMedia",value:function(e){var t=this,n=this.props.mediaMsgs;n.hasMediaBefore&&this.props.uiIdle(function(){n.queryMedia(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.mediaMsgs,n=this.props,i=n.fullCollection,a=n.selectedMessages,s=t.map(function(n,s){var r=null;return!e.props.fullCollection&&s>=t.length-6&&s<=t.length-4&&(r="media-canvas-second-row"),v.createElement(x,{msg:n,hoverEvent:i,selectable:e.props.selectable,selectedMessages:a,onMessageSelect:e.props.onMessageSelect,className:r,key:n.id})});s.reverse(),i||(s=_.slice(s,0,6));var r=b("media-gallery",{"drawer-media-gallery":i,"media-gallery-empty":0===t.length});if(t.queryMediaBefore&&(i||s.length<6)){var o=b("more","media-canvas-component",{"media-canvas-second-row":!i&&s.length>=3,"media-canvas-first":0===t.length});s.push(v.createElement("div",{className:o,key:"spinner"},v.createElement(T,{stroke:6,size:24,className:"spinner-muted"})))}if(0===t.length){if(i)return t.queryMediaBefore?v.createElement("div",{className:"drawer-media-gallery drawer-body"},v.createElement(k.Loading,null)):v.createElement(k.MediaMsgs,null);t.queryMediaBefore||t.hasMediaBefore||(r=b(r,"media-gallery-empty"),s=[P.t("no_media")])}else for(var c=0;c<6;c++)s.push(v.createElement("div",{className:"media-canvas-empty",key:"empty"+c}));return v.createElement("div",{onScroll:this.onScroll,className:r},s)}}]),t}(v.Component),O=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));D.call(e);var n=e.props,i=n.msg,a=n.selectedMessages;return e.state={selected:!(!a||!a.isSelected(i))},e}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.addListener(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props.msg,t=e.mediaData,n=t.type===M.TYPE.IMAGE&&t.renderableUrl?this.onDragStart:null,i=b("media-canvas-component",this.props.className);return v.createElement(w,{classes:i,onClick:this.onClick,hoverEvent:this.props.hoverEvent,selectable:this.props.selectable,selected:this.state.selected,onMessageSelect:this.props.onMessageSelect,onDragStart:n,msg:e,ref:"canvas"})}}]),t}(v.Component),D=function(){var e=this;this.onSelectChange=function(t){e.state.selected!==t&&e.setState({selected:t})},this.onClick=function(t){var n=e.props,i=n.msg,a=n.selectable,s=n.onMessageSelect,r=i.mediaData;if(a&&s)return void s(i,!e.state.selected);if(r.mediaStage===M.STAGE.ERROR_MISSING)return void C.openModal(v.createElement(S,{msg:i}));t&&t.stopPropagation();var o=void 0,c=i.id;r.type===M.TYPE.IMAGE&&!function(){var t=e.refs&&e.refs.canvas;o=function(e){return c.equals(e)&&t?t.refs.component.refs.img:null}}(),C.mediaViewerModal(i,o)},this.onDragStart=function(t){t.nativeEvent.dataTransfer.setData(y.DRAG_TYPE_LOCAL_IMAGE,!0),t.nativeEvent.dataTransfer.setData("text/uri-list",e.props.msg.mediaData.renderableUrl)}},x=E(O);e.exports=E(N)},function(e,t,n){"use strict";var i=n(6),a=n(1328),s=n(142),r=i.createClass({displayName:"Pending",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-media icon-media-disabled"},i.createElement(s,{size:50,stroke:3})))}}),o=i.createClass({displayName:"PendingCancel",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-cancel"},i.createElement(s,{size:50,stroke:3})))}}),c=i.createClass({displayName:"Cancel",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-download"}))}}),l=i.createClass({displayName:"Download",propTypes:{filesize:i.PropTypes.number.isRequired,onClick:i.PropTypes.func},render:function(){var e=this.props.onClick||null;return this.props.filesize>0?i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta",onClick:e},i.createElement("span",{className:"icon-xl icon-media-download-noborder"}),i.createElement(a,null,l10n.filesize(this.props.filesize)))):i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-download",onClick:e}))}}),u=i.createClass({displayName:"Upload",propTypes:{filesize:i.PropTypes.number.isRequired},render:function(){return this.props.filesize>0?i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta"},i.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),i.createElement(a,null,l10n.filesize(this.props.filesize)))):i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-upload"}))}}),d=i.createClass({displayName:"Play",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-play"}))}}),p=i.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:r,Cancel:c,PendingCancel:o,Download:l,Upload:u,Play:d,Missing:p}},function(e,t,n){"use strict";var i=n(6),a=n(104),s=n(435),r=n(45),o=n(216),c=i.createClass({displayName:"MenuBar",propTypes:{children:i.PropTypes.node},render:function(){return i.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),l=i.createClass({displayName:"MenuBarItem",propTypes:{icon:i.PropTypes.string.isRequired,title:i.PropTypes.string.isRequired,children:i.PropTypes.node,transitionName:i.PropTypes.string,onClick:i.PropTypes.func,a8n:i.PropTypes.string.isRequired},getDefaultProps:function(){return{transitionName:"dropdown"}},getInitialState:function(){return{active:!1}},onOpen:function(e){this.setState({active:!0})},onClose:function(e){this.setState({active:!1})},clickHandler:function(e){this.props.onClick&&this.props.onClick(e),e.isDefaultPrevented()||this.state.active||this.onOpen(e)},render:function(){var e=this,t=this.props,n=t.children,c=t.icon,l=t.transitionName,u=t.title,d=this.state.active,p=void 0;n&&d&&(p=i.createElement(o,{displayName:"MenuBarMenuItem",escapable:!0,popable:!0,requestDismiss:function(){return e.onClose()}},i.Children.only(n)));var h={container:r("menu-item",{active:d}),icon:"icon icon-"+c};return i.createElement("div",{"data-a8n":s.key(this.props.a8n),className:h.container},i.createElement("button",{className:h.icon,onMouseDown:this.clickHandler,title:u}),i.createElement(a,{transitionName:l},p))}});e.exports={MenuBar:c,MenuBarItem:l}},function(e,t){"use strict";e.exports=function(e,t){for(var n=e.childNodes,i=0;i<n.length;++i)if(n[i]===t)return i;return-1}},function(e,t,n){"use strict";var i=n(1379),a=i({FORWARD:void 0,BACKWARD:void 0});e.exports=function(e,t){var n=window.getSelection();if(!n||!n.rangeCount)return null;var i=n.getRangeAt(0);if(!i.collapsed)return null;var s=i.startContainer,r=i.startOffset;if(s===e){var o=s.childNodes,c=o.length;if(t===a.FORWARD&&r>c||t===a.BACKWARD&&!r)return null;var l=t===a.BACKWARD?1:0,u=o[r-l];return u instanceof Element?u:null}var d=s.length===r;if(t===a.BACKWARD&&r)return null;if(t===a.FORWARD&&!d)return null;var p=t===a.BACKWARD?"previousSibling":"nextSibling",h=s[p];return h instanceof Element?h:null},e.exports.Direction=a},function(e,t,n){"use strict";var i=n(6),a=i.createClass({displayName:"SectionHeader",propTypes:{header:i.PropTypes.string.isRequired},render:function(){return i.createElement("div",{className:"list-title"},this.props.header)}});e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1383),c=n(1315),l=n(140),u=n(1314),d=c.Size,p=r.createClass({displayName:"ProfileImage",mixins:[l,u],propTypes:{size:r.PropTypes.oneOfType([r.PropTypes.number,r.PropTypes.oneOf(_.values(d))]),waid:r.PropTypes.string,thumb:r.PropTypes.string,className:r.PropTypes.string,quoted:r.PropTypes.bool},componentWillMount:function(){var e=this,t=this.props.waid;t&&Store.ProfilePicThumb.find(t).checkpoint(this.rejectOnUnmount()).then(function(t){e.addObserverAndRun(t,"change:img",function(){e.setState({img:t.img})})})["catch"](_.noop)},render:function(){return this.state.img?r.createElement(c,{id:this.props.waid,className:this.props.className,quoted:this.props.quoted,size:this.props.size}):r.createElement(o,{className:this.props.className,thumb:this.props.thumb,type:s["default"].TYPE.VCARD,quoted:this.props.quoted,shade:!1})}});p.Size=d,e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(1307),o=i(r),c=n(6),l=n(38),u=n(1348),d=n(1),p=n(140),h=n(1318),f=n(8),m=n(84),g=n(428),v=n(1309),y=n(1385),E=n(1319),b=n(1337),M=n(1341),C=n(1522),S=n(1419),T=n(1421),w=n(1526),k=n(1349),P=new(n(1373)),N=n(1320),O=n(1343),D=n(216),x=n(1220),R=n(45),A=n(139),I=n(10),L=n(104),U={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},F=c.createClass({displayName:"Wrapper",mixins:[p,m],propTypes:{msg:c.PropTypes.instanceOf(o["default"]).isRequired,position:c.PropTypes.oneOf(_.values(U)),displayType:c.PropTypes.oneOf(_.values(I.DISP_TYPE)),isMsgVisible:c.PropTypes.func,hideMsgInfo:c.PropTypes.bool,selectable:c.PropTypes.bool,selectedMessages:c.PropTypes.instanceOf(N),current:c.PropTypes.bool,onMessageSelect:c.PropTypes.func,tailOverride:c.PropTypes.oneOf(["left","right"]),isFocusedMsg:c.PropTypes.bool},getDefaultProps:function(){return{displayType:I.DISP_TYPE.CONVERSATION}},getInitialState:function(){return{contextMenu:!1,hover:!1,highlighting:!1,selected:!!this.props.selectedMessages&&this.props.selectedMessages.isSelected(this.props.msg)}},componentWillReceiveProps:function(e){this.props.isFocusedMsg&&!e.isFocusedMsg&&(this.unregCmd("scroll_to_focused_msg",this.scrollMsg),this.unregCmd("flash_focused_msg",this.flashFocusedMsg)),!this.props.isFocusedMsg&&e.isFocusedMsg&&(this.regCmd("scroll_to_focused_msg",this.scrollMsg),this.regCmd("flash_focused_msg",this.flashFocusedMsg))},shouldComponentUpdate:function(e,t){return x(this,e,t)},componentWillMount:function(){var e=this,t=this.props.msg;t.mayFail()&&(A.supportsFeature(A.F.RESEND_ICON)||t.type===o["default"].TYPE.PTT)&&(this.addObserver(t,"change:isFailed",function(){return e.forceUpdate()}),this.addObserver(t,"change:mediaData.mediaStage",function(){return e.forceUpdate()})),this.props.isFocusedMsg&&(this.regCmd("scroll_to_focused_msg",this.scrollMsg),this.regCmd("flash_focused_msg",this.flashFocusedMsg)),t.typeCanChange()&&this.addObserver(t,"change:type",function(){return e.forceUpdate()}),"video"===t.type&&t.mayBeForwardable()&&!t.canForward()&&this.addObserver(t,"change:ack",function(){return e.forceUpdate()})},componentDidMount:function(){this.props.selectedMessages&&this.addObserver(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)},componentWillUnmount:function(){var e=this.refs.bubble;e&&Velocity(l.findDOMNode(e),"stop",!0)},scrollMsg:function(e,t){var n=l.findDOMNode(this);u.scrollAt(n,null,t).then(e)},flashFocusedMsg:function(e){this.highlight(e)},highlight:function(e){var t=this,n=this.refs.highlightTail,i=this.refs.bubble;if(n&&i){this.setState({highlighting:!0});var a=l.findDOMNode(n),s=l.findDOMNode(i),r=250;Velocity(a,"stop",!0),Velocity(a,{opacity:[1,0]},{duration:r}),Velocity(a,{opacity:[0,1]},{duration:r,delay:r});var o=this.props.msg.isSentByMe?"#dcf8c6":"#ffffff",c=this.props.msg.isSentByMe?"#b3cba1":"#cccccc";Velocity(s,"stop",!0),Velocity(s,{backgroundColor:[c,o]},{duration:r}),Velocity(s,{backgroundColor:[o,c]},{duration:r,delay:r,complete:function(){t.onHighlightComplete(e)}})}},onHighlightComplete:function(e){this.setState({highlighting:!1},function(){e&&e()})},resend:function(){var e=this.props.msg;return e.isMMS&&!A.supportsFeature(A.F.MEDIA_RETRY)?void f.openModal(c.createElement(b,{msg:e})):void e.resend()["catch"](function(e){d.log("wrapper:resend failure: "+e)()})},openSingleForwardFlow:function(){return this._openForwardFlow(!1)},openForwardFlow:function(){return this._openForwardFlow(!0)},_openForwardFlow:function(e){var t,n=this.props.msg;if(n.type===o["default"].TYPE.CIPHERTEXT?t=l10n.t("err_unsent_forward_text_decrypting"):n.type===o["default"].TYPE.REVOKED?t=l10n.t("err_unsent_forward_text_revoked"):n.isUnsentMedia&&(t=l10n.t("err_unsent_forward_text")),t)f.openModal(c.createElement(g,{title:l10n.t("err_unsent_forward_title"),onOK:f.closeModal.bind(f),okText:l10n.t("web_ok")},t));else{if(e&&this.props.displayType===I.DISP_TYPE.CONVERSATION)return void this.onSelectClick();f.openModal(c.createElement(y,{msgs:[this.props.msg]}),"modal-flow")}},openInfoDrawer:function(){f.msgInfoDrawer(this.props.msg)},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){f.openChatFromUnread(e).then(function(t){t&&f.focusChatTextInput(e)})})},mouseEnter:function(){!this.state.hover&&this.contextEnabled()&&this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.contextEnabled()&&this.setState({hover:!1})},contextMenu:function(e){e.stopPropagation()},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){f.closeModal(),e.props.msg.chat.sendDeleteMsgs([e.props.msg])},n=l10n.t("delete_message_confirmation");f.openModal(c.createElement(g,{onOK:t,okText:l10n.t("web_delete"),onCancel:f.closeModal.bind(f),cancelText:l10n.t("web_cancel")},c.createElement(v,{text:n})))},onReplyMessage:function(){this.props.msg.chat.composeQuotedMsg=this.props.msg,f.focusChatTextInput(this.props.msg.chat)},onDownload:function(){k.initDownload(this.props.msg)},onStarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),e.isTrusted&&this.state.contextMenu)return void this.setState({contextMenu:!1});var t=this.props.msg,n=[];t.isSentByMe&&A.supportsFeature(A.F.MESSAGE_INFO)&&this.props.displayType!==I.DISP_TYPE.MSG_INFO&&n.push(c.createElement(E,{key:"info",a8n:"mi-msg-info",action:this.openInfoDrawer},l10n.t("message_info"))),t.canReply()&&n.push(c.createElement(E,{key:"reply",a8n:"mi-msg-reply",action:this.onReplyMessage},l10n.t("reply"))),t.mediaData&&t.mediaData.renderableUrl&&n.push(c.createElement(E,{key:"download",a8n:"mi-msg-download",action:this.onDownload},l10n.t("web_button_download"))),t.canForward()&&n.push(c.createElement(E,{key:"forward",a8n:"mi-msg-forward",action:this.openForwardFlow},l10n.t("forward_message"))),A.supportsFeature(A.F.STARRED)&&(t.star?n.push(c.createElement(E,{key:"star",a8n:"mi-msg-unstar",action:this.onUnstarMessage},l10n.t("unstar_message"))):n.push(c.createElement(E,{key:"star",a8n:"mi-msg-star",action:this.onStarMessage},l10n.t("star_message")))),A.supportsFeature(A.F.MESSAGE_DELETE)&&n.push(c.createElement(E,{key:"delete",a8n:"mi-msg-delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isGroupMsg&&t.author&&!t.isSentByMe&&n.push(c.createElement(E,{key:"author",a8n:"mi-msg-author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),this.setState({contextMenu:{menu:n,anchor:e.target,classes:"dropdown-compact"}})},contextOpen:function(){var e=this.refs.context;e&&e.click()},contextClose:function(){this.setState({contextMenu:!1})},getMsgComponent:function(){var e=this.props,t=e.msg,n=e.position,i=e.displayType,a=e.isMsgVisible,s=i!==I.DISP_TYPE.STARRED_MSGS&&!!t.quotedMsg||!(n===U.MID||n===U.END),r=void 0;if(A.supportsFeature(A.F.REPLIES_IN)){var o=t.quotedMsgObj();o&&(r=c.createElement(T,{msg:o,rootMsg:t,displayType:i,chat:t.chat}))}return c.createElement(S,{msg:t,ref:"component",quotedMsg:r,displayAuthor:s,displayType:i,isMsgVisible:a})},onSelectClick:function(e){e&&e.stopPropagation(),this.props.onMessageSelect(this.props.msg,!this.state.selected)},onSelectChange:function(e){this.state.selected!==e&&this.setState({selected:e})},onDoubleClick:function(e){var t=this.props.msg;if(t.canReply()&&!this.props.selectable){var n=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1};n(this.refs.bubble,e.target)||(t.chat.composeQuotedMsg=t,f.focusChatTextInput(t.chat),this.highlight())}},render:function(){var e,t=this.props,n=t.msg,i=t.position,a=t.displayType,r=a===I.DISP_TYPE.CONVERSATION;(this.state.hover&&!this.state.highlighting||this.props.current||this.state.contextMenu)&&(e=c.createElement(w,(0,s["default"])({},this.props,{key:"icon-context",ref:"context",onClick:this.onMenu})));var l,u=n.mediaData?n.mediaData.mediaStage:"NA";n.type===o["default"].TYPE.PTT&&n.isFailed&&u===h.STAGE.PREPARING?l=c.createElement(C,{
onResend:_.noop,errMsg:l10n.t("ptt_failed")}):A.supportsFeature(A.F.RESEND_ICON)&&r&&n.isFailed&&u!==h.STAGE.REMOTE_UPLOADING?l=c.createElement(C,{onResend:this.resend,errMsg:l10n.t("resend_message")}):!n.isUnsentMedia||u!==h.STAGE.ERROR_MISSING&&u!==h.STAGE.ERROR_UNSUPPORTED||(l=c.createElement(C,{onResend:_.noop,errMsg:l10n.t("send_failed")}));var d=!n.isNotification&&this.props.selectable?c.createElement("div",{className:"msg-select",onClick:this.onSelectClick},c.createElement(M,{onChange:this.onSelectClick,checked:this.state.selected})):null,p=i===U.MID||i===U.END,f=P.match(n.body),m=n.type===o["default"].TYPE.CHAT&&1===f.length&&_.first(f)[0].length===n.body.length,g="message-"+(n.mediaData&&n.mediaData.isGif?o["default"].TYPE.IMAGE:n.type),v=n.type===o["default"].TYPE.CIPHERTEXT||n.type===o["default"].TYPE.REVOKED||n.type===o["default"].TYPE.UNKNOWN,y=n.type===o["default"].TYPE.CHAT&&!n.linkPreview,E=n.chat&&n.chat.isPSA,b={wrapper:R("msg",{"msg-continuation":i===U.FRONT||i===U.MID,"msg-group":n.isGroupMsg&&!p,"msg-psa":a!==I.DISP_TYPE.STARRED_MSGS&&E,selected:this.state.selected}),container:R("message "+g,{"message-system":n.isNotification,"message-out":!n.isNotification&&n.isSentByMe,"message-in":!n.isNotification&&!n.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:!(E||this.props.tailOverride||i!==U.FRONT&&i!==U.SINGLE),"tail-override-left":"left"===this.props.tailOverride,"tail-override-right":"right"===this.props.tailOverride,"message-chat":y||v,"message-code":m,"message-placeholder":v})},S=void 0;S=this.state.contextMenu?"none":"rtl"===n.dir||void 0===n.dir&&l10n.isRTL()?"pop-fast-reverse":"pop-fast";var T=c.createElement("span",{className:"tail-container highlight",ref:"highlightTail"}),k=void 0;this.state.contextMenu&&(k=c.createElement(D,{displayName:"MsgContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},c.createElement(O,{contextMenu:this.state.contextMenu})));var N=void 0;return r&&!this.props.selectable&&n.canForward()&&(n.isMedia||n.linkPreview)&&(N=c.createElement("div",{className:"icon icon-forward-chat btn-forward-chat",onClick:this.openSingleForwardFlow})),c.createElement("div",{className:b.wrapper,onDoubleClick:this.onDoubleClick},c.createElement(L,{transitionName:"delay-leave"},d),c.createElement("div",{className:b.container,ref:"bubble"},c.createElement("div",{onContextMenu:this.contextMenu,onMouseOver:this.mouseEnter,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},c.createElement("span",{className:"tail-container"}),"  ",T,"                      ",l,this.getMsgComponent(),c.createElement(L,{transitionName:S},e)),N),k)}});F.Position=U,e.exports=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GifInfo=t.TENOR=t.GIPHY=t.GAP_SIZE=t.TARGET_GIF_HEIGHT=void 0;var a=n(23),s=i(a),r=t.TARGET_GIF_HEIGHT=130,o=(t.GAP_SIZE=6,t.GIPHY="giphy",t.TENOR="tenor",0);t.GifInfo=function c(e,t,n,i,a,l,u){(0,s["default"])(this,c),this.rank=e,this.gifId=++o,this.url=t,this.previewUrl=n||t,this.nonVideoUrl=i,this.width=a,this.widthStr=a+"px",this.ratioStr=Math.ceil(100*r/a)+"%",this.attribution=l,this.trending=u}},function(e,t){"use strict";function n(){this.renderableUrl=void 0,this.thumbWidth=void 0,this.thumbHeight=void 0,this.fullWidth=void 0,this.fullHeight=void 0,this.preview=void 0,this.duration=void 0,this.streamable=void 0}function i(){this.renderableUrl=void 0,this.thumbWidth=void 0,this.thumbHeight=void 0,this.fullWidth=void 0,this.fullHeight=void 0,this.preview=void 0}function a(){this.renderableUrl=void 0,this.duration=void 0}function s(){this.renderableUrl=void 0,this.pageCount=void 0,this.preview=void 0}function r(e,t,n){var i=!1,a=n.preview;return void 0!==a&&""!==a&&a!==t.preview&&(t.preview=a,i=!0,void 0!==n.thumbWidth&&void 0!==n.thumbHeight||e.computePreviewWidthHeight(a)),void 0!==n.thumbWidth&&n.thumbWidth!==t.thumbWidth&&(t.thumbWidth=n.thumbWidth,i=!0),void 0!==n.thumbHeight&&n.thumbHeight!==t.thumbHeight&&(t.thumbHeight=n.thumbHeight,i=!0),i}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoSpecifics=n,t.ImageSpecifics=i,t.AudioSpecifics=a,t.DocumentSpecifics=s;var o=t.TYPE={VIDEO:"VIDEO",IMAGE:"IMAGE",AUDIO:"AUDIO",DOCUMENT:"DOCUMENT"};n.prototype={type:o.VIDEO,hydrate:function(e,t){t.renderableUrl=this.renderableUrl,t.fullWidth=this.fullWidth,t.fullHeight=this.fullHeight,t.preview=this.preview,t.duration=this.duration,t.streamable=this.streamable,e&&(t.thumbWidth=this.thumbWidth,t.thumbHeight=this.thumbHeight)},consolidate:function(e,t){var n=!1;return void 0!==t.renderableUrl&&t.renderableUrl!==this.renderableUrl&&(this.renderableUrl=t.renderableUrl,n=!0),void 0!==t.fullWidth&&t.fullWidth!==this.fullWidth&&(this.fullWidth=t.fullWidth,n=!0),void 0!==t.fullHeight&&t.fullHeight!==this.fullHeight&&(this.fullHeight=t.fullHeight,n=!0),void 0!==t.duration&&t.duration!==this.duration&&(this.duration=t.duration,n=!0),void 0!==t.streamable&&t.streamable!==this.streamable&&(this.streamable=t.streamable,n=!0),r(e,this,t)&&(n=!0),n}},i.prototype={type:o.IMAGE,hydrate:function(e,t){t.renderableUrl=this.renderableUrl,t.fullWidth=this.fullWidth,t.fullHeight=this.fullHeight,t.preview=this.preview,e&&(t.thumbWidth=this.thumbWidth,t.thumbHeight=this.thumbHeight)},consolidate:function(e,t){var n=!1;return void 0!==t.renderableUrl&&t.renderableUrl!==this.renderableUrl&&(this.renderableUrl=t.renderableUrl,n=!0),void 0!==t.fullWidth&&t.fullWidth!==this.fullWidth&&(this.fullWidth=t.fullWidth,n=!0),void 0!==t.fullHeight&&t.fullHeight!==this.fullHeight&&(this.fullHeight=t.fullHeight,n=!0),r(e,this,t)&&(n=!0),n}},a.prototype={type:o.AUDIO,hydrate:function(e,t){t.renderableUrl=this.renderableUrl,t.duration=this.duration},consolidate:function(e,t){var n=!1;return void 0!==t.renderableUrl&&t.renderableUrl!==this.renderableUrl&&(this.renderableUrl=t.renderableUrl,n=!0),void 0!==t.duration&&t.duration!==this.duration&&(this.duration=t.duration,n=!0),n}},s.prototype={type:o.DOCUMENT,hydrate:function(e,t){t.renderableUrl=this.renderableUrl,t.pageCount=this.pageCount,t.preview=this.preview},consolidate:function(e,t){var n=!1;return void 0!==t.renderableUrl&&t.renderableUrl!==this.renderableUrl&&(this.renderableUrl=t.renderableUrl,n=!0),void 0!==t.pageCount&&t.pageCount!==this.pageCount&&(this.pageCount=t.pageCount,n=!0),void 0!==t.preview&&t.preview!==this.preview&&(this.preview=t.preview,n=!0),n}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMetadataProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(218),o=i(r),c=n(145),l=i(c),u=n(6),d=n(1),p=n(439),h=n(441),f=n(66),m=n(8),g=n(139),v=n(14),y=n(10),E=n(432),_=n(105).ActionToast,b=n(105).ActionType,M=(0,c.defineState)("Participant",{props:{id:"string",isAdmin:"boolean"},session:{contact:"object"},initialize:function(){l["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},"delete":function(){l["default"].prototype["delete"].call(this)}}),C=M.Participant,S=p.extend(h,{model:C,comparator:function(e,t){return o["default"].Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(m,"locale_change",this.sort)},"delete":function(){this.invokeMap("delete"),this.stopListening(),this.reset()},addParticipant:function(e,t){var n=this;if(this.get(e.id))return m.openToast(u.createElement(E,{id:E.genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),s["default"].reject(new v.ActionError);if(!this.canAdd())return s["default"].reject(new v.ActionError);var i=f.addParticipant(this.parent.id,e.id),a=new b(l10n.t("action_participant_adding",{participant:e.formattedShortName}));t=t||_.genId();var r=i.then(function(t){return 200===t.status?new b(l10n.t("action_participant_added",{participant:e.formattedShortName})):404===t.status?new b(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new b(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new b(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:addParticipant dropped")(i),new b(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),n.addParticipant.bind(n,e,t))});return m.openToast(u.createElement(_,{id:t,initialAction:a,pendingAction:r})),i},removeParticipant:function(e,t){var n=this;if(!this.canRemove(e))return s["default"].reject(new v.ActionError);var i=f.removeParticipant(this.parent.id,e.id),a=new b(l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}));t=t||_.genId();var r=i.then(function(t){return 200===t.status?new b(l10n.t("action_participant_removed",{participant:e.contact.formattedShortName})):404===t.status?new b(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new b(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new b(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:removeParticipant dropped")(i),new b(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),n.removeParticipant.bind(n,e,t))});return m.openToast(u.createElement(_,{id:t,initialAction:a,pendingAction:r})),i},promoteParticipant:function(e,t){var n=this;if(!this.canPromote(e))return s["default"].reject(new v.ActionError);var i=f.promoteParticipant(this.parent.id,e.id),a=new b(l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}));t=t||_.genId();var r=i.then(function(t){return 200===t.status?new b(l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName})):404===t.status?new b(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new b(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new b(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:removeParticipant dropped")(i),new b(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),n.promoteParticipant.bind(n,e,t))});return m.openToast(u.createElement(_,{id:t,initialAction:a,pendingAction:r})),i},canAdd:function(){return!!g.supportsFeature(g.F.GROUP_ADD_PARTICIPANT)&&!!this.iAmAdmin()},canPromote:function(e){return!!g.supportsFeature(g.F.GROUP_PROMOTE_PARTICIPANT)&&(!!e&&(Store.Conn.me!==e.id&&(!!this.iAmAdmin()&&!e.isAdmin)))},canRemove:function(e){return!!g.supportsFeature(g.F.GROUP_REMOVE_PARTICIPANT)&&(!!e&&(Store.Conn.me!==e.id&&!!this.iAmAdmin()))},canVerifyIdentity:function(e){return!!g.supportsFeature(g.F.QUERY_IDENTITY)&&(!!e&&(Store.Conn.me!==e.id&&!!e.contact.plaintextDisabled))},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),T=(0,c.defineState)("GroupMetadata",{Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:["boolean",!1,!0],inviteCode:"string",promises:{type:"object","default":function(){return{}}}},derived:{groupInviteLink:{deps:["inviteCode"],fn:function(){return this.inviteCode?""+y.GROUP_INVITE_LINK_URL+this.inviteCode:null}}},collections:{participants:S},"delete":function(){l["default"].prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants["delete"]()},canSetSubject:function(){return!!g.supportsFeature(g.F.GROUP_SET_SUBJECT)&&!!this.participants.iAmMember()},initialize:function(){l["default"].prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted(),this.listenTo(this.participants,"add remove reset",this.onParticipantChange)},isTrusted:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,n=0,i=t.length;n<i;++n){var a=t[n];if(a.isAdmin&&a.id!==Store.Conn.me&&a.contact.isMyContact)return this.trusted=!0}return this.trusted=!1},onParticipantChange:function(){Store.Contact.get(this.id).unset("_capabilities"),Store.GroupMetadata.trigger("group_participant_change",this.id)},groupInviteCode:function(){var e=this;return this.promises.groupInviteCode?this.promises.groupInviteCode:this.promises.groupInviteCode=f.groupInviteCode(this.id).then(function(t){var n=t.status,i=t.code;return 200===n&&(e.inviteCode=i),n})["finally"](function(){e.promises.groupInviteCode=null})},revokeGroupInvite:function(){var e=this;return this.promises.revokeGroupInvite?this.promises.revokeGroupInvite:this.promises.revokeGroupInvite=f.revokeGroupInvite(this.id).then(function(t){var n=t.status,i=t.code;return 200===n&&(e.inviteCode=i),n})["finally"](function(){e.promises.revokeGroupInvite=null})}}),w=T.GroupMetadata,k=T.GroupMetadataProxy;t["default"]=w,t.GroupMetadataProxy=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusProxy=t["default"]=void 0;var i=n(145),a=(0,i.defineState)("Status",{Collection:"Status",props:{id:"string",status:"string"},session:{stale:["boolean",!1,!0]}}),s=a.Status,r=a.StatusProxy;t["default"]=s,t.StatusProxy=r},function(e,t,n){"use strict";function i(){if(!s){var e=n(1645),t=e.length/2;s=new Int32Array(t),r=new Int32Array(t);for(var i=0,a=0;i<t;i++,a+=2)s[i]=e[a]+(0===i?0:s[i-1]),r[i]=e[a+1]}}function a(e){i();for(var t=0;t<e.length;t++){var n=0|e.charCodeAt(t);if(55296<=n&&n<56320){if(++t===e.length)break;var a=e.charCodeAt(t);if(!(56320<=a&&a<57344))continue;n=65536+((1023&n)<<10|1023&a)}else if(56320<=n&&n<57344)continue;if(!(n<s[0])){for(var o=0|s.length,c=0,l=o-1|0;c<l;){var u=l+c>>1;if(s[u]>n)l=u-1|0;else{if(s[u+1]>n){l=u;break}c=u+1|0}}var d=r[l],p=s[l]+Math.abs(d)|0;if(n<p)return d<0?"rtl":"ltr"}}}var s,r;e.exports={dir:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(e=e.replace(E,""),e=e.replace(O,""),e=e.replace(A,"$1"),e=e.replace(I,"$1"),!x.test(e)&&D.test(e)){for(var n,i=t.getRangeAt(0).startContainer,a=0;a<5&&!(n=i.getAttribute&&i.getAttribute("data-id"));a++)i=i.parentNode;var s=Store.Msg.get(n);if(s){var r="["+g.timeStr(s.t)+"]",o=s.senderObj.formattedUser;e=S+r+" "+o+": "+T+e}}e=e.replace(R,"");var c=e.match(D);return c&&1===c.length&&(e=e.replace(D,"")),e=e.replace(D,"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e}function s(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(c).join("");return a(t,e)}function r(e){var t={},n=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(function(e){return l(e,t)}).join("");return(0,h["default"])({text:a(n,e),jids:t})}function o(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(c).join("");if(t.indexOf(b)>-1){var n=_.compact(t.match(C));if(n.length)return n.join("\n").replace(M,"")}return t}function c(e){return e instanceof HTMLImageElement?e.alt:e.nodeType===Node.TEXT_NODE?e.nodeValue:_.map(e.childNodes,c).join("")}function l(e,t){if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;if(d(e)){var n=e.getAttribute("data-jid");return t[n]=!0,"@"+f.user(n)}var i=u(e)||"",a=_.map(e.childNodes,function(e){return l(e,t)}).join("");return i?""+i+a+i:a}function u(e){switch(e.tagName){case"CODE":return"```";case"STRONG":return"*";case"EM":return"_";case"DEL":return"~";default:return""}}function d(e){return e&&e instanceof HTMLSpanElement&&e.hasAttribute("data-jid")&&e.getAttribute("data-display")===m.NodeToEmoji(e)}var p=n(20),h=i(p),f=n(26),m=n(433),g=n(143),v="​",y="⁠",E=new RegExp(v,"g"),b=""+v+y+v,M=new RegExp(""+b),C=new RegExp("(?:"+b+"|^)(.+?)(?:"+b+"|$)","g"),S=y+y,T=y+y+y,w=S+"([^"+y+"]+)"+T,k=y+y+y+y,P=y+y+y+y+y,N=k+"[^"+y+"]+"+P,O=new RegExp(N,"g"),D=new RegExp(w,"g"),x=new RegExp("^"+w),R=new RegExp(w+"$"),A=new RegExp("^[^"+y+"]+"+P+"(.*)","g"),I=new RegExp("(.*)"+k+"[^"+y+"]+$","g");e.exports={asPlainText:s,asRichText:r,formatDelim:u,extractIsolatedBlocks:o}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){for(var n=0,i=e[n];n<e.length;i=e[++n])if("text/plain"===i.type)return i;return null}var s=n(2),r=i(s),o=n(23),c=i(o),l=n(25),u=i(l),d=/\r\n/g,p=function(){function e(t){var n=this;(0,c["default"])(this,e),this.hasText=function(){return n.types.some(function(e){return"text/plain"===e})},this.hasType=function(e){return n.types.indexOf(e)!==-1},this.data=t,this.types=t.types?Array.prototype.slice.call(t.types):[]}return(0,u["default"])(e,[{key:"getItems",value:function(){var e=this;if(this.data.items)return Array.prototype.slice.call(this.data.items);var t=this._getFileTypes();return this.types.map(function(n){return{type:n,data:e.data.getData(n),kind:t.indexOf(n)>=0?"string":"file"}})}},{key:"_getFileTypes",value:function(){return Array.prototype.slice.call(this.data.files).map(function(e){var t=e.type;return t})}},{key:"getText",value:function(){return this._getText().then(function(e){return e?e.replace(d,"\n"):null})}},{key:"_getText",value:function(){var e=this.data;if(e.getData)return r["default"].resolve(e.getData("text/plain"));var t=this.data.items,n=a(t,"text/plain");return n?new r["default"](function(e){return n.getAsString(e)}):r["default"].resolve()}},{key:"getFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).filter(function(e){var t=e.kind;return"file"===t}).map(function(e){return e.getAsFile()}).filter(function(e){return!!e}):Array.prototype.slice.call(this.data.files||[])}},{key:"hasFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).some(function(e){var t=e.kind;return"file"===t}):!!Array.prototype.slice.call(this.data.files||[]).length}}]),e}();e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(6),o=n(8),c=n(14),l=n(1345),u=n(1),d={start:function(e){var t=this;if("camera"!==e&&"microphone"!==e)return void u.error("mediaCapture:start incompatible type given")();var n=new s["default"](function(i,a){t.timeout=setTimeout(function(){var t="camera"===e?"guide_desktop_camera_title":"guide_desktop_mic_title",n="camera"===e?"guide_desktop_camera_description":"guide_desktop_mic_description";o.openModal(r.createElement(l,{title:t,desc:n,type:l.TYPE.GUIDE_ALLOW}))},1e3);var s="camera"===e?{video:!0}:{audio:!0};navigator.getUserMedia(s,function(e){o.closeModal(),clearTimeout(t.timeout),i(e)},function(e){var i=_.isString(e)?e:e.name,s=c.GUM[i]||c.GUM.GUMError;clearTimeout(t.timeout),a(new s),n&&!n.isPending()&&o.closeModal()})});return n},stop:function(e){if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()}};e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1339),m=function(e){function t(e,n,i){(0,o["default"])(this,t);var a=(0,d["default"])(this,(0,s["default"])(t).call(this));return a._delimiter=e,a._regex=n,a._group=i,a}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function n(e){for(var t=[],n=void 0;n=this._regex.exec(e);){var i=this._delimiter.length,a=2*i+n[this._group].length;if(n[0].length!==a){var s=n[0].length-a;n.index+=s,n[0]=n[0].slice(s)}this._regex.lastIndex--,t.push(n)}return t}},{key:"group",get:function(){return this._group}},{key:"isFormatter",get:function(){return!0}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1372),m=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).call(this,"```",/```([\s\S]+?)```/g,1))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"formatResult",get:function(){return!1}}]),t}(f);e.exports=m},function(e,t,n){"use strict";var i=n(444),a={multibyteLength:function(e){return i.ucs2.decode(e).length},multibyteSubstr:function(e,t,n){var a=i.ucs2.decode(e);if("undefined"==typeof n)a=a.slice(t);else{if(n<=0)return"";a=a.slice(t,t+n)}return i.ucs2.encode(a)}};e.exports=a},function(e,t,n){"use strict";var i=n(6),a=n(45),s=n(434).MIMETYPES,r=_.pickBy(s,function(e){return"document"===e.msgType}),o=i.createClass({displayName:"AttachMediaTypeFile",propTypes:{mimeType:i.PropTypes.string,filename:i.PropTypes.string},render:function(){var e=this.props,t=e.mimeType,n=e.filename,s="icon-doc";return r[t]&&(s=a(s,r[t].icon)),i.createElement("div",{className:"media-element-container"},i.createElement("div",{className:"media-element"},i.createElement("div",{className:"media-document"},i.createElement("div",{className:s}),i.createElement("div",{className:"media-document-text"},n))))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=i(f),g=n(1307),v=(i(g),n(45)),y=i(v),E=n(1326),_=i(E),b=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props.msg.ack,t=(0,y["default"])("icon icon-ack",{"icon-status-time":e<1,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return m["default"].createElement("span",{className:t})}}]),t}(m["default"].PureComponent);b.CONCERNS={msg:["ack"]},t["default"]=(0,_["default"])(b)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1333),o=i(r),c=n(6),l=n(1),u=n(1319),d=n(1511),p=n(1431),h=n(1334),f=n(1330),m=n(435),g=n(1488),v=n(142),y=n(428),E=n(216),b=n(1343),M=n(8),C=n(10),S=n(45),T=n(104),w=200,k=1.3,P=2,N={GROUP:"group",PROFILE:"profile",NO_EDIT:"no_edit"},O=c.createClass({displayName:"PhotoPicker",propTypes:{startImage:c.PropTypes.string,type:c.PropTypes.oneOf(_.values(N)).isRequired,id:c.PropTypes.string,pending:c.PropTypes.bool,className:c.PropTypes.oneOfType([c.PropTypes.string,c.PropTypes.arrayOf(c.PropTypes.string),c.PropTypes.objectOf(c.PropTypes.bool)]),onImageSet:c.PropTypes.func.isRequired},statics:{Type:N},getInitialState:function(){return{img:this.props.startImage,imgCanvas:null,left:0,top:0,isEditing:!1,hover:!1,contextMenu:!1}},componentWillReceiveProps:function(e){this.props.startImage!==e.startImage&&this.setState({img:e.startImage,imgCanvas:null,isEditing:!1,left:0,top:0})},cropImage:function(){if(!this.state.img)return s["default"].reject("Image missing from state");var e=this.state.imgCanvas||this.state.img,t=this.state.scale,n=Math.abs(this.state.left/t),i=Math.abs(this.state.top/t),a=w/t,r=a;a>C.MAX_PIC_SIDE?r=C.MAX_PIC_SIDE:a<C.MIN_PIC_SIDE&&(r=C.MIN_PIC_SIDE);var o;return new s["default"](function(t,s){f.crop(e,n,i,a,a,r,r,f.DATA_URL|f.CANVAS).then(function(e){var t=e.images;return o=t.dataUrl,f.crop(t.canvas,0,0,C.PROF_PIC_THUMB_SIDE,C.PROF_PIC_THUMB_SIDE,f.DATA_URL)}).then(function(e){var n=e.images;t({thumb:n.dataUrl,full:o})})["catch"](s)})},onZoomIn:function(){var e=this.state.scale*k;P<=e||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/k;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onCrop:function(){this.props.pending||this.cropImage().bind(this).then(function(e){this.props.onImageSet(e.thumb,e.full)})["catch"](function(){this.setState({img:this.props.startImage,imgCanvas:null,isEditing:!1})})},onDragEnd:function(e,t){this.setState({left:e,top:t})},onUpload:function(e){var t=this.refs.imageInput;return t.click(),!0},removeImage:function(){this.props.onImageSet(),M.closeModal()},onRemove:function(e){var t=this.props.type===N.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");M.openModal(c.createElement(y,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:M.closeModal.bind(M),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer,t=function(t){t(e)};M.openModalMedia(c.createElement(p,{contact:Store.Contact.get(this.props.id),animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},onImageTake:function(e){this.createAndSetImage(e)},onImagePick:function(e){this.contextClose();var t=e.target.files[0];return!!t&&(this.createAndSetImage(t),void(e.target.value=""))},createAndSetImage:function(e){var t=this;f.rotateAndResize(e,3*C.IMG_MAX_EDGE,3*C.IMG_MAX_EDGE,f.DATA_URL|f.CANVAS).then(function(e){var n=e.width,i=e.height,a=e.images,s=w/Math.min(n,i);t.setState({img:a.dataUrl,imgCanvas:a.canvas,isEditing:!0,scale:s,minScale:s})})["catch"](function(e){l.error("PhotoPicker:createAndSetImage:error "+e)(e)})},onImageClick:function(e){if(this.props.type===N.NO_EDIT&&this.state.img)return void this.onView();if(!this.state.isEditing){e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&this.state.img&&t.push(c.createElement(u,{a8n:"mi-view-photo",key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(c.createElement(d,{key:"take",onImageTake:this.onImageTake})),t.push(c.createElement(u,{a8n:"mi-upload-photo",key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(c.createElement(u,{a8n:"mi-remove-photo",key:"remove",action:this.onRemove},l10n.t("remove_photo"))),e.persist(),this.setState({contextMenu:{menu:t,event:e}})}},contextClose:function(){this.setState({contextMenu:!1})},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,n=e.target.clientHeight;this.setState({imageSize:{width:t,height:n}})},render:function(){var e;if(this.state.img&&this.state.isEditing){var t={width:w,height:w};e=c.createElement(g,{ref:"img",container:t,onStop:this.onDragEnd,scale:this.state.scale},c.createElement("img",{className:"avatar-original",src:this.state.img}))}else this.state.img&&(e=c.createElement(h,{type:h.TYPES.COVER,size:this.state.imageSize},c.createElement(o["default"],{src:this.state.img,crossOrigin:!1,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var n;(this.props.pending||!this.state.isEditing&&this.state.img&&!this.state.imageSize)&&(n=c.createElement("div",{className:"avatar-spinner-container"},c.createElement(v,{size:50,stroke:3})));var i=null;if(!this.props.pending&&this.props.type!==N.NO_EDIT&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextMenu||!this.state.isEditing&&this.state.hover)){var a;switch(this.props.type){case"group":a=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case"profile":a=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}i=c.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},c.createElement("span",{className:"icon icon-camera-light"}),c.createElement("div",{"data-a8n":m.key("avatar-text"),className:"avatar-overlay-text"},a))}var s,r,l=S("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==N.PROFILE,"icon-user-default":this.props.type===N.PROFILE});this.state.isEditing&&(s=c.createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},c.createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),c.createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),r=c.createElement("div",{className:"tip-container tip-avatar-picker",key:"tip-controls"},c.createElement("div",{className:"tip"},c.createElement("div",{className:"tip-body"},l10n.t("adjust_image")),c.createElement("div",{className:"tip-controls"},c.createElement("button",{className:"button",onClick:this.onCrop},l10n.t("done_adjusting"))))));var u=this.props.type===N.NO_EDIT||this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick,d=void 0;this.state.contextMenu&&(d=c.createElement(E,{displayName:"PhotoPickerContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},c.createElement(b,{contextMenu:this.state.contextMenu})));var p=S("avatar-picker",this.props.className);return c.createElement("div",{className:p},c.createElement("div",{className:l,onClick:u,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer",dir:"ltr"},c.createElement("div",{className:"avatar-body"},e),c.createElement(T,{transitionName:"fade"},n,i)),c.createElement(T,{transitionName:"fade"},s),c.createElement(T,{transitionName:"slide"},r),c.createElement("input",{ref:"imageInput",type:"file",accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}),d)}});e.exports=O},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(147),s=i(a),r=n(1217),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=function(){},h=function(){function e(){(0,l["default"])(this,e),this.internalHandlers=new o["default"]}return(0,d["default"])(e,[{key:"initialize",value:function(e){this.ctx=e}},{key:"registerHandler",value:function(e,t){this.internalHandlers.set(e,t)}},{key:"unregisterHandler",value:function(e){this.internalHandlers["delete"](e)}},{key:"handle",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return(this.internalHandlers.get(e)||p).apply(void 0,(0,s["default"])(t))}}]),e}();e.exports=h},function(e,t){"use strict";var n=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=n);return t};e.exports=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(45),u=c.createClass({displayName:"Row",propTypes:{side:c.PropTypes.node,ellipsify:c.PropTypes.bool,classes:c.PropTypes.string,onClick:c.PropTypes.func},getDefaultProps:function(){return{ellipsify:!1}},render:function(){var e=this.props,t=e.onClick,n=e.side,i=e.ellipsify,a=e.classes,r=e.children,u=(0,o["default"])(e,["onClick","side","ellipsify","classes","children"]),d=l("row",a,{clickable:t}),p=l("row-main",{ellipsify:i}),h=n?c.createElement("div",{className:"row-side"},n):null;return c.createElement("div",(0,s["default"])({className:d,onClick:t},u),c.createElement("div",{className:"row-body"},c.createElement("div",{className:p},r),h))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Location=void 0;var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=i(f),g=n(1309),v=i(g),y=n(1326),E=i(y),_=n(1354),b=(i(_),t.Location={LIST:"list",TITLE:"title"},function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props.presence,t=void 0;return"list"===this.props.location?(t=e.getFormattedString(),t?m["default"].createElement(v["default"],{ellipsify:!0,titlify:!0,text:t}):null):(t=e.withholdDisplay?this.props.placeholder:e.getFormattedString()||(e.forceDisplay?"":this.props.placeholder),t?m["default"].createElement("div",{
className:"chat-status ellipsify"},m["default"].createElement(v["default"],{ellipsify:!0,titlify:!0,text:t})):null)}}]),t}(m["default"].PureComponent));b.CONCERNS={presence:["withholdDisplay","forceDisplay","hasData"],chatstate:["type","deny","t"]},t["default"]=(0,E["default"])(b)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1309),c=n(1417),l=r.createClass({displayName:"Caption",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=this.props.msg,t=e.mentionMap();return r.createElement("div",{className:"image-caption message-text","data-id":e.id},r.createElement(c,{msg:e}),r.createElement(o,{direction:e.dir,dirMismatch:!(!e.dir||e.rtl===l10n.isRTL()),selectable:!0,text:e.caption,linkify:!0,mention:t,format:!0,wbr:15}))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(1307),o=i(r),c=n(6),l=n(1328),u=n(143),d=n(45),p=n(67),h=c.createClass({displayName:"PreviewImage",propTypes:{duration:c.PropTypes.oneOfType([c.PropTypes.string,c.PropTypes.number]),shade:c.PropTypes.bool,thumb:c.PropTypes.string,className:c.PropTypes.string,type:c.PropTypes.oneOf([o["default"].TYPE.AUDIO,o["default"].TYPE.LOCATION,o["default"].TYPE.VIDEO,o["default"].TYPE.PTT,o["default"].TYPE.VCARD]).isRequired,quoted:c.PropTypes.bool},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){if(this.props.type===o["default"].TYPE.VIDEO)return"icon-sm icon-video-inv"},getClassNames:function(){if(this.props.type===o["default"].TYPE.AUDIO)return"icon icon-audio-file preview";var e=this.props.type===o["default"].TYPE.VCARD||this.props.type===o["default"].TYPE.PTT;return d("preview",this.props.className,(0,s["default"])({"icon-user-default":e,"icon-user-default-square":e&&this.props.quoted},"preview-"+this.props.type+" no-image",!this.props.thumb))},getStyles:function(){var e=this.props.thumb;return e?p.isHttp(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=u.durationStr(this.props.duration),t=this.props.shade?c.createElement("span",{className:"shade"}):null,n=this.props.type===o["default"].TYPE.AUDIO?null:c.createElement("div",{className:"preview-image",style:this.getStyles()});return c.createElement("div",{className:this.getClassNames()},n,t,c.createElement("span",{className:"meta meta-audio"},c.createElement("span",{className:this.getIconClassNames()}),c.createElement(l,null,e)))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(103),o=i(r),c=n(6),l=n(38),u=n(140),d=n(1363),p=n(45),h=n(143),f=n(1309),m=n(1348),g=n(1315),v=n(26),y=n(82),E=n(1320),_=n(10),b=c.createClass({displayName:"StarredMsg",mixins:[u],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired,isMsgVisible:c.PropTypes.func,selectable:c.PropTypes.bool,selectedMessages:c.PropTypes.instanceOf(E),onMessageSelect:c.PropTypes.func,currSelection:c.PropTypes.object,activeSelection:c.PropTypes.object,onClickMsg:c.PropTypes.func.isRequired,multiMedia:c.PropTypes.bool},getInitialState:function(){var e=this.props.currSelection,t=this.props.activeSelection,n=this.props.msg;return{hover:!1,current:!!e&&e.value===n,active:!!t&&t.value===n,focus:!1}},componentWillMount:function(){var e=this.props.msg,t=this.props.currSelection;t&&this.addObserver(t,e.id.toString(),this.onSelectionChange);var n=this.props.activeSelection;n&&this.addObserver(n,e.id.toString(),this.onActiveChange)},onSelectionChange:function(e,t){var n="focus"===e;if(n){var i=l.findDOMNode(this);y.focus(i),t&&m.scrollIntoViewIfNeeded(i)}this.setState({current:n})},onActiveChange:function(e){if("focus"===e){var t=l.findDOMNode(this);y.focus(t),m.scrollIntoViewIfNeeded(t)}this.setState({active:!!e})},mouseOver:function(){this.state.hover||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},onEnter:function(e){e.stopPropagation(),e.preventDefault(),this.props.onClickMsg(this.props.msg)},openContextMenu:function(e){this.refs.wrapper.contextOpen()},onFocus:function(e){this.setState({focus:!0}),this.indicateFocus(e)},onBlur:function(e){this.finishFocusIndication(e),this.setState({focus:!1})},indicateFocus:function(e){if(!(Date.now()-(o["default"].flashFocus||0)>200)){var t=this.refs.row,n=this.state.active?"#d6d7d8":"#e2e3e3";Velocity(t,"stop"),Velocity(t,{backgroundColor:[n,"#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.finishFocusIndication})}},finishFocusIndication:function(e){var t=this.refs.row;t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props,n=t.msg,i=t.selectedMessages,a=n.senderObj.formattedName,s=n.chat.isUser?Store.Contact.get(n.to).formattedName?Store.Contact.get(n.to).formattedName:v.formattedUser(n.to):n.chat.title(),r=p("starred-msg-wrapper",{hover:this.state.hover,current:this.state.current&&this.state.focus,active:this.state.active}),l=this.props.multiMedia?null:c.createElement("div",{className:"starred-msg-title"},c.createElement("div",{className:"starred-title-main"},c.createElement(g,{id:n.senderObj.id,size:26}),c.createElement(f,{className:"starred-msg-author",text:a,direction:"auto",ellipsify:!0,titlify:!0}),c.createElement("span",{className:"starred-title-divider"}),c.createElement(f,{className:"starred-msg-chat",text:s,direction:"auto",ellipsify:!0,titlify:!0})),c.createElement("div",{className:"starred-title-meta"},h.relativeStr(n.t)),c.createElement("div",{className:"icon icon-chevron-right-alt"})),u={enter:this.onEnter};u[l10n.LR("right","left")]=this.openContextMenu;var m=this.props.selectable||this.state.hover&&this.props.multiMedia;return c.createElement(o["default"],{handlers:u,onFocus:this.onFocus,onBlur:this.onBlur},c.createElement("div",{ref:"row",className:r,onClick:function(){return e.props.onClickMsg(n,i&&!i.isSelected(n))},onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},l,c.createElement(d,{msg:n,key:n.id,ref:"wrapper",current:this.state.current&&this.state.focus,displayType:_.DISP_TYPE.STARRED_MSGS,isMsgVisible:this.props.isMsgVisible,selectable:m,selectedMessages:i,onMessageSelect:this.props.onMessageSelect,position:d.Position.END,tailOverride:"left"})))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(431),o=i(r),c=n(1307),l=i(c),u=n(6),d=n(1323),p=n(428),h=n(8),f=n(1387),m=u.createClass({displayName:"ForwardMessageFlow",mixins:[d],propTypes:{msgs:u.PropTypes.arrayOf(u.PropTypes.instanceOf(l["default"])).isRequired,onFoward:u.PropTypes.func},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,d.Dir.PUSH,d.Transition.NONE),(0,o["default"])(e,d.Dir.POP,d.Transition.NONE),e},componentWillMount:function(){var e=l10n.t("forward_message_to",{_plural:this.props.msgs.length||1}),t=_.head(this.props.msgs)&&_.head(this.props.msgs).chat;this.push(u.createElement(f,{onChat:this.onForwardConfirmed,excludeChat:t,title:e}))},checkCanForward:function(){return s["default"].map(this.props.msgs,function(e){return s["default"].props({message:e,canForward:e.canForward()})})},onForwardConfirmed:function(e){var t=this,n=this.checkCanForward();s["default"].map(e,function(e){var t=void 0;return t=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),s["default"].all([n,t]).spread(function(t,n){var i=_.map(_.filter(t,{canForward:!0}),"message"),a=_.map(_.filter(t,{canForward:!1}),"message");return s["default"].props({chat:e,undelivered:e.forwardMessages(i),canForward:i,cannotForward:a})})}).then(function(e){var n=_.compact(e.map(function(e){var n=e.chat,i=e.undelivered,a=e.canForward,s=e.cannotForward,r=null;return(i.length||s.length)&&(r=t.getForwardFailReason(n,i,a,s)),r?{chat:n,reason:r}:null}));n.length&&t.showMediaSendError(n)}),this.endFlow(),_.isFunction(this.props.onForward)&&this.props.onForward(this.props.msgs),h.openChatFromUnread(_.head(e))},getForwardFailReason:function(e,t,n,i){var a=n.length-t.length,s=void 0;if(a){var r=i.length+t.length;s=t.length?i.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact",{count:r,_plural:r,contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group",{count:r,_plural:r}):l10n.t("cannot_forward_media_missing",{count:r,_plural:r}):e.isUser?l10n.t("cannot_forward_capability_contact",{count:r,_plural:r,contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group",{count:r,_plural:r})}else s=t.length?i.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group_none"):l10n.t("cannot_forward_media_missing_none"):e.isUser?l10n.t("cannot_forward_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group_none");return s},showMediaSendError:function(e){var t=e.map(function(e){var t=e.chat,n=e.reason;return u.createElement("p",{key:t.id},t.formattedTitle," : ",n)});h.openModal(u.createElement(p,{onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},t),void 0)}});e.exports=m},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){var n=!1,i=r(t.type);if(i){if(!e.specifics)switch(i){case O.TYPE.VIDEO:e._uploadAsGif=!!t.isGif,e.specifics=new O.VideoSpecifics;break;case O.TYPE.IMAGE:e.specifics=new O.ImageSpecifics;break;case O.TYPE.AUDIO:e.specifics=new O.AudioSpecifics;break;case O.TYPE.DOCUMENT:e.specifics=new O.DocumentSpecifics;break;default:C["default"].assert(!1,"media-fault","bad type "+i)()}C["default"].assert(e.type()===i,"media-fault","type mismatch "+e.type+" !== "+i)()}var a=t.downloadStage,s=t.uploadStage;a&&a!==e.downloadStage&&(e.downloadStage=a,n=!0),s&&s!==e.uploadStage&&(e.uploadStage=s,n=!0);for(var o=0;o<D.length;o++){var c=D[o],l="streamable"!==c&&t[c];void 0!==l&&e[c]!==l&&(C["default"].assert(void 0===e[c]||"size"===c||"mediaBlob"===c&&null===e.mediaBlob,"media-fault","value mismatch for "+c+": "+e[c]+" !== "+l)(),e[c]=l,n=!0)}e.specifics.consolidate(e,t)&&(n=!0);var u=e.mediaBlob,d=e.size;return u&&d!==u.size&&(e.size=u.size,n=!0),n}function r(e){switch(e){case U.IMAGE:return O.TYPE.IMAGE;case U.VIDEO:return O.TYPE.VIDEO;case U.AUDIO:case U.PTT:return O.TYPE.AUDIO;case U.DOCUMENT:return O.TYPE.DOCUMENT;default:return}}function o(e){var t={};c(t,e,D),e.specifics&&e.specifics.hydrate(!0,t);for(var n=e._msgs,i=n.length,a=0;a<i;a++){var s=(0,h["default"])(n[a],2),r=s[0],o=s[1];if(!o){t.mediaStage=l(r,e);for(var u=0;u<I.length;u++){var d=I[u];t[d]=r[L[d]]}r.mediaData.set(t)}}for(var p=n.length-1;p>=0;p--)n[p][1]&&n.splice(p,1);var f=e._callOnConsolidate;f&&(e._callOnConsolidate=null,f.forEach(function(e){e()}))}function c(e,t,n){for(var i=0;i<n.length;i++){var a=n[i];e[a]=t[a]}}function l(e,t){if(!t.filehash)return A.PREPARING;if(e.id.fromMe&&e.ack<1)switch(C["default"].assert(e.local,"media-fault","unsent media system message not local")(),t.uploadStage){case R.INIT:return A.PREPARING;case R.PREPARING:return A.PREPARING;case R.UPLOADING:return A.UPLOADING;case R.NEED_UPLOAD:return A.NEED_UPLOAD;case R.ERROR_MISSING:return A.ERROR_MISSING;case R.UPLOADED:return A.SENDING}else switch(t.downloadStage){case x.INIT:return A.INIT;case x.PREPARING:return A.PREPARING;case x.REUPLOADING:return A.REUPLOADING;case x.FETCHING:return A.FETCHING;case x.PROCESSING:return A.DECRYPTING;case x.NEED_POKE:return A.NEED_POKE;case x.ERROR_MISSING:return A.ERROR_MISSING;case x.ERROR_UNSUPPORTED:return A.ERROR_UNSUPPORTED;case x.RESOLVED:return A.RESOLVED}}Object.defineProperty(t,"__esModule",{value:!0}),t.OUTWARD_TYPES=t.FIELDS_TO_MSG_PROPS=t.MSG_SPECIFIC_FIELDS=t.STAGE=t.UPLOAD_STAGE=t.DOWNLOAD_STAGE=void 0;var u=n(32),d=a(u),p=n(86),h=a(p),f=n(2),m=a(f),g=n(23),v=a(g),y=n(25),E=a(y),_=n(1330),b=a(_),M=n(1),C=a(M),S=n(87),T=a(S),w=n(66),k=a(w),P=n(1564),N=n(1365),O=i(N),D=["mediaBlob","size","filehash","mimetype"],x=t.DOWNLOAD_STAGE={INIT:"INIT",PREPARING:"PREPARING",REUPLOADING:"REUPLOADING",FETCHING:"FETCHING",PROCESSING:"PROCESSING",NEED_POKE:"NEED_POKE",ERROR_MISSING:"ERROR_MISSING",ERROR_UNSUPPORTED:"ERROR_UNSUPPORTED",RESOLVED:"RESOLVED"},R=t.UPLOAD_STAGE={INIT:"INIT",PREPARING:"PREPARING",UPLOADING:"UPLOADING",NEED_UPLOAD:"NEED_UPLOAD",ERROR_MISSING:"ERROR_MISSING",UPLOADED:"UPLOADED"},A=t.STAGE={INIT:"INIT",PREPARING:"PREPARING",UPLOADING:"UPLOADING",SENDING:"SENDING",REUPLOADING:"REUPLOADING",FETCHING:"FETCHING",DECRYPTING:"DECRYPTING",RESOLVED:"RESOLVED",NEED_POKE:"NEED_POKE",NEED_UPLOAD:"NEED_UPLOAD",ERROR_MISSING:"ERROR_MISSING",ERROR_UNSUPPORTED:"ERROR_UNSUPPORTED",REMOTE_UPLOADING:"REMOTE_UPLOADING",REMOTE_NEED_UPLOAD:"REMOTE_NEED_UPLOAD"},I=t.MSG_SPECIFIC_FIELDS=["type","filename","isGif","gifAttribution","sidecar"],L=t.FIELDS_TO_MSG_PROPS={preview:"body",encryptionKey:"mediaKey",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",streamable:"streamable",pageCount:"pageCount",type:"type",filename:"filename",isGif:"isGif",gifAttribution:"gifAttribution",sidecar:"streamingSidecar"},U=t.OUTWARD_TYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",DOCUMENT:"document",UNKNOWN:"unknown"},F=function(){function e(){var t=this;(0,v["default"])(this,e),this._msgs=[],this._notifyTimer=new T["default"](function(){o(t)}),this._uploadAsGif=!1,this._callOnConsolidate=null,this.entries=new P.MediaEntryList,this.previewWidthHeightPromise=null,this.downloadStage=x.INIT,this.uploadStage=R.INIT,this.mustDownloadMedia=!1,this.downloadPromise=null,this.uploadPromise=null,this.uploadTargets=null,this.mediaBlob=null,this.size=void 0,this.filehash=void 0,this.mimetype=void 0,this.specifics=null}return(0,E["default"])(e,[{key:"consolidate",value:function(e){return!!s(this,e)&&(this.notifyMsgsAsync(),!0)}},{key:"resolveWhenConsolidated",value:function(){var e=this;return this._notifyTimer.ts?new m["default"](function(t){e._callOnConsolidate?e._callOnConsolidate.push(t):e._callOnConsolidate=[t]}):m["default"].resolve()}},{key:"notifyMsgsAsync",value:function(){this._notifyTimer.debounce(0)}},{key:"addMsg",value:function(e){for(var t=this._msgs,n=0;n<t.length;n++){var i=(0,h["default"])(t[n],2),a=i[0],s=i[1];C["default"].assert(a!==e||s,"redundant-media-msg")()}t.push([e,!1]),this.notifyMsgsAsync()}},{key:"removeMsg",value:function(e){for(var t=this._msgs,n=!1,i=0;!n&&i<t.length;i++){var a=(0,h["default"])(t[i],2),s=a[0],r=a[1];s!==e||r||(t[i][1]=!0,n=!0)}}},{key:"hasAssociatedMsgs",value:function(){for(var e=this._msgs,t=0;t<e.length;t++)if(!e[t][1])return!0;return!1}},{key:"rmr",value:function(){for(var e=this,t=void 0,n=this._msgs,i=0;!t&&i<n.length;i++){var a=(0,h["default"])(n[i],2),s=a[0],r=a[1];r||s.isUnsentPhoneMsg()||(t=s)}return C["default"].assert(t,"media-fault","rmr called on MediaObject with no msg")(),t?k["default"].requestMediaReupload(t).tap(function(n){if(200===n.status&&t){var i=e.entries.addEntry(n.url,n.mediaKey||t.mediaKey);i&&i.markNeedsAck(!0)}}):m["default"].reject(new Error("rmr called on MediaObject with no msg"))}},{key:"msgProps",value:function(e){var t={};c(t,this,D),this.specifics&&this.specifics.hydrate(!1,t),c(t,e,I);var n={};for(var i in t)n[L[i]]=t[i];return n}},{key:"addUploadTargets",value:function(e){var t=this.uploadTargets;t||(this.uploadTargets=t={});for(var n=0;n<e.length;n++)t[e[n]]=!0}},{key:"hasUploadTarget",value:function(e){return!(!this.uploadTargets||!this.uploadTargets[e])}},{key:"claimUploadTargets",value:function(){var e=this.uploadTargets;return e?(this.uploadTargets=null,(0,d["default"])(e)):[]}},{key:"type",value:function(){if(this.specifics)return this.specifics.type;throw C["default"].assert(!1,"media-fault","upload type asked with no specifics")(),new Error("MediaObject:uploadType no specific for upload")}},{key:"uploadType",value:function(){switch(this.type()){case O.TYPE.VIDEO:return this._uploadAsGif?"gif":"video";case O.TYPE.IMAGE:return"image";case O.TYPE.AUDIO:return"audio";case O.TYPE.DOCUMENT:return"document";default:throw new Error("MediaObject:uploadType has unknown specific")}}},{key:"delete",value:function(){this.specifics&&this.specifics.renderableUrl&&window.URL.revokeObjectURL(this.specifics.renderableUrl),this.downloadPromise&&this.downloadPromise.control.waitForPoke(),this.uploadPromise&&this.uploadPromise.control.cancel()}},{key:"computePreviewWidthHeight",value:function(e){var t=this,n=b["default"].loadImage("data:image/jpeg;base64,"+e).then(function(i){n===t.previewWidthHeightPromise&&(t.previewWidthHeightPromise=null);var a=t.specifics;a&&a.preview===e&&t.consolidate({thumbWidth:i.width,thumbHeight:i.height})});this.previewWidthHeightPromise=n}}]),e}();t["default"]=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(1351),v=i(g),y=n(1308),E=(i(y),n(218)),_=i(E),b=n(1322),M=i(b),C=n(103),S=i(C),T=n(6),w=n(38),k=n(438),P=n(31),N=window.Store,O=n(1346),D=n(8),x=n(1311),R=n(1313),A=n(1312),I=n(1471),L=n(1321),U=n(1361),F=n(1324),G=n(1320),j=n(82),B=n(217),H=n(139),q=n(1479),W=n(1325),V=W.GetRef,z=function(e){function t(){var e,n,i,a;(0,l["default"])(this,t);for(var r=arguments.length,c=Array(r),u=0;u<r;u++)c[u]=arguments[u];return n=i=(0,h["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(c))),i.filteredData=null,i.state={searchText:""},i.handleSelect=function(e,t){i.selectedChats.setVal(e,t),i.active.setVal(e)},i.onCancelSelection=function(){i.selectedChats.unsetAll()},i.onSearch=function(e){i.filteredData=null,i.setState({searchText:e})},i.onFocusList=function(e){e.preventDefault(),e.stopPropagation(),S["default"].flashFocus=Date.now(),i.active.setFirst()},i.indicateSearchFocus=function(e){if(i.active.unset(),!(Date.now()-(S["default"].flashFocus||0)>200)&&i.search){var t=w.findDOMNode(i.search);k(t,"stop"),k(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},i.onNext=function(e){e.preventDefault(),e.stopPropagation(),i.active.setNext()},i.onPrev=function(e){e.stopPropagation(),e.preventDefault();var t=i.active.prev();t>-1?i.active.setPrev():(i.active.unset(),S["default"].flashFocus=Date.now(),j.focus(i.search))},i.onChat=function(){s["default"].map(i.selectedChats.getSelected(),function(e){return e instanceof _["default"]?N.Chat.find(e.id):e}).then(function(e){i.props.onChat(e)})},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.active=new F(this.getData(),function(e){return e.id}),this.selectedChats=new G([],function(e){return e.id})}},{key:"getFrequentContacts",value:function(){var e=this.state.searchText;return e||!H.supportsFeature(H.F.FREQUENT_CONTACTS)?[]:N.Contact.frequentContacts(null,this.props.excludeChat)}},{key:"getFilteredChats",value:function(){var e=this.state.searchText;return e?(e=B.accentFold(e),N.Chat.filter(function(t){return t.canSend&&t.isVisible&&t.contact.searchMatch(e)})):N.Chat.filter(function(e){return e.canSend&&e.isVisible})}},{key:"getFilteredContacts",value:function(){var e=N.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=B.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e}},{key:"getFilteredData",value:function(){if(this.filteredData)return this.filteredData;var e={},t=P.compact(P.map(this.getFrequentContacts(),function(t){var n=t.isGroup?N.Chat.get(t.id):t;return n&&(e[n.id]=!0),n})),n=P.compact(P.map(this.getFilteredChats(),function(t){var n=t.isGroup?t:t.contact;return e[n.id]?null:(e[n.id]=!0,n)})),i=P.compact(P.map(this.getFilteredContacts(),function(t){return e[t.id]?null:t}));return this.filteredData={frequentContactsData:t,chatsData:n,contactsData:i}}},{key:"getFilteredItems",value:function(){var e=this,t=[],n=this.getFilteredData(),i=n.frequentContactsData,a=n.chatsData,s=n.contactsData;return i.length&&t.push(T.createElement(U,{key:"frequent-contacts-header",header:B.t("web_frequent_contacts")})),P.forEach(i,function(n){t.push(T.createElement(I,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),a.length&&t.push(T.createElement(U,{key:"chat-header",header:B.t("web_recent_chats")})),P.forEach(a,function(n){t.push(T.createElement(I,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),s.length&&t.length&&t.push(T.createElement(U,{key:"contact-header",header:B.t("web_other_contacts")})),P.forEach(s,function(n){t.push(T.createElement(I,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),t}},{key:"getData",value:function(){var e=this.getFilteredData(),t=e.frequentContactsData,n=e.chatsData,i=e.contactsData;return P.concat(t,n,i)}},{key:"getList",value:function(){var e=this.getFilteredItems();return 0===e.length?null:T.createElement(M["default"],{data:e,height:72,extraItems:4})}},{key:"onCancel",value:function(){D.closeModal()}},{key:"render",value:function(){var e=this.getList();this.active.init(this.getData()),e||(e=this.state.searchText?T.createElement(L.Search,null):T.createElement(L.ListChats,null));var t={down:this.onFocusList},n={down:this.onNext,up:this.onPrev};return T.createElement(O,{type:O.TOWER},T.createElement(x,{key:"chat-modal",onCancel:this.onCancel,className:"forward-modal-drawer"},T.createElement(R,{title:this.props.title,type:R.Type.POPUP,onCancel:this.onCancel}),T.createElement(S["default"],{handlers:t,onFocus:this.indicateSearchFocus},T.createElement(v["default"],{ref:V("search",this),onSearch:this.onSearch,placeholder:B.t("search")})),T.createElement(A,{"data-list-scroll-container":!0},T.createElement(S["default"],{handlers:n,className:"column"},T.createElement("div",{className:"chatlist column"},e)))),T.createElement(q,{selections:this.selectedChats,onForward:this.onChat,onCancel:this.onCancelSelection}))}}]),t}(T.Component);e.exports=z},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(218),s=i(a),r=n(6),o=n(1430),c=n(1324),l=n(1332),u=n(1361),d=n(1321),p=n(140),h=n(45),f=r.createClass({displayName:"ContactsModal",mixins:[p],propTypes:{title:r.PropTypes.string.isRequired,contacts:r.PropTypes.arrayOf(r.PropTypes.instanceOf(s["default"])),filter:r.PropTypes.func,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(e){return Store.Contact.isFilteredContact(e)}}},getInitialState:function(){return this.selection=new c([],function(e){return e.id}),{searchFilter:void 0}},componentWillMount:function(){this.props.contacts||this.addObserver(Store.Contact,"add remove change:name")},onSelect:function(e,t){var n=t.props.contact;this.props.filter(n)===!0&&this.props.onSelect(n)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this.props,t=e.title,n=e.onCancel,i=e.filter,a=e.onSelect,s=l10n.accentFold(this.state.searchFilter),c=this.props.contacts||Store.Contact,p=c.filter(function(e){return i(e)&&(!s||s&&e.searchMatch(s))}),f=[];if(p.length){this.selection.init(p.filter(function(e){return i(e)===!0}));for(var m=void 0,g=void 0,v=p.length>10,y=0;y<p.length;y++){m=p[y],v&&m.header!==g&&f.push(r.createElement(u,{key:m.header,header:m.header}));var E=_.isString(i(m)),b=void 0;y<p.length-1&&p[y+1].header!==m.header&&(b="last");var M=void 0;E&&(M=r.createElement("div",{className:"chat-status ellipsify",title:i(m)},i(m)),b=h(b,"member")),f.push(r.createElement(l,{contact:m,active:this.selection,className:b,secondary:M,onClick:E?void 0:_.once(a.bind(null,m)),key:m.id})),g=m.header}}else f=r.createElement(d.SearchContacts,null);return r.createElement(o,{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:n},f)}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MuteProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(145),o=i(r),c=n(6),l=n(1),u=n(26),d=n(66),p=n(8),h=n(139),f=n(14),m=n(149),g=n(105).ActionToast,v=n(105).ActionType,y=n(0),E=(0,r.defineState)("Mute",{props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string",promises:{type:"object","default":function(){return{}}}},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){o["default"].prototype.initialize.call(this),this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function C(e,t,n){var i=this;if(!_.isNumber(e))return l.log("models:Mute:mute called with invalid expiration "+e)(),s["default"].reject(new f.ActionError);e=Math.round(e),e>2e9&&l.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var C=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-y().unix();l.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=m.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),a=u.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;this.promises.mute=d.sendConversationMute(this.id,e,this.expiration);var r=new v(a?l10n.t("action_group_muting"):l10n.t("action_chat_muting"));n=n||g.genId();var o=this.promises.mute["catch"](function(s){l.error("models:Mute:mute dropped")(s);var r=a?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new v(r,l10n.t("action_try_again"),i.mute.bind(i,e,t,n))}).then(function(e){if(200===e.status){var s=a?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new v(s,l10n.t("action_undo"),i.unmute.bind(i,t,n))}if(e.status>=400)throw new v(a?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed"))});return p.openToast(c.createElement(g,{id:n,initialAction:r,pendingAction:o})),this.promises.mute.then(function(e){200!==e.status||e._duplicate||C()})["finally"](function(){i.promises.mute=null})}return C(),s["default"].resolve()},canMute:function(){return h.supportsFeature(h.F.MUTE)&&u.isGroup(this.id)||h.supportsFeature(h.F.MUTE_1_1)&&u.isUser(this.id)},_clearUnmuteTimer:function(){m.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function S(e,t){var n=this,S=function(){l.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),i=u.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;this.promises.unmute=d.sendConversationMute(this.id,!1,this.expiration);var a=new v(i?l10n.t("action_group_unmuting"):l10n.t("action_chat_unmuting"));t=t||g.genId();var r=this.promises.unmute["catch"](function(a){l.error("models:Mute:unmute dropped")(a);var r=i?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return s["default"].reject(new v(r,l10n.t("action_try_again"),n.unmute.bind(n,e,t)))}).then(function(e){if(200===e.status)return new v(i?l10n.t("action_group_unmuted"):l10n.t("action_chat_unmuted"));if(e.status>=400)throw new v(i?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed"))});return p.openToast(c.createElement(g,{id:t,initialAction:a,pendingAction:r})),this.promises.unmute.then(function(e){200!==e.status||e._duplicate||S()})["finally"](function(){n.promises.unmute=null})}return S(),s["default"].resolve()},"delete":function(){o["default"].prototype["delete"].call(this),Store.Mute.remove(this.id),this._clearUnmuteTimer()}}),b=E.Mute,M=E.MuteProxy;t["default"]=b,t.MuteProxy=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(145),o=n(6),c=n(10),l=n(1),u=n(66),d=n(139),p=n(14),h=n(67),f=n(26),m=n(8),g=n(105).ActionToast,v=n(105).ActionType,y=n(90),E=n(19),_=(0,r.defineState)("ProfilePicThumb",{Collection:"ProfilePicThumb",props:{id:"string",tag:"string",raw:"string",eurl:"string"},session:{stale:["boolean",!1,!0]},derived:{img:{deps:["tag","raw","stale","eurl"],fn:function(){if(this.raw)return"data:image/jpeg;base64,"+this.raw;if(!this.tag&&this.stale)return null;if(this.tag)return this.generateUrl("s")}},imgFull:{deps:["tag","raw","stale","eurl"],fn:function(){if((this.raw||!this.tag)&&this.stale)return null;if(!this.raw&&this.tag)return this.generateUrl("l")}}},onError:function(e){switch(e){case 410:this.update()}},generateUrl:function(e){var t={t:e,u:this.id,i:this.tag};return y&&(this.eurl&&(t.e=this.eurl),t.ref=E.ref,t.tok=E.tok),h.build(c.PP_URL,t)},canSet:function(){return!(!f.isGroup(this.id)||!d.supportsFeature(d.F.GROUP_SET_PIC))||!(!f.isUser(this.id)||this.id!==Store.Conn.me||!d.supportsFeature(d.F.SET_PROFILE_PIC))},setPicture:function(e,t,n){var i=this;if(!this.canSet())return s["default"].reject(new p.ActionError);var a=u.sendSetPicture(this.id,e,t),r=new v(this.id===Store.Conn.me?l10n.t("action_profile_setting"):l10n.t("action_group_icon_setting"));n=n||g.genId();var c=a["catch"](function(e){throw l.error("models:ProfilePicThumb:setPicture dropped")(e),new v(i.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed"))}).then(function(a){if(200===a.status)return new v(i.id===Store.Conn.me?l10n.t("action_profile_set"):l10n.t("action_group_icon_set"));if(a.status>=400){var s=i.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed");return new v(s,l10n.t("action_try_again"),i.setPicture.bind(i,e,t,n))}});return m.openToast(o.createElement(g,{id:n,initialAction:r,pendingAction:c})),a.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=e.tag)})},canDelete:function(){return!!(f.isGroup(this.id)&&d.supportsFeature(d.F.GROUP_SET_PIC)&&this.tag)||!!(f.isUser(this.id)&&this.id===Store.Conn.me&&d.supportsFeature(d.F.SET_PROFILE_PIC)&&this.tag)},deletePicture:function(e){var t=this;if(!this.canDelete())return s["default"].reject(new p.ActionError);var n=u.deletePicture(this.id),i=new v(this.id===Store.Conn.me?l10n.t("action_profile_removing"):l10n.t("action_group_icon_removing"));e=e||g.genId();var a=n["catch"](function(e){throw l.error("models:ProfilePicThumb:deletePicture dropped")(e),new v(t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed"))}).then(function(n){if(200===n.status)return new v(t.id===Store.Conn.me?l10n.t("action_profile_removed"):l10n.t("action_group_icon_removed"));if(n.status>=400){var i=t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed");return new v(i,l10n.t("action_try_again"),t.deletePicture.bind(t,e))}});return m.openToast(o.createElement(g,{id:e,initialAction:i,pendingAction:a})),n.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=void 0)})}}),b=_.ProfilePicThumb,M=_.ProfilePicThumbProxy;t["default"]=b,t.ProfilePicThumbProxy=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(429),l=n(12),u=n(139),d=n(1),p=n(10),h=c.extend({model:o["default"],initialize:function(){var e=this;c.prototype.initialize.call(this),this.isSynced=!1,this.syncPromise=null,this.listenTo(l,"change:stream",function(){l.stream===l.STREAM.DISCONNECTED?e.isSynced=!1:l.stream===l.STREAM.CONNECTED&&e["delete"]()})},comparator:function(e,t){return t.t-e.t},process:function(e,t,n,i){i?this["delete"]():this.update(e,t,n)},sync:function(e){if(this.isSynced)return s["default"].resolve();if(this.syncPromise)return this.syncPromise;if(!u.supportsFeature(u.F.FULL_TEXT_SEARCH))return s["default"].resolve();
var t=this;if(u.supportsFeature(u.F.STARRED_PAGINATION)){var n=this.last()&&this.last().id;this.syncPromise=Store.Msg.getStarred(e,p.PAGE_SIZE,n).then(function(e){e.length&&t.add(e,{silent:!0}),e.length<p.PAGE_SIZE&&(t.isSynced=!0),t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null})}else this.syncPromise=Store.Msg.getStarred().then(function(e){t.set(e),t.synced=!0,t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null});return this.trigger("sync"),this.syncPromise},update:function(e,t,n){var i=this;if(this.isSynced){var a=this.syncPromise||s["default"].resolve();this.syncPromise=a.then(function(){if(e){var a=t.length>0?Store.Msg.incrementalStarredUpdate(t):s["default"].resolve([]);return a.then(function(e){i.add(e.concat(n),{silent:!0}),_.forEach(t,function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),i.trigger("sync")})["catch"](function(e){d.error("models:starred:update:error: ",e)()})}return i.filter(function(e){return!e.star}).forEach(function(e){i.remove(e.id),e.chat.starredMsgs&&e.chat.starredMsgs.remove(e.id)}),s["default"].resolve()})["finally"](function(){i.syncPromise=null})}},add:function(e,t){this.isModel(e)&&this.get(e)||(c.prototype.add.call(this,e,t),!this.parent&&e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.add(e)),Store.StarredGifMsgs.add(e))},remove:function(e,t){this.isModel(e)&&!this.get(e)||(c.prototype.remove.call(this,e,t),this.parent?Store.AllStarredMsgs.remove(e,t):e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)),Store.StarredGifMsgs.remove(e))},"delete":function(){this.synced=!1,c.prototype["delete"].call(this)}});e.exports=h},function(e,t,n){"use strict";function i(e){try{return L.exec(e)}catch(t){return l.assert(!1,"linkify-regex-error","text size: "+e.length+", error: "+t)(t),null}}function a(e){L.lastIndex=0;for(var t=[],n=void 0;n=i(e);)n=r(n),n&&t.push(n);return t}function s(e){return L.lastIndex=0,r(i(e))}function r(e){if(!e)return null;var t=e[w].length,n=e[0],i=e.index+t,a=e.index,s="_"===e[w];if(s&&a-1&&/\S/.test(e.input[a-1]))return null;if(e[O]){var r=parseInt(e[O].slice(1),10);if("0"===e[O][1]||!(0<r&&r<65536))return null}var o=c.find([R,x,D],function(t){return e[t]})||0;if(o){var l=[],u=e[o];"_"===u.slice(-1)&&"_"===n[i-1]&&(n=n.slice(0,-1),e[o]=u=u.slice(0,-1));for(var d=0,p=0,h=0;h<u.length;h++){var f=u.charCodeAt(h);f===p?(p=l.pop()||0,0===p&&(d=h)):f in I?(0!==p&&l.push(p),p=I[f]):f in A||0===p&&(d=h)}for(;0!==l.length;)l.pop();d!==u.length-1?(n=c.compact(e.slice(k,o)).join("")+u.slice(0,d+1),L.lastIndex=i+n.length):n=n.slice(t)}else n=n.slice(t);var m=n,g=e[k];return g?g=g.toLowerCase():(g=0===m.toLowerCase().indexOf("irc.")?"irc://":0===m.toLowerCase().indexOf("ftp.")?"ftp://":e[P]?"mailto:":"http://",m=g+m),{href:m,url:n,index:i,input:e.input,scheme:g,username:e[P],domain:e[N],port:e[O],path:e[D],params:e[x],anchor:e[R]}}function o(e){var t=s(e);return t&&t.url===e&&"mailto:"===t.scheme&&t.username&&!t.params&&!t.anchor?t:null}var c=n(31),l=n(1),u="abbott|ac|academy|ad|adult|ae|aero|af|ag|agency|ai|al|am|ao|app|ar|as|asia|at|au|audio|ax|az|ba|barclays|bb|bd|be|berlin|best|bet|bf|bg|bh|bi|bid|bike|bio|biz|bj|black|blog|blue|bm|bn|bnpparibas|bo|br|bradesco|brussels|bs|bt|business|buzz|bw|by|bz|bzh|ca|cab|cafe|camera|camp|canon|capital|cards|care|careers|casa|cash|casino|cat|cc|cd|center|cern|cf|cg|ch|chat|cheap|church|ci|city|cl|click|cloud|club|cm|cn|co|coach|codes|coffee|com|community|company|cool|coop|cr|cricket|cu|cv|cx|cy|cz|date|de|deals|desi|design|dev|diamonds|digital|direct|directory|dj|dk|do|dog|domains|download|dz|earth|ec|edu|education|ee|eg|email|engineering|es|et|eu|eus|events|exchange|expert|faith|farm|fi|film|finance|fit|fj|fm|fo|forsale|fr|fund|futbol|fyi|ga|gal|gallery|game|gd|gdn|ge|gg|gh|gi|gift|gl|global|gold|google|gov|gp|gq|gr|graphics|gratis|group|gs|gt|guide|guru|gy|help|hk|hm|hn|horse|host|hosting|house|how|hr|ht|hu|id|ie|il|im|in|info|ink|institute|int|international|io|iq|ir|is|ist|istanbul|it|je|jm|jo|jobs|jp|ke|kg|kh|kim|kitchen|kiwi|koeln|kp|kr|krd|kred|kw|kz|la|land|lat|lb|lc|legal|li|life|limited|link|live|lk|lol|london|love|ls|lt|ltd|lu|lv|ly|ma|market|marketing|md|me|media|men|menu|mg|mil|mk|ml|mm|mn|mo|mobi|moda|moe|monash|money|moscow|movie|mr|ms|mt|mu|museum|mv|mw|mx|my|mz|na|nagoya|name|nc|net|network|news|nf|ng|ngo|ni|nico|ninja|nl|no|np|nr|nu|nyc|nz|office|okinawa|om|one|onl|online|ooo|org|ovh|pa|paris|party|pe|pf|pg|ph|photo|photography|photos|pics|pictures|pink|pk|pl|place|plus|pm|pn|porn|post|pr|press|pro|prod|ps|pt|pub|pw|py|qa|re|red|ren|report|rest|review|reviews|rip|ro|rocks|rs|ru|run|rw|sa|sale|sc|school|science|scot|sd|se|services|sex|sexy|sg|sh|shop|show|si|site|sk|sl|sm|sn|so|social|software|solutions|soy|space|sr|st|store|stream|studio|study|style|su|support|sv|sx|sy|systems|sz|taipei|tc|team|tech|technology|tf|tg|th|tips|tj|tk|tl|tm|tn|to|today|tokyo|tools|top|town|tr|trade|training|travel|tt|tv|tw|tz|ua|ug|uk|uno|uol|us|uy|uz|va|vc|ve|ventures|vg|video|vip|vn|vote|vu|wales|wang|watch|webcam|website|wf|wiki|win|work|works|world|ws|wtf|xyz|ye|yt|za|zm|zone|zw|онлайн|рф",d="(?:http|https)://|mailto:",p="\\w|[^\\s\0-«»‘’“”]|%[0-9a-f][0-9a-f]",h="(?:"+p+")|(?:"+p+")(?:"+p+"|-)*(?:"+p+")",f="(?!_)(?:(?:"+h+")\\.)+(?:"+u+")(?!\\."+h+")",m=":\\d{1,5}",g="+@!.?,(\\[{<«‘“:",v="(?:"+p+"|[^\\s%])",y="/"+v+"*?",E="["+g+"]*(?!"+v+"|#)",_="\\?(?!"+E+")"+v+"*?",b="#"+v+"*?",M="0-9a-z!#$%&'*+/=?^_`{|}~\\-",C="\\b\\w["+M+"]*(?:\\.["+M+"]+)*",S="^|\\W\\.|[^/\\w.]|_",T="("+S+")("+d+")?("+C+"@)?("+f+")(?:(?!"+h+")|(?=_))(?:(?=[^:/?#])|("+m+")?("+y+")?("+_+")?("+b+")?(?="+E+"))",w=1,k=2,P=3,N=4,O=5,D=6,x=7,R=8,A={34:34,39:39,41:40,62:60,93:91,125:123,187:171,8217:8216,8221:8220},I={34:34,39:39,40:41,60:62,91:93,123:125,171:187,8216:8217,8220:8221},L=new RegExp(""+T,"ig");e.exports={findLink:s,findLinks:a,validateEmail:o}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(81),l=i(c),u=n(80),d=i(u),p=n(1372),h=function(e){function t(){return(0,o["default"])(this,t),(0,l["default"])(this,(0,s["default"])(t).call(this,"_",/(?:^|[*_~\s])_((?:[\S])|(?:\S[^\n]*?\S))_(?=_|\W|$)/g,1))}return(0,d["default"])(t,e),t}(p);e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1339),m=n(1392),g=m.findLinks,v=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return g(e).map(function(e){return{0:e.url,href:e.href,input:e.input,index:e.index}})}}]),t}(f);e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1339),m=n(1338),g=m.matchAll,v=n(31),y=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this));n._map=e;var i=v.keys(e).map(v.escapeRegExp).join("|");return n._regex=new RegExp("("+i+")","g"),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){var t=this;return g(this._regex,e,function(e){return e.jid=t._map[e[0]].jid,e})}},{key:"mutate",value:function(e){var t=this._map[e];return"@"+t.display}}]),t}(f);e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(23),s=i(a),r=n(25),o=i(r),c=function(){function e(t){(0,s["default"])(this,e),this.args=t}return(0,o["default"])(e,[{key:"onRoot",value:function(e){return e}},{key:"onMutatorNode",value:function(e,t){return{mutator:e.mutator,children:t}}},{key:"onDelimiter",value:function(e){return e}},{key:"onText",value:function(e){return e}}]),e}();e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(81),l=i(c),u=n(80),d=i(u),p=n(1372),h=function(e){function t(){return(0,o["default"])(this,t),(0,l["default"])(this,(0,s["default"])(t).call(this,"~",/(?:^|[*_~\s])~((?:[\S])|(?:\S[^\n]*?\S))~(?=_|\W|$)/g,1))}return(0,d["default"])(t,e),t}(p);e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(81),l=i(c),u=n(80),d=i(u),p=n(1372),h=function(e){function t(){return(0,o["default"])(this,t),(0,l["default"])(this,(0,s["default"])(t).call(this,"*",/(?:^|[*_~\s])\*((?:[\S])|(?:\S[^\n]*?\S))\*(?=_|\W|$)/g,1))}return(0,d["default"])(t,e),t}(p);e.exports=h},,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(6),v=i(g),y=n(45),E=i(y),_=n(218),b=(i(_),n(1309)),M=i(b),C=n(1326),S=i(C);t["default"]=(0,S["default"])((s=a=function(e){function t(){return(0,l["default"])(this,t),(0,h["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.contact,t=(0,E["default"])("chat-status-name",{number:!e.name});return v["default"].createElement(M["default"],{text:e.formattedShortName,direction:"auto",className:t})}}]),t}(v["default"].PureComponent),a.CONCERNS={contact:["formattedShortName","name"]},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=i(f),g=n(1308),v=(i(g),n(1307)),y=(i(v),n(143)),E=i(y),_=n(0),b=i(_),M=n(1329),C=i(M),S=n(1326),T=i(S),w=n(8),k=i(w),P=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.state={updater:!1},i.listening=!1,i.rerender=function(){i.setState({updater:!i.state.updater})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillMount",value:function(){this.maybeRegMidnight()}},{key:"componentWillReceiveProps",value:function(){this.maybeRegMidnight()}},{key:"maybeRegMidnight",value:function(){var e=this.props,t=e.addListener,n=e.removeListener,i=e.msg,a=(0,b["default"])().startOf("day").subtract(7,"day");i.t>=a.unix()?this.listening||(this.listening=!0,t(k["default"],"midnight",this.rerender)):this.listening&&(this.listening=!1,n(k["default"],"midnight",this.rerender))}},{key:"render",value:function(){return m["default"].createElement("div",{className:"chat-meta"},m["default"].createElement("span",{className:"chat-time"},E["default"].relativeStr(this.props.msg.t)))}}]),t}(m["default"].PureComponent);P.CONCERNS={msg:["t"]};var N=(0,C["default"])((0,T["default"])(P)),O=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props.chat;return e.previewMessage?m["default"].createElement(N,{msg:e.previewMessage}):null}}]),t}(m["default"].PureComponent);O.CONCERNS={chat:["previewMessage"]};var D=(0,T["default"])(O);t["default"]=function(e){var t=e.chat,n=e.msg;return t?m["default"].createElement(D,{chat:t}):n?m["default"].createElement(N,{msg:n}):void 0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1322),s=i(a),r=n(103),o=i(r),c=n(6),l=n(38),u=n(1332),d=n(1361),p=n(1324),h=c.createClass({displayName:"ContactList",propTypes:{contacts:c.PropTypes.array.isRequired,exclude:c.PropTypes.array,onClick:c.PropTypes.func,onFocusSearch:c.PropTypes.func},getInitialState:function(){this.selection=new p(this.props.contacts,function(e){return e.id});var e=this.props.exclude;return e&&(e=_.fromPairs(e.map(function(e){return[e.id,!0]}))),{exclude:e}},componentWillReceiveProps:function(e){this.selection.init(e.contacts)},onFocusGain:function(e){e.target===l.findDOMNode(this)&&(this.selection.index<0?this.focusFirst():this.selection.reset())},focusFirst:function(){this.selection.setFirst()},onNextContact:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevContact:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),this.props.onFocusSearch(e))},render:function(){for(var e,t=this.props.contacts,n=[],i=t.length>10,a=this.state.exclude||{},r="XXX",l=0;l<t.length;l++){var p=t[l];if(e=null,i){var h=p.header;l<t.length-1&&h!==t[l+1].header&&(e="last"),h!==r&&(n.push(c.createElement(d,{key:h,header:h})),r=h)}var f=p.id;n.push(c.createElement(u,{contact:p,active:this.selection,className:e,onClick:this.props.onClick,member:a[f],key:f}))}var m={down:this.onNextContact,up:this.onPrevContact};return c.createElement(o["default"],{handlers:m,onFocus:this.onFocusGain,"data-tab":3},c.createElement(s["default"],{className:"chatlist",data:n,height:72,extraItems:4}))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(38),c=n(12),l=n(84),u=n(141),d=n(144),p=n(8),h=n(85),f=r.createClass({displayName:"AudioTag",mixins:[l,u,d],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,className:r.PropTypes.string,controls:r.PropTypes.bool,preload:r.PropTypes.string,type:r.PropTypes.string,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool},componentDidMount:function(){var e=o.findDOMNode(this);this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(h.isGecko||h.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(c.state===c.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.state.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=o.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e.target.src)},onOtherPlaying:function(e){e!==this&&o.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),p.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return r.createElement("audio",{src:this.props.msg.mediaData.renderableUrl,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1310),c=n(1319),l=r.createClass({displayName:"DeleteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onDeleteOrExit:r.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case s["default"].KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case s["default"].KIND.BROADCAST:e=l10n.t("web_delete_list");break;case s["default"].KIND.CHAT:e=l10n.t("delete_chat")}return r.createElement(c,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(1366),o=i(r),c=n(6),l=n(140),u=n(1309),d=n(14),p=c.createClass({displayName:"GroupSubtitle",mixins:[l],propTypes:{presence:c.PropTypes.instanceOf(s["default"]),groupMetadata:c.PropTypes.instanceOf(o["default"]),placeholder:c.PropTypes.node,location:c.PropTypes.oneOf(["list","title"])},_init:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](d.WapDrop,_.noop)},componentWillMount:function(){this.uiIdle(this._init);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),"list"!==this.props.location&&this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=this.getSubtitle(),e?c.createElement(u,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?c.createElement("div",{className:"chat-status ellipsify"},c.createElement(u,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.duration,n=y.durationStr(t);return n?g.createElement("span",{className:"media-canvas-duration"},n):null}var s=n(37),r=i(s),o=n(23),c=i(o),l=n(25),u=i(l),d=n(81),p=i(d),h=n(80),f=i(h),m=n(1307),g=(i(m),n(6)),v=n(1318),y=n(143),E=n(1341),_=n(1329),b=function(e){function t(){(0,c["default"])(this,t);var e=(0,p["default"])(this,(0,r["default"])(t).apply(this,arguments));return e.onSelectClick=function(t){e.props.onMessageSelect&&e.props.onMessageSelect(e.props.msg,!e.props.selected)},e.onMouseOver=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseEnter=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseLeave=function(t){e.state.hover&&e.setState({hover:!1})},e.state={hover:!1},e}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.addListener(this.props.msg.mediaData,"change:preview")}},{key:"render",value:function(){var e=this.props,t=e.msg.mediaData,n=e.selected,i=e.selectable,s=void 0,r=null,o=null,c=null,l=null;switch(t.type){case v.TYPE.AUDIO:s="media-canvas attach-media-audio-thumb",o=g.createElement("span",{className:"icon-s icon-msg-audio-light"}),c=g.createElement(a,{duration:t.duration});break;case v.TYPE.VIDEO:r=g.createElement("div",{className:"shade"}),t.isGif?(s=t.preview?"media-canvas":"media-canvas media-video-thumb",o=g.createElement("span",{className:"icon-s icon-msg-gif-light"})):(s="media-canvas",o=g.createElement("span",{className:"icon-s icon-msg-video-light"}),c=g.createElement(a,{duration:t.duration})),t.preview&&(l={backgroundImage:'url("data:image/jpeg;base64,'+t.preview+'")'});break;case v.TYPE.IMAGE:s="media-canvas",t.renderableUrl?l={backgroundImage:"url("+t.renderableUrl+")"}:t.preview&&(l={backgroundImage:'url("data:image/jpeg;base64,'+t.preview+'")'})}var u=void 0;u=this.props.onDragStart?g.createElement("div",{className:s,style:l,onClick:this.props.onClick||null,ref:"img",onDragStart:this.props.onDragStart,draggable:!0}):g.createElement("div",{className:s,style:l,onClick:this.props.onClick||null,ref:"img"});var d=i||this.state.hover?g.createElement("div",{className:"media-select",onClick:this.onSelectClick},g.createElement("div",{className:"shade"}),g.createElement(E,{onChange:this.onSelectClick,checked:n})):null,p=null,h=null,f=null;return this.props.hoverEvent&&(p=this.onMouseOver,h=this.onMouseEnter,f=this.onMouseLeave),g.createElement("div",{className:this.props.classes,onMouseOver:p,onMouseEnter:h,onMouseLeave:f},d,u,r,o,c)}}]),t}(g.Component);e.exports=_(b)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1310),c=n(1319),l=r.createClass({displayName:"MuteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onMute:r.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return r.createElement(c,{action:e,shortcut:"m",a8n:"mi-mute"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1310),c=n(8),l=n(1380),u=n(1341),d=n(428),p=r.createClass({displayName:"MuteRow",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return this.asyncState({isMuted:"chat.mute.isMuted"})},onMute:function(e){c.muteChat(this.props.chat,e,this)},onUnmute:function(){var e=this.props.chat.isGroup?l10n.t("confirm_unmute_group"):l10n.t("confirm_unmute_chat");c.openModal(r.createElement(d,{onOK:this.unmute,okText:l10n.t("action_chat_unmute"),onCancel:function(){return c.closeModal()},cancelText:l10n.t("web_cancel")},e))},unmute:function(){this.onMute(!1),c.closeModal()},render:function(){var e=this,t=this.props.chat.mute.isMuted,n=t?this.onUnmute:function(){e.onMute(!0)},i=r.createElement(u,{checked:t,onChange:n}),a=t?l10n.t("web_chat_muted"):l10n.t("web_menuitem_mute");return r.createElement(l,{classes:"row-drawer-item",side:i,onClick:n,ellipsify:!0},r.createElement("span",{className:"title"},a))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(147),s=i(a),r=n(86),o=i(r),c=n(32),l=i(c),u=function(e){for(var t={edges:{}},n=t,i=0;i<e.length;++i){for(var a=e[i],s=0;s<a.length;++s){var r=a[s];n.edges[r]||(n.edges[r]={edges:{}}),n=n.edges[r],s===a.length-1&&(n.idx=i)}n=t}return t},d=(0,l["default"])(n(450)),p=u(d),h=function(e,t){for(var n=[],i=e.length,a=t,s=0,r=void 0;(r=s)<i;){var o=a.edges[e[s++]];if(o){a=o;for(var c=a.idx;(a=a.edges[e[s]])&&++s;)void 0!==a.idx&&(c=a.idx);void 0===c?s=r+1:n.push([r,s-1]),a=t}}return n},f=function(e){for(var t=[],n=0,i=e.length;n<i;){var a=e.charCodeAt(n++);if(a>=55296&&a<=56319&&n<i){var s=e.charCodeAt(n++);if(56320===(64512&s)){t.push(""+e[n-2]+e[n-1]);continue}--n}t.push(e[n-1])}return t};e.exports=function(e){if(!e||!e.length)return[];for(var t=[],n=0,i=h(e,p),a=0;a<i.length;++a){var r=(0,o["default"])(i[a],2),c=r[0],l=r[1];c!==n&&t.push.apply(t,(0,s["default"])(f(e.substring(n,c)))),t.push(e.slice(c,l+1)),n=l+1}return n<e.length&&t.push.apply(t,(0,s["default"])(f(e.substr(n)))),t}},function(e,t,n){"use strict";var i=n(1379);e.exports=i({CHANGE:void 0,MOUNT:void 0})},function(e,t,n){"use strict";var i=n(1379);e.exports=i({SEARCH:void 0,INACTIVE:void 0,ENTER:void 0,TAB:void 0,DOWN:void 0,UP:void 0})},function(e,t,n){"use strict";var i=n(6),a=n(45),s=i.createClass({displayName:"Tooltip",propTypes:{body:i.PropTypes.node.isRequired,className:i.PropTypes.string,direction:i.PropTypes.oneOf(["top","right","bottom","left"]).isRequired},getDefaultProps:function(){return{className:null}},render:function(){var e=a("tooltip",this.props.className,this.props.direction);return i.createElement("div",{className:e},this.props.body)}});e.exports=s},function(e,t,n){"use strict";var i=n(6),a=n(38),s=n(141),r=n(1216),o=i.createClass({displayName:"Video",mixins:[s,r],propTypes:{src:i.PropTypes.string.isRequired,onPlay:i.PropTypes.func},componentDidMount:function(){var e=a.findDOMNode(this),t=this;this.regNativeListener(e,"playing",function(n){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(n)})},render:function(){return i.createElement("video",this.props)}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(38),c=n(12),l=n(84),u=n(141),d=n(144),p=n(8),h=n(85),f=n(10),m=r.createClass({displayName:"VideoTag",mixins:[l,u,d],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,poster:r.PropTypes.string,style:r.PropTypes.object,className:r.PropTypes.string,controls:r.PropTypes.bool,width:r.PropTypes.number,height:r.PropTypes.number,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool,loop:r.PropTypes.bool,muted:r.PropTypes.bool,onLoad:r.PropTypes.func,onResize:r.PropTypes.func},componentDidMount:function(){var e=o.findDOMNode(this),t=this.props.msg.mediaData;t.isGif||(this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying)),this.regNativeListener(e,"error",this.onPlayerError,!0),(h.isGecko||h.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess)),this.props.msg.canSendPlayed()&&this.regNativeListener(e,"timeupdate",this.onTimeUpdate)},onTimeUpdate:function(){var e=o.findDOMNode(this);(e.currentTime/e.duration>.5||e.currentTime>10)&&(this.props.msg.sendPlayed(),this.unregNativeListener(e,"timeupdate",this.onTimeUpdate))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(c.state===c.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=o.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&o.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),p.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){var e=this.props.msg.mediaData,t=e.streamable&&!e.renderableUrl?f.VIDEO_STREAM_URL+"?key="+this.props.msg.id.toString():e.renderableUrl;return r.createElement("video",{src:t,poster:this.props.poster,style:this.props.style,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay,loop:this.props.loop,muted:this.props.muted,onEnded:this.props.onEnded,onLoadStart:this.props.onLoad},this.props.children)}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(2),o=i(r),c=n(1308),l=i(c),u=n(1454),d=i(u),p=n(103),h=i(p),f=n(6),m=n(38),g=n(10),v=n(1422),y=v.EmojiPanel,E=n(1500),b=n(84),M=n(144),C=n(1310),S=n(140),T=n(8),w=n(428),k=n(14),P=n(436),N=n(67),O=n(1542),D=n(1421),x=n(1516),R=n(1392),A=n(1),I=n(1314),L=n(1327),U=n(139),F=n(45),G=n(216),j=n(1484),B=n(148),H=n(1541),q=function(){return U.supportsFeature(U.F.LINK_PREVIEW)||U.supportsFeature(U.F.SEND_LINK_PREVIEW)&&!1},W=f.createClass({displayName:"ComposeBox",mixins:[b,M,C,I,S],propTypes:{chat:f.PropTypes.instanceOf(l["default"]).isRequired,onPageUpDown:f.PropTypes.func.isRequired,onComposeHeightChange:f.PropTypes.func},getInitialState:function(){var e=this.props.chat;this.text=e.composeContents.text||"",this.selection=e.composeContents.selection,this.omittedURL=e.composeContents.omittedURL,this.pendingLinkPreviewPromises=[],this.preview=this.omittedURL,this.scanForLinks=this.safeDebounce(this._scanForLinks,200);var t;return t=0,{trusted:this.async("chat.trusted"),hasText:!!this.text,emojiExpanded:!1,recording:!1,linkPreview:null,quotedMsg:e.composeQuotedMsg,textsize:t}},componentWillMount:function(){var e=this.props.chat;e.setComposeContents({}),this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.restoreFocus),this.regCmd("focus_chat_text_input",this.restoreFocus),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("enter_chat_text_input_"+this.props.chat.id,this.onSendText),this.addObserver(e,"change:composeQuotedMsg",this.onQuotedMsgChange)},componentDidMount:function(){var e=this;this.height=m.findDOMNode(this.refs.composeBlock).clientHeight,q()&&this.scanForLinks(),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentWillUnmount:function(){this.props.chat.setComposeContents({text:this.text,selection:this.selection,omittedURL:this.omittedURL})},pasteEmojiInput:function(e){return" "!==e||this.hasText()?void(this.refs.input&&(this.refs.input.focus(!0),this.refs.input.replaceSelection(e))):T.scrollMessages()},onMaxPasteExceeded:function(){T.openModal(f.createElement(w,{title:l10n.t("message_too_large_title"),onOK:T.closeModal.bind(T),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},restoreFocus:function(){this.refs.input&&this.refs.input.focus()},clearLinkPreview:function(){this.preview=null,this.omitLinkPreview()},cancelPendingLinkPreviews:function(){_.forEach(this.pendingLinkPreviewPromises,function(e){return e.cancel()}),this.pendingLinkPreviewPromises=[]},omitLinkPreview:function(e){e!==!0&&this.state.linkPreview&&(this.setState({linkPreview:null}),this.omittedURL=this.preview)},omitQuotedPreview:function(e){e!==!0&&(this.props.chat.composeQuotedMsg=null)},_findFirstWebLink:function(){return _.head(R.findLinks(this.text).filter(function(e){var t=e.url;return N.isHttp(t)}))},_scanForLinks:function(){var e=this;if(!this.state.hasText)return void this.clearLinkPreview();var t=this._findFirstWebLink();if(!t)return void this.clearLinkPreview();var n=t.url;if(!this.preview||this.preview!==n){this.preview=n,this.omittedURL=null;var i=(0,d["default"])(n).checkpoint(this.rejectOnUnmount()).cancellable();this.pendingLinkPreviewPromises.push(i),i.then(function(t){var n=t.url,i=t.data;e.preview&&e.preview!==n||(i.title||i.description)&&e.setState({linkPreview:i})})["catch"](k.Unmount,_.noop)["catch"](k.WapDrop,_.noop)["catch"](o["default"].CancellationError,_.noop)}},onQuotedMsgChange:function(){var e=this.props.chat,t=!1;(this.state.quotedMsg?!e.composeQuotedMsg:e.composeQuotedMsg)&&(t=!0),t&&!e.composeQuotedMsg?this.setState({quotedMsg:null}):this.setState({quotedMsg:e.composeQuotedMsg})},indicateFocus:function(e){var t=this.refs.container;if(t&&t.activate(),!(Date.now()-(h["default"].flashFocus||0)>200)){var n=m.findDOMNode(this.refs.input_hotkey);Velocity(n,"stop"),Velocity(n,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]}),this.refs.input.focus(!1)}},onPageUpDown:function(e){var t=this;this.props.onPageUpDown&&(e.stopPropagation(),this.props.onPageUpDown(e),this.safeDefer(function(){return t.refs.input&&t.refs.input.focus(!0)}))},handleEmoji:function(e){this.refs.input.replaceSelection(e)},handleGif:function(e,t){var n=B.get(e,B.RESP_TYPE.BLOB).then(function(e){var n=e.response;return n.isGifHackDoNotUse=!0,n.gifAttributionHackDoNotUse=t,n})["catch"](function(e){throw A.error("failed loading gif ("+e+")")(),new k.MediaFileFailedLoad});this.closeEmojiPanel(),T.attachMediaDrawer(this.props.chat,[n])},openEmojiPanel:function(){this.state.emojiExpanded!==!0&&this.setState({emojiExpanded:!0})},closeEmojiPanel:function(){this.state.emojiExpanded!==!1&&this.setState({emojiExpanded:!1})},onPTT:function(e){this.setState({recording:e===H.REC})},preventBlur:function(e){var t=e.target,n=m.findDOMNode(this.refs.input),i=m.findDOMNode(this.refs.container);do if(t===n)return;while(t!==i&&(t=t.parentNode));
e.preventDefault(),e.stopPropagation(),this.refs.input.focus(!1)},onChange:function(e){var t=m.findDOMNode(this.refs.composeBlock),n=t.clientHeight,i=n-this.height;i&&this.props.onComposeHeightChange({input:i}),this.height=n;var a=this.hasText();this.text=e;var s=this.hasText();if(s!==a&&this.setState({hasText:s}),s?(this.props.chat.presence.subscribe()["catch"](k.WapDrop,_.noop),this.props.chat.markComposing()):this.props.chat.markPaused(),q()){var r=this._findFirstWebLink();(!r&&this.preview||r&&r.url!==this.preview)&&this.clearLinkPreview(),this.scanForLinks()}},_getSendButton:function(){var e=navigator.getUserMedia&&window.AudioContext;if(this.state.hasText||!e)return f.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText,disabled:!this.hasText});var t=this.props.chat;return f.createElement(H,{key:"ptt",chat:t,onStateChange:this.onPTT})},_restoreEmojiPanelFocus:function(){this.refs.emojiPanel&&this.refs.emojiPanel.restoreFocus()},_getPopupPanel:function(){var e=void 0;this.state.linkPreview&&(e=f.createElement(G,{displayName:"ComposeBoxLinkPreview",escapable:!0,requestDismiss:this.omitLinkPreview},f.createElement("div",{className:"compose-popup-panel"},f.createElement(x,(0,s["default"])({onOmit:this.omitLinkPreview},this.state.linkPreview)))));var t=void 0;this.state.quotedMsg&&(t=f.createElement(G,{displayName:"ComposeBoxQuotedMsg",escapable:!0,requestDismiss:this.omitQuotedPreview},f.createElement("div",{className:"compose-popup-panel"},f.createElement(D,{msg:this.state.quotedMsg,onOmit:this.omitQuotedPreview,chat:this.state.quotedMsg.chat}))));var n=null;return this.state.emojiExpanded&&(n=f.createElement(G,{displayName:"ComposeBoxEmojiPanel",escapable:!0,requestDismiss:this.closeEmojiPanel,requestFocus:this._restoreEmojiPanelFocus},f.createElement("div",null,f.createElement(y,{ref:"emojiPanel",key:"compose-emoji-panel",onEmoji:this.handleEmoji,onFocusRelease:this.restoreFocus,onGif:g.SHOW_GIF_SEARCH?this.handleGif:void 0,text:this.text})))),f.createElement("div",{className:"compose-box-items-positioning-container"},f.createElement("div",{className:"compose-box-items-overlay-container"},f.createElement(j,{onHeightChange:this.onHeightChange},n,t,e)))},onHeightChange:function(e,t){this.props.onComposeHeightChange({overlay:e},t)},onFiles:function(e){var t=_.filter(e.getFiles(),function(e){var t=P.typeFromMimetype(e.type);return"image"===t||"video"===t});if(t.length&&!e.hasType("text/html"))return T.attachMediaDrawer(this.props.chat,t),!0},onSelectionChange:function(e){this.selection=e},hasText:function(){return W.hasText=this.text.trim().length>0},onEnter:function(e){e&&e.repeat||this.onSendText()},onSendText:function(){var e=this.text.trim();if(e.length){var t=/\u200B((\d+)@c\.us)\u200B/g,n=[],i=e.replace(t,function(e,t,i){return n.push(t),"@"+i});this.props.chat.sendMessage(L.emojify(i),this.state.linkPreview,this.props.chat.composeQuotedMsg,n),this.cancelPendingLinkPreviews(),this.setState({emojiExpanded:!1,hasText:!1,linkPreview:null,quotedMsg:this.props.chat.composeQuotedMsg=null}),this.props.chat.setComposeContents({}),this.refs.input.reset(),this.text="",this.hasText()}},render:function(){var e,t=this,n=this.props.chat,i=this.state.emojiExpanded?f.createElement("button",{className:"icon icon-hide btn-emoji",onClick:this.closeEmojiPanel}):f.createElement("button",{className:"icon icon-smiley btn-emoji",onClick:this.openEmojiPanel}),a=F("input-container",{disabled:this.state.recording}),s={pagedown:this.onPageUpDown,pageup:this.onPageUpDown},r=l10n.t("type_a_message"),o=U.supportsFeature(U.F.SPAM)?f.createElement(O,{chat:n}):null,c=_.find(g.TEXTSIZE_CLASS_MAP,function(e){return e.scale===t.state.textsize});c&&(e=c.classname);var l=F("block-compose",e,{"ptt-open":this.state.recording});return f.createElement(G,{displayName:"ComposeBox",ref:"container",state:G.State.PASSIVE,requestFocus:this.restoreFocus},f.createElement(h["default"],{component:"footer",handlers:s,className:"pane-footer pane-chat-footer",onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},o,f.createElement("div",{className:l,ref:"composeBlock"},i,f.createElement(h["default"],{ref:"input_hotkey",className:a,onFocus:this.indicateFocus},f.createElement(E,{placeholder:r,readOnly:this.state.recording,ref:"input",initialValue:this.text,initialSelection:this.selection,spellCheck:!0,multiline:!0,maxLength:g.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onEnter:this.onEnter,onFiles:this.onFiles,onChange:this.onChange,onSelect:this.onSelectionChange,className:"input"})),this._getSendButton()),this._getPopupPanel(),f.createElement(E.Suggestions,{chat:this.props.chat})))}});e.exports=W},function(e,t,n){"use strict";function i(e,t){var n=[];return n.push(r.createElement(c,{key:"info",a8n:"mi-group-info",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_group_info"))),n.push(r.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(r.createElement(l,{key:"mute",onMute:function(t){return o.muteChat(e,t)},chat:e})),e.canClear()&&n.push(r.createElement(c,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}function a(e,t){var n=[];return n.push(r.createElement(c,{key:"info",a8n:"mi-broadcast-info",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_list_info"))),n.push(r.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.canClear()&&n.push(r.createElement(c,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}function s(e,t){var n=[];return e.isPSA||n.push(r.createElement(c,{key:"info",a8n:"mi-contact",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_contact_info"))),n.push(r.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(r.createElement(l,{key:"mute",onMute:function(t){return o.muteChat(e,t)},chat:e})),e.canClear()&&n.push(r.createElement(c,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}var r=n(6),o=n(8),c=n(1319),l=n(1407),u=n(1404);e.exports={group:i,contact:s,broadcast:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(143),c=r.createClass({displayName:"HiddenText",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,n="["+o.timeStr(e.t)+"]";return r.createElement("span",{className:"message-pre-text"},"⁠⁠",n," ",t,": ⁠⁠⁠")}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(1333),o=i(r),c=n(6),l=n(1328),u=n(1310),d=n(141),p=n(1317),h=n(1316),f=n(67),m=n(45),g=n(442),v=n(1330),y=50,E=["foursquare.com","facebook.com","maps.google.com"],b=c.createClass({displayName:"Location",mixins:[u,d],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:c.PropTypes.element,displayAuthor:c.PropTypes.bool},statics:{previewWidth:270,previewHeight:150},getInitialState:function(){var e="",t=!1,n=this.getStaticMapUrl();return v.isCached(n)&&(e=n,t=!0),{src:e,hiResAvail:t}},componentDidMount:function(){this.updateResolution(),this.regNativeListener(window,"dpichange",this.updateResolution)},getClientThumb:function(){return"data:image/jpeg;base64,"+this.async("msg.body")},getStaticMapUrl:function(){var e=this.props.msg,t=b.previewWidth,n=b.previewHeight+y,i=g.currentRes===g.RES.HIGH?2:1,a=f.build("https://maps.googleapis.com/maps/api/staticmap",{markers:"color:red|"+e.lat+", "+e.lng,zoom:14,size:t+"x"+n,scale:i,language:l10n.getLocale(),client:f.GSM_NAME});return f.gsmURL(a,f.GSM_NUMS)},getMapUrl:function(){var e=this.props.msg,t=this.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/")+"?hl="+l10n.getLocale():f.build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17,hl:l10n.getLocale()})},loc:function M(){var M=this.props.msg.get("loc");if(M)return M=M.split("\n"),2===M.length?{name:M[0],addr:M[1]}:{name:M}},getLocationDetails:function(){var e=this.props.msg,t=this.loc(),n=this.props.msg.clientUrl||this.getMapUrl(),i=void 0,a=void 0,s=void 0,r=f.hostname(n),o=_.isEmpty(E.filter(function(e){return r.indexOf(e)>-1}));if(s=o?c.createElement("div",{className:"location-page-host location-caption"},c.createElement(l,null,r)):null,t){i=t.name?c.createElement("a",{href:n,title:t.name,target:"_blank",className:"text-title"},c.createElement(l,null,t.name)):null;var u=m("text-contents",{"location-caption":!s});a=t.addr?c.createElement("div",{title:t.addr,className:u},c.createElement(l,null,t.addr)):null}var d=i&&a?c.createElement("div",{className:"image-caption message-text","data-id":e.id},i,a,s):null;return d},updateResolution:function(){this.setState({src:this.getStaticMapUrl()})},onImgLoaded:function(){this.state.hiResAvail||this.setState({hiResAvail:!0})},onClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=this.getLocationDetails(),n=t?null:c.createElement("div",{className:"shade"}),i=this.props.displayAuthor&&h.shouldRender(e)?c.createElement(h,{msg:e}):null,a=m("bubble-location",{"bubble-location-caption":t,"bubble-broadcast":t&&e.broadcast,"bubble-star":t&&e.star}),s={background:"url("+this.getClientThumb()+")",backgroundSize:"cover",width:b.previewWidth,height:this.state.hiResAvail?void 0:b.previewHeight},r={height:b.previewHeight},l=m("image-thumb-body",{"image-thumb-location-lores":!this.state.hiResAvail});return c.createElement("div",{className:a},i,this.props.quotedMsg,c.createElement("div",{className:"image-thumb",onClick:this.onClick,style:r},c.createElement("a",{href:this.getMapUrl(),target:"_blank"},c.createElement(o["default"],{src:this.state.src,className:l,style:s,hasPrivacyChecks:!1,onLoaded:this.onImgLoaded,noXHR:!0})),n),t,c.createElement(p,{msg:e}))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1307),m=i(f),g=n(6),v=n(1327),y=n(1535),E=n(1530),_=n(1519),b=n(1529),M=n(1539),C=n(1518),S=n(1538),T=n(1418),w=n(1531),k=n(1521),P=n(1523);n(1314);var N=n(1537),O=n(1528),D=n(1532),x=n(1),R=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,n=e.quotedMsg,i=e.displayAuthor,a=e.displayType,s=e.isMsgVisible;switch(t.type){case m["default"].TYPE.CIPHERTEXT:return g.createElement(_,{msg:t,ref:"msg",displayAuthor:i});case m["default"].TYPE.REVOKED:return g.createElement(D,{msg:t,ref:"msg",displayAuthor:i});case m["default"].TYPE.CHAT:return g.createElement(y,{msg:t,ref:"msg",quotedMsg:n,trusted:t.isTrusted(),senderName:t.senderObj?t.senderObj.name:void 0,displayAuthor:i});case m["default"].TYPE.IMAGE:return g.createElement(E,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayAuthor:i});case m["default"].TYPE.GROUP_NOTIFICATION:case m["default"].TYPE.GP2:case m["default"].TYPE.BROADCAST_NOTIFICATION:case m["default"].TYPE.NOTIFICATION:case m["default"].TYPE.E2E_NOTIFICATION:case m["default"].TYPE.CALL_LOG:var r=t.body,o=void 0,c=void 0,l=void 0;switch(t.type){case m["default"].TYPE.GP2:case m["default"].TYPE.GROUP_NOTIFICATION:r=v.formatGroupNotification(t);break;case m["default"].TYPE.BROADCAST_NOTIFICATION:r=v.formatBroadcastNotification(t.subtype,t.body);break;case m["default"].TYPE.E2E_NOTIFICATION:r=v.formatE2ENotification(t),o=t.subtype,l=t.body,c=t.id.remote;break;case m["default"].TYPE.CALL_LOG:r=v.formatCallLog(t,!0)}return g.createElement(b,{text:r,type:t.type,subtype:t.subtype,ref:"msg",e2eSubtype:o,participantJid:l,chatId:c});case m["default"].TYPE.AUDIO:return g.createElement(C,{msg:t,quotedMsg:n,isMsgVisible:s,displayAuthor:i,ref:"msg"});case m["default"].TYPE.VIDEO:return t.isGif?g.createElement(P,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayType:a,displayAuthor:i}):g.createElement(M,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayAuthor:i});case m["default"].TYPE.VCARD:return g.createElement(S,{msg:t,ref:"msg",quotedMsg:n,displayAuthor:i});case m["default"].TYPE.MULTI_VCARD:return g.createElement(O,{msg:t,quotedMsg:n,displayAuthor:i});case m["default"].TYPE.LOCATION:return g.createElement(T,{msg:t,ref:"msg",quotedMsg:n,displayAuthor:i});case m["default"].TYPE.PTT:return g.createElement(w,{msg:t,quotedMsg:n,displayAuthor:i,ref:"msg"});case m["default"].TYPE.DOCUMENT:return g.createElement(k,{msg:t,ref:"msg",quotedMsg:n,trusted:t.isTrusted(),senderName:t.senderObj?t.senderObj.name:null,displayAuthor:i});case m["default"].TYPE.UNKNOWN:return g.createElement(N,{msg:t,displayAuthor:i});default:return x.log("messageList:render Unknown message type: "+t.type)(),g.createElement(N,{msg:t,displayAuthor:i})}}}]),t}(g.Component);e.exports=R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(38),c=n(10),l=n(141),u=n(1403),d=r.createClass({displayName:"PTTPlayer",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,autoPlay:r.PropTypes.bool.isRequired,onPlayingUpdate:r.PropTypes.func.isRequired,onTimeUpdate:r.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){var e=o.findDOMNode(this.refs.audio);this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<c.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=o.findDOMNode(this.refs.audio);e.currentTime=0,e.load()},onTimeUpdate:function(){var e=o.findDOMNode(this.refs.audio),t=0;_.isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=o.findDOMNode(this.refs.audio);this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate)},onDrag:function(e){var t=o.findDOMNode(this.refs.audio),n=e.target.value;this.setState({progress:n}),t.duration&&(t.currentTime=t.duration/100*n)},onPlayerError:function(e){},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={width:this.state.progress-this.state.progress/100*3+"%"};return r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{ref:"play_pause",className:e,onClick:this.onPlayClick})),r.createElement("div",{className:"audio-body"},r.createElement("div",{className:"audio-track-container"},r.createElement("span",{className:"audio-progress",style:t}),r.createElement("input",{type:"range",className:"audio-track",value:this.state.progress,onChange:this.onDrag,min:"0",max:"100"}))),r.createElement(u,{ref:"audio",msg:this.props.msg,preload:"auto",onError:this.onPlayerError,autoPlay:this.props.autoPlay}))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(1308),o=i(r),c=n(1355),l=i(c),u=n(6),d=n(8),p=n(1328),h=n(1327),f=n(1316),m=n(1216),g=n(1309),v=n(1362),y=n(143),E=n(1331),_=n(1310),b=n(45),M=n(104),C=n(10),S=n(1419),T=n(216),w=s["default"].TYPE,k=w.CHAT,P=w.IMAGE,N=w.VIDEO,O=w.LOCATION,D=w.DOCUMENT,x=w.VCARD,R=w.AUDIO,A=w.MULTI_VCARD,I=u.createClass({displayName:"QuotedMsg",mixins:[_,m],propTypes:{msg:u.PropTypes.instanceOf(s["default"]).isRequired,chat:u.PropTypes.instanceOf(o["default"]).isRequired,onOmit:u.PropTypes.func,rootMsg:u.PropTypes.instanceOf(s["default"]),displayType:u.PropTypes.string},getInitialState:function(){var e={hover:!1,preview:!1};return this.props.msg.isMMS&&(e.url=this.async("msg.mediaData.renderableUrl")),e},onClick:function(){var e=this.props,t=e.chat,n=e.rootMsg,i=e.msg;if(n&&(!n.isQuotedMsgAvailable||i.isStatusV3))return void this.setState({preview:!0});var a=i.id,s=t.getSearchContext(Store.Msg.get(a)||a,n);s&&(s.slideToMsg=!0),d.openChatAt(t,s)},onMouseOver:function(e){!this.state.hover&&this.props.rootMsg&&this.setState({hover:!0})},onMouseEnter:function(e){!this.state.hover&&this.props.rootMsg&&this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},render:function(){var e=this,t=this.props,n=t.msg,i=t.displayType,a=t.chat,s=a.assignedColor(n.sender),r=i===C.DISP_TYPE.CONVERSATION,o=u.createElement(f,{msg:n,chat:a,className:"quoted-msg-bubble-ptt-author",displaySelf:n.sender===Store.Conn.me,disableClick:!0}),c=[];n.hasSymbol()&&c.push(u.createElement(l["default"],{msg:n,key:"msg-symbol"})),[N,R].indexOf(n.type)>-1&&!n.isGif&&!n.caption&&c.push(y.durationStr(n.duration)+" "),[P,N,k].indexOf(n.type)>-1?c.push(u.createElement(g,{format:!0,mention:n.mentionMap(),text:h.msgText(n,!1),direction:"auto",key:"status"})):c.push(u.createElement(g,{format:!0,text:h.msgText(n),direction:"auto",key:"status"}));var d=null,m=this.props.rootMsg;if(this.state.preview&&m){var _=b("quoted-msg-preview",m.isSentByMe?"right":"left",{"chat-msg":n.type===k});d=u.createElement(T,{displayName:"QuotedMsgPreview",escapable:!0,popable:!0,requestDismiss:function(){return e.setState({preview:!1})}},u.createElement("div",{className:_},u.createElement(S,{msg:n}),u.createElement("div",{className:"nib-wrapper"},u.createElement("div",{className:"nib"}))))}var w=void 0,I="quoted-msg-image";switch(n.type){case P:case N:case O:case D:if(n.body){var L=n.type===P&&n.url?n.url:"data:image/jpeg;base64,"+n.body;w=u.createElement("div",{style:{backgroundImage:"url("+L+")"},className:I})}break;case k:n.thumbnail&&(w=u.createElement("div",{style:{backgroundImage:'url("data:image/jpeg;base64,'+n.thumbnail+'")'},className:I}));break;case x:w=u.createElement(v,{waid:n.getVCardThumbnailWAid(),size:v.Size.NONE,thumb:n.body&&E.thumbnail(n.body),quoted:!0,className:I});break;case A:w=u.createElement(v,{className:I,quoted:!0})}var U=b("quoted-msg",{"quoted-msg-hover":this.state.hover}),F=this.props.onOmit?u.createElement("div",{style:{display:"flex",flex:"0 0 auto"}},w,u.createElement("div",{className:"btn-background"},u.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit}))):w&&u.createElement("div",{className:"quoted-msg-image-wrapper"},w);return u.createElement("div",{onMouseOver:r?this.onMouseOver:null,onMouseEnter:r?this.onMouseEnter:null,onMouseLeave:r?this.onMouseLeave:null},u.createElement(M,{transitionName:"quoted-msg-preview",className:"quoted-msg-preview-wrapper"},d),u.createElement("div",{className:U,onClick:r?this.onClick:null},u.createElement("div",{className:"quoted-msg-status"},u.createElement("span",{className:"bg-color-"+s+" quoted-msg-color-bar"}),u.createElement("div",{className:"quoted-msg-info"},u.createElement("div",null,o,u.createElement("div",{className:"chat-status message-text quoted-msg-text"},u.createElement(p,null,c))))),F))}});e.exports=I},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){this.key=e,this.css=t,this.title=n,this.className="emoji-"+e}var s,r=n(431),o=i(r),c=n(6),l=i(c),u=n(38),d=i(u),p=n(19),h=i(p),f=n(140),m=i(f),g=n(141),v=i(g),y=n(144),E=i(y),b=n(84),M=i(b),C=n(433),S=i(C),T=n(449),w=i(T),k=n(1627),P=i(k),N=n(1309),O=i(N),D=n(82),x=n(103),R=i(x),A=n(104),I=i(A),L=n(1512),U=i(L),F=n(1319),G=i(F),j=n(437),B=i(j),H=n(52),q=i(H),W=n(1557),V=i(W),z=n(83),Y=i(z),K=n(216),Q=i(K),X=n(222),Z=X.EMOJI.CATEGORIES,J=44,$=[""].concat(S["default"].skinToneVariations),ee=function(e,t,n){for(var i=arguments.length,a=Array(i>3?i-3:0),s=3;s<i;s++)a[s-3]=arguments[s];return function(i){return i&&(i.preventDefault(),i.stopPropagation()),t&&(n?t.call.apply(t,[e,i].concat(a)):t.apply(e,a))}},te=(s={},(0,o["default"])(s,Z.RECENT,new a(Z.RECENT,"icon-emoji-recent",function(){return l10n.t("emoji_tab_recent")})),(0,o["default"])(s,Z.SMILEYS_PEOPLE,new a(Z.SMILEYS_PEOPLE,"icon-emoji-people",function(){return l10n.t("emoji_tab_smileys_people")})),(0,o["default"])(s,Z.ANIMALS_NATURE,new a(Z.ANIMALS_NATURE,"icon-emoji-nature",function(){return l10n.t("emoji_tab_animals_nature")})),(0,o["default"])(s,Z.FOOD_DRINK,new a(Z.FOOD_DRINK,"icon-emoji-food",function(){return l10n.t("emoji_tab_food_drink")})),(0,o["default"])(s,Z.ACTIVITY,new a(Z.ACTIVITY,"icon-emoji-activity",function(){return l10n.t("emoji_tab_activity")})),(0,o["default"])(s,Z.TRAVEL_PLACES,new a(Z.TRAVEL_PLACES,"icon-emoji-travel",function(){return l10n.t("emoji_tab_travel_places")})),(0,o["default"])(s,Z.OBJECTS,new a(Z.OBJECTS,"icon-emoji-objects",function(){return l10n.t("emoji_tab_objects")})),(0,o["default"])(s,Z.SYMBOLS,new a(Z.SYMBOLS,"icon-emoji-symbols",function(){return l10n.t("emoji_tab_symbols")})),(0,o["default"])(s,Z.FLAGS,new a(Z.FLAGS,"icon-emoji-flags",function(){return l10n.t("emoji_tab_flags")})),(0,o["default"])(s,Z.GIFS,new a(Z.GIFS,"icon-emoji-gifs",function(){return l10n.t("emoji_tab_gifs")})),s),ne=[te.RECENT,te.SMILEYS_PEOPLE,te.ANIMALS_NATURE,te.FOOD_DRINK,te.ACTIVITY,te.TRAVEL_PLACES,te.OBJECTS,te.SYMBOLS,te.FLAGS],ie=ne.concat([te.GIFS]),ae=l["default"].createClass({displayName:"EmojiPanel",mixins:[m["default"]],propTypes:{onEmoji:l["default"].PropTypes.func.isRequired,onGif:l["default"].PropTypes.func,onFocusRelease:l["default"].PropTypes.func},getInitialState:function(){var e=this.props.onGif?ie:ne,t=Store.RecentEmoji.length>0?te.RECENT:te.SMILEYS_PEOPLE,n=te[h["default"].getLastEmojiTab()];return n&&e.indexOf(n)>-1&&(t=n),{tabs:e,selected:t}},componentDidMount:function(){var e=this.state.selected.key;this.uiIdle(function(){new q["default"].WebcEmojiOpen({webcEmojiOpenTab:e}).commit()})},componentWillUnmount:function(){h["default"].setLastEmojiTab(this.state.selected.key)},onSelectTab:function(e){var t=this.state.tabs,n=t.indexOf(this.state.selected),i=t.indexOf(e),a=i>n?"right":"left";this.setState({selected:e,direction:a})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},restoreFocus:function(){this.refs.emojiTab&&this.refs.emojiTab.restoreFocus()},render:function(){var e=this,t=void 0;t=this.state.selected===te.GIFS?l["default"].createElement(V["default"],{onGif:this.props.onGif}):l["default"].createElement("div",{className:"emoji-panel-body",key:this.state.selected.key},l["default"].createElement(se,{ref:"emojiTab",tab:this.state.selected,onEmoji:this.onEmoji,onFocusRelease:this.props.onFocusRelease}));var n=this.state.tabs,i=n.indexOf(this.state.selected),a=n.map(function(t){return l["default"].createElement("button",{className:"menu-tab"+(e.state.selected===t?" active":""),onClick:function(){return e.onSelectTab(t)},key:t.key,title:t.title()},l["default"].createElement("span",{className:"icon "+t.css}))}),s=l10n.isRTL()?-1:1,r={width:100/a.length+"%",transform:"translateX("+100*i*s+"%)"},o="right"===this.state.direction?"slide-forward":"slide-back";return l["default"].createElement("div",{className:"emoji-panel k"},l["default"].createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected.key},l["default"].createElement("div",{style:r,className:"menu-tabs-marker"}),a),l["default"].createElement(I["default"],{transitionName:o},t))}}),se=l["default"].createClass({displayName:"EmojiTab",mixins:[m["default"],E["default"],v["default"],M["default"]],propTypes:{tab:l["default"].PropTypes.oneOf(ne).isRequired,onEmoji:l["default"].PropTypes.func.isRequired,onFocusRelease:l["default"].PropTypes.func},lastFocusedElement:null,getInitialState:function(){var e={skinTonePicker:!1,searchText:null};return this.props.tab===te.RECENT&&(e.recent=Store.RecentEmoji.models.map(function(e){return S["default"].emojiMap[e["char"]]}),e.variants={}),e},componentDidMount:function(){var e=this;this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){return e.forceUpdate()}),this.uiIdle(this.restoreFocus)},onEmojiClick:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&(!S["default"].skinToneEmojis[t]||this.state.recent&&!this.state.searchText||Store.EmojiVariant.getVariant(t)?this.onEmoji(e.target.dataset.variant||t):this.onContextMenu(e))},onEmojiMouseDown:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&S["default"].skinToneEmojis[t]&&this.startPickerTimer(e)},onEmoji:function(e){this.props.onEmoji(e),this.releaseFocus()},releaseFocus:function(){this.props.onFocusRelease&&this.props.onFocusRelease()},setEmojiVariant:function(e,t,n){if(this.stopEvent(e),this.onEmoji(n),Store.EmojiVariant.setVariant(t,n),this.state.recent){var i=this.state.variants;i[t]=n,this.setState({variants:i})}return!1},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},onContextMenu:function(e,t){this.stopEvent(e),e&&(t=t||e.target.dataset.unicode),t&&S["default"].skinToneEmojis[t]&&this._onContextMenu(t,e.target)},_onContextMenu:function(e,t,n){var i=this;n||(this.lastFocusedElement=null),this.clearPickerTimer();var a=S["default"].skinToneEmojis[e],s=$.map(function(t){var n=S["default"].variantToUnicode(a,t);return l["default"].createElement(G["default"],{key:n,a8n:"mi-emoji-variant",action:function(t){return i.setEmojiVariant(t,e,n)}},l["default"].createElement("div",{className:"emoji-picker"},l["default"].createElement(O["default"],{text:n,emojiSize:O["default"].EMOJI_SIZE.LARGE,tabIndex:"-1"})))});this.setState({skinTonePicker:{menu:s,anchor:t,type:B["default"].Type.PICKER,menuDirection:{x:B["default"].Direction.X.RIGHT,y:B["default"].Direction.Y.TOP},layoutDirection:B["default"].LayoutDirection.HORIZONTAL,focusFirstOnMount:n}})},closeSkinTonePicker:function(){this.setState({skinTonePicker:!1})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){this.stopEvent(e),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e){var t=this;this.stopEvent(e),this.clearPickerTimer();var n=e.target,i=n.dataset.unicode;this.pickerTimer=this.safeDelay(function(){t.regCmd("window_click",t.eatClick),t._onContextMenu(i,n)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmojiList:function(){var e=void 0;if(this.state.recent){if(e=this.state.recent,this.state.searchText&&"en"===l10n.getLocale()){var t=P["default"].getMatchedEmojiUnicode(this.state.searchText);e=_.compact(_.map(t,function(e){return _.get(S["default"].emojiMap,e)}))}}else e=w["default"][this.props.tab.key];return e},getEmoji:function(){var e=this,t=this.getEmojiList(),n=t.map(function(t,n){var i=S["default"].codeToEmoji[t],a=void 0;return S["default"].skinToneEmojis[i]&&(a=e.state.recent&&!e.state.searchText?e.state.variants[i]:Store.EmojiVariant.getVariant(i),a&&(t=S["default"].emojiMap[a])),l["default"].createElement("span",{key:i,"data-unicode":i,"data-variant":a,tabIndex:"-1","data-emoji-index":n,className:S["default"].getClasses(t,"large")})}),i={up:ee(this,this.onEmojiArrow,!0,"up"),down:ee(this,this.onEmojiArrow,!0,"down"),left:ee(this,this.onEmojiArrow,!0,"left"),right:ee(this,this.onEmojiArrow,!0,"right"),enter:ee(this,this.onEmojiEnter,!0)};return l["default"].createElement(R["default"],{ref:"emojis",onMouseDown:this.onEmojiMouseDown,onClick:this.onEmojiClick,onContextMenu:this.onContextMenu,handlers:i},n)},onSearchEmoji:function(e){this.setState({searchText:e.target.value.trim()})},onSearchEnter:function(e){var t=_.first(this.getEmojiList());if(t){var n=S["default"].codeToEmoji[t];this.keyboardSelectEmoji(e,n)}},onSearchDown:function(){this.getEmojiList().length&&this.focusEmoji(0)},onEmojiArrow:function(e,t){var n=e.target.dataset.emojiIndex;if(n){n=Number(n);var i=this.getEmojiList(),a=this.getEmojiRowLength(),s=n;switch(t){case"up":if(n<a&&this.refs.searchInput)return R["default"].flashFocus=Date.now(),void this.focusSearchInput();s=n-a;break;case"down":s=Math.min(n+a,i.length-1);break;case"left":s=Math.max(n-1,0);break;case"right":s=Math.min(n+1,i.length-1)}this.focusEmoji(s)}},getEmojiRowLength:function(){var e=this.refs.emojiPanel&&this.refs.emojiPanel.offsetWidth;return e?Math.floor(e/J):1},onEmojiEnter:function(e){var t=e.target.dataset.emojiIndex;if(t){var n=this.getEmojiList(),i=n[t],a=S["default"].codeToEmoji[i];this.keyboardSelectEmoji(e,a)}},keyboardSelectEmoji:function(e,t){if(S["default"].skinToneEmojis[t])if(this.state.recent&&!this.state.searchText){var n=this.state.variants[t];this.onEmoji(n||t)}else{var i=Store.EmojiVariant.getVariant(t);i?this.onEmoji(i):(this.stopEvent(e),this._onContextMenu(t,e.target,!0))}else this.onEmoji(t)},focusElement:function(e){(0,D.focus)(e),this.lastFocusedElement=e},focusEmoji:function(e){if(!(e<0)){var t=d["default"].findDOMNode(this.refs.emojis).children;e>t.length||this.focusElement(t[e])}},searchInputHasFocus:function(){var e=document.activeElement;return!!e&&e===this.refs.searchInput},focusSearchInput:function(){if(this.refs.searchInput&&!(this.searchInputHasFocus()||((0,D.focus)(this.refs.searchInput),this.lastFocusedElement=null,Date.now()-(R["default"].flashFocus||0)>200))){var e=d["default"].findDOMNode(this.refs.searchContainer);Velocity(e,"stop"),Velocity(e,{backgroundColor:["#e0e1e2","#D9F3FF"]},{duration:1300,easing:[.24,.91,.01,.99]})}},getSearchBox:function(){if(this.state.recent){var e=l10n.t("search_emoji"),t={enter:ee(this,this.onSearchEnter,!0),down:ee(this,this.onSearchDown,!1)};return l["default"].createElement(R["default"],{handlers:t,"data-tab":4,onFocus:this.focusSearchInput},l["default"].createElement("div",{className:"emoji-search-row"},l["default"].createElement("label",{ref:"searchContainer",className:"emoji-search-row-input"},l["default"].createElement("div",{className:"input-container"},l["default"].createElement("input",{ref:"searchInput",className:"input input-search input-emoji-search",type:"text",dir:"auto",title:e,placeholder:e,onMouseDown:function(e){e.stopPropagation()},onChange:this.onSearchEmoji})))))}return null},restoreFocus:function(){this.lastFocusedElement?this.focusElement(this.lastFocusedElement):this.focusSearchInput()},render:function(){var e=void 0;this.state.skinTonePicker&&(e=l["default"].createElement(Q["default"],{displayName:"SkinTonePicker",popable:!0,escapable:!0,requestDismiss:this.closeSkinTonePicker},l["default"].createElement(U["default"],{tooltip:this.state.skinTonePicker})));var t=null;return"en"===l10n.getLocale()&&(t=this.getSearchBox()),l["default"].createElement("div",{ref:"emojiPanel",className:this.props.tab.className},t,this.getEmoji(),e)}});se.contextTypes={uim:l["default"].PropTypes.instanceOf(Y["default"])},e.exports={EmojiPanel:ae,EmojiTab:se}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1323),c=n(1433),l=n(1586),u=n(1580),d=n(139),p=n(1579),h=n(1572),f=n(1568),m=r.createClass({displayName:"InfoFlow",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired
},componentWillMount:function(){var e=d.supportsFeature(d.F.STARRED)&&d.supportsFeature(d.F.FULL_TEXT_SEARCH),t=e?this.onStarred:null,n=d.supportsFeature(d.F.MEDIA_GALLERY)?this.onMediaGallery:null,i=null;this.props.chat.isGroup?i=r.createElement(p,{chat:this.props.chat,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onGroupInviteLink:this.onGroupInviteLink,onClose:this._pop}):this.props.chat.isBroadcast?i=r.createElement(f,{chat:this.props.chat,onStarred:t,onMediaGallery:n,onClose:this._pop}):this.props.chat.isUser&&(i=r.createElement(h,{contact:this.props.chat.contact,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onClose:this._pop})),this.push(i)},onStarred:function(){var e=r.createElement(c,{chat:this.props.chat,starredMsgs:this.props.chat.getStarredMsgs(),onClose:this._pop});this.push(e)},onMediaGallery:function(){var e=r.createElement(l,{chat:this.props.chat,onBack:this._pop});this.push(e)},onGroupInviteLink:function(){var e=r.createElement(u,{chat:this.props.chat,onBack:this._pop});this.push(e)},_pop:function(){this.pop()}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=(n(1364),n(6)),m=n(85),g=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));return n.setVideoRef=function(e){n._videoRef=e,n.synchronizeVideo()},n.synchronizeVideo=function(){var e=n._videoRef;e&&(n.state.animate?e.paused&&e.play():e.paused||(e.pause(),e.currentTime=0))},n.setShouldAnimate=function(e){n.state.animate===e&&n.state.show||n.setState({animate:e,show:!0},n.synchronizeVideo)},n.handleClick=function(){n.props.onSend(n.props.gif)},n._videoRef=null,n.state={animate:!1,show:!1},n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props.gif,t=null;this.state.show&&(t=m.troublesWithLotsOfVideos&&e.nonVideoUrl?f.createElement("img",{className:"gif-search-gif",onClick:this.handleClick,src:e.nonVideoUrl}):f.createElement("video",{className:"gif-search-gif",onClick:this.handleClick,controls:!1,autoPlay:this.state.animate,loop:!0,muted:!0,ref:this.setVideoRef,src:e.previewUrl}));var n=void 0;return this.props.isStarred&&(n=f.createElement("span",{className:"icon-s icon-star-light"})),f.createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:e.widthStr}},f.createElement("div",{style:{width:e.widthStr}},f.createElement("div",{style:{paddingBottom:e.ratioStr}},t)),n)}}]),t}(f.Component);t["default"]=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=new p.WebcMediaAnalyzed;return r({type:"prep",file:e,asGif:t}).then(function(e){var t=e.type,n=e.result,i=e.error,a=e.filename,s=e.file;switch(t){case"result":return u.log("MediaAnalyzer:checkAndRepair approved file")(),n;case"parsingError":return u.info("trouble parsing file "+s+" (fossil "+a+") "+i)(),s&&(u.error("mediajs-error "+i)(),l.uploadFossil(s,a)),void u.log("MediaAnalyzer:checkAndRepair rejected file ("+i+")")()}})["catch"](function(e){u.assert(!1,"media-detection-error","MediaAnalyzer:checkAndRepair got error! "+e)()})["finally"](function(t){if(n){var i=void 0;if(e.name){var a=e.name.split(".");a.length>1&&(i=a[a.length-1])}n.set({webcMediaSupported:!!t,webcMediaExtensions:i}),n.markWebcMediaAnalyzeT(),n.commit()}})}function s(e,t){return u.log("MediaAnalyzer:reportFossil fossilizing for "+t)(),r({type:"fossilize",file:e}).then(function(t){var n=t.file;u.log("MediaAnalyzer:reportFossil successfully fossilized: "+!!n)(),n&&l.uploadFossil(n,e.name+".prefos")})}function r(e){var t=void 0;return new c["default"](function(n,i){u.log("MediaAnalyzer:sendMessageToWorker")(),t=new d,t.onmessage=function(e){try{e.data&&"log"===e.data.type?u.log("(via Milan) "+e.data.msg)():n(e.data)}catch(t){i(t)}},t.onerror=function(e){i("Milan.onerror = "+(e&&e.message?e.message:e))},t.postMessage(e)})["finally"](function(){t&&t.terminate()})}var o=n(2),c=i(o),l=n(27),u=n(1),d=n(1647),p=n(52);e.exports={checkAndRepair:a,reportFossil:s}},function(e,t,n){"use strict";var i=n(87),a=50,s=75,r={getInitialState:function(){var e=this;this._setState=this.setState,this.setState=function(t,n,i){_.assign(e.getBatchRenderState(),t),_.isUndefined(n)&&_.isUndefined(i)?e._debounceSetState.forceRun():_.isUndefined(i)?e._debounceSetState.debounce(n):e._debounceSetState.debounceAndCap(n,i)}},componentWillMount:function(){var e=this;this._debounceSetState=new i(function(){e._setState(e._batchRenderMixinState),e._batchRenderMixinState={}})},componentWillUnmount:function(){this._debounceSetState.cancel()},getBatchRenderState:function(){return this._batchRenderMixinState||(this._batchRenderMixinState={}),this._batchRenderMixinState}};r.DD=s,r.CD=a,e.exports=r},function(e,t,n){"use strict";var i=n(6),a=n(38),s=n(1),r=n(1413),o=n(1334),c=n(144),l=n(141),u=n(1311),d=n(1313),p=n(1312),h=n(45),f=n(1342),m=n(10),g=n(1327),v=n(1371),y=n(104),E={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},b=i.createClass({displayName:"CaptureDrawer",mixins:[l,c],propTypes:{noContainer:i.PropTypes.bool,stream:i.PropTypes.object.isRequired,caption:i.PropTypes.bool,onBack:i.PropTypes.func.isRequired,onSend:i.PropTypes.func.isRequired},statics:{State:E},getInitialState:function(){return{state:E.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:E.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){if(this.state.url){var e=this.props.stream;v.stop(e),window.URL.revokeObjectURL(this.state.url)}},onCapture:function(e){var t=document.createElement("canvas");if(this.refs.video){var n=a.findDOMNode(this.refs.video);t.height=n.videoHeight,t.width=n.videoWidth;var i=t.getContext("2d");i.translate(t.width,0),i.scale(-1,1),i.drawImage(n,0,0,n.videoWidth,n.videoHeight);var s=t.toDataURL("image/jpeg");this.setState({state:E.SENDING,img:s})}},onVideoLoaded:function(e){this.setState({state:E.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:E.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:g.emojify(_.trim(this.state.caption))})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,n,a;switch(this.state.state){case E.ANIMATING:break;case E.LOADING:case E.RECORDING:var c=h("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===E.LOADING});n=i.createElement("div",{key:"webcam"},i.createElement(o,{type:o.TYPES.CONTAIN,size:this.state.videoSize},i.createElement(r,{className:c,autoPlay:!0,ref:"video",onPlay:this.onVideoLoaded,src:this.state.url}))),e=i.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},i.createElement("span",{className:"icon icon-camera-light"})));break;case E.SENDING:n=i.createElement("div",{key:"snapshot"},i.createElement(o,{type:o.TYPES.CONTAIN,size:this.state.videoSize},i.createElement("img",{className:"capture-image snapshot",src:this.state.img})));var l=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=i.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},i.createElement("span",{className:l}))),t=i.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},i.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),a=i.createElement(f,{ref:"emojiInput",editable:!0,value:this.state.caption,maxLength:m.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange,supportsEmoji:!0,focusOnMount:!0});break;default:s.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var g=void 0;g=this.props.caption?i.createElement("div",{className:"capture-footer"},i.createElement(y,{transitionName:"media-caption",className:"media-caption"},a),i.createElement(y,{transitionName:"pop_delay"},e)):i.createElement("div",{className:"capture-footer"},i.createElement(y,{transitionName:"pop_delay"},e));var v=this.props.noContainer?d.Type.POPUP:d.Type.OFFSET;return i.createElement(u,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},i.createElement(d,{title:l10n.t("take_photo"),type:v,onCancel:this.props.onBack},t),i.createElement(p,null,i.createElement("div",{className:"media-body"},i.createElement("div",{className:"media-body-container"},i.createElement(y,{transitionName:"capture"},n))),g))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1351),s=i(a),r=n(1322),o=i(r),c=n(1307),l=i(c),u=n(1308),d=i(u),p=n(1376),h=i(p),f=n(1355),m=i(f),g=n(103),v=i(g),y=n(6),E=n(38),b=n(143),M=n(1311),C=n(1312),S=n(1348),T=n(1310),w=n(140),k=n(84),P=n(1314),N=n(1426),O=n(141),D=n(1321),x=n(1327),R=n(85),A=n(142),I=n(8),L=n(139),U=n(1374),F=n(14),G=n(1324),j=n(10),B=n(1444),H=n(1340),q=n(1309),W=n(1449),V=n(82),z=n(83),Y=n(1325),K=Y.GetRef,Q=n(1216),X=n(45),Z=2,J=y.createClass({displayName:"ChatSearch",mixins:[w,k,Q,P,N],propTypes:{chat:y.PropTypes.instanceOf(d["default"]).isRequired},getInitialState:function(){var e=this;return this.ftsMsgs=new B,this.fts=_.debounce(function(){e.pending=!1;var t=_.trim(e.state.searchText||"");U.multibyteLength(t)<Z||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=e.ftsMsgs.search(t,e.props.chat).checkpoint(e.rejectOnUnmount()).then(function(n){t===_.trim(e.state.searchText)&&e.setState({searching:!1},N.DD)})["catch"](F.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1},N.DD)}))},750),this.selection=new G([],function(e){return e.id.toString()}),{searchText:"",searching:!1}},componentDidMount:function(){this.onFocusSearch(),this.addObserver(this.ftsMsgs,"reset"),this.addObserver(this.ftsMsgs,"search_more")},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0}))},componentWillUnmount:function(){this.fts.cancel(),this.ftsMsgs["delete"](!0),this._ftsPromise&&this._ftsPromise.cancel()},fullTextSearch:function(e){var t=_.trim(e);U.multibyteLength(t)>=Z&&L.supportsFeature(L.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},N.DD)):(this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.state.searching&&this.setState({searching:!1},N.DD))},shouldFTSSearch:function(e){if(!this.ftsMsgs.hasMoreMsgs||this.pending||this.state.searching||U.multibyteLength(this.state.searchText||"")<Z)return!1;var t=_.last(e.children);return e.scrollHeight<e.clientHeight+t.scrollHeight},onSearch:function(e){if(this.isMounted()){if(!e)return void this.onStopSearch();var t=this.state.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),this.setState({searchText:e}),this.setState(n,N.DD)}}},onStopSearch:function(){this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.setState({searchText:"",searching:!1})},onFocusList:function(e){e.repeat||this.refs.msglist&&this.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),v["default"].flashFocus=Date.now(),this.refs.msglist.focusFirst())},onOpenFirst:function(e){e.preventDefault();var t=_.head(this.state.ftsResult);if(t){var n=t.chat,i=n.getSearchContext(t);I.focusChatTextInput(n),I.openChatAt(n,i)}},onFocusSearch:function(e){v["default"].flashFocus=Date.now(),V.focus(this.search)},onClose:function(){this.context.uim.uie.requestDismiss()},indicateFocus:function(e){if(!(Date.now()-(v["default"].flashFocus||0)>200)){var t=E.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){e.scrollTop+j.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.ftsMsgs.hasMoreMsgs&&!this.pending&&(this.fts(),this.pending=!0)},100),getEmptyChatlistState:function(e){if(e.length)return null;var t=_.trim(this.state.searchText||"");return U.multibyteLength(t)>=Z?this.state.searching?y.createElement(D.SearchingMessages,null):y.createElement(D.SearchMessages,null):D.BeforeSearchMessages(this.props.chat.title())},render:function(){var e=this.ftsMsgs.models,t=this.getEmptyChatlistState(e);if(!t){var n=this.state.searchText?_.trim(this.state.searchText):null;t=y.createElement($,{ref:"msglist",isSearching:!!this.state.searchText,searchText:n,ftsResult:e,selection:this.selection,onFocusSearch:this.onFocusSearch})}var i={down:this.onFocusList,enter:this.onOpenFirst},a=this.ftsMsgs.hasMoreMsgs&&e.length?y.createElement("div",{className:"more",style:{alignSelf:"center"}},y.createElement(A,{stroke:6,size:24})):null;return y.createElement(M,{key:"search-modal",id:"search",variant:"panel",onCancel:this.onClose},y.createElement("header",{className:"pane-header"},y.createElement("div",{className:"header-close"},y.createElement("button",{onClick:this.onClose},y.createElement("span",{className:"icon icon-x"}))),y.createElement("div",{className:"header-body"},y.createElement("div",{className:"header-main"},y.createElement("div",{className:"header-title"},l10n.t("search_msgs"))))),y.createElement(C,null,y.createElement(v["default"],{handlers:i,onFocus:this.indicateFocus,ref:"input_hotkey",className:"search-container"},y.createElement(s["default"],{ref:K("search",this),onSearch:this.onSearch,placeholder:l10n.t("search"),loading:this.state.searching})),y.createElement("div",{ref:"panel",className:"pane-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},t,a)))}});J.contextTypes={uim:y.PropTypes.instanceOf(z)};var $=y.createClass({displayName:"MsgList",mixins:[w,k,O],propTypes:{isSearching:y.PropTypes.bool,searchText:y.PropTypes.string,ftsResult:y.PropTypes.array,onClick:y.PropTypes.func,selection:y.PropTypes.instanceOf(G),onFocusSearch:y.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){return this._listPointerEvents=!0,{}},componentWillMount:function(){this.props.selection.init(this.getSelection())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},onClick:function(e,t,n){var i=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){i.props.isSearching&&i.props.onClick&&i.props.onClick(),2===W.column&&i.context.uim.uie.requestDismiss(),I.focusChatTextInput(e),I.openChatAt(e,n)})},getSelection:function(){return this.props.ftsResult||[]},getList:function(){var e=this;return this.props.ftsResult.map(function(t){return y.createElement(ee,{msg:t,searchText:e.props.searchText,onClick:e.onClick,active:e.props.selection,key:t.id.toString()})})},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){e.target===E.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var i=this.props.selection.next();this.props.selection.index!==i&&this.props.selection.setNext()},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var i=this.props.selection.prev();i>-1?(this.props.selection.setPrev(),this.focusComposer=n):t||this.props.onFocusSearch()},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return y.createElement(v["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},y.createElement(o["default"],{className:"chatlist",data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn}))}});$.contextTypes={uim:y.PropTypes.instanceOf(z)};var ee=y.createClass({displayName:"Message",mixins:[T,w],propTypes:{msg:y.PropTypes.instanceOf(l["default"]).isRequired,searchText:y.PropTypes.string,mouseDownAsClick:y.PropTypes.bool,onClick:y.PropTypes.func,active:y.PropTypes.object},getInitialState:function(){var e=this.props,t=e.msg,n=e.active,i={formattedTitle:this.async("msg.chat.formattedTitle"),active:!!n&&n.value===t};return t.sender&&t.isGroupMsg&&!t.isNotification&&(t.isSentByMe?i.formattedShortName=t.senderObj.formattedShortName:i.formattedShortName=this.async("msg.senderObj.formattedShortName")),i},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.msg.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=E.findDOMNode(this);V.focus(n),t&&S.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.msg,n=t.chat,i=n.getSearchContext(t);i.msg=t,this.props.onClick(e,n,i)}},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),v["default"].flashFocus=Date.now(),this.onClick(e)},indicateFocus:function(e){if(!(Date.now()-(v["default"].flashFocus||0)>200)){var t=E.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=E.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},contextEnabled:function(){return!1},render:function(){var e=this.props.msg,t=y.createElement("span",{className:"chat-time-title"},b.relativeStr(e.t)),n=[];e.isSentByMe&&n.push(y.createElement(h["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||(n.push(y.createElement(q,{text:this.state.formattedShortName,direction:"auto",className:{number:!e.senderObj.name,"chat-status-name":!0},key:"author"})),n.push(y.createElement("span",{className:"chat-status-divider",key:"divider"},":"))),e.hasSymbol()&&n.push(y.createElement(m["default"],{msg:e,key:"msg-symbol"})),n.push(y.createElement(q,{direction:e.dir,ellipsify:!0,highlight:this.props.searchText?[this.props.searchText]:null,text:x.msgText(e),key:"status"}));var i="chat-status";R.isGecko&&(i+=" ellipsify");var a=l10n.embedDir(x.msgText(e),e.rtl),s=y.createElement("div",{className:i,title:a},n),r={enter:this.onEnter},o=X("message",{active:!!this.state.active}),c=this.props.mouseDownAsClick;return y.createElement(v["default"],{handlers:r,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},y.createElement(H,{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:o,primaryDetail:t,secondary:s,onClick:c?null:this.onClick,onMouseDown:c?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=J},function(e,t,n){"use strict";var i=n(6),a=n(45),s=i.createClass({displayName:"DrawerItem",propTypes:{title:i.PropTypes.node,icon:i.PropTypes.node,classes:i.PropTypes.string,onClick:i.PropTypes.func},render:function(){var e=this.props,t=e.onClick,n=e.title,s=e.icon,r=e.classes,o=e.children,c=a("drawer-button",r,{clickable:t}),l=a("contents",{"drawer-button-row":s}),u=a({"col-main":s}),d=a({"col-side":s});return i.createElement("div",{className:c,onClick:t},i.createElement("div",{className:l},i.createElement("div",{className:u},i.createElement("div",{className:"primary"},n),i.createElement("div",{className:"secondary"},o)),i.createElement("div",{className:d},s)))}});e.exports=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(1351),o=i(r),c=n(1322),l=i(c),u=n(6),d=n(1311),p=n(1313),h=n(1312),f=n(1346),m=n(1324),g=n(82),v=n(1325),y=v.GetRef,E=u.createClass({displayName:"ListModal",propTypes:{title:u.PropTypes.string.isRequired,selection:u.PropTypes.instanceOf(m),onSearch:u.PropTypes.func,searchPlaceholder:u.PropTypes.string,onCancel:u.PropTypes.func.isRequired,onSelect:u.PropTypes.func},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.selection;t&&t.setNext()},onPrev:function(e){var t=this.props.selection;if(t){e.preventDefault(),e.stopPropagation();var n=t.prev();n>-1?t.setPrev():(t.unset(),s["default"].flashFocus=Date.now(),g.focus(this.search))}},onFocusList:function(e){this.list&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=Date.now(),this.props.selection.setFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.props.children);t&&this.props.onSelect(e,t)},onSearch:function(e){this.props.onSearch(e)},render:function(){var e=this.props,t=e.title,n=e.onCancel,i=e.onSearch,a=e.searchPlaceholder,r=e.children,c={down:this.onFocusList,enter:this.onSelectFirst},m={down:this.onNext,up:this.onPrev},g=void 0;i&&(g=u.createElement(s["default"],{handlers:c},u.createElement(o["default"],{ref:y("search",this),onSearch:this.onSearch,placeholder:a||l10n.t("search")})));var v=void 0;return v=r&&r.length?u.createElement(s["default"],{handlers:m},u.createElement(l["default"],{className:"chatlist",ref:y("list",this),data:r,height:72,extraItems:4})):r,u.createElement(f,{type:f.TOWER},u.createElement(d,{key:"contact-modal",onCancel:n,position:"right"},u.createElement(p,{title:t,type:p.Type.POPUP,onCancel:n}),g,u.createElement(h,{"data-list-scroll-container":!0},v)))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1333),s=i(a),r=n(218),o=i(r),c=n(6),l=n(1315),u=n(1309),d=n(1334),p=n(8),h=n(1310),f=n(45),m=n(216),g=500,v=c.createClass({displayName:"PhotoViewerModal",mixins:[h],propTypes:{contact:c.PropTypes.instanceOf(o["default"]),imgFull:c.PropTypes.string,animateBorderRadius:c.PropTypes.bool,getZoomNode:c.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.props.imgFull||this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},shouldComponentUpdate:function(e,t){return!!t.imgFull||(this.onClose(),!1)},onScroll:function(e){Math.abs(e.deltaY)>3&&this.onClose()},onClose:function(){if(!this.closing){this.closing=!0;var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return p.closeModalMedia();var t=this.refs.image,n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=i.top-n.top,s=i.left-n.left,r=e.clientWidth/t.clientWidth;Velocity(t,{translateX:[s,0],translateY:[a,0],scale:[r,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){p.closeModalMedia()})}},onImageLoad:function(e){var t=this,n=e.target;this.setState({size:{width:n.naturalWidth,height:n.naturalHeight}},function(){t.props.getZoomNode(function(e){var i=n.getBoundingClientRect(),a=e.getBoundingClientRect(),s=a.top-i.top,r=a.left-i.left,o=e.clientWidth/n.clientWidth,c={visibility:"hidden",transform:"translateX("+r+"px) translateY("+s+"px) scale("+o+")",transition:"transform 0s"};t.props.animateBorderRadius&&(c.borderRadius="50%"),t.setState({style:c},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+g+"ms cubic-bezier(.1,.82,.25,1)"};t.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+g+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+g+"ms cubic-bezier(.1,.82,.25,1)"}),t.setState({style:e})})})})},render:function(){var e=this.props.contact,t=f("media-viewer","media-viewer-animate"),n=f("media-panel-header",{});return c.createElement(m,{displayName:"PhotoViewer",escapable:!0,requestDismiss:this.onClose},c.createElement("div",{className:t,onWheel:this.onScroll,onClick:this.onClose},c.createElement("div",{className:n},c.createElement("div",{className:"chat media-chat"},c.createElement("div",{className:"chat-avatar"},c.createElement(l,{id:e.id})),c.createElement("div",{className:"chat-body"},c.createElement("div",{className:"chat-main"},c.createElement(u,{text:this.state.formattedUser})))),c.createElement("div",{className:"menu menu-horizontal media-panel-tools"},c.createElement("div",{className:"menu-item"},c.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose})))),c.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},c.createElement("div",{className:"media"},c.createElement(d,{type:d.TYPES.SCALE_DOWN,size:this.state.size},c.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},c.createElement(s["default"],{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"})))))))}});e.exports=v},function(e,t,n){"use strict";var i=n(6),a=n(1311),s=n(1313),r=n(1335),o=n(1312),c=n(1377),l=n(428),u=n(8),d=n(1310),p=n(140),h=n(1314),f=n(1342),m=n(10),g=n(1327),v=n(83),y=n(14),E=i.createClass({displayName:"ProfileDrawer",mixins:[d,p,h],propTypes:{id:i.PropTypes.string.isRequired,onClose:i.PropTypes.func},getInitialState:function(){return this.asyncState({status:"id.Status.status",imgFull:"id.ProfilePicThumb.imgFull"},{pushname:Store.Conn.pushname,status:l10n.t("contact_status_loading"),pendingPushname:!1,pendingStatus:!1,pendingPhoto:!1})},componentWillMount:function(){var e=this;this.addObserver(Store.Conn,"change:pushname",function(){e.setState({pushname:Store.Conn.pushname})})},validateStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetStatusError:function(){u.openModal(i.createElement(l,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){var t=this;if(Store.Status.canSetMyStatus()){var n=Store.Status.get(this.props.id).status,i=g.emojify(this.state.status);if(i===n)return this.setState({status:i});this.setState({pendingStatus:!0}),Store.Status.setMyStatus(g.emojify(this.state.status)).checkpoint(this.rejectOnUnmount()).then(function(){t.setState({status:Store.Status.get(t.props.id).status,pendingStatus:!1})})["catch"](y.Unmount,_.noop)}},onBack:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},validatePushname:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetPushname:function(e){var t=this;if(Store.Conn.canSetMyPushname()){var n=Store.Conn.pushname,i=g.emojify(this.state.pushname);if(i===n)return this.setState({pushname:i});this.setState({pendingPushname:!0}),Store.Conn.updatePushname(g.emojify(this.state.pushname)).checkpoint(this.rejectOnUnmount()).then(function(){t.setState({pendingPushname:!1})})["catch"](y.Unmount,_.noop)}},onSetPushnameError:function(){u.openModal(i.createElement(l,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_pushname_empty")))},onPushnameChange:function(e){this.setState({pushname:e.target.value})},onCancelPushname:function(){this.setState({pushname:Store.Conn.pushname})},onImageSet:function(e,t){var n=this,i=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var a;a=e&&t?i.setPicture(e,t):i.deletePicture(),a.checkpoint(this.rejectOnUnmount()).then(function(){n.setState({pendingPhoto:!1})})["catch"](y.Unmount,_.noop)},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=e.canSet()||e.canDelete()?c.Type.PROFILE:c.Type.NO_EDIT,n=i.createElement(c,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet}),l=m.STATUS_V3?null:i.createElement(r,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1 well-input"},i.createElement(f,{value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:m.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus,supportsEmoji:!0,lockable:!0,lowProfile:!0})),u=l10n.t("menuitem_profile_status"),d=l10n.t("menuitem_profile");return i.createElement(a,{onCancel:this.onBack,id:"profile"},i.createElement(s,{a8n:"drawer-title-profile",title:m.STATUS_V3?d:u,onBack:this.onBack,type:s.Type.LARGE}),i.createElement(o,null,i.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},n),i.createElement(r,{a8n:"col-main-profile",title:l10n.t("pushname"),classes:"animate-enter1 well-input"},i.createElement(f,{value:this.state.pushname,editable:Store.Conn.canSetMyPushname(),pending:this.state.pendingPushname,showRemaining:!0,validate:this.validatePushname,maxLength:m.MAX_PUSHNAME_LENGTH,onChange:this.onPushnameChange,onSave:this.onSetPushname,onError:this.onSetPushnameError,onCancel:this.onCancelPushname,supportsEmoji:!0,lockable:!0,lowProfile:!0})),i.createElement("div",{className:"hint animate-enter1 well-transparent"},l10n.t("pushname_description")),l))}});E.contextTypes={uim:i.PropTypes.instanceOf(v)},e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return e.scrollTop+m.SCROLL_FUDGE>e.scrollHeight-e.clientHeight}var s=n(1307),r=i(s),o=n(1308),c=i(o),l=n(1391),u=i(l),d=n(103),p=i(d),h=n(6),f=n(38),m=n(10),g=n(8),v=n(1311),y=n(1321),E=n(1313),b=n(1312),M=n(140),C=n(1314),S=n(104),T=n(1384),w=n(1324),k=n(1460),P=n(142),N=n(14),O=n(139),D=n(1),x=n(82),R=n(141),A=n(1358),I=A.MenuBarItem,L=n(1319),U=n(437),F=n(1597),G=n(83),j=h.createClass({displayName:"StarredDrawer",mixins:[M,C,R],propTypes:{chat:h.PropTypes.instanceOf(c["default"]),starredMsgs:h.PropTypes.instanceOf(u["default"]),onClose:h.PropTypes.func},getInitialState:function(){return this.handleScroll=_.throttle(this._handleScroll,100),this.msgListInfo={visibleMsgs:{}},{cursor:new k(this.props.starredMsgs,(void 0),m.RENDOR_CURSOR.STARRED_DRAWER).loadAfter(m.MSG_PRELOAD_THRESHOLD)}},componentWillMount:function(){this.currSelection=new w([],function(e){return e.id.toString()}),this.activeSelection=new w([],function(e){return e.id.toString()})},componentDidMount:function(){var e=this;this.focus(),this.regNativeListener(window,"resize",this.updateMsgListInfo),!this.props.starredMsgs.isSynced&&this.props.starredMsgs.length<m.PAGE_SIZE&&this.uiIdle(this.loadEarlierMsgs),this.initObservers(),this.addObserver(this.props.starredMsgs,"reset",function(){e.setState(e.getInitialState()),e.loadEarlierMsgs()})},componentWillUnmount:function(){this._firstSyncComplete&&this._firstSyncComplete.cancel(),this.handleScroll.cancel()},componentDidUpdate:function(){this.updateMsgListInfo()},initObservers:function(){var e=this;this.addObserverAndRun(this.props.starredMsgs,"reset sync",function(){e.initSelectionObjects(),e.setState({})}),this.addObserver(this.props.starredMsgs,"add remove",this.handleStarChange),this.onFocusGain()},handleStarChange:function(e){this.initSelectionObjects(),this.setState({})},initSelectionObjects:function(){var e=this.props.starredMsgs.models;this.currSelection.init(e,!0),this.activeSelection.init(e)},loadEarlierMsgs:function(){var e=this,t=this.state.cursor,n=this.props.chat&&this.props.chat.id,i=this.props.starredMsgs.models;if(t.end<i.length)this.setState({cursor:t.loadAfter()});else{if(this.props.starredMsgs.isSynced)return;this.props.starredMsgs.sync(n).checkpoint(this.rejectOnUnmount()).then(function(){t.hasAfter()&&e.setState({cursor:t.loadAfter()})})["catch"](N.Unmount,_.noop)["catch"](function(e){D.log("StarredDrawer:loadEarlierMsgs failed")(),D.log(e)()})}},onClose:function(){
this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},focus:function(){x.focus(f.findDOMNode(this.refs.body))},onFocusGain:function(e){var t=e?e.target:document.activeElement;t===f.findDOMNode(this.refs.body)&&(this.currSelection.index<0?this.currSelection.setFirst():this.currSelection.reset(!1))},onNextMsg:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.currSelection.next();this.currSelection.index!==t&&this.currSelection.setNext()},onPrevMsg:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.currSelection.prev();t>-1&&this.currSelection.setPrev()},onScroll:function(e){this.handleScroll(e.target)},_handleScroll:function(e){this.updateMsgListInfo(),a(e)&&this.loadEarlierMsgs()},selectMsg:function(e){this.currSelection.setVal(e),this.activeSelection.setVal(e),g.openChatAt(e.chat,e.chat.getSearchContext(e)),g.focusShowMsg(e.id)},getMsgList:function(){var e=this.state.cursor,t=this.props.starredMsgs.models,n=this.props.starredMsgs.isSynced?e.end:Math.min(e.end,t.length);return t=t.slice(e.start,n),this.length=t.length,t},getMsgVisibility:function(e){if(!e)return m.VISIBILITY.BELOW;var t=f.findDOMNode(this.refs.scrollContainer),n=t.previousSibling.clientHeight,i=t.scrollTop+n,a=i+t.clientHeight,s=f.findDOMNode(e);return s?s.offsetTop+s.clientHeight<=i?m.VISIBILITY.ABOVE:s.offsetTop>=a?m.VISIBILITY.BELOW:m.VISIBILITY.VISIBLE:m.VISIBILITY.BELOW},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return!!this.msgListInfo.visibleMsgs[e.toString()]&&(!!t||this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs[e.toString()];if(t){var n=t.refs.wrapper;if(n)return n.refs.component&&n.refs.component.refs.msg}},updateMsgListInfo:_.throttle(function(){for(var e=this.getMsgList(),t={},n=0,i=this.length-1;n<i;){var a=Math.floor((n+i)/2),s=this.refs[e[a].id.toString()];this.getMsgVisibility(s)===m.VISIBILITY.ABOVE?n=a+1:i=a}for(var r=n;r<e.length;r++){var o=this.refs[e[r].id.toString()];if(this.getMsgVisibility(o)!==m.VISIBILITY.VISIBLE)break;t[e[r].id.toString()]=!0}this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,t),this.msgListInfo.visibleMsgs=t},100),pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var i=this.props.starredMsgs.get(n);if(i&&i.isGif){var a=this.getMsgComponent(n);a&&a.playCount&&a.pause()}}},render:function(){var e=this,t=this.getMsgList(),n=this.state.cursor,i=this.props.chat||null,a=void 0,s=void 0;if(s=this.props.starredMsgs.isSynced&&n.end>=t.length?null:this.props.starredMsgs.syncPromise?h.createElement("div",{className:"more"},h.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},h.createElement(P,{stroke:6,size:24}))):h.createElement("div",{className:"more"},h.createElement("div",{className:"btn-more",title:l10n.t("load_earlier_messages"),onClick:this.loadEarlierMsgs},h.createElement("span",{className:"icon icon-refresh"}))),t.length>0){var o=t.map(function(t){var n=t.type===r["default"].TYPE.IMAGE||t.type===r["default"].TYPE.VIDEO||t.type===r["default"].TYPE.AUDIO;return h.createElement(T,{key:t.id,ref:t.id.toString(),msg:t,isMsgVisible:n?e.isMsgVisible:_.noop,currSelection:e.currSelection,activeSelection:e.activeSelection,onClickMsg:e.selectMsg})});a=h.createElement(S,{transitionName:"slide"},o)}else this.props.starredMsgs.isSynced?a=h.createElement(y.StarredMsgs,null):(a=h.createElement(y.Loading,null),s=null);var c={down:this.onNextMsg,up:this.onPrevMsg},l=t.length||this.props.starredMsgs.isSynced,u=O.supportsFeature(O.F.UNSTAR_ALL)?h.createElement(I,{a8n:"starred-menu",icon:"menu-white",title:l10n.t("menutitle_menu"),disabled:!l},h.createElement(B,{chat:i,msgs:t})):null;return h.createElement(v,{id:"starred",onCancel:this.onClose},h.createElement(p["default"],{className:"drawer",handlers:c,onFocus:this.onFocusGain,"data-tab":2,ref:"body"},h.createElement(E,{title:l10n.t("starred_flow_title"),onBack:this.onClose,type:E.Type.LARGE,menu:u}),h.createElement(b,{onScroll:this.onScroll,ref:"scrollContainer"},a,s)))}});j.contextTypes={uim:h.PropTypes.instanceOf(G)},e.exports=j;var B=h.createClass({displayName:"StarredHeaderDropdown",propTypes:{chat:h.PropTypes.instanceOf(c["default"]),msgs:h.PropTypes.array},sendUnstarAll:function(){g.openModal(h.createElement(F,{msgs:this.props.msgs,chat:this.props.chat}))},render:function(){return h.createElement(U,{type:U.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"StarredDrawerHeader",direction:{x:U.Direction.X.LEFT}},h.createElement(L,{a8n:"mi-unstar-all menu-item",action:this.sendUnstarAll},l10n.t("unstar_all")))}})},function(e,t,n){"use strict";function i(e){var t=document.createElement("a");t.href=e,t.target="_blank",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function a(e){return e.join(" ")}var s=n(6),r=n(8),o=n(26),c=n(1331),l=n(1362),u=n(1429),d=n(1340),p=s.createClass({displayName:"VCardModalDetails",propTypes:{className:s.PropTypes.string,parsedVCard:s.PropTypes.object.isRequired,thumbnail:s.PropTypes.string},defaultProps:{className:""},openChat:function(e){r.closeModal(),Store.Chat.find(o.numberToWid(e)).then(function(e){r.openChatFromUnread(e).then(function(t){t&&r.focusChatTextInput(e)})})},sendEmail:function(e){var t="mailto:"+e;i(t)},openLocation:function(e){var t=_.map(_.filter(e),encodeURIComponent).join(", "),n="https://maps.google.com/maps/search/"+t+"?hl="+l10n.getLocale();i(n)},getHeader:function(){var e=this.props.parsedVCard,t=c.vcardWAids(this.props.parsedVCard),n=null;if(_.first(e.FN))n=_.first(e.FN).value;else if(_.first(e.NICKNAME))n=_.first(e.NICKNAME).value;else if(_.first(e.TEL)){var i=_.first(e.TEL),a=_.first(i.properties.waid);n=a?o.formattedUser(a):i.value}var r=c.getOrganizationString(e),u=s.createElement("div",{className:"chat-avatar"},s.createElement(l,{thumb:this.props.thumbnail,waid:c.thumbnailWAid(t)}));return s.createElement("div",{className:"chatlist chatlist-plain"},s.createElement(d,{id:t[0],contextEnabled:function(){return!1},image:u,primary:n,secondary:r}))},render:function(){var e=this,t=this.props.parsedVCard,n=_.filter(t.TEL,function(e){return e.properties.waid}),i=_.filter(t.TEL,function(e){return!e.properties.waid}),r=_.map(n,function(t){var n=_.first(t.properties.waid),i=function(){return e.openChat(n)},a=s.createElement("span",{onClick:i,className:"icon icon-chat clickable"}),r=s.createElement("span",{className:"selectable-text"},o.formattedUser(n));return s.createElement(u,{title:r,icon:a,key:"vCard-"+t.index},c.getType(t))}),l=_.map(t.EMAIL,function(t){return s.createElement(u,{title:t.value,onClick:function(){return e.sendEmail(t.value)},key:"vCard-"+t.index},c.getType(t))}),d=_.map(t.ADR,function(t){var n=a(t.value);return s.createElement(u,{title:n,onClick:function(){return e.openLocation(t.value)},key:"vCard-"+t.index},c.getType(t))}),p=_.map(i,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},c.getType(e))}),h=_.map(t.SERVICE,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},c.getType(e))}),f=_.map(t.BDAY,function(e){return s.createElement(u,{title:c.getDate(e.value),key:"vCard-"+e.index},l10n.t("vcard_birthday"))}),m=_.map(t.NICKNAME,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l10n.t("vcard_nickname"))}),g=this.getHeader();return s.createElement("div",{className:this.props.className},s.createElement("div",null,g,s.createElement("div",{className:"drawer-item-container-compact"},r,l,d,p,f,m,h)))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(145),o=i(r),c=n(436),l=n(1353).prepRawMedia,u=n(1626),d=n(14),p={READY:"ready",PROCESSING:"processing",ERROR:"error"},h=(0,r.defineState)("AttachMedia",{props:{id:"number",file:"object",uiProcessed:"boolean"},session:{state:{type:"string",values:_.values(p)},media:"object",mediaPrep:"object",url:"string",name:"string",preview:"string",processPromise:"object",exception:"object",chat:"object",caption:"string",original:"object",generatedPreview:"object"},initialize:function(){o["default"].prototype.initialize.call(this),this.processFile(this.file)},processFile:function(e){var t=this;return this.state=p.PROCESSING,this.processPromise=s["default"].resolve(e).then(function(e){var n=void 0;n=e.isGifHackDoNotUse?{asGif:!0,gifAttribution:e.gifAttributionHackDoNotUse}:{};var i=l(e,n);return i.waitForPrep().then(function(e){return u.enrich(e)}).then(function(e){var n=e.media,a=e.documentPreview;t.set({media:n,mediaPrep:i,url:window.URL.createObjectURL(n.mediaBlob),name:n.filename,preview:n.preview,state:p.READY,generatedPreview:a})})})["catch"](d.MediaFileTooLarge,d.InvalidMediaFileType,d.MediaFileFailedLoad,function(e){return t.set({exception:e,state:p.ERROR}),t})["catch"](function(e){return t.set({exception:new d.InvalidMediaFileType,state:p.ERROR}),t})},getFileType:function(){return c.typeFromMimetype(this.file.type)},editImage:function(e){return this.getFileType()!==c.FILETYPE.IMAGE?null:(window.URL.revokeObjectURL(this.url),e.original=this.original||new f(this.toJSON()),this.set(e),void this.initialize())},revertImage:function(){if(this.getFileType()!==c.FILETYPE.IMAGE)return null;if(!this.original)return this;window.URL.revokeObjectURL(this.url);var e=this.original.toJSON();return e.original=null,this.set(e),this.initialize(),this}}),f=h.AttachMedia;f.STATE=p,e.exports=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistProxy=t["default"]=void 0;var i=n(145),a=(0,i.defineState)("Blocklist",{Collection:"Blocklist",session:{contact:"object"},props:{id:"string"},initialize:function(){this.addChild("contact",Store.Contact.gadd(this.id))}}),s=a.Blocklist,r=a.BlocklistProxy;t["default"]=s,t.BlocklistProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CallProxy=t["default"]=void 0;var a=n(145),s=i(a),r=n(1),o=n(8),c=(0,a.defineState)("Call",{Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){s["default"].prototype.initialize.call(this),this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){r.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type||"offer_video"===this.type?o.alertCall(this.id,this.from,"offer_video"===this.type):o.cancelCall(this.id)}}),l=c.state,u=c.proxy;t["default"]=l,t.CallProxy=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(429),l=n(10),u=n(14),d=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this),this.hasDocBefore=!0},"delete":function(){c.prototype["delete"].call(this),this.stopListening(),this.reset()},queryDocs:function(e,t){var n=this;if(t)return this.queryDocBefore?this.queryDocBefore:(this.queryDocBefore=Store.Msg.queryMedia(t.id.remote,l.MEDIA_QUERY_LIMIT,"before",t.id,"document").then(function(e){return(!e||e.length<l.MEDIA_QUERY_LIMIT)&&(n.hasDocBefore=!1),n.add(e.filter(function(e){return e.isDoc}),{at:0}),{length:e.length}})["catch"](u.WapDrop,u.E404,_.noop)["finally"](function(){n.queryDocBefore=null,n.trigger("query_doc_before")}),this.trigger("query_doc_before"),this.queryDocBefore);var i=e.msgs.models;if(0===this.length){if(!i||0===i.length)return new s["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.isDoc}),{at:0})}if(this.length<=2*l.MEDIA_QUERY_LIMIT){var a=0===this.length?_.head(i):this.head();return this.queryDocs(e,a)}return new s["default"](function(e){e({eof:!1})})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(429),l=n(10),u=n(14),d=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this),this.hasLinkBefore=!0},"delete":function(){c.prototype["delete"].call(this),this.stopListening(),this.reset()},queryLinks:function(e,t){var n=this;if(t)return this.queryLinkBefore?this.queryLinkBefore:(this.queryLinkBefore=Store.Msg.queryMedia(t.id.remote,l.MEDIA_QUERY_LIMIT,"before",t.id,"url").then(function(e){return(!e||e.length<l.MEDIA_QUERY_LIMIT)&&(n.hasLinkBefore=!1),n.add(e.filter(function(e){return e.isLink}),{at:0}),{length:e.length}})["catch"](u.WapDrop,u.E404,_.noop)["finally"](function(){n.queryLinkBefore=null,n.trigger("query_link_before")}),this.trigger("query_link_before"),this.queryLinkBefore);var i=e.msgs.models;if(0===this.length){if(!i||0===i.length)return new s["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.isLink}),{at:0})}if(this.length<=2*l.MEDIA_QUERY_LIMIT){var a=0===this.length?_.head(i):this.head();return this.queryLinks(e,a)}return new s["default"](function(e){e({eof:!1})})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(429),l=n(10),u=n(14),d={before:"before",after:"after"},p=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this),this.hasMediaBefore=!0,this.hasMediaAfter=!0},"delete":function(){c.prototype["delete"].call(this),this.stopListening()},contains:function(e){return this.models.indexOf(e)>-1},getAfter:function(e){var t=this.models.indexOf(e);return t<0||t===this.models.length-1?null:this.models[t+1]},getBefore:function(e){var t=this.models.indexOf(e);return t<=0?null:this.models[t-1]},loadEarlierMedias:function(){var e=this.head();e&&this.queryMedia(null,e)},loadRecentMedias:function(){var e=this.last();e&&this.queryMedia(null,e,d.after)},loadMoreAroundIfNeeded:function(e){if(e){var t=this.models.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.models.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}},queryMedia:function(e,t){var n=this,i=arguments.length<=2||void 0===arguments[2]?d.before:arguments[2];if(!t){var a=e.msgs.models;if(!a||0===a.length)return new s["default"](function(e){e({eof:!0})});this.add(a.filter(function(e){return e.isMedia}),{at:0});var r=this.models;if(this.downloadMedias(r),r.length<=2*l.MEDIA_QUERY_LIMIT){var o=0===r.length?_.head(a):_.head(r);return this.queryMedia(e,o)}return new s["default"](function(e){e({eof:!1})})}return i===d.before?this.queryMediaBefore?this.queryMediaBefore:(this.queryMediaBefore=Store.Msg.queryMedia(t.id.remote,l.MEDIA_QUERY_LIMIT,i,t.id).then(function(e){var t=e.messages;(!t||t.length<l.MEDIA_QUERY_LIMIT)&&(n.hasMediaBefore=!1);var i=[];return t&&t.length>0&&(i=t.filter(function(e){return e.isMedia}),n.downloadMedias(i)),n.add(i,{at:0}),{length:i.length}})["catch"](u.WapDrop,u.E404,_.noop)["finally"](function(){n.queryMediaBefore=null,n.trigger("query_media_before")}),this.trigger("query_media_before"),this.queryMediaBefore):i===d.after?this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=Store.Msg.queryMedia(t.id.remote,l.MEDIA_QUERY_LIMIT,i,t.id).then(function(e){var t=e.messages;(!t||t.length<l.MEDIA_QUERY_LIMIT)&&(n.hasMediaAfter=!1);var i=[];return t&&t.length>0&&(i=t.filter(function(e){return e.isMedia}),n.downloadMedias(i)),n.add(i),{length:i.length}})["catch"](u.WapDrop,u.E404,_.noop)["finally"](function(){n.queryMediaAfter=null,n.trigger("query_media_after")}):void 0},downloadMedias:function(e){_.forEach(e,function(e){e.downloadMedia()})}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(145),s=i(a),r=n(1347),o=n(1),c=(0,a.defineState)("ChatMsgs",{props:{pendingMsgs:"boolean"},session:{msgChunks:{type:"array","default":function(){return[]}},lastReceivedKey:"object",unreadMsgAnchor:"object",disableUnreadAnchor:"boolean",msgsLength:"number",msgsChanged:{type:"number","default":0}},collections:{msgs:r},initialize:function(){var e=this;s["default"].prototype.initialize.call(this),_.isFunction(this.onEmptyMRM)||o.error("states that extend ChatMsgs need to define onEmptyMRM()")(),this.listenTo(this.msgs,"change:last",function(){e.msgsChanged++}),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgsChanged++,e.msgsLength=e.msgs.length})},"delete":function(e){s["default"].prototype["delete"].call(this),this.getAllCMCs().forEach(function(e){e["delete"]()})},removeMsg:function(e){var t=e.msgChunk;if(t){var n=t.indexOf(e);n<0||(o.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))},replaceMsgsCollection:function(e){o.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},notifyMsgCollectionMerge:function(e,t,n){this.trigger("change:cmc:merge",e,t,n)}}),l=c.ChatMsgs;e.exports=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPreferenceProxy=t["default"]=void 0;var i=n(145),a=(0,i.defineState)("ChatPreference",{Collection:"ChatPreference",props:{id:"string",wallpaperColor:"string"}}),s=a.ChatPreference,r=a.ChatPreferenceProxy;t["default"]=s,t.ChatPreferenceProxy=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiVariantProxy=t["default"]=void 0;var i=n(145),a=(0,i.defineState)("EmojiVariant",{idAttribute:"char",props:{"char":"string",variant:"string"}}),s=a.EmojiVariant,r=a.EmojiVariantProxy;t["default"]=s,t.EmojiVariantProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(429),l=n(14),u=n(139),d=100,p=c.extend({model:o["default"],initialize:function(){var e=this;c.prototype.initialize.call(this),this.hasMoreMsgs=!0,this.resultPage=0,this.listenTo(Store.Msg,"remove",function(t){e.remove(t)})},"delete":function(e){e&&this.stopListening(),c.prototype["delete"].call(this)},resetSearch:function(e){this.hasMoreMsgs=!0,this.resultPage=0,this.searchTerm=e,this.searchPromise&&this.searchPromise.cancel()},search:function(e,t){var n=this;if(this.searchTerm!==e&&(this.searchTerm&&0===e.indexOf(this.searchTerm)||(this.searchTerm=e,this["delete"]()),this.resultPage=0,this.hasMoreMsgs=!0),this.searchPromise){if(this.searchTerm===e)return this.searchPromise;this.searchPromise.cancel()}var i=void 0;return i=t?t.fts(e,++this.resultPage,d):Store.Msg.search(e,++this.resultPage,d),this.searchPromise=i.cancellable().then(function(t){u.supportsFeature(u.F.FTS_PAGINATION)&&!t.eof||(n.hasMoreMsgs=!1),n.searchTerm!==e&&n["delete"](),n.searchTerm=e,n.add(t.messages)})["catch"](l.WapDrop,s["default"].CancellationError,_.noop)["finally"](function(){n.searchPromise=null,n.trigger("search_more")}),this.trigger("search_more"),this.searchPromise}});e.exports=p},function(e,t,n){"use strict";var i=n(39),a={dataTypes:{msgKey:{set:function(e){if(e instanceof i)return{val:e,type:"msgKey"}},compare:function(e,t,n){return e instanceof i&&e.equals(t)}}}};e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoProxy=t["default"]=void 0;var a=n(145),s=i(a),r=n(218),o=i(r),c=n(1445),l=n(439),u=n(441),d=(0,a.defineState)("Participant",{props:{id:"string",t:"number"},session:{contact:"object"},initialize:function(){s["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},getCollection:function(){return this.collection}}),p=d.Participant,h=l.extend(u,{model:p,comparator:function(e,t){return o["default"].Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),f=(0,a.defineState)("MsgInfo",{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:h,read:h,delivery:h},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}},c),m=f.MsgInfo,g=f.MsgInfoProxy;t["default"]=m,t.MsgInfoProxy=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiProxy=t["default"]=void 0;var i=n(145),a=(0,i.defineState)("RecentEmoji",{idAttribute:"char",props:{"char":"string",weight:"number"}}),s=a.RecentEmoji,r=a.RecentEmojiProxy;t["default"]=s,t.RecentEmojiProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(1308),o=i(r),c=n(6),l=n(8),u=n(428),d=n(1309),p=n(1349),h=n(1320),f=n(1385),m=n(139),g=n(140),v=n(85),y=c.createClass({displayName:"MultiselectBar",mixins:[g],propTypes:{chat:c.PropTypes.instanceOf(o["default"]).isRequired,selectedMessages:c.PropTypes.instanceOf(h).isRequired,onCancel:c.PropTypes.func.isRequired,noSortOnForward:c.PropTypes.bool},componentWillMount:function(){var e=this;_.forEach(this.props.selectedMessages.getSelected(),function(t){e.addObserver(t,"change:star")}),this.addObserver(this.props.selectedMessages,"all"),this.addObserver(Store.Msg,"change:star",this.onStarChanged)},onStarChanged:function(e){this.props.selectedMessages.isSelected(e)&&this.setState({})},onStarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages.getSelected(),!0),this.props.onCancel()},onUnstarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages.getSelected(),!1),this.props.onCancel()},onDownloadSelected:function(){var e=_.filter(this.props.selectedMessages.getSelected(),function(e){return e.mediaData&&e.mediaData.renderableUrl});e.length&&(p.initDownload(e),this.props.onCancel())},onDeleteSelected:function(){var e=this,t=this.props.selectedMessages.getSelected(),n=function(){l.closeModal(),e.props.chat.sendDeleteMsgs(t),e.props.onCancel()},i=_.size(t),a=l10n.t("delete_message_confirmation",{count:i,_plural:i});l.openModal(c.createElement(u,{onOK:n,okText:l10n.t("web_delete"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},c.createElement(d,{text:a})))},onForwardSelected:function(){var e=this,t=this.props.selectedMessages.getSelected();this.props.noSortOnForward||(t=this.props.chat.sortMsgs(t));var n=_.size(t),i=function(){e.props.onCancel()},a=_.filter(t,function(e){return e.canForward()});if(_.size(a))if(n!==_.size(a)){var s=function(){l.openModal(c.createElement(f,{msgs:a,onForward:i}),"modal-flow")};l.openModal(c.createElement(u,{title:l10n.t("confirm_forward_partial_messages_title"),onOK:s,okText:l10n.t("forward"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else l.openModal(c.createElement(f,{msgs:t,onForward:i}),"modal-flow");else l.openModal(c.createElement(u,{title:l10n.t("err_unsent_forward_title"),onOK:l.closeModal.bind(l),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{count:n,_plural:n})))},render:function(){var e=this.props.selectedMessages.getSelected(),t=_.size(e),n=m.supportsFeature(m.F.ENC_DOC)||_.every(e,function(e){return e.type!==s["default"].TYPE.DOCUMENT}),i=_.some(e,function(e){return e.canForward()}),a=_.some(e,function(e){return e.mediaData&&e.mediaData.renderableUrl}),r=c.createElement("button",{className:"btn-icon btn-forward",disabled:t&&n&&i?null:"disabled",title:l10n.t("forward_message",{count:t,_plural:t}),onClick:this.onForwardSelected},c.createElement("span",{className:"icon icon-forward"})),o=void 0;m.supportsFeature(m.F.MESSAGE_DELETE)&&(o=c.createElement("button",{className:"btn-icon btn-delete",disabled:t?null:"disabled",title:l10n.t("delete_message",{count:t,_plural:t}),onClick:this.onDeleteSelected},c.createElement("span",{className:"icon icon-delete"})));var l=void 0;if(m.supportsFeature(m.F.STARRED)){var u=void 0,d=void 0,p=void 0;t&&_.every(e,"star")?(u=this.onUnstarSelected,d=c.createElement("span",{className:"icon icon-unstar-btn"}),p=l10n.t("unstar_message",{count:t,_plural:t})):(u=this.onStarSelected,d=c.createElement("span",{className:"icon icon-star-btn"}),p=l10n.t("star_message",{count:t,_plural:t})),l=c.createElement("button",{className:"btn-icon btn-star",disabled:t?null:"disabled",title:p,onClick:u},d)}var h=v.isSafari?null:c.createElement("button",{className:"btn-icon",disabled:t&&a?null:"disabled",title:l10n.t("web_button_download"),onClick:this.onDownloadSelected},c.createElement("span",{className:"icon icon-download"}));return c.createElement("div",{className:"multi-controls"},c.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},c.createElement("span",{className:"icon icon-x"})),c.createElement("span",{className:"multi-count"},l10n.t("selected_count",{count:t,_plural:t})),l,o,r,h)}});e.exports=y},function(e,t){"use strict";var n=window.matchMedia("\nonly screen and (max-width: 1024px)\n"),i={column:n.matches?2:3},a=function(e){var t=e.matches?2:3;if(i.column!==t){i.column=t;var n=document.createEvent("Event");n.initEvent("columnChange",!0,!0),window.dispatchEvent(n)}};n.addListener(a),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return e.sign(t).then(function(e){return new Uint8Array(e,0,b)})}function s(e,t){for(var n=t.length-_,i=Math.ceil(n/M),s=[],r=0;r<i;r++){var o=r*M,c=Math.min(o+M+_,t.length),l=t.subarray(o,c);s.push(a(e,l))}return u["default"].reduce(s,function(e,t){return e.writeByteArray(t),e},new g).then(function(e){return e.readBuffer()})}function r(e,t,n,i){var a=void 0;return u["default"].resolve().then(function(){if(!e)throw new h.MediaEncryptionError('decrypt async, missing "type"');if(!t)throw new h.MediaEncryptionError('decrypt async, missing "payload"');if(!n)throw new h.MediaEncryptionError('decrypt async, missing "mediaKey"');if(a=new v.WebcCryptoMedia({webcCryptoType:v.WEBC_CRYPTO_TYPE_CODE.DECRYPT,webcCryptoLibrary:v.WEBC_CRYPTO_LIBRARY_CODE.WEBCRYPTO,webcCryptoFileSize:t.byteLength}),t.byteLength<10)throw new h.MediaEncryptionError("ciphertext too short: "+t.byteLength);var s=c(e,n),r=s.iv,o=s.cipherKey,l=s.macKey,u=t.byteLength-10,d=m.encode(new Uint8Array(t,u)),f=new Uint8Array(t,0,u),E=g.build(r,f).readByteArray();return new p.HmacSha256(l).sign(E).then(function(e){var t=m.encode(new Uint8Array(e,0,10));if(!t||!d||t!==d)throw new h.MediaEncryptionError("hmac fail computed: "+t+" given: "+d)}).then(function(){return(0,p.aesCbcDecrypt)(o,E)}).then(function(t){return new Blob([t],{type:y.getMediaMimeType(e,t,i)})})}).tap(function(){a.markWebcCryptoElapsedT(),a.commit()})["catch"](function(e){return!(e instanceof h.MediaEncryptionError)},function(e){throw new h.MediaEncryptionError("encryption error: "+e+"; stack: "+e.stack)})}function o(e,t,n){var i=void 0;return u["default"].resolve().then(function(){if(!e)throw new h.MediaEncryptionError('encrypt async, missing "type"');if(!t)throw new h.MediaEncryptionError('encrypt async, missing "plaintext"');if(!n)throw new h.MediaEncryptionError('encrypt async, missing "mediaKey"');i=new v.WebcCryptoMedia({webcCryptoType:v.WEBC_CRYPTO_TYPE_CODE.ENCRYPT,webcCryptoLibrary:v.WEBC_CRYPTO_LIBRARY_CODE.WEBCRYPTO});var r=c(e,n),o=r.iv,l=r.cipherKey,f=r.macKey;return(0,p.aesCbcEncrypt)(l,new Uint8Array(t),o).then(function(t){var n=t.subarray(o.length),i=new p.HmacSha256(f),r=a(i,t),c=r.then(function(e){return new Blob([n,e])}),l=null;return e!==d.TYPE.VIDEO&&e!==d.TYPE.AUDIO||(l=r.then(function(e){var n=g.build(t,e);return s(i,n.readByteArray())})),u["default"].props({ciphertext:c,sidecar:l})})}).tap(function(e){var t=e.ciphertext;i.webcCryptoFileSize=t.size,i.markWebcCryptoElapsedT(),i.commit()})["catch"](function(e){return!(e instanceof h.MediaEncryptionError)},function(e){throw new h.MediaEncryptionError("encryption error: "+e+"; stack: "+e.stack)})}function c(e,t){var n=E[e];if(!t||!n)throw new h.MediaEncryptionError("computeKeys fail: !!mediakey: "+!!t+" info: "+n+" type: "+e);var i=f.extractAndExpand(m.decode(t),void 0,n,112);if(!i||i.byteLength<112)throw new h.MediaEncryptionError("computeKeys:hkdf error");return{iv:new Uint8Array(i,0,16),cipherKey:new Uint8Array(i,16,32),macKey:new Uint8Array(i,48,32),refKey:new Uint8Array(i,80,32)}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(2),u=i(l);t.decryptE2EMedia=r,t.encryptE2EMedia=o,t.computeKeys=c;var d=n(1365),p=n(453),h=n(14),f=n(451),m=n(33),g=n(13),v=n(52),y=n(434),E={IMAGE:"WhatsApp Image Keys",VIDEO:"WhatsApp Video Keys",AUDIO:"WhatsApp Audio Keys",DOCUMENT:"WhatsApp Document Keys"},_=16,b=10,M=65536},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1330),o=n(14),c={getFiles:function(e,t){var n=e.target.files||e.dataTransfer.files;if(n=_.map(n,function(e,t){return e}),n.length)return s["default"].resolve(n);if(e.dataTransfer.getData("text/uri-list"))return r.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e){return[e]});if(e.dataTransfer.getData("text/html")){var i=new DOMParser,a=i.parseFromString(e.dataTransfer.getData("text/html"),"text/html");if(a.createNodeIterator(a.childNodes[0],NodeFilter.SHOW_TEXT).nextNode()){if(e.dataTransfer.getData("text/plain")&&!t)return s["default"].reject(new o.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))}else{var c=a.getElementsByTagName("img");if(c.length)return r.urlToFile(c[0].src).then(function(e){return[e]})}}return s["default"].resolve(n)}};e.exports=c},function(e,t,n){"use strict";function i(e){return CryptoJS.lib.WordArray.create(e)}var a=n(1450),s=n(13),r=n(14),o=n(33),c=n(1),l=n(1461),u=n(26),d={ackE2EMedia:function(e,t,n){if(t&&n&&e){var r=u.userToLegacy(Store.Conn.me),d=s.build(r).readBuffer(),p=CryptoJS.lib.WordArray.create(d),h=i((0,a.computeKeys)(e,t).refKey),f=CryptoJS.HmacSHA256(p,h);f.sigBytes=20,f.clamp();var m=o.urlSafe(f.toString(CryptoJS.enc.Base64)),g=n+"?ack="+m;return c.log("crypto:ack:"+g)(),l.postRetry(g)}},computeRefs:function(e,t){if(!e||!t||t.filter(function(e){return!u.isUser}).length>0)throw new r.MediaEncryptionError("computeRefs error: "+!!e+","+(t&&t.join()));var n=i(e);return t.map(function(e){var t=CryptoJS.HmacSHA256(CryptoJS.enc.Utf8.parse(u.userToLegacy(e)),n);return t.sigBytes=20,t.clamp(),o.urlSafe(t.toString(CryptoJS.enc.Base64))})},newB64MediaKey:function(){var e=new Uint8Array(32);return window.crypto.getRandomValues(e),o.encode(e)}};e.exports=d},function(e,t){"use strict";var n={boundHeightWidth:function(e,t,n,i){return t=t||i,e=e||n,t>e?t>i&&(e*=i/t,t=i):e>n&&(t*=n/e,e=n),{width:Math.max(t,1),height:Math.max(e,1)}}};e.exports=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return l.hasOwnProperty(e)?l[e]:l[e]=r["default"].props({url:e,data:c["default"].queryLinkPreview(e)})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),r=i(s);t["default"]=a;var o=n(66),c=i(o),l={}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=void 0;return new u["default"](function(i,a){n=new Image,t&&0!==e.indexOf("data:")&&n.setAttribute("crossOrigin","anonymous"),n.onload=i,n.onabort=function(){a(new Error("loadImage onabort"))},n.onerror=function(){a(new Error("loadImage onerror"))},n.src=e})["return"](n)}function s(e){return a(e).then(function(t){return t.naturalWidth>0?{img:t,fullWidth:t.naturalWidth,fullHeight:t.naturalHeight}:u["default"].reject(new d.MediaLoadError("image loaded with zero width",e))})["catch"](function(){return u["default"].reject(new d.MediaLoadError("unable to render image",e))})}function r(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=new g.WebcMediaLoad,i=void 0,a=void 0,s=++b,r=new u["default"](function(n,r){m.log("MediaLoad:video called (#"+s+") for "+e.name)(),
i=document.createElement("video"),i.volume=0,i.autoplay=!0,i.onloadedmetadata=function(){m.log("MediaLoad:video.onloadedmetadata #"+s)()},t?(i.onloadeddata=function(){m.log("MediaLoad:video.onloadeddata #"+s)()},i.onprogress=function(){m.log("MediaLoad:video.onprogress #"+s)()}):(i.onloadeddata=n,i.onprogress=n),i.onplay=n,i.onerror=function(){m.error("MediaLoad:video.onerror #"+s)(),r(new d.MediaLoadError("unable to play video",a))},i.src=a=window.URL.createObjectURL(e),i.load()});return setTimeout(function(){r.isPending()&&(m.error("unable to load video #"+s+" ("+e.size+" bytes)")(),0===_&&(M=e),3===++_&&(m.assert(!1,"dead-video","had "+_+" silent videos")(),f(M)),new g.WebcMediaLoad({webcMediaLoadResult:g.WEBC_MEDIA_LOAD_RESULT_CODE.SILENCE}).commit())},8e3),r.delay(10).then(function(){if(n.markWebcMediaLoadT(),m.log("MediaLoad:video #"+s+" successful")(),i.pause(),i.videoWidth>0)return n.webcMediaLoadResult=g.WEBC_MEDIA_LOAD_RESULT_CODE.SUCCESS,n.commit(),{video:i,fullWidth:i.videoWidth,fullHeight:i.videoHeight};throw i.duration>0?new d.MediaUnsupportedError("video loaded with duration but no dims"):(n.webcMediaLoadResult=g.WEBC_MEDIA_LOAD_RESULT_CODE.ZEROWIDTH,n.commit(),new d.MediaLoadError("video loaded with zero width",a))})["finally"](function(){i&&(i.onloadedmetadata=null,i.onloadeddata=null,i.onplay=null,i.onerror=null),a&&window.URL.revokeObjectURL(a)})}function o(e){var t=void 0;return new u["default"](function(n,i){t=document.createElement("audio"),t.volume=0,t.autoplay=!0,t.onplay=function(e){t.pause(),n({audio:t})},t.onerror=function(){i(new d.MediaLoadError("unable to play audio",e))},t.src=e})["finally"](function(){t&&(t.onplay=t.onerror=null)})}function c(e,t){var n=t.indexOf(p.MIMETYPE_OGG)>-1;if(n&&!E){if(e.size<=y){var i=new v(e);return i.generateBlob()}throw new d.MediaLoadError("media-load:transcode blob too large",e.size)}return u["default"].resolve(e)}var l=n(2),u=i(l),d=n(14),p=n(10),h=n(1425),f=h.reportFossil,m=n(1),g=n(52),v=n(1636),y=3e5,E=(new Audio).canPlayType("audio/ogg"),_=0,b=0,M=null;e.exports={loadImage:a,image:s,video:r,audio:o,transcode:c}},function(e,t){"use strict";var n={getNameString:function(e){var t=_.find(e,function(e){return!!e.displayName});if(0===e.length)return l10n.t("multi_vcard_display_text_none");if(!t)return l10n.t("multi_vcard_number_of_contacts",{count:e.length,_plural:e.length});var n=t.displayName;return 1===e.length?n:l10n.t("multi_vcard_display_text",{contactName:n,count:e.length-1,_plural:e.length-1})}};e.exports=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(433),m=n(1339),g=n(1338),v=g.matchAll,y=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return v(f.emojiRegex(),e)}},{key:"alwaysApply",get:function(){return!0}}]),t}(m);e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1339),m=n(1338),g=m.matchAll,v=n(31),y=function(e){function t(e){var n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];(0,o["default"])(this,t);var i=(0,d["default"])(this,(0,s["default"])(t).call(this)),a=e.map(v.escapeRegExp),r=n?"(?:^|\\b)":"";return i._regex=new RegExp(r+"("+a.join("|")+")","ig"),i}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return g(this._regex,e)}}]),t}(f);e.exports=y},function(e,t){"use strict";var n=0,i=1,a=2,s=function(e,t){for(var n=[],i=0;i<t.length;++i){var a=t[i],s=a.match(e);if(s&&s.length){for(var r=a.group,o=0;o<s.length;++o){var c=s[o],l=c[0],u=c.index;if(c.idx=i,c.end=u+l.length-1,r){var d=c[r];c.gindex=u+l.indexOf(d),c.gend=c.gindex+d.length-1}else c.gindex=u,c.gend=c.end}n.push(s)}}if(!n.length)return n;if(1===n.length)return n[0].reverse();for(var p=[],h=0;h<n.length;++h)p[h]=n[h].length-1;for(var f=[],m=0;n.length>1;){for(var g=0,v=-1;g<n.length;++g)n[g][p[g]].index>v&&(m=g,v=n[g][p[g]].index);f.push(n[m][p[m]]),--p[m]<0&&(n.splice(m,1),p.splice(m,1))}return f.push.apply(f,n[0].slice(0,p[0]+1).reverse()),f},r=function(e,t){if(1===e.length)return e;for(var n=[],i=void 0;i=e.pop();){var a=e.length;if(!a&&n.push(i))break;for(var s=i,r=s.end,o=s.gend,c=s.idx,l=t[c],u=l.alwaysApply,d=l.formatResult,p=l.mutates,h=!0,f=a-1;f>=0;--f){var m=e[f];if(m.index>r)break;if(m.end>o){if(c<m.idx&&e.splice(f,1))continue;h=!1;break}if(!p||!e.splice(f,1)){var g=t[m.idx];if(!u&&!g.formatResult){h=!1;break}d||g.alwaysApply||!e.splice(f,1)}}h&&n.push(i)}return n},o=function(e,t){for(var s=e[0].input,r={children:[]},o=0,l=r,u=void 0,d=0;d<e.length;++d){for(var p=e[d],h=p.index,f=p.gindex;l.parent&&h>(u=l.match.gend);){if(o<=u&&l.children.push({type:n,value:s.substring(o,u+1)}),o=l.match.end+1,l.mutator.isFragment){var m=l.parent.children;m.pop(),m.push.apply(m,l.children)}l.mutator.isFormatter&&u!==l.match.end&&l.parent.children.push({type:i,value:s.substring(u+1,o)}),l=l.parent}o<h&&l.children.push({type:n,value:s.substring(o,h)});var g=t[p.idx],v=g.mutates,y=g.isFormatter;o=f,y&&h!==f&&l.children.push({type:i,value:s.substring(h,f)});var E={children:[],match:p,mutator:g,parent:l,type:a};if(v){var _=p[g.group],b=g.mutate(_,p);if(_!==b){var M=c(b,t);E.children=M.children,o=p.gend+1}}l.children.push(E),l=E}do{var C=l.match,S=C.end,T=C.gend;if(o<=T&&l.children.push({type:n,value:s.substring(o,T+1)}),o=S+1,l.mutator.isFragment){var w=l.parent.children;w.pop(),w.push.apply(w,l.children)}l.mutator.isFormatter&&T!==S&&l.parent.children.push({type:i,value:s.substring(T+1,o)})}while((l=l.parent)&&l.parent);return o!==s.length&&l.children.push({type:n,value:s.substring(o)}),r},c=function(e,t){var i=s(e,t);return i.length?o(r(i,t),t):{children:[{type:n,value:e}]}},l=function u(e,t){var s=e.children,r=e.type,o=e.value;if(r===i)return t.onDelimiter(o);if(r===n)return t.onText(o);var c=s.map(function(e){return u(e,t)}).filter(function(e){return!!e});return r===a?t.onMutatorNode(e,c):t.onRoot(c)};e.exports={parse:c,serialize:l}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){var i=e.models;if(n===b.BEFORE){var a=function(){var e=0;return{v:{hasNext:function(){return t>=e},next:function(){return i[t--]}}}}();if("object"==typeof a)return a.v}else{if(n!==b.AFTER)throw new Error("RendorCursor:invalid direction");var s=function(){var e=i.length-1;return{v:{hasNext:function(){return t<=e},next:function(){return i[t++]}}}}();if("object"==typeof s)return s.v}}function s(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],s=w*i,r=a(e,t,n),o=0,l=0,u=void 0;r.hasNext();){var d=r.next(),p=c(d),h=2*d.isNotification+d.isSentByMe,f=h&&h===u?M:C;if(o+=p+f,l++,o>s)break;u=h}return l}function r(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],s=w*i,r=a(e,t,n),o=0,l=0,u=void 0;r.hasNext();){var d=r.next(),p=c(d),h=d.author||(d.isSentByMe?Store.Conn.me:void 0),f=h&&!d.isSentByMe&&h!==u?S:0,m=h&&h===u?M:C;if(o+=p+f+m,l++,o>s)break;u=h}return l}function o(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],s=w*i,r=a(e,t,n),o=0,l=0;r.hasNext();){var u=r.next(),d=c(u);if(o+=d+T,l++,o>s)break}return l}function c(e){var t=0;switch(e.quotedMsg&&(t+=54),e.caption&&(t+=31),e.type){case g["default"].TYPE.NOTIFICATION:case g["default"].TYPE.GROUP_NOTIFICATION:case g["default"].TYPE.GP2:case g["default"].TYPE.BROADCAST_NOTIFICATION:case g["default"].TYPE.E2E_NOTIFICATION:case g["default"].TYPE.CALL_LOG:case g["default"].TYPE.CIPHERTEXT:case g["default"].TYPE.REVOKED:case g["default"].TYPE.CHAT:e.linkPreview&&(t+=53);var n=E(e.body).length;return t+19*_.ceil(n/100)+13;case g["default"].TYPE.IMAGE:return t+e.fullWidth&&e.fullHeight?Math.floor(Math.min(330/e.fullWidth*e.fullHeight,330)):330;case g["default"].TYPE.VIDEO:case g["default"].TYPE.AUDIO:return e.isGif?t+137:t+166;case g["default"].TYPE.LOCATION:return t+y.previewHeight;case g["default"].TYPE.PTT:return t+67;case g["default"].TYPE.VCARD:return t+74;case g["default"].TYPE.DOCUMENT:return t+188;case g["default"].TYPE.UNKNOWN:default:return t}}function l(e){switch(e){case v.RENDOR_CURSOR.CONVERSATION:case v.RENDOR_CURSOR.GROUP_CONVERSATION:return v.RENDOR_CURSOR.RECENT_AT_BOTTOM;case v.RENDOR_CURSOR.STARRED_DRAWER:return v.RENDOR_CURSOR.RECENT_AT_TOP;default:return v.RENDOR_CURSOR.RECENT_AT_BOTTOM}}function u(e){switch(e){case v.RENDOR_CURSOR.CONVERSATION:return s;case v.RENDOR_CURSOR.GROUP_CONVERSATION:return r;case v.RENDOR_CURSOR.STARRED_DRAWER:return o;default:return s}}var d=n(23),p=i(d),h=n(25),f=i(h),m=n(1307),g=i(m),v=n(10),y=n(1418),E=n(1409),b={BEFORE:"before",AFTER:"after"},M=2,C=12,S=19,T=65,w=window.innerHeight,k=_.debounce(function(e){w=window.innerHeight},500);window.addEventListener("resize",k);var P=function(){function e(t,n,i){var a=this;(0,p["default"])(this,e);var s=u(i);this.msgCollection=t,this.type=i,this.dir=l(i),this.cursorSize=function(e,t){if(e===b.BEFORE)return s(a.msgCollection,a.start-1,e,t);if(e===b.AFTER)return s(a.msgCollection,a.end,e,t);throw new Error("RendorCursor:invalid direction")},this.init(n)}return(0,f["default"])(e,[{key:"init",value:function(e){return this.before=0,this.after=0,this.prevKey=void 0,this.msgKey=e,this.loadBefore(void 0,1),this.loadAfter(void 0,1),this}},{key:"setKey",value:function(e){var t=this.index;this.msgKey=e;var n=this.index;return e?(this.after=this.after-(n-t),this.before=this.before+(n-t)):(this.before+=this.after,this.after=0),this.updatePrev(),this}},{key:"onRemove",value:function(e){e.id===this.prevKey?this.updatePrev():e.id===this.msgKey&&this.focusBefore()}},{key:"updatePrev",value:function(){this.prevKey=this.index>0?this.msgCollection.models[this.index-1].id:void 0}},{key:"focusBefore",value:function(){this.msgKey=this.prevKey,this.updatePrev()}},{key:"hasBefore",value:function(e){arguments.length<=1||void 0===arguments[1]?2:arguments[1];return this.index-this.before>0}},{key:"loadBefore",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],n=e||this.cursorSize(b.BEFORE,t);return this.before+=n,this}},{key:"hasAfter",value:function(e){arguments.length<=1||void 0===arguments[1]?2:arguments[1];return this.index+this.after<this.msgCollection.length-1}},{key:"loadAfter",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],n=e||this.cursorSize(b.AFTER,t);return this.after+=n,this}},{key:"index",get:function(){if(this.msgKey){var e=this.msgCollection.get(this.msgKey),t=this.msgCollection.indexOf(e);if(t!==-1)return t}return this.dir===v.RENDOR_CURSOR.RECENT_AT_TOP?0:this.msgCollection.length-1}},{key:"start",get:function(){return Math.max(this.index-this.before,0)}},{key:"end",get:function(){return Math.min(this.index+this.after+1,this.msgCollection.length)}}]),e}();e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return o(function(){return h.get(e,t)})}function s(e){return o(function(){return h.head(e)})}function r(e,t){return o(function(){return h.post(e,t)})}function o(e){return u["default"].loop(function(t,n,i){var a=u["default"].delay(f.expBackoff(i,6e4,void 0,.1));return c().then(function(){return e()}).then(function(e){return e.status>=500&&e.status<600?a:void t(e)})["catch"](function(){return a})})}function c(){return d.state===d.STATE.CONNECTED?u["default"].resolve():p.waitForBBEvent(d,"change:state",_.matches({state:d.STATE.CONNECTED}))}var l=n(2),u=i(l),d=n(12),p=n(51),h=n(148),f=n(88);e.exports={headRetry:s,getRetry:a,postRetry:r}},function(e,t,n){e.exports=function(){return new Worker(n.p+"e64cdb20573245f2d149.worker.js")}},,function(e,t,n){"use strict";var i=n(6),a=n(8),s=n(84),r=n(83),o=i.createClass({displayName:"ActionListener",mixins:[s],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("clear_chat_msgs",this.onClear),this.regCmd("mark_chat_unread",this.onMarkUnread)},onMute:function c(e,t){if(t){var s=n(1590),c=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};a.openModal(i.createElement(s,{chat:e,onMute:c}),"modal",this.context.uim)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e){var t=n(1575),s=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};a.openModal(i.createElement(t,{chat:e,onDeleteOrExit:s}),"modal",this.context.uim)},onClear:function(e){var t=n(1570);a.openModal(i.createElement(t,{chat:e}),"modal",this.context.uim)},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["catch"](_.noop)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},render:function(){return null}});o.contextTypes={uim:i.PropTypes.instanceOf(r)},e.exports=o},function(e,t,n){"use strict";var i=n(6),a=n(434).MIMETYPES,s=_.pickBy(a,function(e){return"audio"===e.msgType}),r=i.createClass({displayName:"AttachMediaTypeAudio",propTypes:{mimeType:i.PropTypes.oneOf(_.keys(s)).isRequired,url:i.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.mimeType,n=e.url;return i.createElement("div",{className:"media-element-container"},i.createElement("div",{className:"media-element"},i.createElement("audio",{controls:!0,type:t,src:n})))}});e.exports=r},function(e,t,n){"use strict";var i=n(6),a=n(1334),s=n(1375),r=i.createClass({displayName:"AttachMediaTypeDoc",propTypes:{preview:i.PropTypes.object,mimeType:i.PropTypes.string,filename:i.PropTypes.string},render:function(){var e=this.props.preview;return e?i.createElement("div",{className:"media-element-pdf-container"},i.createElement("div",{className:"media-element-pdf-preview"},i.createElement(a,{type:a.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},i.createElement("img",{src:e.url,className:"media-viewer-img"})))):i.createElement(s,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(6),o=n(1334),c=n(434).MIMETYPES,l=_.pickBy(c,function(e){return"image"===e.msgType||"video"===e.msgType}),u=r.createClass({displayName:"AttachMediaTypeMedia",propTypes:{mimeType:r.PropTypes.oneOf(_.keys(l)).isRequired,url:r.PropTypes.string.isRequired,isGif:r.PropTypes.bool,size:r.PropTypes.shape({width:r.PropTypes.number,height:r.PropTypes.number})},render:function(){var e=this.props,t=e.mimeType,n=e.url,i=e.size,a=void 0;if("image"===l[t].msgType)a=r.createElement("img",{src:n,className:"media-viewer-img"});else if("video"===l[t].msgType){var c=this.props.isGif?{loop:!0,autoPlay:!0,muted:!1,controls:!1}:{};a=r.createElement("video",(0,s["default"])({controls:!0,className:"media-viewer-img",type:t},c,{src:n}))}else"audio"===l[t].msgType&&(a=r.createElement("audio",{controls:!0,className:"media-viewer-audio",type:t,src:n}));return r.createElement("div",{className:"media-element-container"},r.createElement("div",{className:"media-element"},r.createElement(o,{type:o.TYPES.SCALE_DOWN,size:i},a)))}});e.exports=u},function(e,t,n){"use strict";var i=n(6),a=n(1334),s=n(1375),r=i.createClass({displayName:"AttachMediaTypePdf",propTypes:{preview:i.PropTypes.object,mimeType:i.PropTypes.string,filename:i.PropTypes.string},componentWillUnmount:function(){},render:function(){var e=this.props.preview;if(e){var t=l10n.t("attach_document_pdf_total_pages",{count:e.pdfPages,_plural:e.pdfPages});return i.createElement("div",{className:"media-element-pdf-container"},i.createElement("div",{className:"media-element-pdf-preview"},i.createElement(a,{type:a.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},i.createElement("img",{src:e.url,className:"media-viewer-img"}))),i.createElement("div",{className:"media-element-pdf-caption"},t))}return i.createElement(s,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(106),s=i(a),r=n(440),o=i(r),c=n(6),l=n(1),u=n(85),d=n(229),p=n(12),h=n(151),f=n(52),m=n(87),g=n(0),v=n(51),y=n(140),E=n(84),b=n(144),M=n(10),C=n(8),S=n(45),T=n(104),w=n(1345),k=c.createClass({displayName:"ButterBar",mixins:[y,E],getInitialState:function(){var e=this;this._showNotifyTimer=new m(this.showPrompt),this._showBatteryTimer=new m(function(){return e.batteryUpdate()});var t=o["default"].battery<M.BATTERY_LOW_THRESHOLD_1?o["default"].battery<M.BATTERY_LOW_THRESHOLD_2?2:1:0;return{lowBatteryWarning:o["default"].plugged?0:t,notifyPermission:window.Notification&&window.Notification.permission,showNotify:!1}},componentWillMount:function(){this.addObserver(s["default"],"change:displayInfo"),this.addObserver(s["default"],"change:needsUpdate"),this.addObserver(s["default"],"change:needsManualDownload"),this.addObserver(o["default"],"change:plugged",this.batteryUpdate),this.addObserver(o["default"],"change:battery",this.batteryUpdate)},componentWillUnmount:function(){this._showNotifyTimer.cancel(),this._showBatteryTimer.cancel()},onReload:function(){d.restart()},onClickManualDownload:function(){},batteryUpdate:function(e){var t=this.state.lowBatteryWarning;o["default"].plugged||o["default"].battery>M.BATTERY_LOW_THRESHOLD_1?0!==t&&this.setState({lowBatteryWarning:0}):o["default"].battery<=M.BATTERY_LOW_THRESHOLD_2?t!==-2&&(e?this._showBatteryTimer.onOrBefore(M.BATTERY_DELAY):2!==t&&this.setState({lowBatteryWarning:2})):t>-1&&o["default"].battery<=M.BATTERY_LOW_THRESHOLD_1&&(e?this._showBatteryTimer.onOrBefore(M.BATTERY_DELAY):1!==t&&this.setState({lowBatteryWarning:1}))},dismissLowBatteryWarning:function(){var e=this.state.lowBatteryWarning;e>0&&this.setState({lowBatteryWarning:-e})},showPrompt:function(e){this.setState({showNotify:e})},guideConfirm:function(){C.closeModal()},guideLearnMore:function(){switch(u.browser){case M.BROWSER_TYPE.CHROME:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank");case M.BROWSER_TYPE.FIREFOX:return window.open("https://www.whatsapp.com/faq/web/28080006","_blank");case M.BROWSER_TYPE.SAFARI:return window.open("https://www.whatsapp.com/faq/web/28080008","_blank");case M.BROWSER_TYPE.OPERA:return window.open("https://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){C.openModal(c.createElement(w,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:w.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){C.closeModal(),e.setState({notifyPermission:t})})},render:function(){var e=null;switch(s["default"].displayInfo){case s["default"].INFO.OFFLINE:e=c.createElement(O,{key:"bbar"});break;case s["default"].INFO.OPENING:case s["default"].INFO.CONNECTING:e=c.createElement(D,{key:"bbar"});break;case s["default"].INFO.NORMAL:break;case s["default"].INFO.RESUMING:case s["default"].INFO.TIMEOUT:var t=function(){window.open("http://www.whatsapp.com/faq/web/28080002")},n=c.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",c.createElement("span",{className:"action",onClick:t},l10n.t("learn_more")));e=c.createElement(P,{type:"phone",key:"bbar",title:l10n.t("phone_not_connected"),text:n})}if(!e&&this.state.lowBatteryWarning>0&&(e=c.createElement(P,{type:"battery",key:"bbar",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.dismissLowBatteryWarning})),!e&&s["default"].needsUpdate&&(e=c.createElement(P,{type:"update",key:"bbar",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload})),s["default"].needsManualDownload&&(e=c.createElement(P,{type:"update",key:"bbar",title:l10n.t("desktop_client_update_available"),text:l10n.t("click_to_download_desktop_client"),action:this.onClickManualDownload})),e)this.state.showNotify&&this._showNotifyTimer.onOrBefore(0,!1);else if(this.state.showNotify){if(window.Notification&&this.state.notifyPermission===M.PERMISSION_DEFAULT){var i=c.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));e=c.createElement(P,{type:"notification",key:"bbar",title:l10n.t("get_notified_of_new_messages"),text:i})}}else this._showNotifyTimer.onOrBefore(M.NOTIFICATION_PROMPT_DELAY,!0);return c.createElement("div",{className:"butterbar-container"},c.createElement(T,{transitionName:"butterbar"},e))}}),P=c.createClass({displayName:"BB",propTypes:{type:c.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:c.PropTypes.node.isRequired,text:c.PropTypes.node,dismissable:c.PropTypes.bool,onDismiss:c.PropTypes.func,action:c.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:l.log("butterbar:render invalid type")()}var n=S("butterbar",e,{action:this.props.action}),i=S("icon","icon-alert",t),a=this.props.dismissable?c.createElement("div",{className:"butterbar-controls"},c.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,s=this.props.text?c.createElement("div",{className:"butterbar-text"},this.props.text):null;return c.createElement("div",{className:"butterbar-wrapper"},c.createElement("div",{className:n,onClick:this.onClick},c.createElement("div",{className:"butterbar-icon"},c.createElement("span",{className:i})),c.createElement("div",{className:"butterbar-body"},c.createElement("div",{className:"butterbar-title"},this.props.title),s),a))}}),N=3e3,O=c.createClass({displayName:"Offline",mixins:[b],getInitialState:function(){return{allowReconnect:!0}},reconnect:function(){var e=h.numSocketsAttempted+1;p.poke(),v.waitForBBEvent(s["default"],"change:displayInfo",function(){return s["default"].displayInfo===s["default"].INFO.NORMAL}).then(function(){new f.WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:h.numSocketsAttempted===e}).commit()}),this.setState({allowReconnect:!1}),this.reconnectTimeout=this.safeDelay(this.resetReconnectTimeout,N)},resetReconnectTimeout:function(){this.clearSafeTimeout(this.reconnectTimeout),delete this.reconnectTimeout,this.setState({allowReconnect:!0})},render:function(){var e,t;return this.state.allowReconnect?(e=c.createElement("span",null,l10n.t("make_sure_computer_active_internet_connection")+" ",c.createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),c.createElement(P,{type:"computer",title:t,text:e})}}),D=c.createClass({displayName:"Resume",mixins:[y],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this._timeoutTimer=new m(this.timedOut),this._intervalTimer=new m(this.onInterval),this.addObserver(p,"change:state",this.onProgress),this.addObserver(p,"change:retryTimestamp",this.onProgress)},componentDidMount:function(){this._timeoutTimer.onOrBefore(3e3)},componentWillUnmount:function(){this._timeoutTimer.cancel(),this._intervalTimer.cancel()},timedOut:function(){this._intervalTimer.onOrAfter(1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},onProgress:function(){this._intervalTimer.cancel(),this._timeoutTimer.onOrBefore(3e3),this.setState({takingTooLong:!1})},onInterval:function(){this._intervalTimer.onOrAfter(1e3),this.setState({now:Date.now()})},retry:function(e){p.poke(),this.onProgress()},render:function(){var e,t;if(s["default"].displayInfo===s["default"].INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(s["default"].displayInfo!==s["default"].INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var n=p.retryTimestamp-Date.now();if(n<1)n=l10n.t("retrying"),_.defer(function(){return p.poke()});else if(n<6e4){var i=Math.ceil(n/1e3);n=l10n.t("retrying_in_some_seconds",{number:i,_plural:i})}else n=l10n.t("retrying_in",{duration:g.duration(n).humanize()});t=c.createElement("span",null,n," ",c.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?c.createElement("span",null,l10n.t("retrying")):null;return c.createElement(P,{type:"computer",title:e,text:t})}});e.exports=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=i(f),g=n(1308),v=(i(g),n(1354)),y=(i(v),n(1326)),E=i(y),_=n(1475),b=i(_),M=n(1309),C=i(M),S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.chat,n=e.presence;if(n.isActive()){var i=n.getFormattedString();if(i)return m["default"].createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},m["default"].createElement(C["default"],{ellipsify:!0,titlify:!0,text:i}))}var a=t.previewMessage;return a?m["default"].createElement(b["default"],{key:a.id,msg:a}):m["default"].createElement("div",{className:"chat-status"})}}]),t}(m["default"].PureComponent);S.CONCERNS={chat:["previewMessage"],chatstate:["id","type"]},S.WEAK_CONCERNS={presence:["hasData","withholdDisplay"]};var T=(0,E["default"])(S);t["default"]=function(e){var t=e.chat;return m["default"].createElement(T,{chat:t,presence:t.presence,chatstate:t.presence.chatstate})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(218),o=i(r),c=n(1350),l=i(c),u=n(6),d=n(140),p=n(1320),h=n(1324),f=n(1332),m=n(1341),g=n(217),v=u.createClass({displayName:"CheckboxChatWrapper",mixins:[d],propTypes:{chat:u.PropTypes.oneOfType([u.PropTypes.instanceOf(s["default"]),u.PropTypes.instanceOf(o["default"])]).isRequired,active:u.PropTypes.instanceOf(h).isRequired,selections:u.PropTypes.instanceOf(p).isRequired,onSelect:u.PropTypes.func.isRequired},getInitialState:function(){return{selected:this.props.selections.isSelected(this.props.chat)}},componentWillMount:function(){this.addObserver(this.props.selections,this.props.chat.id.toString(),this.onSelectChange)},onSelectChange:function(e){this.state.selected!==e&&this.setState({selected:e})},onSelect:function(){this.props.onSelect(this.props.chat,!this.state.selected)},render:function(){var e=this.props,t=e.chat,n=e.active,i=void 0;return i=t instanceof s["default"]?u.createElement(l["default"],{className:"chat-container",active:n,chat:t,mode:c.Mode.INFO,noContext:!0,onClick:this.onSelect}):u.createElement(f,{className:"chat-container",active:n,contact:t,onClick:this.onSelect,secondary:t.isBlocked()?g.t("confirm_unblock_contact_and_forward_text"):null}),u.createElement("div",{className:"checkbox-chat-wrapper"},u.createElement("div",{className:"checkbox-container-wrapper"},u.createElement(m,{onChange:this.onSelect,checked:this.state.selected})),i)}});e.exports=v},function(e,t,n){"use strict";var i=n(6),a=n(143),s=i.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:i.PropTypes.string.isRequired,icon:i.PropTypes.node.isRequired,t:i.PropTypes.number},render:function(){var e=this.props,t=e.title,n=e.t,s=e.icon,r=n?a.relativeDateAndTimeStr(n):"-",o={cursor:"auto"};return i.createElement("div",{className:"contact chat",style:o},i.createElement("div",{className:"chat-body"},i.createElement("div",{className:"chat-main"},i.createElement("div",{className:"chat-title"},i.createElement("span",{className:"ellipsify",dir:"auto"},s,t))),i.createElement("div",{className:"chat-secondary"},i.createElement("div",{className:"chat-status ellipsify"},i.createElement("span",{className:"ellipsify",dir:"auto"},r)))))}});e.exports=s},function(e,t,n){"use strict";var i=n(6),a=n(1340),s=n(1315),r=n(143),o=n(1310),c=i.createClass({displayName:"GroupMsgInfoCell",mixins:[o],propTypes:{participant:i.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t=i.createElement("div",{className:"chat-avatar"},i.createElement(s,{id:e.id})),n={cursor:"auto"};return i.createElement(a,{id:e.id,contextEnabled:function(){return!1},image:t,primary:this.state.formattedName,secondary:r.relativeDateAndTimeStr(e.t),style:n})}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=i(f),g=n(1308),v=(i(g),n(1389)),y=(i(v),n(1326)),E=i(y),_=n(217),b=i(_),M=n(104),C=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.chat,n=e.mute,i=n.isMuted?m["default"].createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,a=0!==t.unreadCount?m["default"].createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},t.unreadCount>0?b["default"].n(t.unreadCount):m["default"].createElement("span",null," ")):null,s=t.archive?m["default"].createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},b["default"].t("chat_archived")):null;return m["default"].createElement(M,{transitionName:"pop"},i,s,a)}}]),t}(m["default"].PureComponent);C.CONCERNS={chat:["unreadCount","archive"],mute:["isMuted"]},t["default"]=(0,E["default"])(C)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(6),v=i(g),y=n(1307),E=(i(y),n(1400)),_=i(E),b=n(85),M=i(b),C=n(217),S=i(C),T=n(1376),w=i(T),k=n(1355),P=i(k),N=n(1309),O=i(N),D=n(1326),x=i(D);t["default"]=(0,x["default"])((s=a=function(e){function t(){return(0,l["default"])(this,t),(0,h["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=[];e.isSentByMe&&t.push(v["default"].createElement(w["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||t.push(v["default"].createElement(_["default"],{contact:e.senderObj,key:"author"}),v["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":")),e.hasSymbol()&&t.push(v["default"].createElement(P["default"],{msg:e,key:"msg-symbol"})),t.push(v["default"].createElement(O["default"],{direction:e.dir,ellipsify:!0,text:e.msgText(!1),format:!0,dirMismatch:e.dir&&e.rtl!==S["default"].isRTL(),mention:e.mentionMap(),key:"status"}));var n="chat-status";M["default"].isGecko&&(n+=" ellipsify");var i=S["default"].embedDir(e.msgText(e.rtl));return v["default"].createElement("div",{className:n,title:i},t)}}]),t}(v["default"].PureComponent),a.CONCERNS={msg:["isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl"]},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(430),s=i(a),r=n(146),o=i(r),c=n(37),l=i(c),u=n(23),d=i(u),p=n(25),h=i(p),f=n(81),m=i(f),g=n(80),v=i(g),y=n(6),E=i(y),b=n(38),M=i(b),C=n(1340),S=i(C),T=n(1309),w=i(T),k=n(45),P=i(k),N=n(1348),O=i(N),D=n(85),x=i(D),R=n(82),A=i(R),I=n(1401),L=i(I),U=n(1355),F=i(U),G=n(1307),j=(i(G),
n(1376)),B=i(j),H=n(1400),q=i(H),W=n(103),V=i(W),z=n(438),Y=i(z),K=n(217),Q=i(K),X=n(1326),Z=i(X),J=n(1329),$=i(J),ee=function(e){function t(){var e,n,i,a;(0,d["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return n=i=(0,m["default"])(this,(e=(0,l["default"])(t)).call.apply(e,[this].concat(r))),i.state={active:!!i.props.active&&i.props.active.value===i.props.msg},i.onActiveChange=function(e){if("focus"===e){var t=M["default"].findDOMNode(i);A["default"].focus(t),O["default"].scrollIntoViewIfNeeded(t)}i.setState({active:!!e})},i.onClick=function(e){if(_.isFunction(i.props.onClick)){var t=i.props,n=t.msg,a=t.chat,s=Store.Msg.get(n.id),r=a.getSearchContext(s);r.msg=s,i.props.onClick(e,Store.Chat.get(a.id),r)}},i.onMouseDown=function(e){0===e.button&&i.onClick(e)},i.onEnter=function(e){e.preventDefault(),e.stopPropagation(),V["default"].flashFocus=Date.now(),i.onClick(e)},i.indicateFocus=function(e){if(!(Date.now()-(V["default"].flashFocus||0)>200)){var t=M["default"].findDOMNode(i.refs.cell);(0,Y["default"])(t,"stop"),(0,Y["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:i.onBlur})}},i.onBlur=function(e){var t=M["default"].findDOMNode(i.refs.cell);t&&((0,Y["default"])(t,"stop"),t.style.backgroundColor="")},a=n,(0,m["default"])(i,a)}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.active,n=e.msg,i=e.addListener;t&&i(t,n.id.toString(),this.onActiveChange)}},{key:"render",value:function(){var e=this.props,t=e.msg,n=e.chat,i=[];t.isSentByMe&&i.push(E["default"].createElement(B["default"],{msg:t,key:"symbol"})),t.isSentByMe||!t.isGroupMsg||t.isNotification||i.push(E["default"].createElement(q["default"],{contact:t.senderObj,key:"author"}),E["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":")),t.hasSymbol()&&i.push(E["default"].createElement(F["default"],{msg:t,key:"msg-symbol"}));var a=void 0;this.props.searchText&&(a=_.uniq(_.compact(_.split(_.toLower(this.props.searchText)," ")))),i.push(E["default"].createElement(w["default"],{direction:t.dir,ellipsify:!0,text:t.msgText(!1),format:!0,highlight:a,dirMismatch:t.dir&&t.rtl!==Q["default"].isRTL(),mention:t.mentionMap(),key:"status"}));var s=(0,P["default"])("chat-status",{ellipsify:x["default"].isGecko}),r=E["default"].createElement(L["default"],{msg:t}),o=Q["default"].embedDir(t.msgText(t.rtl)),c=E["default"].createElement("div",{className:s,title:o},i),l={enter:this.onEnter},u=(0,P["default"])("message",{active:!!this.state.active}),d=this.props.mouseDownAsClick;return E["default"].createElement(V["default"],{handlers:l,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},E["default"].createElement(S["default"],{id:t.id.toString(),ref:"cell",contextEnabled:function(){return!1},className:u,primary:n.title(),primaryDetail:r,secondary:c,onClick:d?null:this.onClick,onMouseDown:d?this.onMouseDown:null}))}}]),t}(E["default"].PureComponent);ee.CONCERNS={msg:["id","isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl"],chat:["id","formattedTitle"]};var te=(0,$["default"])((0,Z["default"])(ee));t["default"]=function(e){var t=e.msg,n=(0,o["default"])(e,["msg"]);return E["default"].createElement(te,(0,s["default"])({msg:t,chat:t.chat},n))}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1367),s=i(a),r=n(6),o=n(1309),c=n(1310),l=r.createClass({displayName:"Status",mixins:[c],propTypes:{status:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{status:this.async("status.status")}},render:function(){return _.isUndefined(this.state.status)?r.createElement("div",{className:"muted"},l10n.t("contact_status_loading")):r.createElement("div",{className:"chat-status ellipsify",title:this.state.status},r.createElement(o,{direction:"auto",ellipsify:!0,text:this.state.status}))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(8),c=n(84),l=n(83),u=r.createClass({displayName:"ChatActionListener",mixins:[c],componentWillMount:function(){this.regCmd("chat_info_drawer",this.onChatInfoDrawer),this.regCmd("msg_info_drawer",this.onMsgInfoDrawer),this.regCmd("chat_search",this.onChatSearch),this.regCmd("attach_media_drawer",this.onAttachMediaDrawer),this.regCmd("verification_drawer",this.onVerificationDrawer),this.regCmd("media_viewer_modal",this.onMediaViewer)},onChatInfoDrawer:function(e){var t=n(1423);o.openDrawerRight(r.createElement(t,{chat:e}),"slide-left",this.context.uim)},onVerificationDrawer:function(e){var t=n(1599);o.openDrawerRight(r.createElement(t,{contact:Store.Contact.get(e),isFirstLevel:!0}),"slide-left",this.context.uim)},onMsgInfoDrawer:function(e){if(e.chat.kind===s["default"].KIND.CHAT){var t=n(1573);o.openDrawerRight(r.createElement(t,{msg:e}),"slide-left",this.context.uim)}else{var i=n(1583);o.openDrawerRight(r.createElement(i,{msg:e}),"slide-left",this.context.uim)}},onAttachMediaDrawer:function(e,t){var i=n(1548),a={drawerId:"DrawerManagermidAttachMedia",noFocus:!0};o.openDrawerMid(r.createElement(i,{chat:e,files:t}),"slide-up",this.context.uim,a)},onChatSearch:function(e){var t=n(1428);o.openDrawerRight(r.createElement(t,{chat:e}),"slide-left",this.context.uim)},onMediaViewer:function(e,t){if(Store.Msg.get(e.id)){var i=n(1551);o.openModalMedia(r.createElement(i,{msg:e,getZoomNode:t}),"media-viewer",this.context.uim)}else{var a=n(1336);o.openModal(r.createElement(a,{msg:e}))}},render:function(){return null}});u.contextTypes={uim:r.PropTypes.instanceOf(l)},e.exports=u},function(e,t,n){"use strict";var i=n(6),a=n(217),s=n(1320),r=n(140),o=i.createClass({displayName:"ChatSelectorFooter",mixins:[r],propTypes:{selections:i.PropTypes.instanceOf(s).isRequired,onForward:i.PropTypes.func.isRequired,onCancel:i.PropTypes.func.isRequired},componentWillMount:function(){this.addObserver(this.props.selections,"all")},render:function(){var e=this.props.selections.getSelected().length;return i.createElement("div",{className:"multi-controls"},i.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},i.createElement("span",{className:"icon icon-x"})),i.createElement("span",{className:"multi-count"},a.t("selected_count",{count:e,_plural:e})),i.createElement("button",{className:"btn-icon btn-forward",disabled:e?null:"disabled",title:a.t("forward_message",{count:e,_plural:e}),onClick:this.props.onForward},i.createElement("span",{className:"icon icon-forward"})))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(147),s=i(a),r=n(1322),o=i(r),c=n(1350),l=i(c),u=n(1308),d=i(u),p=n(1476),h=i(p),f=n(103),m=i(f),g=n(6),v=n(38),y=n(8),E=n(1361),b=n(140),M=n(84),C=n(141),S=n(1324),T=n(216),w=n(10),k=n(1332),P=n(139),N=g.createClass({displayName:"Chatlist",mixins:[b,M,C],propTypes:{isSearching:g.PropTypes.bool,searchText:g.PropTypes.string,chats:g.PropTypes.array,contacts:g.PropTypes.array,ftsResult:g.PropTypes.array,onClick:g.PropTypes.func,selection:g.PropTypes.instanceOf(S),onFocusSearch:g.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){var e=this;this._listPointerEvents=!0,this.debouncedOpenSelected=_.debounce(function(){e.openSelected(e.focusComposer),e.focusComposer=!1},200);var t;return t=0,{textsize:t}},componentWillMount:function(){this.props.selection.init(this.getSelection())},componentWillUnmount:function(){var e=this.getSelection(),t=this.props.selection.getVal();t&&t.isState&&!this.props.isSearching&&!e.length&&y.clearChat(t)},componentDidMount:function(){var e=this;this.regCmd("focus_chat_list",this.restoreFocus),this.regCmd("focus_next_chat",this.onNextChat.bind(this,null,!0)),this.regCmd("focus_prev_chat",this.onPrevChat.bind(this,null,!0)),this.regCmd("update_chatlist_selection",this.updateSelected),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentDidUpdate:function(e,t){var n=this.props.selection.getVal();this.props.selection.init(this.getSelection(),!e.isSearching&&!this.props.isSearching),n!==this.props.selection.getVal()&&(this.focusComposer=!0,this.debouncedOpenSelected())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},updateSelected:function(e){this.debouncedOpenSelected.cancel(),this.props.selection.setVal(e,!1)},openSelected:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.props.selection.getVal();t&&(t instanceof d["default"]&&t!==this.getActiveChat()?y.openChatFromUnread(t).then(function(n){n&&e&&y.focusChatTextInput(t)}):e&&y.focusChatTextInput(t))},onClick:function(e,t,n){var i=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){i.props.isSearching&&i.props.onClick&&i.props.onClick(),n?y.openChatAt(e,n).then(function(t){t&&y.focusChatTextInput(e)}):e!==i.getActiveChat()?y.openChatFromUnread(e).then(function(t){t&&y.focusChatTextInput(e)}):y.focusChatTextInput(e)})},getSelection:function(){return[].concat((0,s["default"])(this.props.chats),(0,s["default"])(this.props.contacts),(0,s["default"])(this.getFTSStarred()),(0,s["default"])(this.getFTSMessages()))},getFTSStarred:function(){return _.filter(this.props.ftsResult,{star:!0})},getFTSMessages:function(){return _.filter(this.props.ftsResult,{star:!1})},getList:function(){for(var e=this.props,t=e.chats,n=e.contacts,i=[],a=0;a<t.length;a++){var s=t[a];s&&(this.props.isSearching&&0===a&&i.push(g.createElement(E,{key:"chat-header",header:l10n.t("web_chats")})),i.push(g.createElement(l["default"],{chat:s,mode:c.Mode.LAST,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,active:this.props.selection,key:s.id})))}for(var r=0;r<n.length;r++){var o=n[r];o&&(0===r&&i.push(g.createElement(E,{key:"contact-header",header:l10n.t("web_contacts")})),i.push(g.createElement(k,{contact:o,active:this.props.selection,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,key:o.id})))}if(P.supportsFeature(P.F.FULL_TEXT_SEARCH)){for(var u=this.getFTSStarred(),d=0;d<u.length;d++){var p=u[d];0===d&&i.push(g.createElement(E,{key:"fts-header-starred",header:l10n.t("web_starred_messages")})),i.push(g.createElement(h["default"],{msg:p,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection,key:p.id.toString()}))}for(var f=this.getFTSMessages(),m=0;m<f.length;m++){var v=f[m];0===m&&i.push(g.createElement(E,{key:"fts-header-messages",header:l10n.t("web_messages")})),i.push(g.createElement(h["default"],{msg:v,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection,key:v.id.toString()}))}}return i},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){var t=this.refs.uie;t&&t.activate(),e.target===v.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst(),this.debouncedOpenSelected()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var i=this.props.selection.next();this.props.selection.index!==i&&(this.props.selection.setNext(),this.focusComposer=n,this.debouncedOpenSelected())},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var i=this.props.selection.prev();i>-1?(this.props.selection.setPrev(),this.focusComposer=n,this.debouncedOpenSelected()):t||(this.debouncedOpenSelected.cancel(),this.openSelected(),this.props.onFocusSearch())},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}},n=72,i=_.find(w.LIST_HEIGHT_TEXTSIZE_MAP,function(t){return t.scale===e.state.textsize});return i&&(n=i.height),g.createElement(T,{displayName:"Chatlist",ref:"uie",state:T.State.PASSIVE,requestFocus:function(){return e.props.selection.reset(!1)}},g.createElement(m["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},g.createElement(o["default"],{className:"chatlist",data:this.getList(),height:n,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn})))},getActiveChat:function(){return _.find(Store.Chat.toArray(),{active:!0})}});e.exports=N},function(e,t,n){"use strict";var i=n(6),a=n(12),s=n(1432),r=n(428),o=n(1552),c=n(1553),l=n(1556),u=n(1565),d=n(1433),p=n(19),h=n(437),f=n(1319),m=n(1315),g=n(8),v=n(1310),y=n(144),E=n(10),_=n(1358),b=_.MenuBarItem,M=_.MenuBar,C=n(139),S=n(432),T=n(45),w=n(104),k="global_mute",P=i.createClass({displayName:"ChatlistHeader",mixins:[v,y],getDefaultProps:function(){return{muteId:k}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},componentWillMount:function(){},onWindowFocus:function(){var e=this;this.setState({newlyFocused:!0}),this.safeDelay(function(){return e.setState({newlyFocused:!1})},100)},onMouseDown:function(){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onNewChat:function(e){e.preventDefault(),g.openDrawerLeft(i.createElement(o,null))},onProfile:function(){g.openDrawerLeft(i.createElement(s,{id:Store.Conn.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),g.openToast(i.createElement(S,{msg:l10n.t("global_unmuted"),id:S.genId()}))},render:function(){var e=null;this.state.isMuted&&(e=i.createElement(b,{a8n:"menu-bar-unmute",icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"}));var t=T("pane-list-user",{});return i.createElement("header",{className:"pane-header pane-list-header",onMouseDown:this.onMouseDown,onClickCapture:this.onClickCapture},i.createElement("div",{className:t},i.createElement(m,{id:Store.Conn.me,size:40,onClick:this.onProfile})),i.createElement("div",{className:"pane-list-controls"},i.createElement(M,{key:"chatlist-header"},i.createElement(w,{transitionName:"btn"},e,i.createElement(b,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),i.createElement(b,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},i.createElement(N,null))))))}});e.exports=P;var N=i.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:p.getRememberMe()}},onCreateGroup:function(){g.openDrawerLeft(i.createElement(c,null))},onProfile:function(){g.openDrawerLeft(i.createElement(s,{id:Store.Conn.me}))},onDisconnect:function(){var e=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void g.openModal(i.createElement(r,{title:l10n.t("confirm_logout"),onOK:function(){return a.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return g.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):a.logout()},onArchived:function(){g.openDrawerLeft(i.createElement(u,null))},onSettings:function(){g.openDrawerLeft(i.createElement(l,null))},onStarred:function(){g.openDrawerLeft(i.createElement(d,{starredMsgs:Store.AllStarredMsgs}))},render:function(){var e=C.supportsFeature(C.F.GROUP_CREATE)?i.createElement(f,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=C.supportsFeature(C.F.STARRED)&&C.supportsFeature(C.F.FULL_TEXT_SEARCH)?i.createElement(f,{a8n:"mi-starred menu-item",action:this.onStarred},l10n.t("menuitem_starred")):null,n=l10n.t("menuitem_profile_status"),a=l10n.t("menuitem_profile");return i.createElement(h,{type:h.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:h.Direction.X.LEFT}},e,i.createElement(f,{a8n:"mi-profile-status menu-item",action:this.onProfile},E.STATUS_V3?a:n),i.createElement(f,{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),t,i.createElement(f,{a8n:"mi-setting menu-item",action:this.onSettings},l10n.t("menuitem_settings")),i.createElement(f,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(6),o=n(1332),c=n(1324),l=r.createClass({displayName:"ParticipantList",propTypes:{contacts:r.PropTypes.array.isRequired,onDelete:r.PropTypes.func.isRequired,onFocusSearch:r.PropTypes.func.isRequired},getInitialState:function(){return this.selection=new c(this.props.contacts,function(e){return e.id}),null},componentWillReceiveProps:function(e){this.selection.init(e.contacts,!0)},focusLast:function(){_.size(this.props.contacts)&&this.selection.setLast()},focusPrev:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1&&this.selection.setPrev()},focusNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.next();this.selection.index===t?(this.selection.unset(),this.props.onFocusSearch(e)):this.selection.setNext()},deleteContact:function(e){e.preventDefault(),e.stopPropagation();var t=_.find(this.props.contacts,this.selection.getVal());this.props.onDelete(e,t)},onParticipantClick:function(e,t){this.selection.setVal(t)},render:function(){var e=this,t=this.props.contacts;if(!t)return null;var n=_.size(this.props.contacts)?_.map(this.props.contacts,function(t){return r.createElement(o,{contact:t,active:e.selection,onDelete:e.props.onDelete,onClick:e.onParticipantClick,type:o.Type.SMALL,key:t.id})}):null,i={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};i[l10n.LR("left","right")]=this.focusPrev,i[l10n.LR("right","left")]=this.focusNext;var a=r.createElement("ul",{ref:"list"},n);return r.createElement(s["default"],{handlers:i},a)}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1351),s=i(a),r=n(103),o=i(r),c=n(6),l=n(38),u=n(140),d=n(84),p=n(1314),h=n(1426),f=n(1481),m=n(1480),g=n(1321),v=n(142),y=n(1469),E=n(8),b=n(139),M=n(1374),C=n(14),S=n(1324),T=n(10),w=n(82),k=n(1444),P=n(45),N=n(1325),O=N.GetRef,D=n(1216),x=2,R=c.createClass({displayName:"ChatlistPanel",mixins:[u,d,D,p,h],getInitialState:function(){var e=this;this.ftsMsgs=new k,this.fts=_.debounce(function(){e.pending=!1;var t=_.trim(e.searchText||"");M.multibyteLength(t)<x||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=e.ftsMsgs.search(t).checkpoint(e.rejectOnUnmount()).then(function(n){t===_.trim(e.searchText)&&e.setState({searching:!1},h.DD)})["catch"](C.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1},h.DD)}))},750),this.selection=new S([],function(e){return e.id.toString()}),this.throttledFilteredChats=_.throttle(function(t){var n=e.getFilteredChats(t);e.setState({chats:n},h.DD,h.CD)},450,{leading:!1,trailing:!0}),this.throttledFilteredContacts=_.throttle(function(t){var n=e.getFilteredContacts(t);e.setState({contacts:n},h.DD,h.CD)},450,{leading:!1,trailing:!0}),this.searchText="";var t;return t=0,{searching:!1,chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),textsize:t}},componentWillMount:function(){var e=this;this.addObserver(Store.Chat,"sort remove change:archive",function(){e.searchText||(e.throttledFilteredChats.cancel(),e.throttledFilteredContacts.cancel(),e.setState({chats:e.getFilteredChats(),contacts:e.getFilteredContacts()}))})},componentDidMount:function(){var e=this;this.addObserver(this.ftsMsgs,"reset"),this.addObserver(this.ftsMsgs,"search_more"),this.regCmd("focus_chat_search",this.onFocusSearch),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0}))},componentWillUnmount:function(){this.fts.cancel(),this.ftsMsgs["delete"](!0),this._ftsPromise&&this._ftsPromise.cancel(),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel()},getFilteredContacts:function(e,t){if(!e)return[];e=l10n.accentFold(_.trim(e));var n=Store.Contact.getFilteredContacts();return n.filter(function(n){var i=n.searchMatch(e);if(!i)return!1;var a=Store.Chat.get(n.id);return!(!t&&a&&a.isVisible)})},getFilteredChats:function(e){return e=_.trim(e),e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&t.isVisible})):Store.Chat.filter(function(e){return!e.archive&&e.isVisible})},fullTextSearch:function(e){var t=_.trim(e);M.multibyteLength(t)>=x&&b.supportsFeature(b.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},h.DD)):(this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.state.searching&&this.setState({searching:!1},h.DD))},shouldFTSSearch:function(e){if(!this.ftsMsgs.hasMoreMsgs||this.pending||this.state.searching||M.multibyteLength(this.searchText||"")<x)return!1;var t=_.last(e.children);return e.scrollHeight<e.clientHeight+t.scrollHeight},onSearch:function(e){if(!e)return void this.onStopSearch();var t=this.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),this.throttledFilteredChats(e),this.throttledFilteredContacts(e),this.searchText=e,this.setState(n,h.DD)}},onStopSearch:function(){this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.searchText="",this.search&&this.search.setState({searchText:this.searchText}),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel(),this.pending=!1,this.setState({chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),searching:!1})},onFocusList:function(e){e.repeat||this.refs.chatlist&&this.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),o["default"].flashFocus=Date.now(),this.refs.chatlist.focusFirst())},onOpenFirst:function(e){var t=this;e.preventDefault();var n=_.head(this.getFilteredChats(this.searchText))||_.head(this.getFilteredContacts(this.searchText));n&&Store.Chat.find(n.id).then(function(e){t.onStopSearch(),o["default"].flashFocus=Date.now(),E.openChatFromUnread(e).then(function(t){t&&E.focusChatTextInput(e)})})},onFocusSearch:function(e){var t=this;E.existsDrawerLeft(function(e){e||(o["default"].flashFocus=Date.now(),w.focus(t.search))})},indicateFocus:function(e){if(!(Date.now()-(o["default"].flashFocus||0)>200)){var t=l.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){e.scrollTop+T.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.ftsMsgs.hasMoreMsgs&&!this.pending&&(this.fts(),this.pending=!0)},100),getEmptyChatlistState:function(e,t,n){return e.length||t.length||n.length?null:this.searchText?this.state.searching?c.createElement(g.Searching,null):c.createElement(g.Search,null):Store.Chat.some(function(e){return e.isVisible})?c.createElement(g.AllArchived,null):c.createElement(g.ListChats,null)},render:function(){var e=this,t=this.state,n=t.chats,i=t.contacts,a=this.ftsMsgs.models,r=this.getEmptyChatlistState(n,i,a);if(!r){var l=this.searchText?_.trim(this.searchText):null;r=c.createElement(m,{ref:"chatlist",chats:n,contacts:i,isSearching:!!this.searchText,searchText:l,ftsResult:a,selection:this.selection,onFocusSearch:this.onFocusSearch,onClick:this.onStopSearch})}var u,d={down:this.onFocusList,enter:this.onOpenFirst},p=this.ftsMsgs.hasMoreMsgs&&a.length?c.createElement("div",{className:"more",style:{alignSelf:"center"}},c.createElement(v,{stroke:6,size:24})):null,h=_.find(T.TEXTSIZE_CLASS_MAP,function(t){return t.scale===e.state.textsize});h&&(u=h.classname);var g=P("pane pane-list pane-one",u);return c.createElement("div",{id:"side",className:g},c.createElement(f,{key:"ChatHeader"}),c.createElement(y,{key:"ButterBar"}),c.createElement(o["default"],{handlers:d,onFocus:this.indicateFocus,ref:"input_hotkey",className:"search-container"},c.createElement(s["default"],{ref:O("search",this),onSearch:this.onSearch,loading:this.state.searching})),c.createElement("div",{ref:"panel",className:"pane-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},r,p))}});e.exports=R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(147),s=i(a),r=n(2),o=i(r),c=n(37),l=i(c),u=n(23),d=i(u),p=n(25),h=i(p),f=n(81),m=i(f),g=n(80),v=i(g),y=n(86),E=i(y),_=n(8),b=n(6),M=n(38),C=n(438),S={duration:300,easing:[.1,.82,.25,1]},T=function(e,t){return e.map(function(e,n){return[t[n]===e,n]}).filter(function(e){var t=(0,E["default"])(e,1),n=t[0];return!n}).map(function(e){var t=(0,E["default"])(e,2),n=t[1];return n})},w=function(e,t){return T(e,t).filter(function(n){return e[n]&&!t[n]})},k=function(e,t){return T(e,t).filter(function(n){return!e[n]&&t[n]})},P=function(e){function t(){var e,n,i,a;(0,d["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return n=i=(0,m["default"])(this,(e=(0,l["default"])(t)).call.apply(e,[this].concat(r))),i.containerHeight=0,i.childAnimations=[],i.state={children:i.props.children},i.pendingRemoval=[],a=n,(0,m["default"])(i,a)}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"getHeightChange",value:function(e,t){var n=this;return e.reduce(function(e,i){if(i<t)return e;var a=n.refs["animation-child-"+i];return a?e+M.findDOMNode(a).clientHeight:e},0)}},{key:"animateElement",value:function(e,t,n,i){var a=this;this.childAnimations[e]||(this.childAnimations[e]=o["default"].resolve()),this.childAnimations[e].cancel();var s=n>0?[0,n]:[-n,0];return this.childAnimations[e]=this.childAnimations[e].then(function(){return C(t,{translateY:s},S)}).then(function(){return a.childAnimations[e]=o["default"].resolve()}).cancellable()["catch"](o["default"].CancellationError,function(){C(t,"finish",!0),t.style.transform=""}).then(function(){n>=0||(i.indexOf(e)===-1?t.style.transform="":t.style.opacity="0")})["finally"](function(){return _.setUiBusy(!1,"animation_group")}),this.childAnimations[e]}},{key:"transitionAffected",value:function(e,t){if(!e)return o["default"].resolve();for(var n=[],i=e.slice(-1),a=(0,E["default"])(i,1),s=a[0],r=0;r<=s;++r){var c=this.refs["animation-child-"+r];c&&n.push(this.animateElement(r,M.findDOMNode(c),(t?1:-1)*this.getHeightChange(e,r),e))}return o["default"].all(n)}},{key:"notifyHeightChange",value:function(e,t){e.length&&this.props.onHeightChange&&this.props.onHeightChange((t?1:-1)*this.getHeightChange(e,0))}},{key:"componentWillReceiveProps",value:function(e){for(var t,n=this,i=e.children,a=w(this.state.children,i),r=k(this.state.children,i),o=0;o<r.length;++o)_.setUiBusy(!0,"animation_group");if(!a.length)return this.setState({children:i});var c=a.filter(function(e){return n.pendingRemoval.indexOf(e)===-1});if(c.length){for(var l=0;l<c.length;++l)_.setUiBusy(!0,"animation_group");(t=this.pendingRemoval).push.apply(t,(0,s["default"])(c)),this.notifyHeightChange(a,!1),this.transitionAffected(a,!1).then(function(){n.pendingRemoval=n.pendingRemoval.filter(function(e){return c.indexOf(e)===-1}),n.setState({children:i})})}}},{key:"componentDidUpdate",value:function(e,t){var n=t.children,i=k(n,this.state.children);i.length&&(this.notifyHeightChange(i,!0),this.transitionAffected(i,!0))}},{key:"componentDidMount",value:function(){var e=this,t=this.state.children.reduce(function(t,n,i){var a=e.refs["animation-child-"+i];if(!a)return t;var s=M.findDOMNode(a);return s.style.transform="translateY(0)",t+s.clientHeight},0);this.props.onHeightChange(t,!0)}},{key:"render",value:function(){var e=this.state.children,t=b.Children.map(e,function(e,t){return e?b.cloneElement(e,{ref:"animation-child-"+t}):e});return b.createElement("div",null,t)}}]),t}(b.Component);e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1310),c=n(1319),l=r.createClass({displayName:"ArchiveMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onArchive:r.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return r.createElement(c,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1308),m=(i(f),n(1307)),g=(i(m),n(1438)),v=(i(g),n(6)),y=n(10),E=n(1329),_=n(31),b=n(8),M=n(1384),C=n(142),S=n(1321),T=(n(1320),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=_.throttle(function(e){var t=i.props.docMsgs;t.hasDocBefore&&e.scrollTop+y.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryDocs(t.head())},100),i.onClickMsg=function(e,t){i.props.selectable&&void 0!==t?i.props.onMessageSelect(e,t):b.openChatAt(e.chat,e.chat.getSearchContext(e))},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillMount",value:function(){this.props.docMsgs.hasDocBefore&&this.queryDocs()}},{key:"componentDidMount",value:function(){this.props.addListener(this.props.docMsgs,"add remove reset"),this.props.addListener(this.props.docMsgs,"query_doc_before")}},{key:"queryDocs",value:function(e){var t=this,n=this.props.docMsgs;n.hasDocBefore&&this.props.uiIdle(function(){n.queryDocs(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.docMsgs,n=this.props.selectedMessages,i=t.map(function(t){return v.createElement(M,{key:t.id,ref:t.id.toString(),msg:t,multiMedia:!0,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})});if(i.reverse(),t.queryDocBefore){if(0===i.length)return v.createElement(S.Loading,null);i.push(v.createElement("div",{className:"more",key:"spinner"},v.createElement(C,{stroke:6,size:24})))}return 0!==t.length||t.queryDocBefore||t.hasDocBefore?v.createElement("div",{onScroll:this.onScroll,className:"doc-gallery"},i):v.createElement(S.DocMsgs,null)}}]),t}(v.Component));e.exports=E(T)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(142),u=n(45),d=function(e){var t=e.className,n=e.children,i=(0,o["default"])(e,["className","children"]),a=u("doc-state",t);return c.createElement("div",(0,s["default"])({className:a},i),n)},p=function(e){var t=e.onClick;return c.createElement(d,{onClick:t||_.noop},c.createElement("span",{className:"icon doc-state-icon icon-audio-download"}))},h=function(){return c.createElement(d,null,c.createElement(l,{stroke:3,size:32}))},f=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-cancel-noborder"},c.createElement(l,{stroke:3,size:32})))},m=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-upload"}))};e.exports={Download:p,Pending:h,PendingCancel:f,Upload:m}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(6),o=n(38),c=n(141),l=n(219),u=r.createClass({displayName:"Draggable",mixins:[c],propTypes:{children:r.PropTypes.node.isRequired,start:r.PropTypes.shape({x:r.PropTypes.number,y:r.PropTypes.number}),scale:r.PropTypes.number,container:r.PropTypes.shape({width:r.PropTypes.number.isRequired,height:r.PropTypes.number.isRequired}),onStart:r.PropTypes.func,onDrag:r.PropTypes.func,onStop:r.PropTypes.func},getInitialState:function(){return{dragging:!1,x:0,y:0,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){
e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var n=e.container;if(n&&this.refs.draggable){var i,a=o.findDOMNode(this.refs.draggable),s=this.state.x,r=this.state.y,c=a.width*e.scale,l=a.height*e.scale;this.props.scale!==e.scale&&this.state.center?(i=this.state.center,s=n.width/2-i.x*c,r=n.height/2-i.y*l):i={x:(n.width/2-s)/c,y:(n.height/2-r)/l},s>0?s=0:s+c<n.width&&(s=n.width-c),r>0?r=0:r+l<n.height&&(r=n.height-l),this.setState({width:c,height:l,x:s,y:r,center:i}),this.props.onStop&&t&&e.onStop(s,r)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,n=e.clientY-this.state.offsetY,i=this.props.container;i&&((t>0||t+this.state.width<i.width)&&(t=this.state.x),(n>0||n+this.state.height<i.height)&&(n=this.state.y)),this.setState({x:t,y:n}),this.props.onDrag&&this.props.onDrag(t,n)}},render:function(){var e=this.props.scale?" scale("+this.props.scale+")":"",t=(0,s["default"])({},l.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+e);this.state.dragging||(t[l.prefix("transition")]="transform 200ms");var n="draggable";return this.state.dragging&&(n+=" dragging"),r.cloneElement(r.Children.only(this.props.children),{style:t,draggable:!0,ref:"draggable",className:n,onMouseDown:this.handleMouseDown})}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(433),s=i(a),r=n(6),o=n(10),c=o.ONE_BY_ONE_TRANS_GIF,l=n(45);e.exports=function(e){var t=e.emoji,n=e.size,i=void 0===n?"small":n,o=e.className,u=a.emojiMap[t];return u?r.createElement("img",{alt:t,draggable:!1,src:c,className:l(o,s["default"].getClasses(u,i))}):null}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(146),s=i(a),r=n(6),o=r.createClass({displayName:"IsolatedBlock",propTypes:{Component:r.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,n=e.children,i=(0,s["default"])(e,["Component","children"]);return r.createElement(t,i,"​⁠​",n,"​⁠​")}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1308),m=(i(f),n(1307)),g=(i(m),n(1439)),v=(i(g),n(6)),y=n(10),E=n(1329),_=n(31),b=n(8),M=n(1384),C=n(142),S=n(1321),T=(n(1320),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=_.throttle(function(e){var t=i.props.linkMsgs;t.hasLinkBefore&&e.scrollTop+y.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryLinks(t.head())},100),i.onClickMsg=function(e,t){i.props.selectable&&void 0!==t?i.props.onMessageSelect(e,t):b.openChatAt(e.chat,e.chat.getSearchContext(e))},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillMount",value:function(){this.props.linkMsgs.hasLinkBefore&&this.queryLinks()}},{key:"componentDidMount",value:function(){this.props.addListener(this.props.linkMsgs,"add remove reset"),this.props.addListener(this.props.linkMsgs,"query_link_before")}},{key:"queryLinks",value:function(e){var t=this,n=this.props.linkMsgs;n.hasLinkBefore&&this.props.uiIdle(function(){n.queryLinks(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.linkMsgs,n=this.props.selectedMessages,i=t.map(function(t){return v.createElement(M,{key:t.id,ref:t.id.toString(),msg:t,multiMedia:!0,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})});if(i.reverse(),t.queryLinkBefore){if(0===i.length)return v.createElement(S.Loading,null);i.push(v.createElement("div",{className:"more",key:"spinner"},v.createElement(C,{stroke:6,size:24})))}return 0!==t.length||t.queryLinkBefore||t.hasLinkBefore?v.createElement("div",{onScroll:this.onScroll,className:"link-gallery"},i):v.createElement(S.LinkMsgs,null)}}]),t}(v.Component));e.exports=E(T)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(6),v=n(219),y=n(45),E=function(e){function t(e){(0,l["default"])(this,t);var n=(0,h["default"])(this,(0,o["default"])(t).call(this,e));return n.state={rendered:!1},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.setState({rendered:!0})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.rowNumber,i=e.rowHeight,a=e.zIndex,r=e.className,o=(0,s["default"])({zIndex:a,height:i},v.prefix("transform"),"translate3d(0, "+i*n+"px, 0)");return r=y(r,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0}),g.createElement("div",{className:r,style:o},t)}}]),t}(g.Component);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1310),c=n(1319),l=r.createClass({displayName:"MarkUnreadMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onMarkUnread:r.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return r.createElement(c,{a8n:"mi-mark-as",action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){e.some(function(e){var i=(0,r["default"])(e,2),a=i[0],s=i[1],o=s.call(a,n,t);return!!n.defaultPrevented||o===!0&&(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),!0)})}}var s=n(86),r=i(s),o=n(32),c=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.handlers;return n?((0,c["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,c["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(){for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];e.forEach(function(e){var n=(0,r["default"])(e,2),a=n[0],s=n[1];return s.call.apply(s,[a].concat(i,[t]))})}}var s=n(86),r=i(s),o=n(32),c=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.hooks;return n?((0,c["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,c["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){e.some(function(e){var i=(0,r["default"])(e,2),a=i[0],s=i[1],o=s.call(a,n,t);return!!n.defaultPrevented||o===!0&&(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),!0)})}}var s=n(86),r=i(s),o=n(32),c=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.hotkeys;return n?((0,c["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,c["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):e.matches(t)}function s(e,t){for(var n=0;n<t.length;++n){var i=t[n].serializers;if(i)for(var s=0;s<i.length;++s){var r=(0,c["default"])(i[s],2),o=r[0],l=r[1];if(a(e,o))return l}}return null}function r(e,t){for(var n=[],i=e.cloneNode(!0),a=i.firstChild;a;){switch(a.nodeType){case 1:var r=s(a,t);if(r){n.push(r(a));break}switch(a.tagName){case"P":case"BR":case"PRE":case"DIV":n.push("\n")}case 3:n.push(a.nodeValue)}if(a.hasChildNodes())a=a.firstChild;else{for(;a&&!a.nextSibling;)if(a=a.parentNode,a===e){a=null;break}a&&(a=a.nextSibling)}}return n.join("")}var o=n(86),c=i(o);e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return t.reduce(function(e,t){var n=t.parsers;return n?n.reduce(function(e,t){return t(e)},e):e},r["default"].escape(e))}var s=n(31),r=i(s);e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(6),v=function(e,t){var n,i;return i=n=function(n){function i(){return(0,l["default"])(this,i),(0,h["default"])(this,(0,o["default"])(i).apply(this,arguments))}return(0,m["default"])(i,n),(0,d["default"])(i,[{key:"render",value:function(){return g.createElement(e,(0,s["default"])({},this.props,t))}}]),i}(g.Component),n.displayName="Wrapper("+(e.displayName||e.name)+")",i};e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(81),l=i(c),u=n(80),d=i(u),p=n(1502),h=i(p),f=n(1507),m=i(f),g=n(1501),v=i(g),y=n(1510),E=i(y),_=n(1509),b=i(_),M=n(1499),C=i(M),S=function(e){function t(){return(0,o["default"])(this,t),(0,l["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,d["default"])(t,e),t}((0,v["default"])([h["default"],m["default"],E["default"]]));S.Suggestions=(0,C["default"])(b["default"],{plugin:m["default"]}),e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return{handlers:s(e,G)}}function s(e,t){return t.reduce(function(t,n){return Array.isArray(n)?t[n[0]]=e[n[1]]:t[n]=e[n],t},{})}function r(e){return e.which===L&&(e.getModifierState("Shift")||e.getModifierState("Alt")||e.getModifierState("Control"))}function o(e,t,n){var i={};return n.forEach(function(n){return i[n]=e[n]!==t[n]}),i}var c=n(147),l=i(c),u=n(430),d=i(u),p=n(37),h=i(p),f=n(23),m=i(f),g=n(25),v=i(g),y=n(81),E=i(y),_=n(80),b=i(_),M=n(103),C=i(M),S=n(1378),T=n(1370),w=n(82),k=n(1410),P=n(6),N=n(1494),O=n(1495),D=n(1496),x=n(45),R=n(1497),A=n(1409),I=n(1498),L=13,U=function(e){function t(){var e,n,i,a;(0,m["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return n=i=(0,E["default"])(this,(e=(0,h["default"])(t)).call.apply(e,[this].concat(r))),F.call(i),a=n,(0,E["default"])(i,a)}return(0,b["default"])(t,e),(0,v["default"])(t,[{key:"replaceSelection",value:function(e){if(!this.props.readOnly){var t=this.refs.input;this._hasFocus(t)||(w.focus(t),this.selection&&this.restoreSelection(this.selection));var n=this.trimToFit(e);if(n.length){this.props.multiline||(n=n.replace(/\r?\n/g,"")),window.getSelection().getRangeAt(0).deleteContents();var i=t.scrollTop,a=t.scrollHeight;document.execCommand("insertHTML",!1,I(n,this.plugins)),this.onSelect();var s=t.scrollHeight,r=t.clientHeight;s<=r||(t.scrollTop=(i||0)+(s-a))}}}},{key:"restoreSelection",value:function(e){var t=this.refs.input;if(t){var n=e.anchorIndex,i=e.focusIndex,a=e.anchorOffset,s=e.focusOffset,r=t.childNodes,o=n===-1?t:r[n],c=i===-1?t:r[i];if(o&&c)try{if(o===c&&a>s){var l=[s,a];a=l[0],s=l[1]}var u=document.createRange();u.setStart(o,a),u.setEnd(c,s);var d=window.getSelection();d.removeAllRanges(),d.addRange(u)}catch(p){this.focus(!0)}}}},{key:"getSelection",value:function(){var e=this.refs.input;if(!e||document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=t.focusNode,s=t.focusOffset,r=e.childNodes,o=-1,c=-1,l=0,u=void 0;(o<0||c<0)&&(u=r[l++]);)n===u&&(o=l-1),a===u&&(c=l-1);return{anchorIndex:o,anchorOffset:i,focusIndex:c,focusOffset:s}}},{key:"trimToFit",value:function(e){var t=this.props.maxLength;if(!t)return e;var n=this.selectionLength,i=this.length,a=t+n-i;if(a<=0)return"";var s=A(String(e));return s.slice(0,a).join("")}},{key:"render",value:function(){var e=this.props.placeholder,t=this.state.value,n=t.length?"hidden":"visible",i=I(t,this.plugins);return P.createElement(C["default"],{className:"input-emoji",handlers:this.hotKeyMap},P.createElement("div",{className:"input-placeholder",ref:"placeholder",style:{visibility:n}},e),P.createElement("div",(0,d["default"])({},this.handlerMap,{className:x(this.props.className),contentEditable:!this.props.readOnly,dangerouslySetInnerHTML:{__html:i},"data-tab":this.props.readOnly?null:1,dir:"auto",ref:"input",spellCheck:this.props.spellCheck})))}},{key:"value",get:function(){return this.state.value}},{key:"selectionLength",get:function(){if(this.props.readOnly)return 0;var e=this.refs.input;this._hasFocus(e)||w.focus(e);var t=window.getSelection();return t.rangeCount?A(R(t.getRangeAt(0).cloneContents(),this.plugins)).length:0}},{key:"length",get:function(){return A(this.state.value).length}},{key:"isComposing",get:function(){return this.__isComposing}}]),t}(P.Component),F=function(){var e=this;this.__changeDueToReset=!1,this.__isMounted=!0,this.__isComposing=!1,this.selection=this.props.initialSelection,this.state={value:this.props.initialValue||""},this.trigger=function(t){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],i=e.hookMap[t];i&&i.apply(void 0,(0,l["default"])(n))},this.serializeNode=function(t){return R(t,e.plugins)},this._hasFocus=function(){var t=arguments.length<=0||void 0===arguments[0]?e.refs.input:arguments[0];if(!t)return!1;var n=document,i=n.activeElement;return!!i&&(i===t||t.contains(i))},this.focus=function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];return setTimeout(function(){if(!e.props.readOnly&&e.__isMounted){var n=e.refs.input;if(n){var i=e._hasFocus(n);if(!i||t)if(i||w.focus(n),!t&&e.selection)e.restoreSelection(e.selection);else{var a=window.getSelection();a&&a.rangeCount&&(a.selectAllChildren(n),a.collapseToEnd())}}}},0)},this.reset=function(){e.__changeDueToReset=!0,e.selection=null,e.setState({value:""})},this.onSelect=function(){e.selection=e.getSelection(),e.props.onSelect&&e.props.onSelect(e.selection)},this.shouldComponentUpdate=function(t,n){var i=n.value,a=!i.length&&!!e.state.value.length,s=!!i.length&&!e.state.value.length;if(!s&&!a)return!1;var r=s?"hidden":"visible";return e.refs.placeholder&&e.refs.placeholder.setAttribute("style","visibility: "+r),a&&(e.refs.input.innerHTML=""),e.__changeDueToReset&&(e.__changeDueToReset=!1,e.refs.input&&(e.refs.input.innerHTML=I(i,e.plugins))),!1},this.componentWillReceiveProps=function(t){var n=o(e.props,t,["readOnly"]);n.readOnly&&e.refs.input.setAttribute("contentEditable",String(!t.readOnly))},this.componentWillUnmount=function(){return(e.__isMounted=!1)||void 0},this.onInput=function(t){var n=R(e.refs.input,e.plugins),i="\n"===n?"":n,a=e.props.maxLength;if(a>0&&A(i).length>a){var s=e.selection;return e.refs.input.innerHTML=I(e.state.value,e.plugins),void(s&&e.restoreSelection(s))}e.setState({value:i},function(){e.trigger(k.CHANGE,[i]),e.props.onChange&&e.props.onChange(i)})},this.onPaste=function(t){t.preventDefault();var n=new T(t.clipboardData),i=e.props.onFiles;n.hasFiles()&&i&&i(n)||n.hasText()&&n.getText().then(function(t){if(t){if(A(t).length>e.props.maxLength){var n=e.props.onMaxPasteExceeded;return n&&n()}e.replaceSelection(t)}})},this.onBeforeInput=function(t){if(e.props.readOnly)return!0;var n=e.props.maxLength;if(!n)return!1;var i=t.data.charCodeAt(0);if(8===i||127===i)return!1;var a=e.selectionLength,s=e.length,r=n+a-s;return A(t.data).length>r},this.onKeyDown=function(t){return!(!e.props.onKeyDown||!e.props.onKeyDown(t))||t.which===L&&((!e.props.multiline||!r(t))&&(e.props.onEnter&&e.props.onEnter(t),!0))},this.componentDidMount=function(){e.refs.input.restoreFocus=e.focus,e.trigger(k.MOUNT)},this.onBlur=function(t){return e.props.onBlur&&e.props.onBlur(t)},this.onFocus=function(t){e.props.onFocus&&e.props.onFocus(t)},this.onCompositionStart=function(t){return!(e.__isComposing=!0)},this.onCompositionEnd=function(){return e.__isComposing=!1}};e.exports=function(e){var t=function(t){function n(){var t,i,s,r;(0,m["default"])(this,n);for(var o=arguments.length,c=Array(o),u=0;u<o;u++)c[u]=arguments[u];return i=s=(0,E["default"])(this,(t=(0,h["default"])(n)).call.apply(t,[this].concat(c))),s.plugins=[].concat((0,l["default"])(e.map(function(e){return e instanceof S&&e.initialize(s),e})),[a(s)]),s.handlerMap=N(s.plugins,s),s.hookMap=O(s.plugins,s),s.hotKeyMap=D(s.plugins,s),r=i,(0,E["default"])(s,r)}return(0,b["default"])(n,t),n}(U);return t};var G=["onBeforeInput","onBlur","onCompositionEnd","onCompositionStart","onFocus","onInput","onKeyDown","onPaste","onSelect"]},function(e,t,n){"use strict";var i=n(433),a=i.emojiRegex,s=i.emojiMap,r=n(10),o=r.ONE_BY_ONE_TRANS_GIF,c=a(),l={serializers:[["img.emoji",function(e){return e.getAttribute("alt")||""}]],parsers:[function(e){return e.replace("️","")},function(e){return e.replace(c,function(e,t){var n=s[t];if(!n)return"";var a=document.createElement("img");return a.setAttribute("alt",t),a.setAttribute("draggable","false"),a.setAttribute("class",i.getClasses(n)),a.setAttribute("src",o),a.outerHTML})}],handlers:{onBeforeInput:function(e,t){var n=e.data,i=c.exec(n);return!!i&&(t.replaceSelection(i[0]),!0)}}};e.exports=l},function(e,t,n){"use strict";var i=n(1359),a=n(1360),s=n(1352),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.BACKWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),c=window.getSelection();c.removeAllRanges();var l=document.createRange();return l.setStart(t,o),l.setEnd(t,o),c.addRange(l),!0}},function(e,t,n){"use strict";var i=n(1359),a=n(1360),s=n(1352),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.FORWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),c=window.getSelection();c.removeAllRanges();var l=document.createRange();return l.setStart(t,o+1),l.setEnd(t,o+1),c.addRange(l),!0}},function(e,t,n){"use strict";var i=n(1359),a=n(1360),s=n(1352),r=a.Direction,o=n(85),c=o.isGecko;e.exports=function(e,t){if(!c||!s(e))return!1;var n=a(t,r.BACKWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var u=document.createRange();return u.setStart(t,o),u.setEnd(t,o+1),l.addRange(u),!0}},function(e,t,n){"use strict";var i=n(1359),a=n(1360),s=n(1352),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.FORWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),c=window.getSelection();c.removeAllRanges();var l=document.createRange();return l.setStart(t,o),l.setEnd(t,o+1),c.addRange(l),!0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e.hasChildNodes())for(;e.childNodes.length;)e.removeChild(e.childNodes[0])}function s(e,t){if(!e.rangeCount)return null;var n=e.getRangeAt(0);if(!n.collapsed)return null;for(var i=0;i<5;++i)e.modify("extend","backward","word");var a=e.getRangeAt(0).cloneContents(),s=t.serializeNode(a),c=D(U,s).pop();if(!c)return r(e,n);r(e,n);for(var l=c[0].length;l--;)e.modify("extend","backward","character");var u=S.findDOMNode(t.refs.input),d=u.querySelectorAll("span[data-mention-jid]");return o(e,d)?r(e,n):{original:n,range:e.getRangeAt(0),match:c}}function r(e,t){e.removeAllRanges(),e.addRange(t)}function o(e,t){var n=t.length;if(!n)return 0;for(var i=0,a=0;a<n;++a)e.containsNode(t[a],!0)&&++i;return i}var c=n(431),l=i(c),u=n(37),d=i(u),p=n(23),h=i(p),f=n(25),m=i(f),g=n(81),v=i(g),y=n(80),E=i(y),_=n(1378),b=n(1411),M=n(139),C=n(1410),S=n(38),T=n(1368),w=T.dir,k=n(85),P=k.isGecko,N=k.isTrident,O=n(1338),D=O.matchAll,x=n(1505),R=n(1506),A=n(1504),I=n(1503),L=/\u200B((\d+)@c\.us)\u200B/g,U=/(?:\B|^)@((?:[^\s@]+ ?){1,3}(?:[^\s@]+)?)?$/g,F={Enter:b.ENTER,Tab:b.TAB,ArrowUp:b.UP,ArrowDown:b.DOWN},G=function(e){function t(){var e,n,i,o,c;(0,h["default"])(this,t);for(var u=arguments.length,p=Array(u),f=0;f<u;f++)p[f]=arguments[f];return i=o=(0,v["default"])(this,(e=(0,d["default"])(t)).call.apply(e,[this].concat(p))),o.serializers=[["span[data-mention-jid]",function(e){return a(e),"​"+(e.getAttribute("data-mention-jid")||"")+"​"}]],o.parsers=[function(e){return e.replace(L,function(e,t,n){var i=window.Store.Contact.get(t);if(!i)return t;var a=!i.isMyContact&&i.notifyName?i.notifyName:i.formattedName,s=document.createElement("span");s.setAttribute("data-mention-jid",i.id);var r=document.createElement("span");r.setAttribute("class","at-symbol"),r.appendChild(document.createTextNode("@"));var o=document.createElement("span");return o.setAttribute("dir",w(a)||"auto"),o.appendChild(document.createTextNode(a)),s.appendChild(r),s.appendChild(o),s.outerHTML})}],o.hooks=(n={},(0,l["default"])(n,C.CHANGE,function(e,t){var n=t.refs.input;if(P)for(var i=n.querySelectorAll("[data-mention-jid]"),a=0;a<i.length;++a){var s=i[a].nextSibling;s&&s instanceof Element&&"BR"===s.tagName&&"_moz"===s.getAttribute("type")&&s.remove()}}),(0,l["default"])(n,C.MOUNT,function(e){for(var t=e.refs.input,n=t.querySelectorAll("[data-mention-jid]"),i=0;i<n.length;++i)n[i].setAttribute("contenteditable","false")}),n),o.handlers={onKeyDown:function(e,t){if(!this.ctx.isComposing){var n=t.refs.input,i=e.key;if("Backspace"===i&&x(e,n)||"Delete"===i&&R(e,n))return!1;if("ArrowRight"===i&&A(e,n)||"ArrowLeft"===i&&I(e,n))return!0}var a=F[e.key];return!!a&&this.handle(a,[e,t])},onBlur:function(){return this.handle(b.INACTIVE),!1},onSelect:function(e,t){var n=M.supportsFeature(M.F.MENTIONS_OUT);if(N||this.ctx.isComposing||!n)return!1;if(t.value.indexOf("@")<0)return this.handle(b.INACTIVE);var i=window.getSelection(),a=s(i,t);if(!a)return this.handle(b.INACTIVE);var o=a.original,c=a.match;return this.handle(b.SEARCH,[c[1]||""]),r(i,o),!1}},c=i,(0,v["default"])(o,c)}return(0,E["default"])(t,e),(0,m["default"])(t,[{key:"handleSelect",value:function(e,t){if(s(window.getSelection(),this.ctx)){this.ctx.replaceSelection("​"+e.id+"​ "),this.handle(b.INACTIVE);for(var n=this.ctx.refs.input,i=n.querySelectorAll("[data-mention-jid]"),a=0;a<i.length;++a)i[a].setAttribute("contenteditable","false")}}}]),t}(_);e.exports=new G},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1315),m=n(1309),g=n(6),v=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.className!==e.className||this.props.contact!==e.contact||this.props.term!==e.term}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.contact,i=n.id,a=n.formattedName,s=n.isMyContact,r=n.notifyName,o=e.onMouseDown,c=e.onMouseOver,l=e.onMouseUp,u=e.term;return g.createElement("div",{className:t,onMouseDown:o,onMouseUp:l,onMouseOver:c},g.createElement(f,{id:i,size:32,className:"mentions-result-image"}),g.createElement("div",{className:"mentions-result-text-contact",dir:"auto"},g.createElement(m,{text:a,highlight:u?[u]:null,highlightBounary:!0})),g.createElement("div",{className:"mentions-result-text-pushname",dir:"auto"},!s&&r?g.createElement(m,{text:r,highlight:u?[u]:null,highlightBounary:!0,className:"emoji-text"}):null))}}]),t}(g.Component);e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n,i){return!(!t.state.active||!t.state.results.length)&&(e.call(t,n,i),!0)}}function s(e,t){if(t.isMe)return!1;var n=[t.searchName||t.formattedName];return!t.isMyContact&&t.notifyName&&n.push(t.notifyName.toLowerCase()),n.some(function(t){return r(e,t)})}function r(e,t){var n=-1;do if(t.indexOf(e,n+1)===n+1)return!0;while((n=t.indexOf(" ",n+1))!==-1);return!1}var o=n(37),c=i(o),l=n(23),u=i(l),d=n(25),p=i(d),h=n(81),f=i(h),m=n(80),g=i(m),v=n(1322),y=i(v),E=n(1411),_=n(6),b=n(38),M=n(1508),C=n(216),S=n(104),T=n(45),w={active:!1,offset:0,omitted:"",query:"",results:[],scrollTop:0},k=52,P=function(e){function t(){var e,n,i,s;(0,u["default"])(this,t);for(var r=arguments.length,o=Array(r),l=0;l<r;l++)o[l]=arguments[l];return n=i=(0,f["default"])(this,(e=(0,c["default"])(t)).call.apply(e,[this].concat(o))),i.state=w,i.onEnter=a(function(){return i.handleSelect(i.state.offset)},i),i.onInactive=a(function(){return i.setState(w)},i),i.onSearch=function(e){var t=i,n=t.state.omitted;n&&e.startsWith(n)||i.props.chat&&i.props.chat.isGroup&&i.setState({active:!0,offset:0,omitted:null,query:e,results:i.getResults(e)})},i.onEscape=function(){i.setState({active:!1,offset:0,omitted:i.state.query,query:"",results:[]})},i.onUp=a(function(){var e=Math.max(i.state.offset-1,0);i.setOffset(e)},i),i.onDown=a(function(){var e=i.state.results.length-1,t=Math.min(i.state.offset+1,e);i.setOffset(t)},i),s=n,(0,f["default"])(i,s)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.plugin;e.registerHandler(E.ENTER,this.onEnter),e.registerHandler(E.TAB,this.onEnter),e.registerHandler(E.SEARCH,this.onSearch),e.registerHandler(E.INACTIVE,this.onInactive),e.registerHandler(E.UP,this.onUp),e.registerHandler(E.DOWN,this.onDown)}},{key:"componentWillUnmount",value:function(){var e=this.props.plugin;e.unregisterHandler(E.ENTER),e.unregisterHandler(E.TAB),e.unregisterHandler(E.SEARCH),e.unregisterHandler(E.INACTIVE),e.unregisterHandler(E.UP),e.unregisterHandler(E.DOWN)}},{key:"handleSelect",value:function(e){var t=this.state.results[e];if(t&&t.id){var n=this.props.chat.assignedColor(t.id);this.props.plugin.handleSelect(t,n)}}},{key:"getResults",value:function(e){var t=this.props.chat.groupMetadata.participants,n=t.models.map(function(e){var t=e.contact;return t}),i=(e||"").toLowerCase(),a=n.filter(function(e){return s(i,e)});return a}},{key:"setOffset",value:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=e*k,i=n+k,a=b.findDOMNode(this.refs.overflow),s=a.scrollTop,r=s+a.clientHeight,o={offset:e,scrollTop:s};t||(s>n?o.scrollTop=n:r<i&&(o.scrollTop+=i-r)),this.setState(o)}},{key:"renderList",value:function(e,t,n){var i=this;if(!e||!t.length)return null;var a=t.map(function(e,t){return _.createElement(M,{key:e.id,contact:e,term:n,ref:"mention-result-"+t,className:T("mentions-result",{selected:t===i.state.offset}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(){return i.handleSelect(t)},onMouseOver:function(){return i.setOffset(t,!0)}})});return _.createElement(C,{displayName:"MentionSuggestions",escapable:!0,requestDismiss:this.onEscape},_.createElement("div",{className:"mentions-overlay-container"},_.createElement("div",{className:"mentions-results-container","data-list-scroll-container":"true",ref:"overflow"},_.createElement(y["default"],{data:a,height:k,scrollTop:this.state.scrollTop,animate:!1}))))}},{key:"render",value:function(){var e=this.state,t=e.query,n=e.results,i=e.active;return _.createElement(S,{component:"div",className:"mentions-positioning-container",transitionName:"slide-up"},this.renderList(i,n,t))}}]),t}(_.Component);e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(81),l=i(c),u=n(80),d=i(u),p=n(1378),h=i(p),f=n(8),m=i(f),g=n(1352),v=i(g),y=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),u=0;u<r;u++)c[u]=arguments[u];return n=i=(0,l["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.handlers={onKeyDown:function(e){return!this.ctx.isComposing&&(!(" "!==e.key||!(0,v["default"])(e))&&(!this.ctx.value.length&&(m["default"].scrollMessages(),!0)))}},a=n,(0,l["default"])(i,a)}return(0,d["default"])(t,e),t}(h["default"]);t["default"]=new y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(6),o=n(14),c=n(8),l=n(1319),u=n(1569),d=n(1345),p=r.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:r.PropTypes.func.isRequired},onCapture:function(){var e=this,t=new s["default"](function(n,i){navigator.getUserMedia({video:!0},function(i){c.closeModal(),n(i),t.isPending()||c.openModal(r.createElement(u,{stream:i,onSend:e.props.onImageTake}))},function(e){var n=_.isString(e)?e:e.name,a=o.GUM[n]||o.GUM.GUMError;i(new a),t&&!t.isPending()&&c.closeModal()})}).bind(this).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(e){c.openModal(r.createElement(u,{stream:e,onSend:this.props.onImageTake}))})["catch"](s["default"].TimeoutError,function(e){c.openModal(r.createElement(d,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:d.TYPE.GUIDE_ALLOW}))})["catch"](o.GUM.PermissionDeniedError,function(){c.openModal(r.createElement(d,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:d.TYPE.GUIDE_UNBLOCK}))})["catch"](o.GUM.GUMError,function(){c.openModal(r.createElement(d,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:d.TYPE.GUIDE_NONE}))})},render:function(){return r.createElement(l,{action:this.onCapture,a8n:"mi-take-photo"},l10n.t("take_photo"))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(146),o=i(r),c=n(6),l=n(8),u=n(83),d=c.createClass({displayName:"UIETooltip",propTypes:{tooltip:c.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.tooltip,n=t.menu,i=(0,o["default"])(t,["menu"]);l.openTooltip(n,(0,s["default"])({},i),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){l.closeTooltip(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:c.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(106),s=i(a),r=n(6),o=n(38),c=n(84),l=n(141),u=n(140),d=n(144),p=n(1543),h=n(1562),f=n(14),m=n(10),g=n(8),v=void 0,y=r.createClass({displayName:"Conversation",mixins:[c,l,u,d],getInitialState:function(){return{chat:void 0,msgCollection:void 0,focusCtx:void 0}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus)},componentDidMount:function(){var e=this.safeDebounce(this.windowResized,100);this.regNativeListener(window,"resize",e),e()},windowResized:function(){v=o.findDOMNode(this).clientHeight},shouldComponentUpdate:function(e,t){return t!==this.state||e.animate!==this.props.animate},componentDidUpdate:function(e,t){var n=this.state.chat,i=t.chat;n&&i!==n&&(this.addObserver(n,"change:cmc:merge",this.msgCollectionChanged),i&&this.removeObserver(i,"change:cmc:merge"))},msgCollectionChanged:function(e,t,n){var i=this.state.msgCollection;i!==e&&i!==t||this.setState({msgCollection:n})},windowGainedFocus:function(){s["default"].markAvailable();var e=this.state.chat;e&&e.isUser&&e.presence.subscribe()["catch"](f.WapDrop,_.noop)},windowLostFocus:function(){s["default"].markUnavailable(m.SEND_UNAVAILABLE_WAIT)},handleClearChat:function(e){this.state.chat===e&&this.setState({
chat:void 0,msgCollection:void 0,focusCtx:void 0})},handleOpenChat:function(e,t,n){var i=this;g.updateChatlistSelection(e);var a=this.openedChatInfo,s={},r=function(e){_.assign(s,e)};this.state.chat!==e?this.setState({chat:e,msgCollection:t?t.collection:e.msgs,focusCtx:t,notifyChatRendered:function(){return n(i.newChatScrollInfo(a,t))},updateOpenedChatInfo:r}):this.setState({msgCollection:t?t.collection:e.msgs,focusCtx:t,notifyChatRendered:function(){return n(i.newChatScrollInfo(a,t))},updateOpenedChatInfo:r}),this.openedChatInfo=s},newChatScrollInfo:function(e,t){var n=t?t.msg||Store.Msg.get(t.key):void 0;if(t&&n&&e&&e.chat&&e.renderedMsgsInfo&&e.visibleMsgOrder&&!_.isEmpty(e.renderedMsgsInfo)&&!_.isEmpty(e.visibleMsgOrder)){var i=e.renderedMsgsInfo[_.head(e.visibleMsgOrder)],a=_.find(e.renderedMsgsInfo,function(e,t){return t===n.id.toString()});return a?{wasVisible:!0,offset:a.offset}:e.chat===n.chat?n.t<i.t?{wasVisible:!1,alignAt:"top"}:{wasVisible:!1,alignAt:"bottom"}:{wasVisible:!1,alignAt:"center"}}return{wasVisible:!1,alignAt:"center"}},render:function(){var e=this.state,t=e.chat,n=e.msgCollection,i=e.focusCtx;return t?r.createElement(p,{key:t.id,chat:t,msgCollection:n,height:v,focusCtx:i,notifyChatRendered:this.state.notifyChatRendered,updateOpenedChatInfo:this.state.updateOpenedChatInfo}):r.createElement(h,{animate:this.props.animate})}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1308),o=i(r),c=n(1381),l=i(c),u=n(6),d=n(10),p=n(434),h=n(1310),f=n(1314),m=n(144),g=n(1416),v=n(1405),y=n(1315),E=n(1309),b=n(1549),M=n(1423),C=n(1428),S=n(8),T=n(1345),w=n(428),k=n(14),P=n(139),N=n(1358),O=N.MenuBar,D=N.MenuBarItem,x=n(437),R=n(1319),A=n(1412),I=n(1371),L=n(1388),U=n(83),F=u.createClass({displayName:"ConversationHeader",mixins:[h,f,m],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired,canAttach:u.PropTypes.bool.isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return this.asyncState({img:"chat.ProfilePicThumb.img",formattedTitle:"chat.formattedTitle"},{activeDropdown:void 0})},componentWillMount:function(){},onWindowFocus:function(){var e=this;this.setState({newlyFocused:!0}),this.safeDelay(function(){return e.setState({newlyFocused:!1})},100)},onMouseDown:function(e){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onClick:function(){var e=this.props.chat;!e.isPSA&&(e.isUser||e.isBroadcast||e.isGroup)&&S.openDrawerRight(u.createElement(M,{chat:e}),"slide-left",this.context.uim)},checkForDrawerMid:function(e){S.existsDrawerMid(function(t){t&&e.preventDefault()})},onChatSearch:function(e){e.preventDefault(),S.openDrawerRight(u.createElement(C,{chat:this.props.chat}),"slide-left",this.context.uim)},onCaptureClick:function(){var e=this,t=this.props.chat,n=I.start("camera");s["default"].race([n,this.rejectOnUnmount()]).bind(this).checkpoint(this.rejectOnUnmount()).then(function(n){S.openDrawerMid(u.createElement(b,{chat:t,stream:n}),"slide-up",e.context.uim,{noFocus:!0})})["catch"](k.Unmount,function(){n.then(function(e){return I.stop(e)})["catch"](_.noop)})["catch"](k.GUM.PermissionDeniedError,function(){S.openModal(u.createElement(T,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:T.TYPE.GUIDE_UNBLOCK}))})["catch"](k.GUM.GUMError,function(){S.openModal(u.createElement(T,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:T.TYPE.GUIDE_NONE}))})},render:function(){var e,t,i=this.props.chat;i.isUser?(e=u.createElement(H,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=u.createElement(l["default"],{presence:i.presence,chatstate:i.presence.chatstate,placeholder:l10n.t("click_here_for_user_info"),location:c.Location.TITLE})):i.isBroadcast?(e=u.createElement(B,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=null):i.isGroup&&(e=u.createElement(j,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=u.createElement(v,{presence:i.presence,groupMetadata:i.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"}));var a=n(139),s=a.supportsFeature(a.F.FTS_IN_CONV)?u.createElement(D,{a8n:"search-button",icon:"search-alt",title:l10n.t("search"),onClick:this.onChatSearch}):null,r=this.props.canAttach?u.createElement(D,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu",onClick:this.checkForDrawerMid},u.createElement(G,{chat:i,onCaptureClick:this.onCaptureClick})):null,o="chat-avatar",d="chat-body",p="chat-title",h=null,f=i.contact&&i.contact.isVerified;return(i.isPSA||f)&&(i.isPSA&&(o+=" chat-psa",d+=" chat-psa"),p+=" chat-title-verified",h=u.createElement("span",{className:"icon-psa-verified"}),t=null),u.createElement("header",{className:"pane-header pane-chat-header",onClickCapture:this.onClickCapture,onMouseDown:this.onMouseDown},u.createElement("div",{className:o,onClick:this.onClick},u.createElement(y,{id:i.id,size:40})),u.createElement("div",{className:d,onClick:this.onClick},u.createElement("div",{className:"chat-main"},u.createElement("h2",{className:p,dir:"auto"},u.createElement(E,{text:i.title(),titlify:!0,ellipsify:!0}),h)),t),u.createElement("div",{className:"pane-chat-controls"},u.createElement(O,{key:"conversation-header"},s,r,u.createElement(D,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu"),onClick:this.checkForDrawerMid},e))))}});F.contextTypes={uim:u.PropTypes.instanceOf(U)};var G=u.createClass({displayName:"AttachMenuDropdown",mixins:[f],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired},canSendDocument:function(){return P.supportsFeature(P.F.ENC_DOC)},onDocumentPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",this.canSendDocument()?S.attachMediaDrawer(this.props.chat,t):this.showCantSendDocument())}},onMediaPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",S.attachMediaDrawer(this.props.chat,t))}},onMediaClick:function(e){e.preventDefault(),this.refs.mediaPicker.triggerInput()},onDocumentClick:function(e){e.preventDefault(),this.canSendDocument()?this.refs.docPicker.triggerInput():this.showCantSendDocument()},confirmContactSend:function(e){var t=this,n=void 0;n=this.props.chat.isUser?l10n.t("confirm_contact_send_chat",{name:e.formattedName,chat:this.props.chat.title()}):this.props.chat.isGroup?l10n.t("confirm_contact_send_group",{name:e.formattedName,chat:this.props.chat.title()}):l10n.t("confirm_contact_send_broadcast",{name:e.formattedName}),S.openModal(u.createElement(w,{key:"contact_confirm",onOK:function(){return t.sendContact(e)},onCancel:function(){return S.closeModal()}},n))},sendContact:function(e){this.props.chat.sendContact(e),S.closeModal()},onContactClick:function(e){e.preventDefault(),S.openModal(u.createElement(L,{key:"contacts",title:l10n.t("send_contact"),filter:Store.Contact.isFilteredContact,onCancel:function(){return S.closeModal()},onSelect:this.confirmContactSend}))},showCantSendDocument:function(e){var t;if(e instanceof k.InvalidMediaFileType)t=l10n.t("cannot_send_document_type_unsupported");else if(e instanceof k.MediaFileTooLarge)t=l10n.t("document_too_big",{maxSize:d.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});else{var n=this.props.chat;t=n.isUser?l10n.t("cannot_send_document_to_contact_unsupported",{contact:n.title()}):l10n.t("cannot_send_document_to_group_unsupported",{group:n.title()})}S.openModal(u.createElement(w,{key:"doc_cant_send",onOK:S.closeModal.bind(S)},u.createElement(E,{text:t})))},onCaptureClick:function(){this.props.onCaptureClick()},render:function(){var e=u.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_capture")}),t=navigator.getUserMedia?u.createElement(R,{tooltip:e,a8n:"mi-attach-camera",action:this.onCaptureClick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-camera"}))):null,n=void 0;if(P.supportsFeature(P.F.ENC_DOC)){var i=u.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_document")});n=u.createElement(R,{tooltip:i,ref:"docPicker",a8n:"mi-attach-document",action:this.onDocumentClick,filePickerMimes:p.DOC_MIMES,onFilePick:this.onDocumentPick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-document"})))}var a=u.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_media")}),s=u.createElement(R,{tooltip:a,ref:"mediaPicker",a8n:"mi-attach-media",filePickerMimes:[d.IMAGE_MIMES,d.VIDEO_MIMES].join(","),action:this.onMediaClick,onFilePick:this.onMediaPick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-image"}))),r=u.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_vcard")}),o=u.createElement(R,{tooltip:r,a8n:"mi-attach-contact",action:this.onContactClick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-contact"})));return u.createElement("div",null,u.createElement(x,{type:x.Type.MENU,key:"AttachMenuDropdown"},s,t,n,o))}}),j=u.createClass({displayName:"GroupMenuDropdown",mixins:[h],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e=g.group(this.props.chat,this.props.onSelectMessages);return u.createElement(x,{type:x.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:x.Direction.X.LEFT}},e)}}),B=u.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired},render:function(){var e=g.broadcast(this.props.chat,this.props.onSelectMessages);return u.createElement(x,{type:x.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:x.Direction.X.LEFT}},e)}}),H=u.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired},render:function(){var e=g.contact(this.props.chat,this.props.onSelectMessages);return u.createElement(x,{type:x.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:x.Direction.X.LEFT}},e)}});e.exports=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(1308),o=i(r),c=n(1307),l=i(c),u=n(6),d=n(38),p=n(1370),h=n(10),f=n(1310),m=n(140),g=n(84),v=n(144),y=n(1314),E=n(1540),b=n(1517),M=n(8),C=n(1347),S=n(141),T=n(436),w=n(45),k=n(1416),P=n(87),N=n(1460),O=n(1320),D=n(1534),x=n(104),R=n(1),A=n(143),I=n(1343),L=n(216),U=n(217),F=n(82),G=n(432),j=n(14),B=3e3,H=8.5,q=300,W=E.UpdateTypes,V=E.UpdateTypePriority,z=u.createClass({displayName:"ConversationMsgs",mixins:[f,g,m,S,v,y],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,msgCollection:u.PropTypes.instanceOf(C).isRequired,selectable:u.PropTypes.bool,onMessageSelect:u.PropTypes.func.isRequired,onSelectMessages:u.PropTypes.func.isRequired,focusCtx:u.PropTypes.object,selectedMessages:u.PropTypes.instanceOf(O),notifyChatRendered:u.PropTypes.func,updateOpenedChatInfo:u.PropTypes.func.isRequired},getInitialState:function(){return this.rerender=this.safeDebounce(this._rerender,100),this.handleScroll=_.throttle(this._handleScroll,100),this.initialState(this.props)},componentWillMount:function(){var e=this;this._hideStickyDateMarkerTimer=new P(function(){return e.hideFloatingMarker()})},componentDidMount:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection;if(this.regCmd("compose_height_change",this.composeHeightChange),this.regCmd("scroll_chat_to_bottom",this.scrollToBottom),this.regCmd("scroll_to_focused_msg",function(){e.chatOpenScrollTimestamp=Date.now()}),this.attachMsgCollectionObservers(this.props,void 0),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),this.handleResize=_.throttle(function(){e.updateMsgListInfo(),e.updateFloatingDateMarker()},100),this.updateNearBottomOnResize=this.safeDebounce(this.updateNearBottom,100),this.regNativeListener(window,"resize",this.handleResize),this.regNativeListener(window,"resize",this.updateNearBottomOnResize),this.addObserver(n,"change:trusted"),this.regCmd("textsize_change",function(t){e.setState({textsize:t})}),n.isGroup?this.addObserver(n.groupMetadata.participants,"change:contact.name change:contact.isMyContact change:contact.notifyName",this.rerender):n.isUser&&this.addObserver(n.contact,"change:isMyContact",this.rerender),this.addObserver(i,"change:star",this.rerender),this.addObserver(n,"change:quotedMsg",this.onQuotedMsgChange),!this.props.focusCtx){var a=d.findDOMNode(this.refs.scrollContainer),s=d.findDOMNode(this.refs.messageList);s.clientHeight<a.clientHeight&&this.loadEarlierMsgs()}this.updateMsgListInfo(),this.updateFloatingDateMarker(),this.props.updateOpenedChatInfo({chat:n}),n.sendSeen();var r=void 0,o=void 0,c=void 0;this.regCmd("panes_will_change",function(t){if(e.msgListInfo&&e.msgListInfo.visibleMsgOrder&&e.msgListInfo.visibleMsgOrder.length&&e.refs.messageList){var n=_.last(e.msgListInfo.visibleMsgOrder).toString();c=d.findDOMNode(e.refs.messageList.refs[n]),o=d.findDOMNode(e.refs.scrollContainer),r=e.getMsgBottom(o,c)}}),this.regCmd("panes_did_change",function(t){o&&c&&!_.isUndefined(r)&&(e.setMsgBottom(o,c,r),c=void 0,o=void 0,r=void 0)})},getMsgBottom:function(e,t){var n=e.scrollTop,i=e.scrollHeight,a=e.clientHeight,s=i-(n+a);return i-(t.offsetTop+t.clientHeight+s)},setMsgBottom:function(e,t,n){var i=t.offsetTop,a=t.clientHeight,s=i+a+n-e.clientHeight;this.setScrollTop(e,s)},_rerender:function(){var e=this,t=d.findDOMNode(this.refs.scrollContainer),n=t.scrollTop;this.setState({msgListKey:this.state.msgListKey+1},function(){e.setScrollTop(t,n)})},componentDidUpdate:function(e,t){if(this.updateType=W.DEFAULT,this.updateMsgListInfo(),t.msgListKey===this.state.msgListKey){var n=e.chat===this.props.chat;this.updateFloatingDateMarker(n),this.props.updateOpenedChatInfo({chat:this.props.chat})}},initialState:function(e){var t=e.focusCtx,n=e.chat,i=e.msgCollection;this.updateType=W.DEFAULT,this.msgListInfo={visibleMsgs:{},dateMarker:void 0};var a,s=t||this.getUnreadFocusCtx(e),r=s&&s.msg,o=r&&r.id;return a=0,{msgListKey:0,cursor:new N(i,o,n.isGroup?h.RENDOR_CURSOR.GROUP_CONVERSATION:h.RENDOR_CURSOR.CONVERSATION),unreadCount:n.pendingSeenCount?0:n.unreadCount,isNearBottom:!0,newUnread:0,focusCtx:s,contextMenu:!1,textsize:a}},attachMsgCollectionObservers:function(e,t){var n=this,i=e.chat,a=e.msgCollection,s=e.focusCtx;this.props.msgCollection&&(this.removeObserver(this.props.chat,"change:unreadCount"),this.removeObserver(this.props.msgCollection,"change:last"),this.removeObserver(this.props.msgCollection,"remove",this.onMsgDelete),this.removeObserver(this.props.chat.msgs,"change:last")),a===i.msgs&&this.addObserver(i,"change:unreadCount",this.onUnreadCount),this.addObserver(i.msgs,"change:last",this.onLastMsgChanged),this.addObserver(a,"remove",this.onMsgDelete),this.state.cursor.msgCollection=a;var r=s,o=function(){return r.key&&(r.msg=Store.Msg.get(r.key)),r.msg?(n.setUpdateType(W.KEEP_SCROLL_BOTTOM),void n.setState({cursor:n.state.cursor.init(r.msg.id)})):M.openChatBottom(n.props.chat)};r&&a.loadAroundPromise?a.loadAroundPromise.checkpoint(this.rejectOnUnmount()).then(o)["catch"](j.Unmount,_.noop)["catch"](j.E404,function(){M.openToast(u.createElement(G,{msg:U.t("message_query_404"),id:G.genId()})),o()})["catch"](o):r&&o()},isMostRecentCMC:function(){return this.props.chat.msgs===this.props.msgCollection},componentWillReceiveProps:function(e){var t=this;this.attachMsgCollectionObservers(e,this.props.focusCtx);var n=_.clone(e);n.selectable=!e.selectable,_.isEqual(n,this.props)||this.setState(this.initialState(e),function(){t.props.chat.sendSeen()})},componentWillUnmount:function(){this._hideStickyDateMarkerTimer.cancel(),this.handleScroll.cancel(),this.handleResize.cancel(),this.maybeSendSeen()&&(this.props.chat.markedUnread=!1)},loadEarlierMsgs:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection,a=this.state.cursor;if(a.start>0)a.hasBefore()&&(this.setUpdateType(W.KEEP_SCROLL_BOTTOM),this.setState({cursor:a.loadBefore()}));else{if(i.msgLoadState.noEarlierMsgs||i.msgLoadState.isLoadingEarlierMsgs||i.msgLoadState.isLoadingAroundMsgs)return;n.loadEarlierMsgs(i).checkpoint(this.rejectOnUnmount()).then(function(){a.hasBefore()?(e.setUpdateType(W.KEEP_SCROLL_BOTTOM),e.setState({cursor:a.loadBefore()})):i.msgLoadState.noEarlierMsgs&&e.setState({})})["catch"](j.Unmount,_.noop)["catch"](function(e){R.log("ConversationMsgs:loadEarlierMsgs failed")(),R.log(e)()})}},loadRecentMsgs:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection,a=this.state.cursor;if(a.end<i.length)this.setUpdateType(W.KEEP_SCROLL_TOP),this.setState({cursor:a.loadAfter()});else{if(i.msgLoadState.isLoadingRecentMsgs||i.msgLoadState.isLoadingAroundMsgs)return;n.loadRecentMsgs(i).checkpoint(this.rejectOnUnmount()).then(function(){a.hasAfter()?(e.setUpdateType(W.KEEP_SCROLL_TOP),e.setState({cursor:a.loadAfter()})):e.state.cursor.end>=i.length&&e.isMostRecentCMC()&&e.setState({})})["catch"](j.Unmount,_.noop)["catch"](function(e){R.log("ConversationMsgs:loadRecentMsgs failed")(),R.log(e)()})}},composeHeightChange:function(e){var t=this,n=d.findDOMNode(this.refs.scrollContainer);if(e){if(e<0&&n.scrollTop===n.scrollHeight-n.clientHeight)return;this.setScrollTop(n,n.scrollTop+e)}else!function(){var e=n.scrollHeight-(n.scrollTop+n.clientHeight);Velocity(n,{tween:18},{progress:function(){t.setScrollTop(n,n.scrollHeight-e-n.clientHeight)},duration:300},[.1,.82,.25,1])}()},getScrollBottom:function(){var e=d.findDOMNode(this.refs.scrollContainer);return e.scrollHeight-(e.scrollTop+e.clientHeight)},setScrollBottom:function(e){var t=d.findDOMNode(this.refs.scrollContainer);this.setScrollTop(t,t.scrollHeight-e-t.clientHeight)},onStickyDateMarkerUpdated:function(e){var t=this.refs.stickyDateMarker;t&&t.updateDateMarkerText(e)},hideFloatingMarker:function(){var e=this.refs.stickyDateMarker;e&&e.hideStickyDateMarker(!0)},setScrollTop:function(e,t){this.programmaticScroll=Date.now(),e.scrollTop=t},updateFloatingDateMarker:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.msgListInfo.dateMarker;if(this.isMounted()&&void 0!==t){var n=e||Date.now()-(this.programmaticScroll||0)<200;if(!n){var i=this.refs.stickyDateMarker;i&&i.hideStickyDateMarker(!1)}if(this.refs.messageList){var a=this.refs.messageList.refs;if(t===-1)this.onStickyDateMarkerUpdated();else if(a){var s=a["dateMarker_"+t];if(s){var r=s.props.timestamp,o=A.relativeDateStr(r).toUpperCase();this.onStickyDateMarkerUpdated(o)}}if(a&&t!==this.dateMarkerIdx){var c=a["dateMarker_"+this.dateMarkerIdx],l=a["dateMarker_"+t];c&&c.hide(!1),l&&l.hide(!0),this.dateMarkerIdx=t}n||this._hideStickyDateMarkerTimer.debounce(B)}}},setUpdateType:function(e){V[e]>=V[this.updateType]&&(this.updateType=e)},nearBottom:function(e){return e=e||d.findDOMNode(this.refs.scrollContainer),e.scrollTop+h.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},updateNearBottom:function(){var e=this.nearBottom();this.nearBottom!==e&&(this.setUpdateType(W.NONE),this.setState({isNearBottom:e}))},getUnreadFocusCtx:function(e){var t,n=e||this.props,i=n.chat,a=n.msgCollection,r=n.focusCtx;if((!r||this.isMostRecentCMC())&&i.unreadCount){var o=(t={},(0,s["default"])(t,l["default"].TYPE.CHAT,l["default"].TYPE.CHAT),(0,s["default"])(t,l["default"].TYPE.IMAGE,l["default"].TYPE.IMAGE),(0,s["default"])(t,l["default"].TYPE.VIDEO,l["default"].TYPE.VIDEO),(0,s["default"])(t,l["default"].TYPE.AUDIO,l["default"].TYPE.AUDIO),(0,s["default"])(t,l["default"].TYPE.VCARD,l["default"].TYPE.VCARD),(0,s["default"])(t,l["default"].TYPE.LOCATION,l["default"].TYPE.LOCATION),(0,s["default"])(t,l["default"].TYPE.PTT,l["default"].TYPE.PTT),t),c=_(a.toArray()).filter(function(e){return!!o[e.type]}).reverse().take(i.unreadCount).value();if(c.length===i.unreadCount)return c=_.last(c),{msg:c,isUnreadDivider:!0,highlightMsg:!1}}},getMsgs:function(){var e=this.props.msgCollection,t=this.state.cursor;return e.toArray().slice(t.start,t.end)},updateMsgListInfo:function(){var e=this.refs.messageList;if(e){for(var t=e.props.msgs,n=e.refs,i={},a=[],s=0,r=t.length-1;s<r;){var o=Math.floor((s+r)/2),c=n[t[o].id.toString()],l=d.findDOMNode(c);l||(R.error("invalid ref lookup for ref: "+t[o].id.toString()+" msg index: "+o)(),_.forEach(_.keys(n),function(e){R.info(""+e)()})),e.getMsgVisibility(c).visibility===h.VISIBILITY.ABOVE?s=o+1:r=o}for(var u=s;u<t.length;u++){var p=n[t[u].id.toString()],f=e.getMsgVisibility(p);if(f.visibility!==h.VISIBILITY.VISIBLE)break;i[t[u].id.toString()]={offset:f.offset,t:t[u].t},a.push(t[u].id)}var m=_.pickBy(n,function(e,t){return _.startsWith(t,"dateMarker_")}),g=d.findDOMNode(this.refs.scrollContainer),v=g.scrollTop,y=n.dateMarker_0?d.findDOMNode(n.dateMarker_0).offsetTop:void 0;if(s=0,r=_.size(m)-1,_.size(m)&&y<=v+H)for(;s<r;){var E=Math.ceil((s+r)/2),b=d.findDOMNode(n["dateMarker_"+E]);if(!b)return;b.offsetTop>v+H?r=E-1:s=E}else s=-1;this.msgListInfo.dateMarker=s,this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,i),this.msgListInfo.visibleMsgs=i,this.msgListInfo.visibleMsgOrder=a,this.props.updateOpenedChatInfo({renderedMsgsInfo:i,visibleMsgOrder:a,clientHeight:g.clientHeight})}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return!!this.msgListInfo.visibleMsgs[e.toString()]&&(!!t||this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs.messageList;if(t){var n=t.refs[e.toString()];if(n)return n.refs.component&&n.refs.component.refs.msg}},pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var i=this.props.msgCollection.get(n);if(i&&i.isGif){var a=this.getMsgComponent(n);a&&a.playCount&&a.pause()}}},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom,this)},_handleScroll:function(e,t,n){this.updateMsgListInfo(),e.scrollTop<q&&Date.now()-(this.chatOpenScrollTimestamp||0)>h.MSG_FOCUS_SCROLL_ANIMATION_DURATION+50&&this.loadEarlierMsgs();var i=this.state,a=i.isNearBottom,s=i.cursor,r=n(e);r?(this.maybeSendSeen(!0),this.isMostRecentCMC()&&a!==r&&(this.setUpdateType(W.NONE),this.setState({isNearBottom:r,newUnread:0})),(s.end<this.props.msgCollection.length||!this.isMostRecentCMC())&&this.loadRecentMsgs()):a!==r&&(this.setUpdateType(W.NONE),this.setState({isNearBottom:r})),this.updateFloatingDateMarker()},windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer,this.maybeSendSeen()},h.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){if(this.state.unreadCount&&this.isMostRecentCMC()){var e=this.props.chat;0===e.unreadCount&&(this.setUpdateType(W.KEEP_SCROLL_BOTTOM),this.setState({unreadCount:0})),e.markedUnread=!1}},maybeSendSeen:function(e,t){var n=this.props,i=n.chat,a=n.msgCollection,s=this.state.cursor;if(i.isDirty()&&this.isMostRecentCMC()&&s.end>=a.length&&(_.isUndefined(t)&&(t=document.hasFocus()),t&&(_.isUndefined(e)&&(e=this.nearBottom()),e)))return i.sendSeen(),!0},jumpToBottom:function(){var e=this;this.isMostRecentCMC()&&this.state.cursor.end>=this.props.msgCollection.length?this.scrollToBottom():M.openChatBottom(this.props.chat).then(function(t){t&&M.focusChatTextInput(e.props.chat)})},scrollToBottom:function(e){var t=d.findDOMNode(this.refs.scrollContainer);t&&this.setScrollTop(t,t.scrollHeight),e&&e()},onLastMsgChanged:function(){var e=this.props.msgCollection,t=this.state,n=t.cursor,i=t.focusCtx,a=e.last();if(!this.isMostRecentCMC())return void(a&&a.isSentByMe&&this.jumpToBottom());var s={},r=document.hasFocus(),o=this.nearBottom();this.setUpdateType(o?W.SCROLL_BOTTOM:W.KEEP_SCROLL_TOP),r&&o?(this.setUpdateType(W.SCROLL_BOTTOM),s.unreadCount=0,s.focusCtx=void 0,s.cursor=n.setKey()):a&&a.isSentByMe&&(this.setUpdateType(W.SCROLL_BOTTOM),this.state.unreadCount&&(s.unreadCount=0,s.focusCtx=void 0,s.cursor=n.setKey()),this.jumpToBottom()),this.isMostRecentCMC()&&(i&&!s.hasOwnProperty("focusCtx")?s.cursor=n.loadAfter(1):s.cursor=n.loadBefore(1)),_.isEmpty(s)||this.setState(s)},onUnreadCount:function(){var e=this.props.chat,t=this.nearBottom(),n=document.hasFocus();this.maybeSendSeen(t,n);var i={};if(e.unreadCount&&!e.pendingSeenCount){i.unreadCount=e.unreadCount;var a=this.getUnreadFocusCtx();a&&(i.focusCtx=a,i.cursor=this.state.cursor.setKey(a.msg.key))}t&&i.unreadCount-this.state.unreadCount===1&&this.setUpdateType(W.SCROLL_BOTTOM),(!t&&this.isMostRecentCMC()||!e.pendingSeenCount&&this.state.newUnread!==e.unreadCount)&&(i.newUnread=e.unreadCount),_.isEmpty(i)||this.setState(i)},onMsgDelete:function(e,t,n){this.state.cursor.onRemove(e),this.setState({})},onPageUpDown:function(e){F.focus(d.findDOMNode(this.refs.scrollContainer))},onKeyPress:function(e){e.metaKey||e.ctrlKey||(e.preventDefault(),"Enter"!==e.key||e.shiftKey?M.pasteChatTextInput(this.props.chat,String.fromCharCode(e.charCode)):M.enterChatTextInput(this.props.chat))},onContextMenu:function(e){var t,n=this.props.chat,i=this.props.onSelectMessages;if(n.isUser)t=k.contact(n,i);else if(n.isGroup)t=k.group(n,i);else{if(!n.isBroadcast)return;t=k.broadcast(n,i)}e.preventDefault(),e.stopPropagation(),e.persist(),this.setState({contextMenu:{menu:t,event:e}})},contextClose:function(){this.setState({contextMenu:!1})},onPaste:function(e){var t=this;e.preventDefault();var n=new p(e.clipboardData);if(!n.hasFiles())return void n.getText().then(function(e){return M.pasteChatTextInput(t.props.chat,e)});var i=_.filter(n.getFiles(),function(e){var t=T.typeFromMimetype(e.type);return"image"===t||"video"===t});i.length&&M.attachMediaDrawer(this.props.chat,i)},render:function(){var e,t=this,n=this.props,i=n.chat,a=n.msgCollection,s=n.selectable,r=n.onMessageSelect,o=this.state.focusCtx,c=w("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:s}),l=this.isMostRecentCMC(),d=!!o,p=_.find(h.TEXTSIZE_CLASS_MAP,function(e){return e.scale===t.state.textsize});p&&(e=p.classname);var f=u.createElement(E,{key:"ml-"+i.id+"-"+this.state.msgListKey,ref:"messageList",updateType:this.updateType,unreadCount:this.state.unreadCount,selectable:s,onMessageSelect:r,msgs:this.getMsgs(),focusedMsgCtx:o,selectedMessages:this.props.selectedMessages,isMsgVisible:this.isMsgVisible,notifyChatRendered:this.props.notifyChatRendered}),m=u.createElement(b,{direction:"around",isMostRecentCMC:l,loadMoreMsgs:_.noop,msgCollection:a}),g=void 0;(this.state.cursor.start>0||!a.msgLoadState.noEarlierMsgs)&&(g=u.createElement(b,{direction:"earlier",isMostRecentCMC:l,loadMoreMsgs:this.loadEarlierMsgs,msgCollection:a}));var v=void 0;(this.state.cursor.end<a.length||!l)&&(v=u.createElement(b,{direction:"recent",isMostRecentCMC:l,loadMoreMsgs:this.loadRecentMsgs,msgCollection:a})),d&&a.msgLoadState.isLoadingAroundMsgs?(v=void 0,g=void 0,f=void 0):m=void 0;var y=void 0,M=void 0,C=this.state,S=C.isNearBottom,T=C.newUnread;S&&(a.msgLoadState.isLoadingAroundMsgs||l)||(T&&i.unreadCount&&(M=u.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},U.n(this.state.newUnread))),y=u.createElement("div",{className:"incoming-msgs",onClick:this.jumpToBottom},u.createElement(x,{transitionName:"pop"},M),u.createElement("span",{className:"icon icon-down"})));var k=void 0;return this.state.contextMenu&&(k=u.createElement(L,{displayName:"ConversationContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},u.createElement(I,{contextMenu:this.state.contextMenu}))),u.createElement("div",{className:e},u.createElement(D,{ref:"stickyDateMarker"}),u.createElement(x,{transitionName:"pop"},y),u.createElement("div",{className:c,ref:"scrollContainer",onScroll:this.onScroll,onKeyPress:this.onKeyPress,onContextMenu:s?null:this.onContextMenu,onPaste:this.onPaste,tabIndex:"0"},u.createElement("div",{className:"pane-chat-empty"}),m,g,f,v),k)}});e.exports=z},function(e,t,n){"use strict";var i=n(6),a=i.createClass({displayName:"LinkPreview",propTypes:{title:i.PropTypes.string,description:i.PropTypes.string,canonicalUrl:i.PropTypes.string,thumbnail:i.PropTypes.string,onOmit:i.PropTypes.func},render:function(){var e=this.props,t=e.title,n=e.description,a=e.canonicalUrl,s=e.thumbnail,r=s?i.createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+s}):null,o=this.props.onOmit?i.createElement("div",{className:"btn-background"},i.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit})):null;return i.createElement("div",{className:"message-in link-preview-compose"},i.createElement("div",{className:"link-preview-container"},r,i.createElement("div",{className:"link-preview-body"},i.createElement("div",{className:"link-preview-title",title:t},t),i.createElement("div",{className:"link-preview-description",title:n},n),i.createElement("div",{className:"link-preview-source ellipsify"},a))),o)}});e.exports=a},function(e,t,n){"use strict";var i=n(6),a=n(142),s=n(140),r=n(1347),o=i.createClass({displayName:"LoadMoreMessages",mixins:[s],propTypes:{direction:i.PropTypes.oneOf(["recent","earlier","around"]).isRequired,isMostRecentCMC:i.PropTypes.bool.isRequired,loadMoreMsgs:i.PropTypes.func.isRequired,msgCollection:i.PropTypes.instanceOf(r).isRequired},getInitialState:function(){return this.props.msgCollection.msgLoadState.toJSON()},componentWillMount:function(){this.attachObservers()},componentWillReceiveProps:function(e){this.attachObservers(e)},attachObservers:function(e){var t=this,n=this.props.msgCollection.msgLoadState;e&&(this.removeObserver(n,"change"),n=e.msgCollection.msgLoadState),this.addObserver(n,"change",function(){t.setState(n.toJSON())})},loadMoreMsgs:function(e){"earlier"===this.props.direction&&this.state.isLoadingEarlierMsgs||"recent"===this.props.direction&&this.state.isLoadingRecentMsgs||"around"===this.props.direction&&this.state.isLoadingAroundMsgs||this.props.loadMoreMsgs()},render:function(){var e=this.props.direction;if("earlier"===e&&this.state.isLoadingEarlierMsgs||"recent"===e&&this.state.isLoadingRecentMsgs||"around"===e&&this.state.isLoadingAroundMsgs)return i.createElement("div",{className:"more"},i.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},i.createElement(a,{stroke:6,size:24})));var t;return t="earlier"===e?l10n.t("load_earlier_messages"):"recent"===e?l10n.t("load_recent_messages"):l10n.t("loading_messages"),i.createElement("div",{className:"more"},i.createElement("div",{className:"btn-more",title:t,onClick:this.loadMoreMsgs},i.createElement("span",{className:"icon icon-refresh"})))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(10),c=n(1310),l=n(1318),u=n(1317),d=n(1316),p=n(1383),h=n(1420),f=n(8),m=n(1336),g=n(1337),v=n(139),y=n(1349),E=n(428),_=n(142),b=r.createClass({displayName:"Audio",mixins:[c],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaStage:"msg.mediaData.mediaStage",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){v.supportsFeature(v.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(g,{msg:this.props.msg
}))},downloadUnsupportedToDesktop:function(e){var t=this;e&&e.stopPropagation(),f.openModal(r.createElement(E,{onCancel:f.closeModal.bind(f),onOK:function(){f.closeModal(),y.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(_,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===o.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e,t=this.props.msg,n=t.mediaData,i=this.getStatusClass("bubble bubble-attach bubble-audio"),a=this.state.playing?this.state.currentTime:n.duration,s=r.createElement(p,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,thumb:this.state.img,type:n.type,shade:!1,duration:a}),o=t.isSentByMe?s:null,c=t.isSentByMe?null:s,f=t.isSentByMe?"text no-author":"text";switch(n.mediaStage){case l.STAGE.RESOLVED:e=r.createElement(h,{msg:t,autoPlay:!1,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case l.STAGE.NEED_POKE:e=this.loader(this.downloadMedia,"icon-audio-download");break;case l.STAGE.NEED_UPLOAD:e=this.loader(this.resumeUpload,"icon-audio-upload");break;case l.STAGE.REMOTE_NEED_UPLOAD:e=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case l.STAGE.ERROR_MISSING:e=this.loader(this.showMediaMissing,"icon-audio-play");break;default:e=this.loader(null,null,!0)}var m=this.props.displayAuthor&&d.shouldRender(t)?r.createElement(d,{msg:t,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:i},this.props.quotedMsg?m:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},o,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:m,r.createElement("div",{className:f},e)),c,r.createElement(u,{msg:t})))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1317),c=n(1316),l=n(67),u=n(45),d=r.createClass({displayName:"Ciphertext",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},onLearnMore:function(){var e="https://www.whatsapp.com/faq/general/26000015/";e=l.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&c.shouldRender(e),n=t?r.createElement(c,{msg:e}):null,i=u("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:"icon icon-ciphertext placeholder-icon"}),r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},l10n.t("placeholder_msg")),r.createElement("span",{className:"placeholder-learn-more",onClick:this.onLearnMore},l10n.t("learn_more")))),r.createElement(o,{msg:e}))}});e.exports=d},function(e,t,n){"use strict";var i=n(6),a=n(1328),s=n(1309),r=n(84),o=n(45),c=n(143),l=n(0),u=i.createClass({displayName:"DateMarker",mixins:[r],propTypes:{timestamp:i.PropTypes.number.isRequired},getInitialState:function(){return{hide:!1}},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},hide:function(e){this.state.hide!==e&&this.setState({hide:e})},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){this.unregCmd("midnight",this.rerender);var e=l().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.regCmd("midnight",this.rerender)},render:function(){var e=c.relativeDateStr(this.props.timestamp).toUpperCase(),t=o("message-system-body",{"date-marker-floating":this.state.hide});return i.createElement("div",{className:"msg"},i.createElement("div",{className:"message message-system"},i.createElement("span",{className:t},i.createElement(a,null,i.createElement(s,{direction:"auto",text:e})))))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(6),l=n(1310),u=n(1316),d=n(1318),p=n(1317),h=n(1309),f=n(45),m=n(1336),g=n(1337),v=n(1487),y=n(139),E=n(8),b=n(434).MIMETYPES,M=n(1349),C=n(432),S=_.pickBy(b,function(e){return"document"===e.msgType}),T=c.createClass({displayName:"Doc",mixins:[l],propTypes:{msg:c.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:c.PropTypes.element,displayAuthor:c.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},showMediaMissing:function(){E.openModal(c.createElement(m,{msg:this.props.msg}))},downloadMedia:function(e){var t=this;e&&e.stopPropagation(),this.downloadToBlob().then(function(){M.initDownload(t.props.msg)})},downloadToBlob:function(){return this.props.msg.mediaData.mediaStage===d.STAGE.RESOLVED?s["default"].resolve():this.props.msg.forceDownloadMedia().then(this.displayToast)["catch"](_.noop)},displayToast:function(){if(this.props.msg.mediaData.mediaStage!==d.STAGE.RESOLVED)return s["default"].reject(this.props.msg.mediaData.mediaStage);var e=this.props.msg,t=e.mediaData,n=e.caption||t.filename||l10n.t("untitled_document"),i={actionText:l10n.t("open_downloaded_document"),onAction:this.openDownloadedFile};return E.openToast(c.createElement(C,{msg:l10n.t("document_downloaded",{name:n}),id:C.genId(),action:i})),s["default"].resolve()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){y.supportsFeature(y.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():E.openModal(c.createElement(g,{msg:this.props.msg}))},openDownloadedFile:function(){var e=this.props.msg.mediaData.renderableUrl;e&&window.open(e,"_blank")},render:function(){var e,t=this.props,n=t.msg,i=t.displayAuthor,a=n.mediaData,s=f("bubble","bubble-doc",{"bubble-broadcast":n.broadcast,"bubble-star":n.star}),r=i&&u.shouldRender(n)?c.createElement(u,{msg:n}):null;a.pageCount>0&&(e=c.createElement("span",{className:"document-meta-value"},l10n.t("web_conversations_most_recent_document",{count:a.pageCount,_plural:a.pageCount})));var o,l=a.size>0?c.createElement("span",{className:"document-meta-value"},l10n.filesize(a.size)):null,m="icon-doc";_.has(S,a.mimetype)&&(o=c.createElement("span",{className:"document-meta-value"},S[a.mimetype].ext),m=f(m,S[a.mimetype].icon));var g=a.preview?c.createElement("div",{className:"document-thumb",style:{backgroundImage:'url("data:image/jpeg;base64,'+a.preview+'")'}}):null,y=n.caption||a.filename||l10n.t("untitled_document"),E=null,b=null;switch(a.mediaStage){case d.STAGE.RESOLVED:case d.STAGE.ERROR_UNSUPPORTED:E=c.createElement(v.Download,{onClick:this.downloadMedia}),b=this.openDownloadedFile;break;case d.STAGE.FETCHING:E=c.createElement(v.PendingCancel,null),b=this.cancelDownload;break;case d.STAGE.NEED_POKE:case d.STAGE.INIT:E=c.createElement(v.Download,{onClick:this.downloadMedia}),b=this.downloadToBlob;break;case d.STAGE.UPLOADING:E=c.createElement(v.PendingCancel,null),b=this.cancelUpload;break;case d.STAGE.NEED_UPLOAD:E=c.createElement(v.Upload,null),b=this.resumeUpload;break;case d.STAGE.REMOTE_NEED_UPLOAD:E=c.createElement(v.Upload,null),b=this.resumeRemoteUpload;break;case d.STAGE.ERROR_MISSING:b=this.showMediaMissing;break;default:E=c.createElement(v.Pending,null)}return c.createElement("div",{className:s},r,this.props.quotedMsg,c.createElement("div",{className:"document-container",onClick:b,title:l10n.t("web_download_document",{name:y})},g,c.createElement("div",{className:"document-body"},c.createElement("div",{className:"document-icon"},c.createElement("div",{className:m})),c.createElement("div",{className:"document-text"},c.createElement(h,{text:y,ellipsify:!0,selectable:!1,dirMismatch:n.rtl!==l10n.isRTL(),direction:"auto"})),E)),c.createElement("div",{className:"document-meta"},e,o,l),c.createElement(p,{msg:n}))}});e.exports=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(6),o=n(1412),c=r.createClass({displayName:"FailedMsgIcon",propTypes:{onResend:r.PropTypes.func.isRequired,errMsg:r.PropTypes.string.isRequired},getInitialState:function(){return{hover:!1}},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},render:function(){var e=r.createElement("span",null,this.props.errMsg),t=this.state.hover?r.createElement(o,{direction:"left",className:"tooltip-error",body:e}):null;return r.createElement(s["default"],{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:"icon-error-container"},t,r.createElement("button",{className:"error",onClick:this.props.onResend},r.createElement("span",{className:"icon icon-error"})))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(6),l=n(38),u=n(1310),d=n(144),p=n(1316),h=n(1382),f=n(45),m=n(8),g=n(428),v=n(1337),y=n(1318),E=n(1357),b=n(1317),M=n(1414),C=n(139),S=n(10),T=n(1314),w=n(51),k=2.4,P=330,N=P/k,O=3,D=6,x=c.createClass({displayName:"Gif",mixins:[u,d,T],propTypes:{msg:c.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:c.PropTypes.element,isMsgVisible:c.PropTypes.func,displayType:c.PropTypes.oneOf(_.values(S.DISP_TYPE)),displayAuthor:c.PropTypes.bool},getInitialState:function(){return this.playCount=0,{mediaStage:this.async("msg.mediaData.mediaStage"),playing:!1}},componentDidMount:function(){this.props.msg.downloadMedia()},componentWillUnmount:function(){this._preppingPlay&&this._preppingPlay.cancel()},pause:function(){this.playCount=0,this._pause()},play:function(e){var t=this;this.props.msg.mediaData.mediaStage===y.STAGE.RESOLVED&&this.refs.player&&(e&&e.stopPropagation(),this._preppingPlay&&this._preppingPlay.cancel(),this._preppingPlay=s["default"].resolve().cancellable().then(function(){if(!_.isUndefined(t.duration))return t.duration;var e=l.findDOMNode(t.refs.player);return e.readyState>0?e.duration:w.waitForEvent(e,"canplay").then(function(){return e.duration})}).then(function(e){t.duration=e,t.setState({playing:!0});var n=Math.ceil(D/e);t.playCount=Math.max(n,O),t._play()}),this._preppingPlay["catch"](s["default"].CancellationError,_.noop)["finally"](function(){t._preppingPlay=void 0}))},_pause:function(){if(this.setState({playing:!1}),this.refs.player){var e=l.findDOMNode(this.refs.player);e&&(e.currentTime=0,e.paused||e.pause())}},_play:function(){if(this.refs.player){if(!this.playCount)return this.pause();this.playCount-=1;var e=l.findDOMNode(this.refs.player);e&&e.paused&&e.play()}},getStyle:function(){var e=this.props.msg.mediaData,t=e.thumbWidth||1,n=e.thumbHeight||1,i=void 0,a=void 0,s=this.aspect(t,n);s?s<1/k?(a=P,i=N):s<1?(a=P,i=t*a/n):s<k?(i=P,a=n*i/t):(i=P,a=N):(a="100%",i=P);var r=e.renderableUrl?e.fullWidth||t:t,o=e.renderableUrl?e.fullHeight||n:n;return s?r/o>i/a?(r=r*a/o,o=a):(o=o*i/r,r=i):(r=P,o="100%"),{bubbleWidth:i,bubbleHeight:a,contentWidth:r,contentHeight:o}},aspect:function(e,t){if(e&&t)return e/t},showMediaMissing:function(){m.openModal(c.createElement(g,{title:l10n.t("missing_photo_title"),onOK:m.closeModal.bind(m),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;m.mediaViewerModal(n,i?this.getZoomNode:_.noop)},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){C.supportsFeature(C.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():m.openModal(c.createElement(v,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(S.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){if(this.refs.player)return l.findDOMNode(this.refs.player)},render:function(){var e=this.props.msg,t=e.mediaData,n=e.caption?c.createElement(h,{msg:e}):null,i=n?null:c.createElement("div",{className:"shade"}),a="data:image/jpeg;base64,"+t.preview,s=null,r=null,l=null,u=null,d=this.getStyle(),m=d.bubbleWidth,g=d.bubbleHeight,v=d.contentWidth,_=d.contentHeight,C={width:m,height:g};switch(t.mediaStage){case y.STAGE.RESOLVED:this.state.playing||(u=c.createElement("span",{className:"image-gif-control",onClick:this.play},c.createElement("button",{className:"icon icon-media-gif"}))),l=c.createElement(M,{msg:e,poster:a,ref:"player",className:"image-thumb-body",width:v,height:_,onEnded:this._play,muted:!0},l10n.t("video_playback_not_supported")),r=this.launchMediaViewer;break;case y.STAGE.INIT:r=this.launchMediaViewer;break;case y.STAGE.FETCHING:s=c.createElement(E.PendingCancel,null),r=this.cancelDownload;break;case y.STAGE.NEED_POKE:s=c.createElement(E.Download,{filesize:t.size}),r=this.downloadMedia;break;case y.STAGE.UPLOADING:s=c.createElement(E.PendingCancel,null),r=this.cancelUpload;break;case y.STAGE.NEED_UPLOAD:s=c.createElement(E.Upload,{filesize:t.size}),r=this.resumeUpload;break;case y.STAGE.REMOTE_NEED_UPLOAD:s=c.createElement(E.Upload,{filesize:t.size}),r=this.resumeRemoteUpload;break;case y.STAGE.ERROR_MISSING:r=this.showMediaMissing;break;default:s=c.createElement(E.Pending,null)}l||(l=c.createElement("div",{className:"image-thumb-body image-thumb-gif",style:{backgroundImage:"url("+a+")"}}));var S=f("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),T=this.props.displayAuthor&&p.shouldRender(e)?c.createElement(p,{msg:e}):null,w=void 0;switch(e.gifAttribution){case o["default"].GIF_ATTRIBUTION.GIPHY:w=c.createElement("span",{className:"icon-gif-vendor icon icon-giphy"});break;case o["default"].GIF_ATTRIBUTION.TENOR:w=c.createElement("span",{className:"icon-gif-vendor icon icon-tenor"});break;default:w=null}return c.createElement("div",{className:S,onClick:this.stopEvent,style:{width:C.width}},T,this.props.quotedMsg,c.createElement("div",{className:"image-thumb",onClick:r,style:C},u,s,l,i,w),n,c.createElement(b,{msg:this.props.msg}))}});e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EMOJI_SIZE=void 0;var a,s,r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(1333),v=i(g),y=n(1329),E=i(y),_=n(6),b=n(442),M=n(1369),C=n(433),S=C.emojiMap,T=C.getEmojiPath,w=C.getClasses,k=n(10),P=k.ONE_BY_ONE_TRANS_GIF,N=n(45),O=t.EMOJI_SIZE={LARGE:"large",XLARGE:"xlarge"};t["default"]=(0,E["default"])((s=a=function(e){function t(){var e,n,i,a;(0,l["default"])(this,t);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return n=i=(0,h["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.state={assetLoaded:!1},i.onAssetLoaded=function(){i.setState({assetLoaded:!0})},i.onCopy=function(e){if(e.clipboardData){var t=window.getSelection();e.clipboardData.setData("text/plain",M.asPlainText(t))}e.stopPropagation(),e.preventDefault()},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.props.addListener(window,"dpichange",function(){e.setState({assetLoaded:!1})})}},{key:"render",value:function(){var e=S[this.props.emoji];if(!e)return null;var t=T(e,this.props.emojiSize)[b.currentRes],n=void 0;return n=this.state.assetLoaded?N("large-emoji","selectable-text",{"heart-animation":this.props.animation}):N(w(e),"selectable-text"),this.props.animation&&this.state.assetLoaded?_.createElement("div",{className:"large-emoji-container",onCopy:this.onCopy},_.createElement("img",{className:"large-emoji selectable-text image",src:P,alt:this.props.emoji}),_.createElement(v["default"],{className:"large-emoji heart-animation container",draggable:!1,src:t})):_.createElement("div",{className:"large-emoji-container",onCopy:this.onCopy},_.createElement(v["default"],{draggable:!1,onLoad:this.onAssetLoaded,alt:this.props.emoji,src:t,className:n}))}}]),t}(_.Component),a.defaultProps={emojiSize:O.LARGE,animation:!1},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(67),c=n(1216),l=n(45),u={LINK:"link",GROUP_INVITE:"group_invite"},d=r.createClass({displayName:"LinkPreview",mixins:[c],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,type:r.PropTypes.oneOf(_.values(u)).isRequired},getDefaultProps:function(){return{type:u.LINK}},render:function(){var e=this.props,t=e.msg,n=e.type,i=void 0;if(t.thumbnail){var a=l({"link-preview-media":n===u.LINK,"group-invite-preview":n===u.GROUP_INVITE});i=r.createElement("img",{className:a,src:"data:image/jpeg;base64,"+t.thumbnail})}var s=t.title?r.createElement("div",{className:"link-preview-title",title:t.title},t.title):null,c=t.description?r.createElement("div",{className:"link-preview-description",title:t.description},t.description):null,d=l("link-preview-body",{nothumb:!i}),p=n===u.LINK?r.createElement("div",{className:"link-preview-source ellipsify"},o.hostname(t.canonicalUrl||t.matchedText)):null,h=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return r.createElement("div",{className:"link-preview-container",onClick:h},i,r.createElement("div",{className:d},s,c,p))}});d.Type=u,e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(45),c={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},l=r.createClass({displayName:"Menu",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,position:r.PropTypes.oneOf(_.values(c)).isRequired,onClick:r.PropTypes.func,isFocusedMsg:r.PropTypes.bool},click:function(){this.refs.context.click()},render:function(){var e=this.props,t=e.msg,n=e.position,i=e.onClick,a=t.isMedia,l=t.isSentByMe,u=t.isGroupMsg,d=t.type,p=!!t.quotedMsg,h=l?"context-out":"context-in",f=t.type===s["default"].TYPE.DOCUMENT&&!t.body,m=t.type===s["default"].TYPE.DOCUMENT&&t.body,g=d===s["default"].TYPE.LOCATION;a=a||m||g||p;var v;u&&(v=!l&&(n===c.FRONT||n===c.SINGLE),a=a&&!v);var y=d===s["default"].TYPE.CHAT&&t.matchedText&&t.matchedText.length&&t.body.indexOf(t.matchedText)>-1&&!v&&t.isTrusted(),E=o("js-context-icon",a&&d!==s["default"].TYPE.AUDIO?"context-icon-media":"context-icon"),_=o(h,{context:!(a||y),"context-media":a&&d!==s["default"].TYPE.AUDIO,"context-media-document":m,"context-ptt":d===s["default"].TYPE.PTT&&!p,"context-ptt-author":d===s["default"].TYPE.PTT&&v&&!p,"context-special":(y||f)&&!v&&!p,"context-doc":f&&!v&&!p,"context-inverse":d===s["default"].TYPE.CHAT&&!p&&!!t.dir&&t.rtl!==l10n.isRTL()});return r.createElement("div",{className:_},r.createElement("div",{className:E,ref:"context",onClick:i}))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1524),m=i(f),g=n(6),v=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"render",value:function(){var e=this,t=this.props.emojis,n=_.size(t);if(0===n)return null;var i=1===n?f.EMOJI_SIZE.XLARGE:f.EMOJI_SIZE.LARGE,a=t.map(function(t,n){return g.createElement(m["default"],{animation:e.props.animation,emoji:t,key:t+n,emojiSize:i})});return g.createElement("span",{className:"large-emoji-wrapper"},a)}}]),t}(g.Component);t["default"]=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(45),c=n(1316),l=n(1456),u=n(1331),d=n(1362),p=n(1317),h=n(1309),f=n(8),m=n(1589),g=r.createClass({displayName:"VCardList",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.node,displayAuthor:r.PropTypes.bool},getDefaultProps:function(){return{quotedMsg:null,displayAuthor:!1}},_showContactsModal:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},_renderProfilePics:function(){for(var e=_(this.props.msg.vcardList).map(function(e,t){var n=u.thumbnailWAid(u.vcardWAids(u.parse(e.vcard))),i=u.thumbnail(e.vcard);if(n||i)return r.createElement(d,{key:t,waid:n,thumb:i,className:"preview-vcard-multi preview-vcard",size:d.Size.NONE})}).filter().take(3).value(),t=Math.min(3-e.length,this.props.msg.vcardList.length-e.length),n=0;n<t;n++)e.push(r.createElement(d,{key:"default-"+n,className:"preview-vcard-multi preview-vcard",size:d.Size.NONE}));return e},render:function(){var e=this.props.msg,t=this.props.quotedMsg,n=o(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption}),i="vcard-avatar";t&&(i=o(i,"quoted-msg-bubble-vcard"));var a=this.props.displayAuthor&&c.shouldRender(e)?r.createElement(c,{msg:e}):null,s=null,u=l.getNameString(e.vcardList),f=t?r.createElement(d,{className:"preview-vcard",size:d.Size.NONE}):this._renderProfilePics();return r.createElement("div",{className:n},a,t,r.createElement("div",{className:"wrapper wrapper-vcard wrapper-vcard-multi",title:u,onClick:this._showContactsModal},r.createElement("div",{className:"vcard"},r.createElement("div",{className:i},f),r.createElement("div",{className:"vcard-body"},r.createElement(h,{text:u,element:"div",className:"vcard-name vcard-name-multi",dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15})))),s,r.createElement(p,{msg:e,contextMenu:this.contextMenu}))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1328),c=n(1309),l=n(1216),u=n(8),d=n(1578),p=r.createClass({displayName:"Notification",mixins:[l],propTypes:{text:r.PropTypes.string.isRequired,e2eSubtype:r.PropTypes.string,participantJid:r.PropTypes.string,chatId:r.PropTypes.string,type:r.PropTypes.string,subtype:r.PropTypes.string},onSecurityClick:function(){u.openModal(r.createElement(d,{e2eSubtype:this.props.e2eSubtype,jid:this.props.participantJid,chatId:this.props.chatId}))},render:function(){var e=null;this.props.type===s["default"].TYPE.CALL_LOG&&(e="miss_video"===this.props.subtype?r.createElement("span",{className:"icon icon-miss_video"}):r.createElement("span",{className:"icon icon-miss"}));var t=r.createElement(o,null,e,r.createElement(c,{direction:"auto",text:this.props.text})),n=!!this.props.e2eSubtype,i=n?r.createElement("button",{className:"message-system-e2e",onClick:this.onSecurityClick},t):r.createElement("span",{className:"message-system-body"},t);return i}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!e||!t)return C;var n=e/t,i=void 0;return i=n<=1?C:n<=2.4?t*(M/e):M/2.4,Math.round(i)}function s(e,t,n,i){return e&&t&&n&&i?t/e>i/n?{height:"100%"}:{width:"100%"}:{height:"100%",width:"100%"}}var r=n(1307),o=i(r),c=n(6),l=n(1310),u=n(1316),d=n(1382),p=n(45),h=n(8),f=n(1336),m=n(1337),g=n(1318),v=n(1357),y=n(1317),E=n(139),b=n(10),M=330,C=330,S=c.createClass({displayName:"Picture",mixins:[l],propTypes:{msg:c.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:c.PropTypes.element,isMsgVisible:c.PropTypes.func,displayAuthor:c.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){h.openModal(c.createElement(f,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;h.mediaViewerModal(n,i?this.getZoomNode:_.noop)},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){E.supportsFeature(E.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():h.openModal(c.createElement(m,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(b.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){return this.refs.img},render:function(){var e=this.props.msg,t=e.mediaData,n=e.caption?null:c.createElement("div",{className:"shade"}),i=e.caption?c.createElement(d,{msg:e}):null,r=t.renderableUrl||"data:image/jpeg;base64,"+t.preview,o=null,l=null;switch(t.mediaStage){case g.STAGE.RESOLVED:l=this.launchMediaViewer;break;case g.STAGE.FETCHING:o=c.createElement(v.PendingCancel,null),l=this.cancelDownload;break;case g.STAGE.NEED_POKE:o=c.createElement(v.Download,{filesize:t.size}),l=this.downloadMedia;break;case g.STAGE.UPLOADING:o=c.createElement(v.PendingCancel,null),l=this.cancelUpload;break;case g.STAGE.NEED_UPLOAD:o=c.createElement(v.Upload,{filesize:t.size}),l=this.resumeUpload;break;case g.STAGE.REMOTE_NEED_UPLOAD:o=c.createElement(v.Upload,{filesize:t.size}),l=this.resumeRemoteUpload;break;case g.STAGE.ERROR_MISSING:l=this.showMediaMissing;break;case g.STAGE.ERROR_UNSUPPORTED:o=c.createElement(v.Download,{filesize:t.size}),l=this.launchMediaViewer;break;default:o=c.createElement(v.Pending,null)}var h=p("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),f=p("image-thumb-body",{"image-thumb-lores":!t.renderableUrl}),m=this.props.displayAuthor&&u.shouldRender(e)?c.createElement(u,{msg:e}):null,E=M,_=a(t.thumbWidth,t.thumbHeight),b={width:E,height:_},C=t.fullHeight||t.thumbHeight,S=t.fullWidth||t.thumbWidth,T=s(C,S,_,E);return c.createElement("div",{className:h,onClick:this.stopEvent},m,this.props.quotedMsg,c.createElement("div",{className:"image-thumb",onClick:l,style:b},o,c.createElement("img",{src:r,onDragStart:this.onDragStart,className:f,style:T,ref:"img"}),n),i,c.createElement(y,{msg:e}))}});e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(10),c=n(1310),l=n(1317),u=n(1316),d=n(1383),p=n(1420),h=n(1337),f=n(8),m=n(139),g=n(1318),v=n(1336),y=n(142),E=r.createClass({displayName:"PTT",mixins:[c],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaStage:"msg.mediaData.mediaStage",img:"msg.sender.ProfilePicThumb.img",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){f.openModal(r.createElement(v,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){m.supportsFeature(m.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(h,{msg:this.props.msg}))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(y,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===o.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e=this.props.msg,t=e.mediaData,n=this.getStatusClass("bubble bubble-attach bubble-audio"),i="audio-status icon ";i+=this.state.ack===o.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var a,s=r.createElement("span",{className:i,key:"status"}),c=this.state.playing?this.state.currentTime:t.duration,h=r.createElement(d,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,thumb:this.state.img,type:t.type,shade:!1,duration:c}),f=e.isSentByMe?[h,s]:null,m=e.isSentByMe?null:[h,s],v=e.isSentByMe?"text no-author":"text";switch(t.mediaStage){case g.STAGE.RESOLVED:a=r.createElement(p,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case g.STAGE.NEED_POKE:a=this.loader(this.downloadMedia,"icon-audio-download");break;case g.STAGE.NEED_UPLOAD:a=this.loader(this.resumeUpload,"icon-audio-upload");break;case g.STAGE.REMOTE_NEED_UPLOAD:a=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case g.STAGE.ERROR_MISSING:a=this.loader(this.showMediaMissing,"icon-audio-play");break;default:a=this.loader(null,null,!0)}var y=this.props.displayAuthor&&u.shouldRender(e)?r.createElement(u,{msg:e,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:n},this.props.quotedMsg?y:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},f,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:y,r.createElement("div",{className:v},a)),m,r.createElement(l,{msg:e})))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1317),c=n(1316),l=n(45),u=r.createClass({displayName:"Revoked",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&c.shouldRender(e),n=t?r.createElement(c,{msg:e}):null,i=l("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},l10n.t("revoked_msg")))),r.createElement(o,{msg:e}))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1310),c=n(45),l=r.createClass({displayName:"Status",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},render:function(){var e=this.props.msg,t=e.ack,n=e.isMedia&&!e.caption&&e.type!==s["default"].TYPE.AUDIO||e.type===s["default"].TYPE.LOCATION&&!e.get("loc"),i="icon",a=void 0;return a=t<1?n?"icon-msg-time-light":"icon-msg-time":1===t?n?"icon-msg-check-light":"icon-msg-check":2===t?n?"icon-msg-dblcheck-light":"icon-msg-dblcheck":n?"icon-msg-dblcheck-ack-light":"icon-msg-dblcheck-ack",i=c("icon",a),r.createElement("span",{onClick:this.openInfoDrawer,className:i})}});e.exports=l},function(e,t,n){"use strict";var i=n(6),a=n(1328),s=n(1309),r=n(104),o=i.createClass({displayName:"StickyDateMarker",proptypes:{},getInitialState:function(){return{date:null,hide:!1}},updateDateMarkerText:function(e){this.setState({date:e})},hideStickyDateMarker:function(e){this.state.hide!==e&&this.setState({hide:e})},render:function(){var e=void 0;
return this.state.date&&!this.state.hide&&(e=i.createElement("div",{className:"msg sticky-date-marker-floating-container"},i.createElement("div",{className:"sticky-date-marker-floating-wrapper"},i.createElement("span",{className:"message-system-body"},i.createElement(a,null,i.createElement(s,{direction:"auto",text:this.state.date})))))),i.createElement(r,{transitionName:"slide-down-date"},e)}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(86),s=i(a),r=n(1307),o=i(r),c=n(1527),l=i(c),u=n(6),d=n(1316),p=n(1317),h=n(1525),f=n(1417),m=n(1309),g=n(45),v=n(1216),y=n(220),E=y.parseCmd,_=y.Cmd,b=n(217),M=n(433),C=u.createClass({displayName:"Text",mixins:[v],propTypes:{msg:u.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:u.PropTypes.element,senderName:u.PropTypes.string,displayAuthor:u.PropTypes.bool,trusted:u.PropTypes.bool},render:function(){var e=this.props,t=e.msg,n=e.displayAuthor,i=e.trusted,a=n&&d.shouldRender(t),r=g("bubble","bubble-text",{"bubble-broadcast":t.broadcast,"bubble-star":t.star,"has-author":a}),o=a?u.createElement(d,{msg:t,className:this.props.quotedMsg?"text-author-quoted-msg":null}):null,c=void 0,v=void 0;if(i&&t.linkPreview){var y=E(t.matchedText),C=(0,s["default"])(y,1),S=C[0];if(S===_.GROUP_INVITE){c=u.createElement(h,{msg:t,type:h.Type.GROUP_INVITE});var T=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)},w=t.isSentByMe?b.t("group_invite_view"):b.t("group_invite_join");v=u.createElement("div",{className:"bubble-actions"},u.createElement("div",{className:"bubble-btn",onClick:T,title:w},w))}else c=u.createElement(h,{msg:t})}var k=void 0,P=void 0,N=t.mentionMap(),O=M.getMatchedEmojis(t.body);if(O){k=g("message-text","large-emoji-text",{"one-emoji-text":1===O.length,"two-emoji-text":2===O.length,"three-emoji-text":3===O.length});var D="❤"===O[0];P=u.createElement(l["default"],{animation:D,emojis:O})}else k=g("message-text"),P=u.createElement(m,{text:t.body,selectable:!0,dirMismatch:t.rtl!==b.isRTL(),direction:t.dir,linkify:i,mention:N,format:!0,wbr:15});return u.createElement("div",{className:r},o,this.props.quotedMsg,u.createElement("div",{className:k,"data-id":t.id},c,u.createElement(f,{msg:t}),P),u.createElement(p,{msg:t}),v)}});e.exports=C},function(e,t,n){"use strict";var i=n(6),a=n(1328),s=i.createClass({displayName:"Unread",propTypes:{count:i.PropTypes.number.isRequired},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return i.createElement("span",{className:"msg-unread-body"},i.createElement(a,null,e))}});e.exports=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1317),c=n(1316),l=n(45),u=r.createClass({displayName:"UnsupportedMsg",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&c.shouldRender(e),n=t?r.createElement(c,{msg:e}):null,i=l("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:"icon icon-unknown placeholder-icon"}),r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},e.isSentByMe?l10n.t("unsupported_msg_send"):l10n.t("unsupported_msg")))),r.createElement(o,{msg:e}))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(45),c=n(1316),l=n(1317),u=n(8),d=n(1331),p=n(1309),h=n(1362),f=n(140),m=n(1598),g=n(1546),v=n(1574),y=r.createClass({displayName:"Vcard",mixins:[f],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},onMessageClick:function(){var e=this.props.msg.getWAids();e.length>1?u.openModal(r.createElement(m,{vCard:this.props.msg.vcard,onCancel:u.closeModal.bind(u),onSelect:this.openContactChat})):this.openContactChat(_.first(e))},openContactChat:function(e){Store.Chat.find(e).then(function(e){u.closeModal(),u.openChatFromUnread(e).then(function(t){t&&u.focusChatTextInput(e)})})},viewContact:function(){u.openModal(r.createElement(v,{msg:this.props.msg}))},onAddToGroupClick:function(){var e=this.props.msg.getWAids();e.length>1?u.openModal(r.createElement(m,{vCard:this.props.msg.vcard,onCancel:u.closeModal.bind(u),onSelect:this.addContactToGroup,iconClass:"icon icon-add-user"})):this.addContactToGroup(_.first(e))},addContactToGroup:function(e){Store.Contact.find(e).then(function(e){u.openModal(r.createElement(g,{contact:e}),"modal-flow")})},render:function(){var e=this.props.msg,t=e.getWAids(),n="vcard-avatar vcard-avatar-single";this.props.quotedMsg&&(n=o(n,"quoted-msg-bubble-vcard"));var i=o(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption}),a=void 0;t.length>0&&(a=r.createElement("div",{className:"bubble-actions"},r.createElement("div",{className:"bubble-btn",onClick:this.onMessageClick,title:l10n.t("message_author",{author:e.subtype})},l10n.t("message")),r.createElement("div",{className:"bubble-btn",onClick:this.onAddToGroupClick,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var s=this.props.displayAuthor&&c.shouldRender(e)?r.createElement(c,{msg:e}):null;return r.createElement("div",{className:i},s,this.props.quotedMsg,r.createElement("div",{className:"wrapper wrapper-vcard",onClick:this.viewContact},r.createElement("div",{className:"vcard"},r.createElement(h,{className:n,thumb:d.thumbnail(e.body),waid:e.getVCardThumbnailWAid()}),r.createElement("div",{className:"vcard-body"},r.createElement(p,{text:e.subtype,element:"div",className:"vcard-name vcard-name-single",selectable:!0,dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15})))),a,r.createElement(l,{msg:e,contextMenu:this.contextMenu}))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1310),c=n(141),l=n(1318),u=n(1357),d=n(1382),p=n(1317),h=n(1316),f=n(8),m=n(1336),g=n(1337),v=n(139),y=n(143),E=n(1349),b=n(428),M=r.createClass({displayName:"Video",mixins:[o,c],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,isMsgVisible:r.PropTypes.func,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},showMediaMissing:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){v.supportsFeature(v.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(g,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},downloadUnsupportedToDesktop:function(e){var t=this;e&&e.stopPropagation(),f.openModal(r.createElement(b,{onCancel:f.closeModal.bind(f),onOK:function(){f.closeModal(),E.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},launchMediaViewer:function(e){var t=this.props,n=t.msg,i=t.isMsgVisible;n.downloadMedia(),e&&e.stopPropagation(),f.mediaViewerModal(n,i?this.getZoomNode:_.noop)},stopEvent:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=null,n=null;switch(e.mediaData.mediaStage){case l.STAGE.RESOLVED:case l.STAGE.INIT:t=r.createElement(u.Play,null),n=this.launchMediaViewer;break;case l.STAGE.NEED_POKE:t=r.createElement(u.Download,{filesize:e.size}),n=this.downloadMedia;break;case l.STAGE.UPLOADING:t=r.createElement(u.PendingCancel,null),n=this.cancelUpload;break;case l.STAGE.NEED_UPLOAD:t=r.createElement(u.Upload,{filesize:e.size}),n=this.resumeUpload;break;case l.STAGE.REMOTE_NEED_UPLOAD:t=r.createElement(u.Upload,{filesize:e.size}),n=this.resumeRemoteUpload;break;case l.STAGE.ERROR_MISSING:n=this.showMediaMissing;break;case l.STAGE.ERROR_UNSUPPORTED:e.isUnsentMedia||(t=r.createElement(u.Download,{filesize:e.size}),n=this.downloadUnsupportedToDesktop);break;default:t=r.createElement(u.Pending,null)}var i=null,a=y.durationStr(e.duration);a&&(i=r.createElement("span",{className:"message-duration"},r.createElement("span",{className:"icon-s icon-msg-video-light"}),a));var s={backgroundImage:'url("data:image/jpeg;base64,'+e.body+'")'},o=r.createElement("div",{className:"image-thumb-body",style:s}),c=this.props.displayAuthor&&h.shouldRender(e)?r.createElement(h,{msg:e}):null,f=r.createElement("div",{className:"shade"}),m=e.caption?r.createElement(d,{msg:e}):null,g=m?"bubble-image bubble-video bubble-image-caption":"bubble-image bubble-video";return r.createElement("div",{onClick:this.stopEvent},r.createElement("div",{className:g},c,this.props.quotedMsg,r.createElement("div",{className:"image-thumb",onClick:n},t,o,f,i),m,r.createElement(p,{msg:this.props.msg})))}});e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1307),m=i(f),g=n(6),v=n(38),y=n(1520),E=n(1536),b=n(1363),M=n(45),C=n(143),S=n(1369),T=(n(1320),n(10)),w={KEEP_SCROLL_BOTTOM:"KEEP_SCROLL_BOTTOM",KEEP_SCROLL_TOP:"KEEP_SCROLL_TOP",SCROLL_BOTTOM:"SCROLL_BOTTOM",NONE:"NONE",DEFAULT:"DEFAULT"},k={};k[w.KEEP_SCROLL_BOTTOM]=2,k[w.KEEP_SCROLL_TOP]=2,k[w.SCROLL_BOTTOM]=2,k[w.NONE]=1,k[w.DEFAULT]=0;var P=function(e){function t(e){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).call(this,e))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return e.updateType!==w.NONE}},{key:"componentWillUpdate",value:function(e){var t=v.findDOMNode(this).parentNode,n=e.updateType;n===w.KEEP_SCROLL_BOTTOM?this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight:n===w.KEEP_SCROLL_TOP&&(this.shouldRestoreScroll=t.scrollTop)}},{key:"componentDidMount",value:function(){this.maybeNotifyChatRendered()}},{key:"componentDidUpdate",value:function(e){var t=v.findDOMNode(this).parentNode;this.props.updateType===w.SCROLL_BOTTOM?t.scrollTop=t.scrollHeight:void 0!==this.shouldRestoreScroll&&(this.props.updateType===w.KEEP_SCROLL_BOTTOM?t.scrollTop=t.scrollHeight-this.shouldRestoreScroll-t.clientHeight:t.scrollTop=this.shouldRestoreScroll,this.shouldRestoreScroll=void 0),this.maybeNotifyChatRendered()}},{key:"maybeNotifyChatRendered",value:function(){this.props.notifyChatRendered&&(this.props.focusedMsgCtx&&this.props.focusedMsgCtx.msg&&!_.includes(this.props.msgs,this.props.focusedMsgCtx.msg)||this.props.notifyChatRendered())}},{key:"onCopy",value:function(e){var t=window.getSelection();e.clipboardData.setData("text/plain",S.asPlainText(t)),e.stopPropagation(),e.preventDefault()}},{key:"getMsgVisibility",value:function(e){var t=v.findDOMNode(this).parentNode,n=t.scrollTop,i=n+t.clientHeight,a=v.findDOMNode(e);return a.offsetTop+a.clientHeight<=n?{visibility:T.VISIBILITY.ABOVE,offset:a.offsetTop-n}:a.offsetTop>=i?{visibility:T.VISIBILITY.BELOW,offset:a.offsetTop-n}:{visibility:T.VISIBILITY.VISIBLE,offset:a.offsetTop-n}}},{key:"render",value:function(){var e,t,n=[],i=this.props.msgs,a=this.props,s=a.focusedMsgCtx,r=a.unreadCount,o=a.selectedMessages,c=!1,l=void 0,u=0;for(t=0;t<i.length;t++)if(e=i[t]){var d=C.dayOfMsg(e);0!==t&&l===d||(n.push(g.createElement(y,{ref:"dateMarker_"+u,key:"msg-"+e.id+"-date",timestamp:e.t})),c=!1,u+=1),l=d,r>0&&s&&s.isUnreadDivider&&s.msg===e&&(n.push(g.createElement("div",{className:"msg-unread",key:"msg-unread"},g.createElement(E,{count:r}))),c=!1);var p=_.matches({from:e.from,startOfDay:e.startOfDay}),h=_.matches({author:e.author,startOfDay:e.startOfDay}),f=e.isGroupMsg?h:p,v=b.Position.SINGLE,S=i[t+1];(S&&r&&s&&s.isUnreadDivider&&s.msg===S||S&&S.isNotification||S&&d!==C.dayOfMsg(S))&&(S=!1),e.isNotification?v=b.Position.SINGLE:f(S)&&!f(c)?v=b.Position.FRONT:f(c)&&f(S)?v=b.Position.MID:f(c)&&!f(S)&&(v=b.Position.END);var w=s&&s.msg===e,k=e.type===m["default"].TYPE.IMAGE||e.type===m["default"].TYPE.VIDEO||e.type===m["default"].TYPE.AUDIO;n.push(g.createElement(b,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,displayType:T.DISP_TYPE.CONVERSATION,isMsgVisible:k?this.props.isMsgVisible:_.noop,selectable:this.props.selectable,selectedMessages:o,onMessageSelect:this.props.onMessageSelect,position:v,isFocusedMsg:w})),c=!e.isNotification&&e}var P=M("message-list",{selectable:this.props.selectable});return g.createElement("div",{className:P,onCopy:this.onCopy.bind(this)},n)}}]),t}(g.Component);P.UpdateTypes=w,P.UpdateTypePriority=k,e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1308),o=i(r),c=n(1353),l=n(6),u=n(1),d=n(8),p=n(1314),h=n(141),f=n(144),m=n(14),g=n(1345),v=n(1371),y=n(1637),E=n(0),b=n(51),M=n(216),C=n(104),S=l.createClass({displayName:"PTT",mixins:[f,h,p],propTypes:{chat:l.PropTypes.instanceOf(o["default"]),onStateChange:l.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:S.READY,active:void 0,elapsedTime:0,startTime:0}},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===S.REC||e===S.DELAY||e===S.PROCESSSING},cancelRecording:function(){this.isRecording()&&(this.state.state!==S.READY&&this.props.onStateChange(S.READY),this.safeIsMounted()&&this.setState({state:S.READY,active:void 0,elapsedTime:0,startTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,this.recorder&&this.recorder.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3),this.setState({elapsedTime:0,startTime:Date.now()})},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===S.DELAY&&this.setState({state:S.REC})},onMouseOverSend:function(){this.setState({active:S.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:S.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),this.cancelRecording())},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;if(this.state.state===S.REC){this.setState({state:S.PROCESSSING}),this.props.onStateChange(S.READY);var n=t.regCancellablePromise(b.waitForEvent(this.recorder,"dataAvailable").then(function(e){return e.detail}));(0,c.prepRawMedia)(n,{isPtt:!0,precomputedDuration:~~this.recorder.duration}).sendToChat(t,{quotedMsg:t.composeQuotedMsg||void 0,addEvenWhilePreparing:!0}),t.composeQuotedMsg=null,n["catch"](s["default"].CancellationError,_.noop)["finally"](function(){e.cancelRecording()}),this.recorder.stop()}else this.cancelRecording(),u.log("ptt:onMouseUpSend duration too short")()}},onMouseDown:function(){var e=this;if(this.state.state===S.READY){var t=v.start("microphone");s["default"].race([t,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(t){e.recorder=new y({bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),e.recorder.initStream(t),e.recorder.start(),e.props.chat.presence.update()["catch"](m.WapDrop,_.noop),e.props.chat.markRecording(),e.setState({state:S.DELAY}),e.props.onStateChange(S.REC),e.pttTimer=e.safeDelay(e.onPTTReady,1500),e.startInterval()})["catch"](m.Unmount,function(){t.then(function(e){return v.stop(e)})["catch"](_.noop)})["catch"](m.GUM.PermissionDeniedError,function(){d.openModal(l.createElement(g,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:g.TYPE.GUIDE_UNBLOCK}))})["catch"](m.GUM.GUMError,function(){d.openModal(l.createElement(g,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:g.TYPE.GUIDE_NONE}))})["catch"](function(t){e.recorder&&e.recorder.stop(),u.error("PTT Recording Error")(t)})}},render:function(){var e="btn-close btn-border ptt-close";this.state.active===S.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===S.SEND&&(t+=" is-hover");var n=void 0;this.state.state!==S.DELAY&&this.state.state!==S.REC||(n=l.createElement(M,{displayName:"PTT",popable:!0,escapable:!0,requestDismiss:this.cancelRecording},l.createElement("div",{className:"ptt-recording",key:"recording"},l.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},l.createElement("span",{className:"icon icon-round-x btn-state-default"}),l.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),l.createElement("div",{className:"ptt-counter"},E.unix(this.state.elapsedTime).format("m:ss")),l.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},l.createElement("span",{className:"icon icon-round-send btn-state-default"}),l.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"})))));var i=this.state.state===S.READY||this.state.state===S.PROCESSSING?l.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===S.PROCESSSING,key:"button"}):null,a="ptt-container";return n&&(a+=" active"),l.createElement("div",{className:a},l.createElement(C,{transitionName:"ptt"},n||i))}});e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1308),o=i(r),c=n(6),l=n(428),u=n(8),d=n(140),p=n(51),h=c.createClass({displayName:"Spam",mixins:[d],propTypes:{chat:c.PropTypes.instanceOf(o["default"]).isRequired},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove reset"),this.addObserver(this.props.chat,"change:trusted")},confirmReportGroupSpam:function(){u.openModal(c.createElement(l,{onOK:this.reportGroupSpam,okText:l10n.t("report_group_spam"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("report_group_spam_ack")))},reportGroupSpam:function(){var e=this.props.chat,t=e.sendSpamReport(!0);if(!e.isReadOnly){var n=e.sendExit(),i=p.waitForBBEvent(e.msgs,"change:last",function(e){return e.isGroupLeave()});t=s["default"].all([t,n,i])}t.then(function(){return e.sendDelete()})["catch"](_.noop),u.closeModal()},confirmReportSpam:function(){u.openModal(c.createElement(l,{onOK:this.reportSpam,okText:l10n.t("report_spam"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("report_spam_ack")))},reportSpam:function(){var e=this.props.chat;e.sendSpamReport().then(function(){return e.contact.setBlock(!0)}).then(function(){return e.sendDelete()})["catch"](_.noop),u.closeModal()},notSpam:function(){this.props.chat.sendNotSpam(!0)["catch"](_.noop)},confirmBlock:function(){u.openModal(c.createElement(l,{onOK:this.block,okText:l10n.t("block"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("block_ack")))},block:function(){this.props.chat.contact.setBlock(!0)["catch"](_.noop),u.closeModal()},confirmUnblock:function(){u.openModal(c.createElement(l,{okText:l10n.t("unblock_button"),onOK:this.unblock,cancelText:l10n.t("web_cancel"),onCancel:u.closeModal.bind(u)},l10n.t("unblock_confirmation",{contact:this.props.chat.contact.formattedName})))},unblock:function(){this.props.chat.contact.setBlock(!1)["catch"](_.noop),u.closeModal()},render:function(){var e=this.props.chat;if(e.isPSA||!e.isVisible||e.trusted)return null;var t,n=[];if(e.isGroup)t=l10n.t("group_admin_not_a_contact"),n.push(c.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportGroupSpam},l10n.t("report_spam")));else{t=l10n.t("sender_not_a_contact"),n.push(c.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportSpam},l10n.t("report_spam")));var i=Store.Blocklist.get(e.id);i?n.push(c.createElement("button",{onClick:this.confirmUnblock,key:"unblock",className:"spam-button btn-plain"},l10n.t("unblock_button"))):n.push(c.createElement("button",{onClick:this.confirmBlock,key:"block",className:"spam-button btn-plain"},l10n.t("block")))}return n.push(c.createElement("button",{onClick:this.notSpam,key:"not_spam",className:"spam-button btn-plain"},l10n.t("not_spam"))),c.createElement("div",{className:"spam"},c.createElement("div",{className:"spam-text"},t),c.createElement("div",{className:"spam-controls"},n))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1308),o=i(r),c=n(6),l=n(38),u=n(140),d=n(84),p=n(1347),h=n(1514),f=n(1515),m=n(1415),g=n(1448),v=n(8),y=n(52),E=n(104),b=n(1320),M=n(1310),C=n(10),S=n(1478),T=n(216),w=c.createClass({displayName:"ConversationPanel",mixins:[u,M,d],propTypes:{chat:c.PropTypes.instanceOf(o["default"]).isRequired,msgCollection:c.PropTypes.instanceOf(p).isRequired,focusCtx:c.PropTypes.object,notifyChatRendered:c.PropTypes.func,updateOpenedChatInfo:c.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.chat;return this.fillerHeight=e.fillerHeight||0,this.selectedMessages=new b([],function(e){return e.id.toString()}),{canCompose:e.canSend,selectable:!1,wallpaperColor:this.async("chat.ChatPreference.wallpaperColor")}},componentWillMount:function(){var e=this.props.chat;e.fillerHeight=null,this.addObserver(e,"change:canSend",this.onComposeState),this.openEvent=new y.WebcChatOpen({webcUnreadCount:e.unreadCount})},componentDidMount:function(){var e=this.props.chat;e.set({active:!0,viewed:!0}),this.openEvent&&(this.openEvent.markWebcChatOpenT(),this.openEvent.commit(),delete this.openEvent),this.addObserver(Store.ChatPreference,"wallpaper_color_preview",this.onWallpaperColorPreview),this.regCmd("scroll_messages",this.scrollMessages)},componentWillUnmount:function(){this.props.chat.set("active",!1)},onComposeState:function(){var e=this.props.chat.canSend;this.state.canCompose!==e&&this.setState({canCompose:e})},onComposeHeightChange:function(e,t){var n=this,i=e.input,a=e.overlay,r=l.findDOMNode(this.refs.msgPanel);if(r&&this.refs.msgs){var o=this.refs.msgs.getScrollBottom();if(_.isNumber(i))return void this.refs.msgs.composeHeightChange(i);if(t)return this.fillerHeight=a,void(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px",this.refs.msgs.setScrollBottom(o)));this.fillerHeight+=a,a<0&&(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px"),this.refs.msgs&&this.refs.msgs.setScrollBottom(o)),this.msgPanelAnimation||(this.msgPanelAnimation=s["default"].resolve()),this.msgPanelAnimation.cancel(),this.msgPanelAnimation=this.msgPanelAnimation.then(function(){return Velocity(r,{translateY:a>0?[-a,0]:[0,a]},{duration:300,easing:[.1,.82,.25,1]})}).then(function(){return n.msgPanelAnimation=null}).cancellable()["catch"](s["default"].CancellationError,function(){Velocity(r,"finish",!0),r.style.transform=""}).then(function(){n.isMounted()&&(a>0&&n.refs.filler&&(n.refs.filler.style.height=n.fillerHeight+"px"),r.style.transform="",n.refs.msgs&&a>0&&n.refs.msgs.setScrollBottom(o))})}},onWallpaperColorPreview:function(e){e?this.state.wallpaperColor!==e&&this.setState({wallpaperColor:e}):this.setState({wallpaperColor:Store.ChatPreference.get("defaultPreference").wallpaperColor})},onSelectMessages:function(){this.state.selectable||this.setState({selectable:!0})},onCancelSelection:function(){this.state.selectable&&(this.selectedMessages.unsetAll(),this.setState({selectable:!1}))},onMessageSelect:function(e,t){this.onSelectMessages(),this.selectedMessages.setVal(e,t)},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},scrollMessages:function(){var e=this.refs.msgs,t=e&&e.refs.scrollContainer;if(t){var n=_.last(e.msgListInfo.visibleMsgOrder);if(n){var i=l.findDOMNode(e.refs.messageList.refs[n.toString()]);if(i){var a=0;1===e.msgListInfo.visibleMsgOrder.length&&(a=i.clientHeight),Velocity(i,"stop"),Velocity(t,"stop"),Velocity(i,"scroll",{duration:300,container:t,offset:a})}}}},onDragStart:function(e){this.state.canCompose&&(this.blockDrop=!0)},onDragEnd:function(e){this.state.canCompose&&(this.blockDrop=!1)},onDragEnter:function(e){this.state.canCompose&&!this.blockDrop&&(_.includes(e.dataTransfer.types,"Files")||_.includes(e.dataTransfer.types,"text/uri-list")||_.includes(e.dataTransfer.types,"text/html"))&&(v.attachMediaDrawer(this.props.chat),e.stopPropagation(),e.preventDefault())},render:function(){var e,t,n,i=this.props,a=i.chat,s=i.msgCollection,r=i.focusCtx;if(this.state.selectable)t=c.createElement(T,{displayName:"MultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},c.createElement(g,{chat:a,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})),e=c.createElement("footer",{className:"pane-footer pane-chat-footer"}),n=c.createElement("div",{ref:"filler",className:"compose-filler"});else if(this.state.canCompose)e=c.createElement(m,{chat:a,ref:"composeBox",onComposeHeightChange:this.onComposeHeightChange,onPageUpDown:this.onPageUpDown}),n=c.createElement("div",{ref:"filler",style:{height:this.fillerHeight+"px"},className:"compose-filler"});else{var o;o=a.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):a.isPSA?l10n.t("web_psa_title"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:a.contact.formattedName}),e=c.createElement("footer",{className:"pane-footer pane-chat-footer"},c.createElement("div",{className:"block-message"},o))}var l={},u={};return this.state.wallpaperColor!==C.DEFAULT_CHAT_WALLPAPER&&(l.background=this.state.wallpaperColor,l.transition="background 0.3s ease",u.display="none"),c.createElement(T,{displayName:"ConversationPanel",state:T.State.INACTIVE,requestFocus:this.requestFocus},c.createElement("div",{id:"main",className:"pane pane-chat pane-two"},c.createElement("div",{className:"pane-chat-tile",style:u}),c.createElement(h,{chat:a,canAttach:this.state.canCompose,onSelectMessages:this.onSelectMessages}),c.createElement("div",{className:"pane-body pane-chat-tile-container",ref:"msgPanel",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragOver:this.onDragOver,onDragEnter:this.onDragEnter,style:l},c.createElement(f,{ref:"msgs",chat:a,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:s,onSelectMessages:this.onSelectMessages,focusCtx:r,selectedMessages:this.selectedMessages,notifyChatRendered:this.props.notifyChatRendered,updateOpenedChatInfo:this.props.updateOpenedChatInfo})),n,e,c.createElement(E,{transitionName:"slide-up"},t),c.createElement(S,null)))}});e.exports=w},function(e,t,n){"use strict";var i=n(6),a=n(38),s=n(104),r=n(84),o=n(216),c=n(446),l=n(45),u=n(1220),d=n(31),p=n(82),h=n(83),f={LEFT:"drawer-left",MID:"slide-up",RIGHT:"slide-left",NONE:"none"},m={LEFT:"left",MID:"mid",RIGHT:"right"},g=function(e){return f[e.toUpperCase()]},v=i.createClass({displayName:"DrawerManager",mixins:[r],propTypes:{direction:i.PropTypes.oneOf(d.values(m)),onDrawerIn:i.PropTypes.func,onDrawerOut:i.PropTypes.func,onDrawerAnimationComplete:i.PropTypes.func},getChildContext:function(){var e=this.state.uim||this.context.uim;return{uim:e}},getInitialState:function(){return{drawer:void 0,drawerId:0,transition:g(this.props.direction),uim:void 0}},componentWillMount:function(){this.regCmd("open_drawer_"+this.props.direction,this.openFlow),this.regCmd("exists_drawer_"+this.props.direction,this.existsFlow),this.regCmd("close_drawer_"+this.props.direction,this.closeFlow)},shouldComponentUpdate:function(e,t){return u(this,e,t)},openFlow:function(e){var t=arguments.length<=1||void 0===arguments[1]?g(this.props.direction):arguments[1],n=arguments[2],i=arguments[3];this.state.drawer?t=f.NONE:this.props.onDrawerIn&&this.props.onDrawerIn();var a=i&&i.drawerId||d.uniqueId("DrawerManager"+this.props.direction);this.setState({drawer:e,drawerId:a,transition:t,uim:n,option:i})},existsFlow:function(e){e(!!this.state.drawer)},closeFlow:function(e){e&&this.state.drawerId!==e||this.state.drawer&&(this.props.onDrawerOut&&this.props.onDrawerOut(),this.setState({drawer:void 0}))},requestFocus:function(e){var t=a.findDOMNode(this.refs.UIE);t&&!t.contains(document.activeElement)&&p.focus(t)},render:function(){var e=this.props,t=e.onDrawerAnimationComplete,n=e.direction,a=this.state,r=a.drawer,u=a.drawerId,p=a.transition,h=a.option,f=h&&h.noFocus?null:this.requestFocus;r&&(r=i.createElement(o,{displayName:"Drawer"+d.upperFirst(n),escapable:!0,key:u,ref:"UIE",requestFocus:f,requestDismiss:this.closeFlow.bind(null,u)},i.createElement(c,{style:{height:"100%"}},r)));var g=l("pane",{"pane-one":n===m.LEFT,"pane-two":n===m.MID,"pane-three":n===m.RIGHT});return i.createElement(s,{transitionName:p,className:g,onAnimationComplete:t},r)}});v.contextTypes={uim:i.PropTypes.instanceOf(h)},v.childContextTypes={uim:i.PropTypes.instanceOf(h)},v.Dir=m,v.Transition=f,e.exports=v},function(e,t,n){"use strict";var i=n(6),a=n(84),s=n(141),r=n(144),o=n(433),c=n(1374),l=n(85),u=n(444),d=n(82),p=n(1370),h=i.createClass({displayName:"EmojiInput",mixins:[a,s,r],propTypes:{focusOnMount:i.PropTypes.bool,editable:i.PropTypes.bool,format:i.PropTypes.bool,value:i.PropTypes.string,selection:i.PropTypes.object,className:i.PropTypes.string,placeholder:i.PropTypes.string,onKeyPress:i.PropTypes.func,onEnter:i.PropTypes.func,onChange:i.PropTypes.func,onFocus:i.PropTypes.func,onBlur:i.PropTypes.func,onFiles:i.PropTypes.func,onMouseDown:i.PropTypes.func,onSelectionChange:i.PropTypes.func,maxLength:i.PropTypes.number,multiline:i.PropTypes.bool,spellCheck:i.PropTypes.bool,focusOnChange:i.PropTypes.bool},getDefaultProps:function(){return{editable:!0,format:!1,value:"",focusOnChange:!0}},getInitialState:function(){return this.value=this.props.value||"",this.selection=this.props.selection,null},componentWillMount:function(){this.debouncedSaveSelection=this.safeDebounce(this._saveSelection,0)},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.props.focusOnChange&&this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input;t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input;document.activeElement!==t&&(d.focus(t),this.selection&&!e?this.restoreSelection(this.selection):this._moveCursorToEnd(t),this.debouncedSaveSelection())}},_moveCursorToEnd:function(e){if(e){var t=window.getSelection();t&&(t.selectAllChildren(e),t=window.getSelection(),t&&t.rangeCount&&t.collapseToEnd())}},componentDidMount:function(){this.props.focusOnMount&&this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.refs.input.restoreFocus=this.restoreFocus,this.refs.input.pasteText=this.pasteText},componentWillUnmount:function(){this.refs.input.restoreFocus=null},_disableObjectResize:function(){l.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var n=this.selectionLength(),i=n+t-c.multibyteLength(this.value);return i>0?c.multibyteSubstr(e,0,i):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),
this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.debouncedSaveSelection()},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){if(l.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.setNewValue("",!0,!0)}}this.debouncedSaveSelection()},onKeyPress:function(e){if(l.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){var t=e.ctrlKey||e.shiftKey||e.altKey;if(!this.props.multiline&&"Enter"===e.key||this.props.multiline&&"Enter"===e.key&&!t)return e.preventDefault(),void(this.props.onEnter&&this.props.onEnter(e));var n=this.limitLength(u.ucs2.encode([e.charCode]));this.props.multiline&&"Enter"===e.key&&t&&(this.replaceSelection("\n",!0),e.preventDefault()),n.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input;e=_.isBoolean(e)?e:void 0,this.setNewValue(o.NodeToEmoji(t),!0,e)},setNewValue:function(e,t,n){if(e!==this.value||n){if(e&&!this.value){var i=this.refs.placeholder;i&&(i.style.display="none")}else if(this.value&&!e){var a=this.refs.placeholder;a&&(a.style.display="")}this.value=e,t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.debouncedSaveSelection()}},updateDOM:function(){var e=o.emojiToHTML(_.escape(this.value)),t=this.refs.input;t.innerHTML!==e&&(t.innerHTML=e)},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input;d.focus(e);var t=window.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);return c.multibyteLength(o.NodeToEmoji(n.cloneContents()))}return 0},_saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(!this.isMounted())return-1;var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=e.childNodes,s=0;e===n&&(n=a[i]);for(var r=0;r<a.length;r++){var o=a[r];if(o===n)return s+i;o.nodeType===window.Node.ELEMENT_NODE&&o.alt?s+=o.alt.length:o.nodeType===window.Node.TEXT_NODE&&(s+=o.length)}return s},isAtBeginning:function(){return this.isCollapsed()&&0===this.getCursor()},isAtEnd:function(){return this.isCollapsed()&&this.getCursor()===this.value.length},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=t.focusNode,s=t.focusOffset,r=e.childNodes,o=-1,c=-1,l=!1,u=!1,d=0;d<r.length;d++){var p=r[d];if(p===n&&(o=d,l=!0),p===a&&(c=d,u=!0),l&&u)break}return{anchor:{index:o,offset:i},focus:{index:c,offset:s}}},restoreSelection:function(e){var t,n,i,a,s,r,o=this.refs.input,c=o.childNodes;e.anchor.index===-1?(t=o,i=e.anchor.offset,s=0):(t=c[e.anchor.index],i=e.anchor.index,s=e.anchor.offset),e.focus.index===-1?(n=o,a=e.focus.offset,r=0):(n=c[e.focus.index],a=e.focus.index,r=e.focus.offset);var u;u=i===a?r>=s?"forward":"reverse":i>a?"reverse":"forward";var d=window.getSelection();if(t&&n)try{var p=document.createRange();return void(l.isTrident?("forward"===u?(p.setStart(t,e.anchor.offset),p.setEnd(n,e.focus.offset)):(p.setStart(n,e.focus.offset),p.setEnd(t,e.anchor.offset)),d.removeAllRanges(),d.addRange(p)):(p.setStart(t,e.anchor.offset),d.removeAllRanges(),d.addRange(p),d.extend(n,e.focus.offset)))}catch(h){this._moveCursorToEnd(o)}else this._moveCursorToEnd(o)},onCut:function(e){l.isTrident&&this.onInput(e)},onPaste:function(e){if(!e.defaultPrevented){e.preventDefault();var t=new p(e.clipboardData);if(t.hasFiles())return e.stopPropagation(),this.props.onFiles&&this.props.onFiles(t);var n=l.isTrident?"text":"text/plain",i=e.clipboardData.getData(n);this.pasteText(i)}},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e,t){if(this.props.editable&&(d.focus(this.refs.input),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var n=window.getSelection(),i=null;n.getRangeAt&&n.rangeCount&&(i=n.getRangeAt(0),i.deleteContents());var a=this.refs.input,s=a.scrollTop,r=a.scrollHeight,c=o.emojiToHTML(_.escape(e));l.isTrident?i&&this.replaceSelectionTrident(c,n,i):t?document.execCommand("insertText",!1,c):document.execCommand("insertHTML",!1,c),this.onInput(!0),this.debouncedSaveSelection(),this.scrollToCursor(s,r)}},scrollToCursor:function(e,t){var n=this.refs.input,i=n.scrollHeight,a=n.clientHeight;if(!(i<=a)){var s=i-t;this.refs.input.scrollTop=(e||0)+s}},replaceSelectionTrident:function(e,t,n){var i=document.createElement("div");i.innerHTML=e;for(var a,s,r=document.createDocumentFragment();a=i.firstChild;)s=r.appendChild(a);n.insertNode(r),s&&(n=n.cloneRange(),n.setStartAfter(s),n.collapse(!0),t.removeAllRanges(),t.addRange(n))},shouldComponentUpdate:function(){return!1},render:function(){var e=o.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",n="input-emoji",a=this.props.placeholder&&!this.props.value?i.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return i.createElement("div",{className:n},a,i.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input",spellCheck:this.props.spellCheck,"data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(218),o=i(r),c=n(6),l=n(1323),u=n(428),d=n(1309),p=n(8),h=n(1584),f=c.createClass({displayName:"AddContactToGroupFlow",mixins:[l],propTypes:{contact:c.PropTypes.instanceOf(o["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,l.Dir.PUSH,l.Transition.NONE),(0,s["default"])(e,l.Dir.POP,l.Transition.NONE),e},filter:function(e){var t=e.groupMetadata;return!(!e.isGroup||e.isGroup&&!t.participants.iAmMember())&&(t.participants.get(this.props.contact.id)?l10n.t("already_added_to_group"):!!t.participants.iAmAdmin()||l10n.t("chat_not_an_admin"))},componentWillMount:function(){this.push(c.createElement(h,{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this.pop,onGroup:this.confirmAddToGroup}))},confirmAddToGroup:function(e){this.push(c.createElement(u,{onOK:this.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:this.pop,cancelText:l10n.t("web_cancel")},c.createElement(d,{text:l10n.t("confirm_add_group_participant",{participant:this.props.contact.formattedName,subject:e.contact.name})})))},addToGroup:function(e){e.groupMetadata.participants.addParticipant(this.props.contact).then(function(){p.openChatFromUnread(e).then(function(t){t&&p.focusChatTextInput(e)})})["catch"](_.noop),this.endFlow()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(1308),o=i(r),c=n(6),l=n(1323),u=n(428),d=n(1388),p=n(8),h=n(1309),f=c.createClass({displayName:"AddGroupParticipantFlow",mixins:[l],propTypes:{chat:c.PropTypes.instanceOf(o["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,l.Dir.PUSH,l.Transition.NONE),(0,s["default"])(e,l.Dir.POP,l.Transition.NONE),e},componentWillMount:function(){this.push(c.createElement(d,{title:l10n.t("add_group_participant"),filter:this.contactFilter,onCancel:this._pop,onSelect:this.confirmAddParticipant}))},contactFilter:function(e){var t=this.props.chat.groupMetadata;return!!Store.Contact.isFilteredContact(e)&&(!t.participants.get(e.id)||l10n.t("already_added_to_group"))},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),n=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(c.createElement(u,{onOK:t,okText:l10n.t("add_group_participant"),onCancel:this._pop,cancelText:l10n.t("web_cancel")},c.createElement(h,{text:n})))},_pop:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),p.closeModal()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(1323),c=n(140),l=n(1566),u=n(8),d=n(85),p=n(1601),h=r.createClass({displayName:"AttachMediaFlow",mixins:[o,c],propTypes:{files:r.PropTypes.array,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){this.mediaCollection=new p},componentWillMount:function(){u.closeContextMenu(),u.closeTooltip(),this.push(r.createElement(l,{chat:this.props.chat,files:this.props.files,onBack:this.endFlow,onSendMedia:_.once(this.sendMedia),onDropText:_.once(this.setText),mediaCollection:this.mediaCollection}))},componentDidMount:function(){var e=this;this.uiIdle(function(){e.initializeFiles()})},componentWillUnmount:function(){var e=this;d.isGecko?_.defer(function(){return u.focusChatTextInput(e.props.chat)}):u.focusChatTextInput(this.props.chat),this.mediaCollection&&this.mediaCollection["delete"]()},initializeFiles:function(){var e=this.props.files;e&&this.mediaCollection.processFiles(e,this.props.chat)},sendMedia:function(e){var t=this.props.chat;_.delay(function(){e.forEach(function(e,n){var i={};0===n&&(i.quotedMsg=t.composeQuotedMsg,t.composeQuotedMsg=null),i.caption=e.caption,e.mediaPrep.sendToChat(t,i)})},300),this.endFlow()},setText:function(e){var t=this.props.chat;_.delay(function(){u.pasteChatTextInput(t,e)},300),this.endFlow()}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(1353),o=n(6),c=n(1323),l=n(1427),u=o.createClass({displayName:"CaptureFlow",mixins:[c],propTypes:{chat:o.PropTypes.instanceOf(s["default"]).isRequired,stream:o.PropTypes.object.isRequired},componentWillMount:function(){this.push(o.createElement(l,{onBack:this.endFlow,caption:!0,onSend:this.sendMedia,stream:this.props.stream}))},sendMedia:function(e){var t=e.file,n=e.caption,i=this.props.chat,a=i.composeQuotedMsg;i.composeQuotedMsg=null,(0,r.prepRawMedia)(t,{}).sendToChat(i,{caption:n||void 0,quotedMsg:a||void 0}),this.endFlow()}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(431),s=i(a),r=n(1308),o=i(r),c=n(6),l=n(1582),u=n(1323),d=c.createClass({displayName:"GroupInviteRevokeFlow",mixins:[u],propTypes:{chat:c.PropTypes.instanceOf(o["default"]).isRequired,onConfirm:c.PropTypes.func.isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,u.Dir.PUSH,u.Transition.NONE),(0,s["default"])(e,u.Dir.POP,u.Transition.NONE),e},componentWillMount:function(){this.push(c.createElement(l,{chat:this.props.chat,onConfirm:this.props.onConfirm}))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(38),c=n(10),l=n(8),u=n(141),d=n(1314),p=n(140),h=n(1588),f=n(1406),m=n(142),g=n(1),v=n(139),y=n(14),E=n(45),b=n(104),M=r.createClass({displayName:"MediaViewerFlow",mixins:[u,d,p],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,getZoomNode:r.PropTypes.func},getInitialState:function(){this.zoomIn=!0;var e=this.props.msg;return this.mediaMsgs=e.chat.constructMediaMsgs(e),{activeMsg:e,imgZoomed:!1}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){var e=this;this.zoomIn=!1,v.supportsFeature(v.F.MEDIA_GALLERY)&&this.uiIdle(function(){e.mediaMsgs.loadMoreAroundIfNeeded(e.state.activeMsg)}),this.addObserver(this.mediaMsgs,"remove reset",function(t,n,i){if(e.mediaMsgs.indexOf(t)>-1||e.state.activeMsg!==t)return void e.forceUpdate();var a=i.index;0===e.mediaMsgs.length?e.endFlow():e.mediaMsgs.length===a?e.onSelectThumb(e.mediaMsgs.at(a-1)):e.onSelectThumb(e.mediaMsgs.at(a))}),this.addObserver(this.mediaMsgs,"query_media_after"),this.addObserver(this.mediaMsgs,"query_media_before",function(){var t=o.findDOMNode(e.refs.thumbs);t&&(e.prevScrollWidth=t.scrollWidth,e.forceUpdate())}),this.scrollToActive(),Velocity(this.refs.thumbsContainer,{opacity:[1,0],translateY:["0%","100%"]},{duration:300,delay:100,easing:[.1,.82,.25,1]})},componentDidUpdate:function(e,t){if(t.activeMsg!==this.state.activeMsg)this.scrollToActive(!0);else{var n=o.findDOMNode(this.refs.thumbs);if(!n||!this.prevScrollWidth)return;n.scrollLeft+=n.scrollWidth-this.prevScrollWidth,this.prevScrollWidth=null}},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){var t=this;this.mediaMsgs.hasMediaBefore&&e.scrollLeft<e.clientWidth&&!function(){var e=t.mediaMsgs.head();t.uiIdle(function(){t.mediaMsgs.queryMedia(e.chat,e),t.forceUpdate()})}(),this.mediaMsgs.hasMediaAfter&&e.scrollLeft+c.SCROLL_FUDGE>e.scrollWidth-2*e.clientWidth&&!function(){var e=t.mediaMsgs.last();t.uiIdle(function(){t.mediaMsgs.queryMedia(e.chat,e,"after"),t.forceUpdate()})}()},100),onNext:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,i=this.mediaMsgs.getAfter(n);return i?void this.onSelectThumb(i):void(v.supportsFeature(v.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaAfter&&(this._queryMediaAfter||(this._queryMediaAfter=this.mediaMsgs.queryMedia(n.chat,n,"after").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onNext()})["catch"](y.Unmount,_.noop)["catch"](function(e){g.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaAfter=null}))))}},onPrev:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,i=this.mediaMsgs.getBefore(n);return i?void this.onSelectThumb(i):void(v.supportsFeature(v.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaBefore&&(this._queryMediaBefore||(this._queryMediaBefore=this.mediaMsgs.queryMedia(n.chat,n,"before").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onPrev()})["catch"](y.Unmount,_.noop)["catch"](function(e){g.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaBefore=null}))))}},onImgZoomIn:function(e){this.setState({imgZoomed:e})},endFlow:function(){l.closeModalMedia()},willEndFlow:function(){Velocity(this.refs.thumbsContainer,{opacity:[0,1],translateY:["100%","0%"]},{duration:300,easing:[.1,.82,.25,1]})},onSelectThumb:function(e,t){var n=this;v.supportsFeature(v.F.MEDIA_GALLERY)&&this.uiIdle(function(){n.mediaMsgs.loadMoreAroundIfNeeded(e)}),this.setState({activeMsg:e})},scrollToActive:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.refs.thumbsContainer,n=o.findDOMNode(this.refs.thumbs),i=o.findDOMNode(this.refs.activeThumb);if(t&&n&&i){var a=i.clientWidth/2-t.clientWidth/2;Velocity(n,"stop");var s=0;e&&(s=300),Velocity(i,"scroll",{duration:s,container:n,offset:a,axis:"x",easing:[.1,.82,.25,1]})}},getThumbs:function(){var e=this,t=this.mediaMsgs.map(function(t){var n=E("media-thumb",{active:t===e.state.activeMsg});return r.createElement(f,{classes:n,msg:t,ref:t===e.state.activeMsg?"activeThumb":null,key:"media-"+t.id.id,onClick:e.onSelectThumb.bind(e,t)})});return t.push(r.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-right"},this.mediaMsgs.queryMediaAfter?r.createElement(m,{stroke:6,size:24}):null)),t.unshift(r.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-left"},this.mediaMsgs.queryMediaBefore?r.createElement(m,{stroke:6,size:24}):null)),t.push(r.createElement("div",{className:"media-thumb-padding",key:"padding-right"})),t.unshift(r.createElement("div",{className:"media-thumb-padding",key:"padding-left"})),t},render:function(){var e=this.mediaMsgs.last(),t=this.mediaMsgs.hasMediaAfter||this.state.activeMsg!==e?this.onNext:null,n=this.mediaMsgs.head(),i=this.mediaMsgs.hasMediaBefore||this.state.activeMsg!==n?this.onPrev:null,a=this.getThumbs(),s=v.supportsFeature(v.F.MEDIA_GALLERY)?this.onScroll:null;return r.createElement("div",{className:this.state.imgZoomed?"img-zoomed-in":null},r.createElement("div",{className:"media-collection media-viewer-thumbs-container",ref:"thumbsContainer"},r.createElement("div",{onScroll:s,style:{width:"100%"},dir:"ltr"},r.createElement(b,{className:"media-viewer-thumbs",ref:"thumbs",transitionName:"thumb-scale"},a))),r.createElement(h,{msg:this.state.activeMsg,onBack:this.endFlow,onExitAnimation:this.willEndFlow,onNext:t,onPrev:i,onImgZoomIn:this.onImgZoomIn,getZoomNode:this.props.getZoomNode,zoomIn:this.zoomIn}))}});e.exports=M},function(e,t,n){"use strict";var i=n(6),a=n(1323),s=n(1571),r=n(8),o=i.createClass({displayName:"NewChatFlow",mixins:[a],componentWillMount:function(){this.push(i.createElement(s,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(r.openChatFromUnread.bind(r)),this.endFlow()}});e.exports=o},function(e,t,n){"use strict";var i=n(6),a=n(1323),s=n(1591),r=n(1592),o=i.createClass({displayName:"NewGroupFlow",mixins:[a],componentWillMount:function(){this.push(i.createElement(s,{onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,n){this.push(i.createElement(r,{subject:e,thumb:t,full:n,onBack:this.participantsBack,onContinue:_.once(this.createGroup)}))},createGroup:function(e,t,n,i){Store.Chat.createGroup(e,t,n,i),this.endFlow()},participantsBack:function(e,t,n){this.pop()}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(431),o=i(r),c=n(1308),l=i(c),u=n(1454),d=i(u),p=n(6),h=n(1323),f=n(8),m=n(10),g=n(1387),v=n(1330),y=p.createClass({displayName:"SendGroupInviteFlow",mixins:[h],propTypes:{chat:p.PropTypes.instanceOf(l["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,h.Dir.PUSH,h.Transition.NONE),(0,o["default"])(e,h.Dir.POP,h.Transition.NONE),e},componentWillMount:function(){var e=this;this.push(p.createElement(g,{onChat:this.onForwardConfirmed,title:l10n.t("group_invite_send_link_title")}));var t=this.props.chat;this.linkPreview={canonicalUrl:m.GROUP_INVITE_LINK_URL,description:l10n.t("whatsapp_group_invite"),matchedText:t.groupMetadata.groupInviteLink,title:t.title()};var n=t.contact.profilePicThumb;n&&n.imgFull?v.generateLinkPreview(n.imgFull).then(function(t){e.linkPreview.thumbnail=t}):(0,d["default"])(t.groupMetadata.groupInviteLink).then(function(t){var n=(t.url,t.data);(n.title||n.description)&&(e.linkPreview.thumbnail=n.thumbnail)})["catch"](_.noop)},onForwardConfirmed:function(e){var t=this;s["default"].map(e,function(e){var n=void 0;n=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(n){e.sendMessage(t.props.chat.groupMetadata.groupInviteLink,t.linkPreview)})}),this.endFlow(),f.openChatFromUnread(_.head(e))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(6),o=n(1323),c=n(8),l=n(1387),u=n(31),d=r.createClass({displayName:"SendMsgMultiFlow",mixins:[o],propTypes:{msgText:r.PropTypes.string.isRequired},componentWillMount:function(){this.push(r.createElement(l,{onChat:this.onForwardConfirmed,title:l10n.t("msg_send_title")}))},onForwardConfirmed:function(e){var t=this.props.msgText;1===e.length?!function(){var n=void 0,i=u.head(e);n=i.isUser&&i.contact.isBlocked()?i.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(e){return t&&i.setComposeContents({text:t}),c.openChatFromUnread(i).then(function(e){e&&c.focusChatTextInput(i)})})}():(s["default"].map(e,function(e){var n=void 0;n=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(n){e.sendMessage(t)})}),c.openChatFromUnread(u.head(e))),this.endFlow()}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1595),s=i(a),r=n(6),o=n(1323),c=n(1567),l=n(1432),u=n(1593),d=n(1585),p=n(1600),h=n(27),f=r.createClass({displayName:"SettingsFlow",mixins:[o],componentWillMount:function(){this.push(r.createElement(s["default"],{profileId:Store.Conn.me,onWallpaper:this.showWallpaperDrawer,onBlocked:this.showBlockedDrawer,onProfile:this.showProfileDrawer,onNotifications:this.showNotifications,onHelp:this.showHelp,onClose:this._pop}))},showWallpaperDrawer:function(){this.push(r.createElement(p,{onClose:this._pop}))},showBlockedDrawer:function(){this.push(r.createElement(c,{onClose:this._pop}))},showProfileDrawer:function(){this.push(r.createElement(l,{id:Store.Conn.me,onClose:this._pop}))},showNotifications:function(){this.push(r.createElement(u,{onClose:this._pop}))},showHelp:function(){h.upload("help-page-opened"),this.push(r.createElement(d,{onClose:this._pop}))},_pop:function(){this.pop()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){switch(u()){case"giphy":return s(e);case"tenor":return o(e);default:throw new Error("Unrecognized provider "+u())}}function s(e){var t=!e,n=void 0;return n=t?D.request("https://api.giphy.com/v1/gifs/trending","GET",{api_key:R,limit:100,rating:"pg-13"},"json"):D.request("https://api.giphy.com/v1/gifs/search","GET",{q:e,api_key:R,limit:100,rating:"pg-13"},"json"),n["catch"](function(){return null}).then(function(e){return e&&e.status<300&&r(e.response,t)})}function r(e,t){if(!e||!_.isArray(e.data))return[];for(var n=e.data,i=[],a=0;a<n.length;a++){var s=n[a];if(s&&s.images){var r=s.images.downsizedSmall,o=s.images.fixed_height,c=s.images.fixed_width,l=void 0,u=void 0;if(c&&c.mp4){var d=parseInt(c.height,10);d===d&&d<I&&(l=c,u=I*v.TARGET_GIF_HEIGHT/d)}if(o&&o.mp4){var p=parseInt(c.width,10);p===p&&p<I&&(l=o,u=p*v.TARGET_GIF_HEIGHT/I)}l&&i.push(new v.GifInfo(i.length,r&&r.url||l.mp4,l.mp4,l.webp||l.gif||void 0,Math.round(u),v.GIPHY,t))}}return i}function o(e){var t=!e,n=l10n.lng().replace("-","_"),i=void 0;return i=t?D.request("https://api.tenor.co/v1/trending","GET",{key:A,limit:50,safesearch:"moderate",locale:n},"json"):D.request("https://api.tenor.co/v1/search","GET",{tag:e,key:A,limit:50,safesearch:"moderate",locale:n},"json"),i["catch"](function(){return null}).then(function(e){return e&&e.status<300&&c(e.response)})}function c(e,t){if(!e||!_.isArray(e.results))return[];for(var n=e.results,i=[],a=0;a<n.length;a++){var s=n[a];if(s&&s.media&&s.media[0]){var r=s.media[0],o=r.tinymp4,c=r.nanomp4,l=r.tinygif;if(o){var u=(0,p["default"])(o.dims,2),d=u[0],h=u[1];i.push(new v.GifInfo(i.length,o.url,c&&c.url||void 0,l&&l.url||void 0,Math.round(d*v.TARGET_GIF_HEIGHT/h),v.TENOR,t))}}}return i}function l(e,t){for(var n=[],i=.9*t,a=e,s=null,r=.05;r<1&&a.length;r+=.05){a.sort(function(e,t){var n=e.rank-t.rank;return Math.abs(n)>8?n:t.width-e.width});for(var o=(1+r)*t,c=[],l=[],u=0;u<a.length;u++){for(var d=a[u],p=!1,h=Math.min(o-d.width,i),f=0;!p&&f<c.length;f++)c[f]<h&&(c[f]+=d.width+v.GAP_SIZE,l[f].push(d),p=!0);p||(c.push(d.width),l.push([d]))}if(1===l.length){a=[];var m=t-c[0]-v.GAP_SIZE;s={gifs:l[0],blankStr:m>0?m+"px":void 0}}else{a=[];for(var g=0;g<l.length;g++)c[g]>i?n.push(l[g]):a.push.apply(a,l[g])}}n.forEach(function(e){return e.sort(function(e,t){return e.rank-t.rank})}),n.sort(function(e,t){return e[0].rank-t[0].rank});var y=n.map(function(e){return{gifs:e,blankStr:void 0}});return s&&y.push(s),y}function u(){switch(C.SHOW_GIF_SEARCH){case"giphy":return v.GIPHY;case"tenor":default:return v.TENOR}}var d=n(86),p=i(d),h=n(2),f=i(h),m=n(1307),g=i(m),v=n(1364),y=n(1424),E=i(y),b=n(6),M=n(38),C=n(10),S=n(14),T=n(52),w=n(89),k=n(87),P=n(1314),N=n(51),O=n(1639),D=n(148),x=n(1559),R="3o85xmWDYKgihhIKSA",A="DLAQBEYLJJIM",I=200,L={giphy:"GIPHY",tenor:"Tenor"},U={giphy:T.GIF_SEARCH_PROVIDER.GIPHY,tenor:T.GIF_SEARCH_PROVIDER.TENOR},F={giphy:g["default"].GIF_ATTRIBUTION.GIPHY,tenor:g["default"].GIF_ATTRIBUTION.TENOR},G=new O(a,{maxCached:6,maxAge:36e4,shouldCache:function(e){return!(!e||!e.length)}}),j=b.createClass({displayName:"GifSearch",mixins:[P],propTypes:{onGif:b.PropTypes.func.isRequired},getInitialState:function(){return this._scrollTop=0,this._animatingRow=null,this._containerDom=null,this._didSendGif=!1,{searchText:"",gifRows:[],width:0}},shouldComponentUpdate:function(e,t){return e.onGif!==this.props.onGif||t.gifRows!==this.state.gifRows},componentWillMount:function(){var e=this;this._searchTimer=new k(this.searchForAndSetGifs),this._animateTimer=new k(this.animateGif),this._onlineRestarter=f["default"].loop(function(){return N.waitForBBEvent(w,"change:online",function(){return w.online}).then(function(){return e.scheduleQuery()})}).cancellable(),this._onlineRestarter["catch"](f["default"].CancellationError,_.noop),this.searchForAndSetGifs(),new T.GifSearchSessionStarted({gifSearchProvider:U[u()]}).commit()},componentWillUnmount:function(){this._animateTimer.cancel(),this._searchTimer.cancel(),this._onlineRestarter.cancel(),this._didSendGif||new T.GifSearchCancelled({gifSearchProvider:U[u()]}).commit()},scheduleQuery:function(){this._searchTimer.debounceAndCap(200,2e3)},onSearchInput:function(e){this._searchText=e.target.value.trim(),this.scheduleQuery()},onScroll:function(e){this._scrollTop=e.currentTarget.scrollTop,this._animateTimer.debounce(200)},onSend:function(e){var t=U[e.attribution];new T.GifFromProviderSent({gifSearchProvider:t}).commit(),e.trending||new T.GifSearchResultTapped({gifSearchProvider:t,rank:e.rank}).commit(),this._didSendGif=!0,this.props.onGif(e.url,F[e.attribution])},setGifAnimating:function(e,t){var n=this.refs[e];n&&n.setShouldAnimate(t)},animateGif:function(){var e=this,t=this._animatingRow,n=this._scrollTop;this._starredGifsDom&&(n-=this._starredGifsDom.clientHeight);var i=Math.round(n/(v.TARGET_GIF_HEIGHT+v.GAP_SIZE)),a=this.state.gifRows[i];if(a&&a.gifs.length&&a!==t){if(this._animatingRow=a,t)for(var s=0;s<t.gifs.length;s++)this.setGifAnimating(t.gifs[s].gifId,!1);for(var r=0;r<a.gifs.length;r++)this.setGifAnimating(a.gifs[r].gifId,!0)}[i+1,i-1].forEach(function(t){if(e.state.gifRows[t])for(var n=e.state.gifRows[t].gifs,i=0;i<n.length;i++)e.setGifAnimating(n[i].gifId,!1)})},searchForAndSetGifs:function(){var e=this,t=U[u()],n=this._searchText,i=G.getOrRun(n);i=i.then(),this._pendingQuery=i,i.checkpoint(this.rejectOnUnmount()).then(function(a){if(a&&0===a.length&&new T.GifSearchNoResults({gifSearchProvider:t}).commit(),i===e._pendingQuery&&(e._pendingQuery=null,a)){n||new T.GifTrendingViewed({gifSearchProvider:t}).commit();var s=e._containerDom.clientWidth;s-=2*v.GAP_SIZE,e._resetScroll=!0,e._animateTimer.debounce(0),e.setState({searchText:n,gifRows:l(a,s),width:s})}})["catch"](S.Unmount,f["default"].CancellationError,_.noop),n&&setTimeout(function(){e.rejectOnUnmount().isPending()&&n===e._searchText&&new T.GifSearchPerformed({gifSearchProvider:t}).commit()},500)},onStarredGifsMount:function(e){this._starredGifsDom=M.findDOMNode(e)},render:function(){function e(e){l=e,null!==e&&e.focus()}function t(e){e.target!==l&&(e.preventDefault(),l.focus()),e.stopPropagation()}var n=this,i=this.state.gifRows;this._gifPreviews={};var a=i.map(function(e,t){var i=e.gifs.map(function(e,t){return b.createElement(E["default"],{key:e.gifId,ref:e.gifId,gif:e,display:!0,onSend:n.onSend})}),a=null;return e.blankStr&&(a=b.createElement("div",{className:"gif-search-blank",style:{flexBasis:e.blankStr}})),b.createElement("div",{key:t,className:"gif-search-row"},i,a)}),s=void 0;a.length&&!this.state.searchText&&(s=b.createElement("div",{className:"gif-section-title"},l10n.t("gif_trending_title")));var r=void 0;this.state.searchText||(r=b.createElement(x,{onSend:this.onSend,ref:this.onStarredGifsMount}));var o=!!this._resetScroll,c=function(e){n._containerDom=e,null!==e&&o&&(o=!1,e.scrollTop=0)},l=null,d=l10n.t("search_gifs",{service:L[u()]});return b.createElement("div",{className:"gif-search-container",ref:c,onScroll:this.onScroll,onMouseDown:t,onContextMenu:t},b.createElement("label",{className:"gif-search-row-input"},b.createElement("div",{className:"input-container"},b.createElement("input",{className:"input input-search input-gif-search",type:"text",dir:"auto",title:d,placeholder:d,ref:e,onMouseDown:function(e){e.stopPropagation()},onChange:this.onSearchInput}))),r,s,a)}});e.exports=j},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1424),s=i(a),r=n(1364),o=n(1307),c=i(o),l=n(6),u=n(140),d=l.createClass({displayName:"StarredGifPreview",mixins:[u],propTypes:{msg:l.PropTypes.instanceOf(c["default"]).isRequired,onSend:l.PropTypes.func.isRequired},animateGif:function(){this._gifRef&&this._gifRef.setShouldAnimate(!0)},componentDidMount:function(){this.animateGif()},componentDidUpdate:function(){this.animateGif()},componentWillMount:function(){this.addObserver(this.props.msg,"change:mediaData.renderableUrl"),this.props.msg.mediaData.renderableUrl||this.props.msg.downloadMedia(!0)},setGifRef:function(e){this._gifRef=e},getGifProvider:function(){var e=this.props.msg.gifAttribution;switch(e){case c["default"].GIF_ATTRIBUTION.GIPHY:return r.GIPHY;case c["default"].GIF_ATTRIBUTION.TENOR:return r.TENOR;default:return}},render:function(){var e=this.props.msg,t=e.mediaData,n=new r.GifInfo((void 0),t.renderableUrl,(void 0),(void 0),Math.round(t.thumbWidth*r.TARGET_GIF_HEIGHT/t.thumbHeight),this.getGifProvider(),(!1));return l.createElement(s["default"],{key:e.filehash,ref:this.setGifRef,gif:n,display:!0,onSend:this.props.onSend,isStarred:!0})}});e.exports=d},function(e,t,n){"use strict";var i=n(6),a=n(45),s=n(140),r=n(1558),o=n(1364),c=o.TARGET_GIF_HEIGHT,l=o.GAP_SIZE,u={RIGHT:"RIGHT",LEFT:"LEFT"},d=4,p=i.createClass({displayName:"StarredGifs",mixins:[s],propTypes:{onSend:i.PropTypes.func.isRequired},getInitialState:function(){return{curIndex:0,direction:u.RIGHT}},componentWillMount:function(){var e=Store.StarredGifMsgs;this.addObserver(e,"add remove reset"),e.isSynced||e.sync()},onSlideLeft:function(){this.setState({curIndex:this.state.curIndex-1,direction:u.LEFT})},onSlideRight:function(){this.setState({curIndex:this.state.curIndex+1,direction:u.RIGHT})},render:function(){var e=this,t=Store.StarredGifMsgs.models;if(0===t.length)return null;if(t.length<=d){var n=0,s=t.map(function(t){return n+=Math.round(t.mediaData.thumbWidth*c/t.mediaData.thumbHeight),i.createElement(r,{key:t.filehash,msg:t,onSend:e.props.onSend})});return n+=(s.length-1)*l,i.createElement("div",{className:"star-gifs-container"},i.createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),i.createElement("div",{className:"gif-search-row",style:{maxWidth:n+"px"}},s))}var o=void 0,u=void 0,p=this.state.curIndex>0,h=this.state.curIndex+d<t.length,f=p?this.onSlideLeft:null,m=h?this.onSlideRight:null,g=a("star-gifs-pager gifs-pager-left",{"gifs-pager-disabled":!p}),v=a("star-gifs-pager gifs-pager-right",{"gifs-pager-disabled":!h});o=i.createElement("div",{className:g,onClick:f},i.createElement("span",{className:"icon icon-chevron-left-alt"})),u=i.createElement("div",{className:v,onClick:m},i.createElement("span",{className:"icon icon-chevron-right-alt"}));var y=t.slice(this.state.curIndex,this.state.curIndex+d).map(function(t){return i.createElement(r,{key:t.filehash,msg:t,onSend:e.props.onSend})});return i.createElement("div",{className:"star-gifs-container"},i.createElement("div",{
className:"gif-section-title"},l10n.t("gif_starred_title")),i.createElement("div",{className:"gif-search-row"},o,i.createElement("div",{className:"starred-gifs-body"},y),u))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(430),s=i(a),r=n(2),o=i(r),c=n(37),l=i(c),u=n(23),d=i(u),p=n(25),h=i(p),f=n(81),m=i(f),g=n(80),v=i(g),y=n(6),E=i(y),_=n(1325),b=i(_),M=n(14),C=i(M),S=n(31),T=i(S);t["default"]=function(e){return function(t){function n(){var e,t,i,a;(0,d["default"])(this,n);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return t=i=(0,m["default"])(this,(e=(0,l["default"])(n)).call.apply(e,[this].concat(r))),i.isUnmounted=!1,i.rejectOnUnmount=function(){return i.rejectPromise?i.rejectPromise:(i.rejectPromise=new o["default"](function(e,t){i.rejector=t}),i.rejectPromise["catch"](T["default"].noop),i.isUnmounted&&i.rejector(new C["default"].Unmount),i.rejectPromise)},a=t,(0,m["default"])(i,a)}return(0,v["default"])(n,t),(0,h["default"])(n,[{key:"componentWillUnmount",value:function(){this.isUnmounted=!0,this.rejectPromise&&this.rejector(new C["default"].Unmount)}},{key:"render",value:function(){return E["default"].createElement(e,(0,s["default"])({ref:_.HOCRef,rejectOnUnmount:this.rejectOnUnmount},this.props))}}]),n}(b["default"])}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(430),s=i(a),r=n(1217),o=i(r),c=n(37),l=i(c),u=n(23),d=i(u),p=n(25),h=i(p),f=n(81),m=i(f),g=n(80),v=i(g),y=n(6),E=i(y),_=n(31),b=i(_),M=n(1325),C=i(M);e.exports=function(e){return function(t){function n(){var e,t,i,a;(0,d["default"])(this,n);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return t=i=(0,m["default"])(this,(e=(0,l["default"])(n)).call.apply(e,[this].concat(r))),i.timers=new o["default"],i.timerId=0,i.setInterval=function(e,t){var n=setInterval(e,t);return i.reg(function(){return clearInterval(n)})},i.clearInterval=function(e){var t=i.timers.get(e);t&&t()},i.setTimeout=function(e,t){var n=setTimeout(e,t);return i.reg(function(){return clearTimeout(n)})},i.clearTimeout=function(e){var t=i.timers.get(e);t&&t()},i.debounce=function(e,t,n){var a=++i.timerId,s=b["default"].debounce(function(){i.timers["delete"](a),e()},t,n),r=s.cancel.bind(s);return s.cancel=function(){i.timers["delete"](a),r()},i.timers.set(a,s.cancel),s},i.reg=function(e){var t=++i.timerId;return i.timers.set(t,function(){i.timers["delete"](t),e()}),t},a=t,(0,m["default"])(i,a)}return(0,v["default"])(n,t),(0,h["default"])(n,[{key:"componentWillUnmount",value:function(){this.timers.forEach(function(e){return e()})}},{key:"render",value:function(){return E["default"].createElement(e,(0,s["default"])({ref:M.HOCRef,setInterval:this.setInterval,clearInterval:this.clearInterval,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout,debounce:this.debounce},this.props))}}]),n}(C["default"])}},function(e,t,n){"use strict";var i=n(6),a=n(435),s=i.createClass({displayName:"IntroPanel",componentDidMount:function(){var e=this.refs.image,t=this.refs.text;this.props.animate?(Velocity(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),Velocity(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})):(e.style.opacity=1,t.style.opacity=1)},render:function(){return i.createElement("div",{className:"pane pane-intro pane-two"},i.createElement("div",{className:"intro-body"},i.createElement("div",{ref:"image",className:"intro-image"}),i.createElement("div",{ref:"text",className:"intro-text-container"},i.createElement("h1",{"data-a8n":a.key("intro-title"),className:"intro-title"},l10n.t("intro_title")),i.createElement("div",{"data-a8n":a.key("intro-text"),className:"intro-text"},l10n.t("intro_connection")))))}});e.exports=s},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e){e.mustDownloadMedia=!1;var t=e.downloadPromise;t&&t.control.waitForPoke()}function r(e,t){if(!e.filehash)return S["default"].resolve();t&&(e.mustDownloadMedia=!0);var n=e.downloadPromise;if(n)return n.control.poke(),n;if(e.downloadStage===oe.DOWNLOAD_STAGE.ERROR_MISSING)return S["default"].reject(new ue);if(e.downloadStage===oe.DOWNLOAD_STAGE.PREPARING)return S["default"].resolve();var i=S["default"].loop(function(t){if(e.mediaBlob)return A["default"].validateBlob(e.mediaBlob).then(function(n){return n?void t():(e.consolidate({mediaBlob:null}),!1)});var n=e.entries.getDownloadEntry(),i=void 0;if(n)i=c(e,n);else{if(!e.mustDownloadMedia)return e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.NEED_POKE}),S["default"].sit("poke");e.mustDownloadMedia=!1,i=o(e)}return i["catch"](O["default"].MediaNeedsReupload,function(){})["catch"](de,le,O["default"].MediaLoadError,function(t){return j["default"].error("msg:processMedia:"+t)(),e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.NEED_POKE}),S["default"].sit("poke")})}).then(function(){return e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.RESOLVED}),e.downloadPromise=null,e.resolveWhenConsolidated()}).endWithControls("poke","waitForPoke");return i["catch"](ue,function(t){e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.ERROR_MISSING})})["catch"](O["default"].MediaUnsupportedError,function(){e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.ERROR_UNSUPPORTED})})["catch"](O["default"].LogoutDrop,function(){}),e.downloadPromise=i}function o(e){return e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.REUPLOADING}),e.rmr()["catch"](function(e){return!(e instanceof O["default"].LogoutDrop)},function(){return S["default"].reject(new O["default"].MediaNeedsReupload)}).then(function(e){switch(e.status){case 200:return;case 404:return S["default"].reject(new ue);default:return S["default"].reject(new O["default"].MediaNeedsReupload)}})}function c(e,t){return e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.FETCHING}),S["default"].loop(function(n,i){var a=X["default"].expDelaySec(i,60,void 0,.1);return z["default"].waitForOnline.then(function(){return K["default"].getResponseIfOnline(t.mmsUrlOrBackup(),"GET",null,ae["default"].RESP_TYPE.ARRAY_BUFFER)}).addRejectControl("waitForPoke",function(){return new de}).then(function(s){if(!(s&&s.status<500))return i>3?S["default"].reject(new O["default"].MediaNeedsReupload):z["default"].online&&!t.useBackupUrl?(t.useBackupUrl=!0,0):(e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.NEED_POKE}),a["return"](i+1).addResolveControl("poke",function(){return 0}));if(s.status>=400)throw t.markWhetherOnServer(!1),new O["default"].MediaNeedsReupload;t.markWhetherOnServer(!0),n(s.response)})},0).then(function(n){if(!e.specifics)throw j["default"].assert(!1,"media-fault","object-without-type")(),new Error("downloaded object without type");var i=e.specifics.type;return e.entries.downloadedLocally(i),e.consolidate({downloadStage:oe.DOWNLOAD_STAGE.PROCESSING}),w.decryptE2EMedia(i,n,t.encryptionKey,e.mimetype)["catch"](O["default"].MediaEncryptionError,function(e){return j["default"].assert(!1,"decryption-error","msg:processEncryptedMedia "+e)(),S["default"].reject(new ue)})}).then(function(t){switch(e.type()){case ce.TYPE.IMAGE:var n=window.URL.createObjectURL(t);return W["default"].image(n).then(function(e){return{mediaBlob:t,renderableUrl:n,fullWidth:e.fullWidth,fullHeight:e.fullHeight}});case ce.TYPE.VIDEO:return W["default"].video(t).then(function(e){return{mediaBlob:t,renderableUrl:window.URL.createObjectURL(t),fullWidth:e.fullWidth,fullHeight:e.fullHeight}});case ce.TYPE.AUDIO:return W["default"].transcode(t,e.mimetype).then(function(e){var n=window.URL.createObjectURL(e);return W["default"].audio(n)["return"]({mediaBlob:t,renderableUrl:n})});case ce.TYPE.DOCUMENT:return{mediaBlob:t,renderableUrl:window.URL.createObjectURL(t)}}}).then(function(t){e.consolidate(t)})}function l(e,t){return S["default"].resolve(e).then(function(e){var n,i=t.asDocument?R.FILETYPE.DOCUMENT:A["default"].typeFromMimetype(e.type);switch(i){case R.FILETYPE.DOCUMENT:n=P["default"].MAX_FILE_SIZE;break;case R.FILETYPE.IMAGE:n=Math.min(pe,P["default"].MAX_MEDIA_UPLOAD_SIZE);break;default:n=P["default"].MAX_MEDIA_UPLOAD_SIZE}if(e.size>n)return S["default"].reject(new O["default"].MediaFileTooLarge(e));switch(i){case R.FILETYPE.IMAGE:return u(e);case R.FILETYPE.VIDEO:case R.FILETYPE.AUDIO:return d(e,!!t.isPtt,t.precomputedDuration,t.asGif,t.gifAttribution||(t.asGif?0:void 0));case R.FILETYPE.DOCUMENT:return p(e);default:return S["default"].reject(new Error("unrecognized media type "+i))}})}function u(e){return F["default"].rotateAndResize(e,P["default"].IMG_MAX_EDGE,P["default"].IMG_MAX_EDGE,F["default"].BLOB|F["default"].CANVAS).then(function(e){var t=e.width,n=e.height,i=e.images,a=i.blob,s=i.canvas;return F["default"].rotateAndResize(s,P["default"].IMG_THUMB_MAX_EDGE,P["default"].IMG_THUMB_MAX_EDGE,F["default"].DATA_URL).then(function(e){var i=e.width,s=e.height,r=e.images.dataUrl;return{type:oe.OUTWARD_TYPES.IMAGE,mediaBlob:a,mimetype:"image/jpeg",thumbWidth:i,thumbHeight:s,fullWidth:t,fullHeight:n,preview:J["default"].parseDataURL(r).data}})})}function d(e,t,n,i,a){return re["default"].checkAndRepair(e,!!i).then(function(s){if(!s)return j["default"].error("processRawAudioVideo bad video file "+e.type)(e),S["default"].reject(new O["default"].InvalidMediaFileType);var r=s.type,o=s.file,c=i||s.isGif;switch(A["default"].typeFromMimetype(r)){case R.FILETYPE.VIDEO:return t?(j["default"].assert(!1,"media-fault","ptt became video")(),S["default"].reject(new O["default"].InvalidMediaFileType)):F["default"].generateVideoThumbAndDuration(o,P["default"].IMG_THUMB_MAX_EDGE,P["default"].IMG_THUMB_MAX_EDGE).then(function(e){var t=e.thumb,n=e.duration;return{type:oe.OUTWARD_TYPES.VIDEO,mediaBlob:o,mimetype:r,thumbWidth:t.width,thumbHeight:t.height,fullWidth:t.fullWidth,fullHeight:t.fullHeight,preview:J["default"].parseDataURL(t.url).data,duration:n.toString(),isGif:c,gifAttribution:c?a||0:void 0}});case R.FILETYPE.AUDIO:return(void 0!==n?S["default"].resolve(n):A["default"].getAudioDuration(o)).then(function(e){return{type:t?oe.OUTWARD_TYPES.PTT:oe.OUTWARD_TYPES.AUDIO,mediaBlob:o,mimetype:r,duration:e.toString()}});default:throw j["default"].assert(!1,"media-fault","audio/video became other")(),new Error("audio/video became "+r)}})}function p(e){var t=e.type,n=e.name||void 0,i=void 0;if(t){if(!("*"===H["default"].DOC_MIMES||H["default"].DOC_MIMES.indexOf(t)>-1))return S["default"].reject(new O["default"].InvalidMediaFileType("disallowed mimetype "+t));i=S["default"].resolve(t)}else i=A["default"].blobToArrayBuffer(e).then(function(t){var i=(0,L["default"])(new Uint8Array(t,0,Math.min(262,t.byteLength)));if(i&&i.mime){var a=H["default"].DOC_MIMES?i.mime:H["default"].isAllowedDocumentMimetype(i.mime,n,!0);if(a)return a}else if(n){var s="",r=n.split(".");if(r.length>1&&(s=r[r.length-1]),s){var o="*"===H["default"].DOC_MIMES?H["default"].EXT_TO_MIME[s]||"application/octet-stream":H["default"].isAllowedDocumentMimetype(H["default"].EXT_TO_MIME[s],n,!1);if(o)return o}}return S["default"].reject(new O["default"].InvalidMediaFileType("type: "+e.type+" name: "+n))});return i.then(function(t){return{type:oe.OUTWARD_TYPES.DOCUMENT,mediaBlob:e,mimetype:t,filename:n||void 0}})}function h(e){e.uploadPromise&&e.uploadPromise.control.cancel()}function f(e,t){if(e.addUploadTargets([t]),e.uploadPromise)return e.uploadPromise.then(function(n){return e.hasUploadTarget(t)?f(e,t):n});e.consolidate({uploadStage:oe.UPLOAD_STAGE.UPLOADING});var n=v(e).then(function(t){return t?t:e.mediaBlob?m(e,e.mediaBlob):r(e,!0).addRawControl("cancel",function(e,t,n){t(new S["default"].CancellationError),n.control.waitForPoke()}).then(function(){var t=e.mediaBlob;if(!t)throw new Error("upload has no media blob after download");return m(e,t)})}).endWithControls("cancel");return n["finally"](function(){e.uploadPromise=null}).tap(function(){e.consolidate({uploadStage:oe.UPLOAD_STAGE.UPLOADED})})["catch"](O["default"].GaveUpRetry,S["default"].CancellationError,O["default"].Server5xxDrop,function(n){j["default"].error("MediaAlgo failed to upload to "+t+", "+n)(),e.consolidate({uploadStage:oe.UPLOAD_STAGE.NEED_UPLOAD})})["catch"](O["default"].LogoutDrop,function(){})["catch"](function(e){j["default"].assert(!1,"upload-uncaught-error",""+e)()}),e.uploadPromise=n}function m(e,t){var n=e.entries.getUploadEntry(),i=n&&n.encryptionKey||x["default"].newB64MediaKey();return A["default"].blobToArrayBuffer(t).addCancelControl().then(function(t){return w.encryptE2EMedia(e.type(),t,i)}).addCancelControl().then(function(t){var n=t.ciphertext,a=t.sidecar;return A["default"].getHash(n).addCancelControl().then(function(t){var s=t.hash;return g(e,s,i,n,a)})})}function g(e,t,n,i,a){return S["default"].loop(function(s,r,o){if(o>4)throw new O["default"].GaveUpRetry("gave up mms upload after "+o+" tries");var c=X["default"].expDelaySec(o+1,60);return S["default"].all([ee["default"].requestEncryptedMediaUpload(e.uploadType(),t),y(e,n)]).addCancelControl().spread(function(r,l){var u=r.data,d=l.chatIds,p=l.refs,h=new FormData;return h.append("hash",t),h.append("refs",p.join("\r\n")),h.append("file",i),j["default"].log("MediaUpload attempt #"+o+" for hash: "+t)(),K["default"].getResponseIfOnline(u+"?f=j","POST",h).timeout(3e5*(o+1))["catch"](S["default"].TimeoutError,function(){return null}).addCancelControl().then(function(i){if(i&&200===i.status){j["default"].log("MediaUpload success: 200")(i.response);var r=JSON.parse(i.response);return void s(r.url?e.entries.addEntry(r.url,n,t,a):null)}return j["default"].log("MediaUpload error: "+(i?i.status:"offline"))(),e.addUploadTargets(d),c.addCancelControl().then(function(){return z["default"].waitForOnline})})})})}function v(e){return S["default"].loop(function(t,n,i){if(i>4)throw new O["default"].GaveUpRetry("gave up adding refs after "+i+" tries");var a=e.entries.getUploadEntry();if(!a)return t(null);var s=X["default"].expDelaySec(i+1,60);return a.getUploadHash().then(function(t){return S["default"].all([t,ee["default"].requestEncryptedMediaUpload(e.uploadType(),t),y(e,a.encryptionKey)])}).spread(function(n,r,o){var c=r.data,l=o.chatIds,u=o.refs,d=new FormData;return d.append("hash",n),d.append("refs",u.join("\r\n")),K["default"].getResponseIfOnline(c+"?f=j","POST",d).timeout(3e5*(i+1))["catch"](S["default"].TimeoutError,function(){return null}).then(function(i){if(i&&200===i.status){var r=JSON.parse(i.response);return void t(r.url?e.entries.addEntry(r.url,a.encryptionKey,n,a.sidecar):null)}return j["default"].log("addRefsToMedia error: "+(i?i.status:"offline"))(),e.addUploadTargets(l),s.then(function(){return z["default"].waitForOnline})})})})["catch"](O["default"].MediaNeedsReupload,O["default"].GaveUpRetry,function(){return null})}function y(e,t){var n=e.claimUploadTargets();return S["default"].map(n,function(e){return ne["default"].isUser(e)?[e]:window.Store.GroupMetadata.find(e).then(function(e){return e.participants.map(function(e){return e.id})})}).then(function(n){var i=(0,M["default"])({},window.Store.Conn.me,!0);return n.forEach(function(e){e.forEach(function(e){i[e]=!0})}),x["default"].computeRefs(w.computeKeys(e.type(),t).refKey,(0,_["default"])(i))}).then(function(e){return{chatIds:n,refs:e}})}Object.defineProperty(t,"__esModule",{value:!0}),t.uploadMediaForChat=t.downloadMedia=void 0;var E=n(32),_=a(E),b=n(431),M=a(b),C=n(2),S=a(C);t.cancelDownloadMedia=s,t.processRawMedia=l,t.cancelUploadMedia=h;var T=n(1450),w=i(T),k=n(10),P=a(k),N=n(14),O=a(N),D=n(1452),x=a(D),R=n(436),A=a(R),I=n(454),L=a(I),U=n(1330),F=a(U),G=n(1),j=a(G),B=n(434),H=a(B),q=n(1455),W=a(q),V=n(89),z=a(V),Y=n(51),K=a(Y),Q=n(88),X=a(Q),Z=n(67),J=a(Z),$=n(66),ee=a($),te=n(26),ne=a(te),ie=n(148),ae=a(ie),se=n(1425),re=a(se),oe=n(1386),ce=(a(oe),n(1365)),le=O["default"].define("WapBlockedMedia"),ue=O["default"].define("MediaNotOnPhone"),de=O["default"].define("WaitForPoke"),pe=26214400,he=S["default"].wrap(r);t.downloadMedia=he;var fe=S["default"].wrapSync(f);t.uploadMediaForChat=fe},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){e.entries.sort(function(e,t){return s(t)-s(e)})}function s(e){var t=0;switch(e.encrypted&&(t+=1e4),e.needsMediaAck&&(t+=1e3),e.serverStatus){case _.PROBABLY_ON_SERVER:t+=200;break;case _.PROBABLY_OFF_SERVER:break;case _.UNKNOWN:t+=100}return e.uploadHash?t+=20:e._uploadHashPromise&&(t+=10),t}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEntryList=t.MediaEntry=void 0;var r=n(2),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(14),h=i(p),f=n(1452),m=i(f),g=n(1),v=i(g),y=n(1461),E=i(y),_=(n(1365),{PROBABLY_ON_SERVER:"PROBABLY_ON_SERVER",PROBABLY_OFF_SERVER:"PROBABLY_OFF_SERVER",UNKNOWN:"UNKNOWN"}),b=t.MediaEntry=function(){function e(t,n,i,a){(0,l["default"])(this,e),this.needsMediaAck=!1,this.useBackupUrl=!1,this._uploadHashPromise=null,this.mmsUrl=t,this.encryptionKey=n,this.uploadHash=i,this.serverStatus=_.UNKNOWN,this.sidecar=a,this.encrypted&&!this.encryptionKey&&v["default"].assert(!1,"media-fault","No encryption key for "+t)()}return(0,d["default"])(e,[{key:"getUploadHash",value:function(){var e=this;if(this._uploadHashPromise)return this._uploadHashPromise;if(this.uploadHash)return this._uploadHashPromise=o["default"].resolve(this.uploadHash);var t=E["default"].headRetry(this.mmsUrl).then(function(t){if(200!==t.status)throw e.serverStatus=_.PROBABLY_OFF_SERVER,new h["default"].MediaNeedsReupload;var n=t.getResponseHeader("X-WA-Metadata"),i=/\bfilehash=([A-Za-z0-9+\/]+=?=?)(?:;|$)/.exec(n||"");if(i)return e.serverStatus=_.PROBABLY_ON_SERVER,e.uploadHash=i[1];throw v["default"].assert(!1,"wa-metadata-header-missing","HEAD "+e.mmsUrl+" got "+t.status+" (header="+n+")")(),e.serverStatus=_.PROBABLY_OFF_SERVER,new h["default"].MediaNeedsReupload});return t["catch"](function(){e._uploadHashPromise=null}),this._uploadHashPromise=t}},{key:"mmsUrlOrBackup",value:function(){return this.useBackupUrl?this.mmsUrl.replace(/^https:\/\/[^\/]+\//,"https://mms.whatsapp.net/"):this.mmsUrl}},{key:"markWhetherOnServer",value:function(e){this.serverStatus=e?_.PROBABLY_ON_SERVER:_.PROBABLY_OFF_SERVER}},{key:"markNeedsAck",value:function(e){this.needsMediaAck=e,e&&(this.serverStatus=_.PROBABLY_ON_SERVER)}}]),e}();t.MediaEntryList=function(){function e(){(0,l["default"])(this,e),this.entries=[]}return(0,d["default"])(e,[{key:"addEntry",value:function(e,t,n,i){if(!/\.enc$/.test(e))return null;for(var a=this.entries,s=void 0,r=0;!s&&r<a.length;r++)a[r].mmsUrl===e&&(s=a[r]);var o=void 0;if(s)t&&t!==s.encryptionKey&&v["default"].assert(!1,"media-fault","mismatch decryption key for "+e)(),n&&(v["default"].assert(!s.uploadHash||s.uploadHash===n,"media-fault","same entry has multiple upload hashes")(),s.uploadHash=n),i&&(s.sidecar=i),o=s;else{if(!t)return null;o=new b(e,t,n,i),a.push(o)}return o}},{key:"knowsUrl",value:function(e){for(var t=this.entries,n=0;n<t.length;n++)if(t[n].mmsUrl===e)return!0;return!1}},{key:"getUploadEntry",value:function(){a(this);for(var e=this.entries,t=0;t<e.length;t++)if(e[t].encrypted)return e[t];return null}},{key:"getDownloadEntry",value:function(){a(this);var e=this.entries[0];return e&&e.serverStatus!==_.PROBABLY_OFF_SERVER?e:null}},{key:"downloadedLocally",value:function(e){this.entries.forEach(function(t){t.needsMediaAck&&(t.needsMediaAck=!1,t.serverStatus=_.UNKNOWN,m["default"].ackE2EMedia(e,t.encryptionKey,t.mmsUrl))})}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1322),s=i(a),r=n(1350),o=i(r),c=n(103),l=i(c),u=n(6),d=n(38),p=n(8),h=n(1311),f=n(1313),m=n(1312),g=n(1321),v=n(140),y=n(1324),E=n(82),_=n(83),b=u.createClass({displayName:"ArchivedDrawer",mixins:[v],getInitialState:function(){this.selection=new y([],function(e){return e.id})},componentDidMount:function(){this.addObserver(Store.Chat,"change:archive add remove"),this.refs.list&&E.focus(d.findDOMNode(this.refs.list))},onClick:function(e,t){p.openChatFromUnread(t).then(function(e){e&&p.focusChatTextInput(t)}),this.onClose()},onClose:function(){this.context.uim.uie.requestDismiss()},getList:function(){return Store.Chat.filter("archive")},onNextChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setPrev()},render:function(){var e=this,t=void 0,n=this.getList();if(this.selection.init(n,!0),n.length>0){var i=n.map(function(t){return u.createElement(o["default"],{chat:t,mode:r.Mode.LAST,key:t.id,active:e.selection,onClick:e.onClick})}),a={down:this.onNextChat,up:this.onPrevChat};t=u.createElement(l["default"],{handlers:a,ref:"list",className:"drawer-section-main chatlist","data-list-scroll-container":!0},u.createElement(s["default"],{data:i,height:s["default"].DEFAULT_HEIGHT,extraItems:4}))}else t=u.createElement(g.Archived,null);return u.createElement(h,{id:"blocked",onCancel:this.onClose},u.createElement(f,{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:f.Type.LARGE}),u.createElement(m,null,t))}});b.contextTypes={uim:u.PropTypes.instanceOf(_)},e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(103),o=i(r),c=n(1308),l=i(c),u=n(6),d=n(38),p=n(14),h=n(1435),f=n(141),m=n(144),g=n(1314),v=n(140),y=n(10),E=n(8),b=n(1451),M=n(45),C=n(1342),S=n(1370),T=n(1311),w=n(1313),k=n(1312),P=n(1375),N=n(1467),O=n(1465),D=n(1468),x=n(1466),R=n(82),A=n(436),I=n(142),L=n(432),U=n(104),F=n(1327),G=s["default"].TYPE,j=G.IMAGE,B=G.VIDEO,H=G.DOCUMENT,q=G.AUDIO,W=n(434),V=_.pickBy(W.MIMETYPES,function(e){return e.msgType===H}),z=function(e){return 150+15*e},Y=400,K=h.STATE.PROCESSING,Q=u.createClass({displayName:"AttachMediaDrawer",mixins:[f,m,g,v],propTypes:{chat:u.PropTypes.instanceOf(l["default"]),files:u.PropTypes.array,mediaCollection:u.PropTypes.object.isRequired,onBack:u.PropTypes.func.isRequired,onSendMedia:u.PropTypes.func.isRequired,onDropText:u.PropTypes.func.isRequired},getDefaultProps:function(){return{isDragging:!1}},getInitialState:function(){return this.transition="media-scale",{activeMedia:null}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown),this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){this.addObserver(this.props.mediaCollection,"add remove reset"),this.addObserver(this.props.mediaCollection,"change:state",this.onProcessComplete),this.addObserver(this.props.mediaCollection,"max_upload_limit",this.showIgnoredToast)},componentWillUpdate:function(e,t){var n=t.activeMedia,i=this.state.activeMedia;return i&&n&&i!==n?void(this.props.mediaCollection.indexOf(n)>this.props.mediaCollection.indexOf(i)?this.transition="media-slide-forward":this.transition="media-slide-back"):void(this.transition="media-scale")},componentDidUpdate:function(e,t){!t.activeMedia&&this.state.activeMedia&&this.refs.emojiInput?this.refs.emojiInput.restoreFocus():!d.findDOMNode(this).contains(document.activeElement)&&this.refs.sendButton&&R.focus(this.refs.sendButton)},onProcessComplete:function(){if(!this.props.mediaCollection.some({state:K})){var e=this.props.mediaCollection.getValidMedias(),t=this.props.mediaCollection.uiProcessMsgs(),n=t.activeMedia,i=t.errorMsgs;i&&e.length>0&&E.openToast(u.createElement(L,{msg:i,id:L.genId()})),n?this.setState({activeMedia:n}):this.forceUpdate()}},showIgnoredToast:function(e){if(e>0){var t=l10n.t("too_many_files_uploaded",{number:e,_plural:e,max:y.MAX_FILES});E.openToast(u.createElement(L,{msg:t,id:L.genId()}))}},onDragStart:function(e){this.blockDrop=!0},onDragEnd:function(e){this.blockDrop=!1},onDragOver:function(e){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.props.mediaCollection)&&this.props.onBack()},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.onFilePick(e))},onDragLeave:function(e){this.props.mediaCollection.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.activeMedia&&!e.repeat)if(37===e.keyCode){var t=this.state.activeMedia,n=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||n&&(n.isAtBeginning()||!n.getCursor()))&&this.onPrev()}else if(39===e.keyCode){var i=this.state.activeMedia,a=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(i&&!i.caption||a&&(a.isAtEnd()||!a.getCursor()))&&this.onNext()}else 13===e.keyCode&&this.onSend()},onNext:function(){var e=this.props.mediaCollection.getAfter(this.state.activeMedia);e&&this.setState({activeMedia:e})},onPrev:function(){var e=this.props.mediaCollection.getBefore(this.state.activeMedia);e&&this.setState({activeMedia:e})},onSelectThumb:function(e,t){e!==this.state.activeMedia&&this.setState({activeMedia:e})},onSend:function(e){this.props.onSendMedia(_.map(this.props.mediaCollection.getValidMedias(),function(e){var t=e.caption;return t&&(t=_.trim(e.caption)),t&&(t=F.emojify(t)),t&&(e.caption=t),e})),e&&e.preventDefault()},onAddFileClick:function(e){var t=this.refs.input;t.click()},onFilePick:function(e){var t=this;b.getFiles(e).then(function(e){return t.props.mediaCollection.processFiles(e,t.props.chat)}).checkpoint(this.rejectOnUnmount())["catch"](p.Unmount,_.noop)["catch"](p.MediaDragDropError,function(e){if(t.props.mediaCollection.length)throw e;t.props.onDropText(e.src)}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var n=this.props.mediaCollection.getBefore(e)||this.props.mediaCollection.getAfter(e);this.props.mediaCollection.remove(e),this.setState({activeMedia:n})},onCaptionChange:function(e){var t=this.state.activeMedia;t.caption=e.target.value,this.setState({media:t})},onPaste:function(e){e.preventDefault(),e.stopPropagation();var t=new S(e.clipboardData);t.hasFiles()&&this.onFiles(t)},onFiles:function(e){var t=_.filter(e.getFiles(),function(e){var t=A.typeFromMimetype(e.type);return"image"===t||"video"===t});this.props.mediaCollection.processFiles(t,this.props.chat)},getMedia:function(){var e=void 0,t=void 0,n=this.state.activeMedia;switch(n.media.type){case j:case B:var i=void 0;n.media.fullWidth&&n.media.fullHeight&&(i={width:n.media.fullWidth,height:n.media.fullHeight}),e=u.createElement(N,{mimeType:n.media.mimetype,url:n.url,isGif:!!n.media.isGif,size:i}),t=u.createElement("div",{className:"media-caption"},u.createElement(C,{ref:"emojiInput",editable:!0,value:n.caption,placeholder:l10n.t("add_a_caption"),maxLength:y.MAX_CAPTION_LENGTH,showRemaining:!0,onEnter:this.onSend,onChange:this.onCaptionChange,onFiles:this.onFiles,supportsEmoji:!0}));break;case q:e=u.createElement(O,{mimeType:n.media.mimetype,url:n.url});break;case H:switch(W.previewType(n.media.mimetype)){case"pdf":e=u.createElement(D,{preview:n.generatedPreview,mimeType:n.media.mimetype,filename:n.media.filename});break;case"msoffice":e=u.createElement(x,{preview:n.generatedPreview,mimeType:n.media.mimetype,filename:n.media.filename});break;default:e=u.createElement(P,{mimeType:n.media.mimetype,filename:n.media.filename})}}return u.createElement("div",{className:"media-body-container",key:n.id},e,t)},getThumbs:function(e){var t=this;return e.map(function(e,n){var i=M("media-thumb","stagger-delay",{active:e===t.state.activeMedia}),a=t.props.mediaCollection.indexOf(t.state.activeMedia),s=Math.max(t.props.mediaCollection.length-a-1,1),r=z(n)/s*Math.max(0,n-a)+"ms";return u.createElement(X,{className:i,key:"media-"+e.id,media:e,onClick:t.onSelectThumb.bind(null,e),onClose:t.onRemoveThumb.bind(null,e),staggerDelay:r})})},render:function(){var e=void 0,t=void 0,n=void 0,i=0,a=this.props.mediaCollection.getValidMedias();a.length>y.MAX_FILES&&(a=a.slice(0,y.MAX_FILES)),this.props.mediaCollection.some({state:K})?e=u.createElement(I,{key:"processing"}):this.state.activeMedia?e=this.getMedia():0===a.length&&this.props.mediaCollection.errorMsgs&&(e=u.createElement("div",{className:"invalid-media-container",key:"pending"},u.createElement("div",{className:"invalid-media"},this.props.mediaCollection.errorMsgs))),a.length>0&&(t=this.getThumbs(a),i=1===a.length?Y:Y+z(a.length),n=u.createElement("div",{className:"drawer-controls",tabIndex:"-1",ref:"sendButton",onKeyPress:function(e){return e.preventDefault()}},u.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},u.createElement("span",{className:"icon icon-send-light"}))));var s=this.state.isDragging?u.createElement("div",{key:"container",className:"drag-drop"},u.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,r=a.length<y.MAX_FILES?u.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},u.createElement("button",{className:"btn-fill"},u.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null,c={enter:this.onSend};return u.createElement(T,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},u.createElement(w,{title:l10n.t("web_preview_msg"),type:w.Type.OFFSET,onCancel:this.props.onBack}),u.createElement(k,{onDragStart:this.onDragStart,onPaste:this.onPaste,onDragEnd:this.onDragEnd},s,u.createElement("div",{className:"media-body"},u.createElement(U,{transitionName:this.transition},e)),u.createElement(U,{transitionName:"thumb-scale",className:"media-collection"},t,r),u.createElement(o["default"],{handlers:c},u.createElement(U,{transitionName:"btn",delay:i},n)),u.createElement("input",{ref:"input",type:"file",accept:y.IMAGE_MIMES+","+y.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0})))}}),X=u.createClass({displayName:"AttachMediaThumb",propTypes:{media:u.PropTypes.instanceOf(h).isRequired,className:u.PropTypes.string,onClick:u.PropTypes.func,onClose:u.PropTypes.func},render:function(){var e=this.props,t=e.media,i=e.className,a=e.onClick,s=e.onClose,r=void 0,o=void 0,c=void 0;switch(t.media.type){case j:c={backgroundImage:"url("+t.url+")"},r=u.createElement("div",{className:"media-thumb-body",style:c});break;case B:c={backgroundImage:"url(data:image/jpeg;base64,"+t.preview+")"},r=u.createElement("div",{className:"media-thumb-body",style:c});break;case q:r=u.createElement("div",{className:"attach-media-audio-thumb"});break;case H:var l=n(1);if(l.log("media is",t)(),t.media.documentPreview&&t.media.documentPreview.thumbUrl){var d={backgroundImage:"url("+t.media.documentPreview.thumbUrl+")"};V[t.media.mimetype]&&(o=V[t.media.mimetype].icon),o=M(o,"icon-doc","icon-doc-thumb-filetype"),r=u.createElement("div",{className:"media-thumb-body",style:d},u.createElement("div",{className:o}));break}V[t.media.mimetype]&&(o=V[t.media.mimetype].icon);default:o=M(o,"icon-doc"),r=u.createElement("div",{className:"media-thumb-body"},u.createElement("div",{className:o}))}return u.createElement("div",{className:i,onClick:a},u.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:s}),r)}});e.exports=Q},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1322),s=i(a),r=n(6),o=n(8),c=n(1311),l=n(1313),u=n(1312),d=n(1321),p=n(1332),h=n(428),f=n(140),m=n(1388),g=r.createClass({displayName:"BlockedDrawer",mixins:[f],propTypes:{onClose:r.PropTypes.func},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove")},onBlockConfirm:function(e){e.setBlock(!0)["catch"](_.noop),o.closeModal()},onBlock:function(e){var t=function(e){return!!Store.Contact.isFilteredContact(e)&&(!Store.Blocklist.get(e.id)||l10n.t("participant_already_blocked"))};o.openModal(r.createElement(m,{title:l10n.t("add_blocked_title"),filter:t,onCancel:o.closeModal.bind(o),onSelect:_.once(this.onBlockConfirm)}))},onUnblockConfirm:function(e){e.setBlock(!1)["catch"](_.noop),
o.closeModal()},onUnblockCancel:function(){o.closeModal()},onUnblock:function(e,t){o.openModal(r.createElement(h,{okText:l10n.t("unblock_button"),onOK:this.onUnblockConfirm.bind(this,t),cancelText:l10n.t("web_cancel"),onCancel:this.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},render:function(){var e=this,t=void 0,n=void 0;if(Store.Blocklist.length>0){var i=Store.Blocklist.map(function(t){return r.createElement(p,{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=r.createElement("div",{className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(s["default"],{data:i,height:s["default"].DEFAULT_HEIGHT,extraItems:4})),n=r.createElement("div",{className:"hint"},l10n.t("add_blocked_description"))}else t=r.createElement(d.Blocked,null);return r.createElement(c,{id:"blocked",onCancel:this.props.onClose},r.createElement(l,{title:l10n.t("blocked_flow_title"),onBack:this.props.onClose,type:l.Type.LARGE}),r.createElement(u,null,r.createElement("div",{className:"list-action",onClick:this.onBlock},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_blocked_title"))),t,n))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(1322),o=i(r),c=n(6),l=n(1310),u=n(140),d=n(8),p=n(143),h=n(1332),f=n(1311),m=n(1312),g=n(1335),v=n(1344),y=n(1315),E=n(1356),_=n(83),b=n(139),M=c.createClass({displayName:"BroadcastInfoDrawer",mixins:[l,u],propTypes:{chat:c.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{everyoneEncrypted:this.async("chat.contact.plaintextDisabled")}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){d.openChatFromUnread(e).then(function(t){t&&d.focusChatTextInput(e)})})},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onDelete:function(){d.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=e.groupMetadata,n=this.onParticipantClick,i=t.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return c.createElement(h,{contact:t,admin:!!e.isAdmin,onClick:n,key:e.id})}),a=null;if(this.props.onMediaGallery){var s=c.createElement("span",{className:"icon icon-chevron-right-alt"}),r=b.supportsFeature(b.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");a=c.createElement(g,{title:r,titleOnClick:this.props.onMediaGallery,subtitle:s,classes:"animate-enter2",noContainer:!0},c.createElement(E,{chat:e,mediaMsgs:e.getMediaMsgs()}))}var l,u=null,d=i.length?c.createElement(g,{classes:"animate-enter1 well-simple-body",title:l10n.t("web_recipients_title"),subtitle:l10n.n(i.length),"data-list-scroll-offset":!0},c.createElement("div",{className:"drawer-section-body chatlist"},c.createElement(o["default"],{data:i,height:72,extraItems:4}))):null;e.canDelete()&&(l=c.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},c.createElement(v,{iconClass:"icon-delete-danger",a8n:"li-delete-broadcast",className:"danger first",onClick:this.onDelete},l10n.t("web_delete_list"))));var _;e.groupMetadata.creation?(_=p.timeStr(e.groupMetadata.creation),_=c.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:_}))):_=null;var M=null,C=null;return(u||M)&&(C=c.createElement(g,{classes:"well-simple animate-enter2"},u,M)),c.createElement(f,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},c.createElement("header",{className:"pane-header"},c.createElement("div",{className:"header-close"},c.createElement("button",{onClick:this.onClose},c.createElement("span",{className:"icon icon-x"}))),c.createElement("div",{className:"header-body"},c.createElement("div",{className:"header-main"},c.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),_))),c.createElement(m,{expands:!!i.length,"data-list-scroll-container":!0},c.createElement(g,{classes:"drawer-scale drawer-section-photo"},c.createElement(y,{id:e.id,size:y.Size.LARGE})),a,C,d,l))}});M.contextTypes={uim:c.PropTypes.instanceOf(_)},e.exports=M},function(e,t,n){"use strict";var i=n(6),a=n(1346),s=n(1427),r=n(8),o=i.createClass({displayName:"CaptureModal",propTypes:{onSend:i.PropTypes.func.isRequired,stream:i.PropTypes.object.isRequired},onCancel:function(){r.closeModal()},onSend:function(e){this.props.onSend(e.file),this.onCancel()},render:function(){return i.createElement(a,{type:a.BOX},i.createElement(s,{onBack:this.onCancel,caption:!1,onSend:this.onSend,stream:this.props.stream,noContainer:!0}))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(435),c=n(8),l=n(139),u=n(1341),d=n(1309),p=n(428),h=r.createClass({displayName:"ClearChatPopup",propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{keepStarred:!0}},getText:function(){var e=this.props.chat;switch(e.kind){case s["default"].KIND.GROUP:return l10n.t("clear_chat_group",{name:e.title()});case s["default"].KIND.CHAT:return l10n.t("clear_chat_chat",{name:e.title()});case s["default"].KIND.BROADCAST:return l10n.t("clear_chat_broadcast");default:return""}},onCancel:function(){c.closeModal()},onClear:function(){var e=this.props.chat;e.pendingAction++,e.sendClear(l.supportsFeature(l.F.STARRED)&&l.supportsFeature(l.F.CHAT_CLEAR_STARRED)&&this.state.keepStarred)["finally"](function(){e.pendingAction--}),c.closeModal()},onToggleStarred:function(){this.setState({keepStarred:!this.state.keepStarred})},render:function(){var e=void 0;return l.supportsFeature(l.F.STARRED)&&l.supportsFeature(l.F.CHAT_CLEAR_STARRED)&&(e=r.createElement("div",{className:"controls-section",onClick:this.onToggleStarred},r.createElement("div",{"data-a8n":o.key("menu-icon-clear-chat"),className:"control"},r.createElement(u,{onChange:this.onToggleStarred,checked:this.state.keepStarred})),r.createElement("div",{className:"label"},l10n.t("keep_starred")))),r.createElement(p,{title:l10n.t("are_you_sure"),onOK:this.onClear,okText:l10n.t("clear_button"),onCancel:this.onCancel},r.createElement("div",null,r.createElement(d,{text:this.getText()}),e))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1351),s=i(a),r=n(103),o=i(r),c=n(6),l=n(1311),u=n(1313),d=n(1312),p=n(1402),h=n(1321),f=n(144),m=n(82),g=n(1325),v=g.GetRef,y=c.createClass({displayName:"ContactDrawer",mixins:[f],propTypes:{onBack:c.PropTypes.func.isRequired,onClick:c.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",active:!1}},componentDidMount:function(){var e=this;this.safeDefer(function(){e.setState({active:!0})})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},onSearch:function(e){this.setState({searchText:e})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),o["default"].flashFocus=Date.now(),this.refs.list.focusFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&(o["default"].flashFocus=Date.now(),this.props.onClick(e,t))},onFocusSearch:function(e){o["default"].flashFocus=Date.now(),m.focus(this.search)},render:function(){var e=void 0;if(this.state.active){var t=this.getFilteredContacts();e=0===t.length?c.createElement(h.SearchContacts,null):c.createElement(p,{ref:"list",contacts:t,onFocusSearch:this.onFocusSearch,onClick:this.props.onClick})}else e=null;var n={down:this.onFocusList,enter:this.onSelectFirst};return c.createElement(l,{key:"contact-modal",onCancel:this.props.onBack},c.createElement(u,{title:this.props.title,type:u.Type.LARGE,onBack:this.props.onBack}),c.createElement(o["default"],{handlers:n},c.createElement(s["default"],{ref:v("search",this),onSearch:this.onSearch,placeholder:l10n.t("search_contacts")})),c.createElement(d,{"data-list-scroll-container":!0},e))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1322),s=i(a),r=n(1350),o=i(r),c=n(1381),l=i(c),u=n(218),d=i(u),p=n(6),h=n(1310),f=n(144),m=n(1314),g=n(140),v=n(1369),y=n(8),E=n(1),b=n(1431),M=n(428),C=n(1356),S=n(1311),T=n(1312),w=n(1344),k=n(1335),P=n(1315),N=n(1490),O=n(1309),D=n(1380),x=n(14),R=n(139),A=n(83),I=n(1408),L=n(26),U=n(10),F=p.createClass({displayName:"ContactInfoDrawer",mixins:[h,f,m,g],propTypes:{contact:p.PropTypes.instanceOf(d["default"]).isRequired,onVerification:p.PropTypes.func},getInitialState:function(){return this.asyncState({status:"contact.Status.status",encryptionStatus:"contact.plaintextDisabled"},{commonGroups:void 0,contactIsBlocked:!!Store.Blocklist.get(this.props.contact.id)})},componentDidMount:function(){this.addObserver(Store.Blocklist,"add remove reset sync",this.onBlocklistChange),this.uiIdle(this._init)},_init:function(){var e=this;this.props.contact.findCommonGroups().checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({commonGroups:t}),e.addObserver(Store.GroupMetadata,"group_participant_change",e.commonGroupsUpdate)})["catch"](x.Unmount,_.noop)["catch"](x.WapDrop,_.noop)["catch"](_.noop),R.supportsFeature(R.F.QUERY_IDENTITY)&&this.props.contact.queryIdentity()["catch"](function(e){E.error("contactInfoDrawer:queryIdentity error: "+e)()})},onBlocklistChange:function(e){this.state.contactIsBlocked!==!!Store.Blocklist.get(this.props.contact.id)&&this.setState({contactIsBlocked:!!Store.Blocklist.get(this.props.contact.id)})},commonGroupsUpdate:function(e){var t=this.state.commonGroups,n=this.props.contact.updateCommonGroups(t,e);n&&this.setState({commonGroups:n})},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);y.deleteOrExitChat(e)},onBlockContact:function(){y.openModal(p.createElement(M,{title:l10n.t("block"),onOK:this.blockContact,okText:l10n.t("block"),onCancel:y.closeModal.bind(y),cancelText:l10n.t("web_cancel")},l10n.t("block_confirmation",{contact:this.props.contact.formattedName})))},onUnblockContact:function(){y.openModal(p.createElement(M,{okText:l10n.t("unblock_button"),onOK:this.unblockContact,cancelText:l10n.t("web_cancel"),onCancel:y.closeModal.bind(y)},l10n.t("unblock_confirmation",{contact:this.props.contact.formattedName})))},blockContact:function(){this.props.contact.setBlock(!0),y.closeModal()},unblockContact:function(){this.props.contact.setBlock(!1),y.closeModal()},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onCopy:function(e){var t=v.extractIsolatedBlocks(window.getSelection());e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,n=function(e){e(t)};y.openModalMedia(p.createElement(b,{contact:this.props.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},onClick:function(e,t){y.openChatFromUnread(t).then(function(e){e&&y.focusChatTextInput(t)}),this.onClose()},render:function(){var e,t,n=this,i=this.props.contact,a=this.state.commonGroups;a=_.compact(_.values(a)),_.isArray(a)&&a.length&&(e=a.map(function(e){return p.createElement(o["default"],{chat:e,mode:r.Mode.INFO,onClick:n.onClick,key:e.id})}),e=p.createElement(k,{classes:"animate-enter well-simple-body",title:l10n.t("web_groups_participation_you_and_name"),subtitle:l10n.n(a.length),"data-list-scroll-offset":!0,noContainer:!0},p.createElement("div",{className:"drawer-section-body chatlist"},p.createElement(s["default"],{data:e,height:72,extraItems:4}))));var u=Store.Chat.get(i.id);_.isArray(a)&&u&&u.canDelete()&&(t=p.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},p.createElement(w,{iconClass:"icon-delete-danger",className:"danger first",a8n:"li-delete-chat",onClick:this.onDeleteChat},l10n.t("delete_chat"))));var d=null;this.props.contact.canBlock()&&(d=this.state.contactIsBlocked?p.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},p.createElement(w,{className:"success first",a8n:"li-unblock",iconClass:"icon-settings-blocked-success",onClick:this.onUnblockContact},l10n.t("unblock_contact"))):p.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},p.createElement(w,{className:"first",a8n:"li-block",iconClass:"icon-settings-blocked",onClick:this.onBlockContact},l10n.t("block_contact"))));var h=null;if(this.props.onMediaGallery&&u){var f=p.createElement("span",{className:"icon icon-chevron-right-alt"}),m=R.supportsFeature(R.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");h=p.createElement(k,{title:m,titleOnClick:this.props.onMediaGallery,subtitle:f,classes:"animate-enter2",noContainer:!0},p.createElement(C,{chat:u,mediaMsgs:u.getMediaMsgs()}))}var g=null,v=u&&u.mute.canMute()?p.createElement(I,{chat:u}):null,y=null,E=null,b=null;(v||y||E)&&(b=p.createElement(k,{classes:"well-simple animate-enter2"},v,y,E));var M=U.STATUS_V3?null:p.createElement(D,{classes:"row-drawer-item"},p.createElement(N,{dir:"auto"},p.createElement(O,{className:"title",selectable:!0,direction:"auto",text:this.state.status}))),x=p.createElement(D,{classes:"row-drawer-item last"},p.createElement(N,{className:"selectable-text title",dir:"auto"},L.formattedUser(i.id))),A=l10n.t("contact_info_status_phone"),F=l10n.t("contact_info_phone_number"),G=p.createElement(k,{classes:"animate-enter2 well-simple-body",title:U.STATUS_V3?F:A},M,x),j=u&&u.presence?p.createElement(l["default"],{presence:u.presence,chatstate:u.presence.chatstate,location:c.Location.LIST}):null;return p.createElement(S,{key:"contact-info-modal",id:"info",variant:"panel"},p.createElement("header",{className:"pane-header"},p.createElement("div",{className:"header-close"},p.createElement("button",{onClick:this.onClose},p.createElement("span",{className:"icon icon-x"}))),p.createElement("div",{className:"header-body"},p.createElement("div",{className:"header-main"},p.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),p.createElement(T,{"data-list-scroll-container":!0,onCopy:this.onCopy},p.createElement("div",{className:"well well-chat"},p.createElement(P,{id:i.id,size:P.Size.LARGE,loader:!0,className:"drawer-scale well-chat-avatar",onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:P.Quality.HIGH}),p.createElement("div",{className:"well-chat-name"},p.createElement(N,{dir:"auto"},p.createElement(O,{selectable:!0,text:i.formattedUser}))),p.createElement("div",{className:"well-chat-secondary"},j)),h,b,G,g,e,d,t))}});F.contextTypes={uim:p.PropTypes.instanceOf(A)},e.exports=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(8),c=n(1310),l=n(140),u=n(1314),d=n(1311),p=n(1313),h=n(1312),f=n(1335),m=n(1472),g=n(1363),v=n(142),y=n(432),E=n(14),b=n(45),M=n(10),C=n(83),S=r.createClass({displayName:"ContactMsgInfoDrawer",mixins:[c,l,u],propTypes:{msg:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](E.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),o.openToast(r.createElement(y,{msg:l10n.t("msg_info_failed"),id:y.genId("msg_info_failed")}))})},componentDidMount:function(){if(this.props.msg.type===s["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return e===this.props.msg.id&&(!!t||this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;if(e)return e.refs.component&&e.refs.component.refs.msg},onClose:function(){this.context.uim.uie.requestDismiss()},render:function(){var e=this.props.msg,t=this.state,n=t.msgInfo,i=t.star,a=t.unimplemented,o=void 0,c=void 0;if(n){var l=[],u=void 0,y=void 0,E=void 0;n.isPTT&&(c=l10n.t("message_info_seen"),u=n.played.head(),y=u&&u.t,E=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),l.push(r.createElement(m,{title:l10n.t("message_info_played"),t:y,icon:E,key:"played"}))),u=n.read.head(),y=u&&u.t,E=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck-ack"}),c=c||l10n.t("message_info_read"),l.push(r.createElement(m,{title:c,t:y,icon:E,key:"read"})),u=n.delivery.head(),y=u&&u.t,E=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck"}),l.push(r.createElement(m,{title:l10n.t("message_info_delivered"),t:y,icon:E,key:"delivery"})),o=r.createElement(f,{classes:"drawer-section-info well animate-enter"},l)}var _=void 0;n||a||(_=r.createElement(f,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(v,{size:50,stroke:4})));var C=b("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===s["default"].TYPE.PTT||e.type===s["default"].TYPE.IMAGE||e.type===s["default"].TYPE.LOCATION||e.type===s["default"].TYPE.VCARD||e.isGif});return r.createElement(d,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(p,{title:l10n.t("message_info"),type:p.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:C,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(g,{msg:e,key:"star-"+i.toString(),ref:"wrapper",displayType:M.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:g.Position.END}))),r.createElement(h,{classes:"drawer-body-msg-info"},_,o))}});S.contextTypes={uim:r.PropTypes.instanceOf(C)},e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(103),o=i(r),c=n(6),l=n(8),u=n(1346),d=n(1311),p=n(1313),h=n(1312),f=n(1434),m=n(1331),g=c.createClass({displayName:"ContactViewerModal",propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired},render:function(){return c.createElement(u,{type:u.BOX},c.createElement(d,{key:"vcard-modal",onCancel:function(){return l.closeModal()}},c.createElement(p,{title:l10n.t("contact_viewer"),type:p.Type.POPUP,onCancel:function(){return l.closeModal()}}),c.createElement(h,null,c.createElement(o["default"],null,c.createElement(f,{parsedVCard:this.props.msg.vcard,thumbnail:m.thumbnail(this.props.msg.body),className:"chatlist column"})))))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(435),c=n(1),l=n(8),u=n(1310),d=n(1309),p=r.createClass({displayName:"DeleteChatPopup",mixins:[u],propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.title();return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){l.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():c.error("deleteChatPopup:onDelete Unsupported chat type")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),l.closeModal()},render:function(){return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title"},l10n.t("are_you_sure")),r.createElement("div",{className:"popup-contents"},r.createElement(d,{text:this.getText()}))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{"data-a8n":o.key("cancel-btn"),className:"btn-plain popup-controls-item",onClick:this.onCancel},l10n.t("web_cancel")),r.createElement("button",{"data-a8n":o.key("delete-btn"),className:"btn-plain btn-default popup-controls-item",onClick:this.onDelete},this.getButton())))))}});e.exports=p},function(e,t,n){"use strict";var i=n(6),a=n(435),s=n(1),r=n(8),o=n(1341),c=n(432),l=n(45),u=n(0),d={title:0,hour:1,day:24,week:168},p=i.createClass({displayName:"DoNotDisturbSettings",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:d.title}},componentWillUnmount:function(){this.state.dnd!==d.title&&r.openToast(i.createElement(c,{msg:this.globalMuteDurationLabel(this.state.dnd),id:c.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return s.log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onPreviews:function(){var e=!this.state.previews;this.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:d.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var n=u().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(n)},onClose:function(e){r.closeModal()},render:function(){var e=[];if(window.Notification){e.push(i.createElement("div",{className:"controls-section",onClick:this.onNotifications,key:0},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onNotifications,checked:this.state.notifications})),i.createElement("div",{className:"label"},l10n.t("option_desktop_notifications"))));var t=l("controls-section",{disabled:!this.state.notifications});e.push(i.createElement("div",{className:t,onClick:this.onPreviews,key:1},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onPreviews,checked:this.state.previews})),i.createElement("div",{className:"label"},l10n.t("option_msg_previews"),i.createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))))}return i.createElement("div",{className:"controls-container drawer-section"},i.createElement("div",{className:"controls-section",onClick:this.onSounds},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onSounds,checked:this.state.sounds})),i.createElement("div",{className:"label"},l10n.t("option_sounds"))),e,i.createElement("div",{className:"controls-section controls-section-wide"},i.createElement("div",{className:"select"},i.createElement("select",{value:this.state.dnd,onChange:this.onDND},i.createElement("option",{value:d.title,disabled:this.state.state===d.title},l10n.t("option_select_mute")),i.createElement("option",{value:d.hour,disabled:this.state.state===d.hour},l10n.t("mute_1hour")),i.createElement("option",{value:d.day,disabled:this.state.state===d.day},l10n.t("mute_1day")),i.createElement("option",{value:d.week,disabled:this.state.state===d.week},l10n.t("mute_1week"))))))}});e.exports=p},function(e,t,n){"use strict";var i=n(6),a=n(45),s=i.createClass({displayName:"DrawerSectionFooter",propTypes:{children:i.PropTypes.node.isRequired,separator:i.PropTypes.bool},getDefaultProps:function(){return{separator:!1}},render:function(){var e=a("drawer-section-footer",{separator:this.props.separator});return i.createElement("div",{className:e},i.createElement("div",{className:"col-main"},this.props.children))}});e.exports=s},function(e,t,n){"use strict";var i=n(6),a=n(8),s=n(10),r=n(67),o=n(26),c=n(428),l=n(83),u=i.createClass({displayName:"E2EInfoModal",propTypes:{e2eSubtype:i.PropTypes.string.isRequired,jid:i.PropTypes.string,chatId:i.PropTypes.string,unencryptedContact:i.PropTypes.string},onLearnMore:function(){var e;switch(this.props.e2eSubtype){case"info_encrypted":case"info_unencrypted":e=s.E2E_FAQ_LINK;break;case"identity":e=s.CODE_CHANGE_FAQ_LINK;break;case"encrypt":default:e=s.SECURITY_LINK}var t=r.build(e,{lg:Store.Conn.lg,lc:Store.Conn.lc});window.open(t,"_blank")},onVerificationClick:function(){a.closeModal(),a.verificationDrawer(this.props.jid)},render:function(){var e,t=null,n=null,s=a.closeModal.bind(a),r=l10n.t("web_ok");switch(this.props.e2eSubtype){case"info_encrypted":o.isGroup(this.props.chatId)?e=l10n.t("web_group_info_encrypted_description"):o.isBroadcast(this.props.chatId)&&(e=l10n.t("web_broadcast_info_encrypted_description"));break;case"info_unencrypted":e=o.isGroup(this.props.chatId)?l10n.t("web_group_info_unencrypted_description"):o.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_info_unencrypted_description"):l10n.t("web_contact_info_unencrypted_description",{contact:this.props.unencryptedContact});break;case"identity":var l=Store.Contact.get(this.props.jid),u=l?l.formattedName:"";e=l10n.t("web_security_code_change_description",{name:u}),t=s,n=r,s=this.onVerificationClick,r=l10n.t("web_verify_button");break;case"encrypt":default:e=o.isGroup(this.props.chatId)?l10n.t("web_group_encryption_state_change_description"):o.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_encryption_state_change_description"):l10n.t("web_individual_chat_encryption_state_change_description")}var d=i.createElement("span",{className:"action",onClick:this.onLearnMore},l10n.t("learn_more"));return i.createElement(c,{onOK:s,okText:r,onCancel:t,cancelText:n},e," ",d)}});u.contextTypes={uim:i.PropTypes.instanceOf(l)},e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(1322),o=i(r),c=n(6),l=n(1310),u=n(140),d=n(8),p=n(143),h=n(1332),f=n(1356),m=n(1311),g=n(1312),v=n(1335),y=n(1344),E=n(1377),_=n(1309),b=n(1319),M=n(428),C=n(1547),S=n(432),T=n(1327),w=n(1342),k=n(1343),P=n(216),N=n(83),O=n(1408),D=n(139),x=n(10),R=S.genId("max_participant_toast"),A=c.createClass({displayName:"GroupInfoDrawer",mixins:[l,u],propTypes:{chat:c.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1,everyoneEncrypted:this.async("chat.contact.plaintextDisabled"),contextMenu:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var i;i=e&&t?n.setPicture(e,t):n.deletePicture(),i.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){d.openChatFromUnread(e).then(function(t){t&&d.focusChatTextInput(e)})})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,n=t.get(e.id);return n&&(t.canPromote(n)||t.canRemove(n)||t.canVerifyIdentity(n))},onParticipantMenu:function(e,t){var n=this.props.chat.groupMetadata.participants,i=n.get(t.id);if(this.menuEnabled(t)){var a=[];if(n.canPromote(i)){var s=this.confirmParticipantPromote.bind(this,i);a.push(c.createElement(b,{a8n:"mi-grp-promote-admin",key:"promote",action:s},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var r=this.confirmParticipantRemove.bind(this,i);a.push(c.createElement(b,{a8n:"mi-grp-remove-participant",key:"remove",action:r,shortcut:"d"},l10n.t("menuitem_remove")))}e.event&&e.event.persist(),this.setState({contextMenu:{contactId:t.id,menu:a,anchor:e.anchor,event:e.event}})}},contextClose:function(){this.setState({contextMenu:!1})},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),n=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});d.openModal(c.createElement(M,{onOK:t,okText:l10n.t("remove"),onCancel:d.closeModal.bind(d),cancelText:l10n.t("web_cancel")},c.createElement(_,{text:n})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),d.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),n=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});d.openModal(c.createElement(M,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:d.closeModal.bind(d),cancelText:l10n.t("web_cancel")},c.createElement(_,{text:n})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),d.closeModal()},onVerifyIdentity:function(e){this.props.onVerification(e.contact)},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=x.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:x.MAX_GROUP_SIZE});d.openToast(c.createElement(S,{msg:e,id:R}))}else{var t=c.createElement(C,{chat:this.props.chat});d.openModal(t,"modal-flow")}},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onExitOrDeleteGroup:function(){d.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetSubjectError:function(){d.openModal(c.createElement(M,{onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,n=t.groupMetadata;if(n.canSetSubject()){var i=T.emojify(this.state.name);if(i===t.contact.name)return this.setState({name:i});this.setState({pendingSubject:!0}),t.setSubject(i).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})})}},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,n=this.props.chat,i=n.groupMetadata,a=this,s=i.participants.map(function(e){var t=e.contact,n=a.state.contextMenu&&t.id===a.state.contextMenu.contactId;return c.createElement(h,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:a.onParticipantClick,contextEnabled:a.menuEnabled.bind(a,t),contextMenu:n,onContext:a.onParticipantMenu,showNotifyName:!0})});n.canDelete()&&(t=c.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},c.createElement(y,{iconClass:"icon-exit",a8n:"li-delete-group",className:"danger first",onClick:this.onExitOrDeleteGroup},n.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),
i.participants.canAdd()&&(e=c.createElement("div",{className:"list-action list-action-alt",title:l10n.t("add_group_participant"),onClick:this.openAddGroupParticipantFlow},c.createElement("div",{className:"list-action-icon"},c.createElement("span",{className:"icon icon-add-user-light"})),c.createElement("div",{className:"list-action-body ellipsify"},l10n.t("add_group_participant"))));var r=void 0;i.participants.iAmAdmin()&&this.props.onGroupInviteLink&&(r=c.createElement("div",{className:"list-action list-action-alt",title:l10n.t("group_invite_link"),onClick:this.props.onGroupInviteLink},c.createElement("div",{className:"list-action-icon"},c.createElement("span",{className:"icon icon-link"})),c.createElement("div",{className:"list-action-body ellipsify"},l10n.t("group_invite_link"))));var l=s.length?c.createElement(v,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:s.length,max:x.MAX_GROUP_SIZE}),"data-list-scroll-offset":!0,classes:"animate-enter2 well-simple-body",ref:"container",noContainer:!0},e,r,c.createElement("div",{className:"drawer-section-body chatlist"},c.createElement(o["default"],{data:s,height:o["default"].DEFAULT_HEIGHT,extraItems:4}))):null,u=null;if(this.props.onMediaGallery){var d=c.createElement("span",{className:"icon icon-chevron-right-alt"}),_=D.supportsFeature(D.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");u=c.createElement(v,{title:_,titleOnClick:this.props.onMediaGallery,subtitle:d,classes:"animate-enter2",noContainer:!0},c.createElement(f,{chat:n,mediaMsgs:n.getMediaMsgs()}))}var b=n.contact.profilePicThumb,M=n.isReadOnly||!b.canDelete()&&!b.canSet()?E.Type.NO_EDIT:E.Type.GROUP,C=c.createElement(E,{className:"well-chat-avatar",type:M,id:n.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet}),S=null;n.groupMetadata.creation&&(S=c.createElement("div",{className:"well-chat-secondary well-chat-secondary-group"},l10n.t("web_group_creation_time",{when:p.relativeDateAndTimeStr(n.groupMetadata.creation)})));var T=null,N=n&&n.mute.canMute()?c.createElement(O,{chat:n}):null,R=null,A=void 0;this.state.contextMenu&&(A=c.createElement(P,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},c.createElement(k,{contextMenu:this.state.contextMenu})));var I=null;return(N||R||T)&&(I=c.createElement(v,{classes:"well-simple animate-enter2"},N,R,T)),c.createElement(m,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},c.createElement("header",{className:"pane-header"},c.createElement("div",{className:"header-close"},c.createElement("button",{onClick:this.onClose},c.createElement("span",{className:"icon icon-x"}))),c.createElement("div",{className:"header-body"},c.createElement("div",{className:"header-main"},c.createElement("div",{className:"header-title"},l10n.t("web_group_info"))))),c.createElement(g,{"data-list-scroll-container":!0},c.createElement("div",{className:"well well-chat"},C,c.createElement("div",{className:"well-chat-name"},c.createElement(w,{value:this.state.name,editable:i.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:x.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject,supportsEmoji:!0,lockable:!0,lowProfile:!0,className:"text-input-large"})),S),u,I,l,t),A)}});A.contextTypes={uim:c.PropTypes.instanceOf(N)},e.exports=A},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1308),o=i(r),c=n(6),l=n(1311),u=n(1313),d=n(1312),p=n(142),h=n(1314),f=n(14),m=n(140),g=n(1315),v=n(1309),y=n(1344),E=n(1550),b=n(1554),M=n(8),C=n(432),S={LOADING:0,REVOKING:1,SUCCESS:2},T=c.createClass({displayName:"GroupInviteLinkDrawer",mixins:[h,m],propTypes:{chat:c.PropTypes.instanceOf(o["default"]).isRequired,onBack:c.PropTypes.func.isRequired},getInitialState:function(){return{state:S.LOADING}},getErrorMessageFromStatusCode:function(e){switch(e){case 401:return l10n.t("group_invite_query_401");case 403:return l10n.t("group_invite_query_403");case 404:return l10n.t("group_invite_query_404");default:return l10n.t("group_invite_query_406")}},handleLoadingStatusCode:function(e){if(200===e)this.setState({state:S.SUCCESS});else{var t=this.getErrorMessageFromStatusCode(e);this.props.onBack(),M.openToast(c.createElement(C,{msg:t,id:C.genId()}))}},componentWillMount:function(){this.addObserver(this.props.chat.groupMetadata,"change:inviteCode"),this.props.chat.groupMetadata.groupInviteCode().checkpoint(this.rejectOnUnmount).then(this.handleLoadingStatusCode)["catch"](f.Unmount,_.noop)},onRevokeGroupInvite:function(){M.openModal(c.createElement(E,{chat:this.props.chat,onConfirm:this.onConfirmRevokeGroupInvite}),"modal-flow")},handleRevokingStatusCode:function(e){if(200===e)M.openToast(c.createElement(C,{msg:l10n.t("group_invite_revoke_success"),id:C.genId()})),this.setState({state:S.SUCCESS});else{var t=this.getErrorMessageFromStatusCode(e);this.props.onBack(),M.openToast(c.createElement(C,{msg:t,id:C.genId()}))}},onConfirmRevokeGroupInvite:function(){var e=this;this.setState({state:S.REVOKING}),s["default"].props({_:s["default"].delay(500),status:this.props.chat.groupMetadata.revokeGroupInvite()}).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status;e.handleRevokingStatusCode(n)})["catch"](f.Unmount,_.noop)},onSendGroupInviteLink:function(){M.openModal(c.createElement(b,{chat:this.props.chat}),"modal-flow")},onClickGroupInviteLink:function(e){e.preventDefault(),this.onSendGroupInviteLink()},onCopyLink:function(){window.getSelection().removeAllRanges();var e=document.querySelector("#group-invite-link-anchor"),t=document.createRange();t.selectNode(e),window.getSelection().addRange(t);var n=void 0;try{n=document.execCommand("copy"),window.getSelection().removeAllRanges()}catch(i){n=!1}n?M.openToast(c.createElement(C,{msg:l10n.t("group_invite_link_copy_success"),id:C.genId()})):M.openToast(c.createElement(C,{msg:l10n.t("group_invite_link_copy_failed"),id:C.genId()}))},renderDrawerBody:function(){var e=this.props.chat.groupMetadata,t=void 0;if(this.state.state===S.LOADING)t=c.createElement("div",{className:"group-invite-loading-container"},c.createElement(p,{className:"group-invite-spinner",size:55,stroke:3}),c.createElement("span",null,l10n.t("group_invite_check_link")));else if(this.state.state===S.REVOKING)t=c.createElement("div",{className:"group-invite-loading-container"},c.createElement(p,{className:"group-invite-spinner",size:55,stroke:3}),c.createElement("span",null,l10n.t("group_invite_revoke_in_progress",{groupName:this.props.chat.contact.name})));else{var n=e.groupInviteLink,i=null;document.queryCommandSupported("copy")&&(i=c.createElement(y,{iconClass:"icon-copy",a8n:"li-copy-link",onClick:this.onCopyLink},l10n.t("group_invite_drawer_copy_link"))),t=c.createElement(d,{wide:!0},c.createElement("div",{className:"chatlist list-identity list-invite"},c.createElement("div",{className:"chat chat-idle","data-ignore-capture":"any"},c.createElement("div",{className:"chat-avatar"},c.createElement(g,{id:this.props.chat.id,size:82,quality:g.Quality.HIGH})),c.createElement("div",{className:"chat-body"},c.createElement("div",{className:"chat-main"},c.createElement("div",{className:"chat-title"},c.createElement("span",{className:"emojitext ellipsify",dir:"auto"},c.createElement(v,{text:this.props.chat.contact.name,direction:"auto"})))),c.createElement("div",{className:"chat-status"},c.createElement("a",{id:"group-invite-link-anchor",href:n,onClick:this.onClickGroupInviteLink},n))))),c.createElement("div",{className:"controls-container drawer-section"},c.createElement("div",{className:"controls-section"},l10n.t("group_invite_link_description"))),c.createElement("div",{className:"chatlist list-icons list-actions"},c.createElement(y,{iconClass:"icon-share",a8n:"li-share-link",onClick:this.onSendGroupInviteLink},l10n.t("group_invite_drawer_send_link")),i,c.createElement(y,{iconClass:"icon-revoke",a8n:"li-revoke-link",onClick:this.onRevokeGroupInvite},l10n.t("group_invite_drawer_revoke_link"))))}return t},render:function(){return c.createElement(l,{id:"invite",onCancel:this.props.onBack},c.createElement(u,{title:l10n.t("group_invite_link"),onBack:this.props.onBack,type:u.Type.SMALL}),this.renderDrawerBody())}});e.exports=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(146),o=i(r),c=n(1333),l=i(c),u=n(1366),d=i(u),p=n(6),h=n(428),f=n(142),m=n(1315),g=n(1314),v=n(8),y=n(14),E=n(10),b=n(66),M={LOADING:0,SUCCESS:1,ACCEPT_ERROR:2,QUERY_ERROR:3},C=p.createClass({displayName:"GroupInviteModal",mixins:[g],props:{groupCode:p.PropTypes.string.isRequired},getInitialState:function(){return{state:M.LOADING,status:void 0,groupMetadata:void 0}},componentWillMount:function(){var e=this;b.groupInviteInfo(this.props.groupCode).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status,i=(0,o["default"])(t,["status"]);if(200===n){var a=new d["default"](i);Store.Contact.gadd(i.id),e.setState({status:n,groupMetadata:a,state:M.SUCCESS})}else e.setState({status:n,state:M.QUERY_ERROR})})["catch"](y.Unmount,_.noop)},onViewGroup:function(){v.openChatFromUnread(Store.Chat.get(this.state.groupMetadata.id)),v.closeModal()},onJoinGroup:function(){var e=this;b.acceptGroupInvite(this.props.groupCode).then(function(e){var t=e.status,n=e.gid;return 200===t?Store.Chat.find(n):s["default"].reject(t)}).then(function(e){v.openChatFromUnread(e).then(function(t){t&&v.focusChatTextInput(e)}),v.closeModal()}).checkpoint(this.rejectOnUnmount)["catch"](y.Unmount,_.noop)["catch"](function(t){e.setState({state:M.ACCEPT_ERROR,status:t})})},onCancel:function(){v.closeModal()},render:function(){var e=this.state,t=e.state,n=e.status,i=e.groupMetadata,a={cancelText:l10n.t("group_invite_cancel"),onCancel:this.onCancel},s=void 0;if(t===M.LOADING)s=p.createElement("div",{className:"group-invite-loading-container"},p.createElement(f,{className:"group-invite-spinner",size:55,stroke:3}),p.createElement("span",null,l10n.t("group_invite_check_link")));else if(t===M.SUCCESS){var r=i.participants.map(function(e){return p.createElement("div",{key:e.id,className:"participant-wrapper"},p.createElement(m,{className:"participant-image",size:50,id:e.id}),p.createElement("span",{className:"participant-text"},e.contact.formattedName))}),o=Store.Contact.gadd(i.owner).formattedName,c=""+E.GROUP_INVITE_URL+this.props.groupCode;s=p.createElement("div",{className:"group-invite-modal"},p.createElement("div",{className:"metadata-container"},p.createElement("div",{className:"metadata-icon"},p.createElement("div",{className:"icon-group-default"}),p.createElement(l["default"],{src:c})),p.createElement("div",{className:"metadata-text"},p.createElement("span",{className:"metadata-title"},i.subject),p.createElement("span",{className:"metadata-subtitle"},l10n.t("group_invite_created_by",{participant:o})))),p.createElement("span",{className:"participants-title"},l10n.t("group_invite_participants",{count:r.length,_plural:r.length})),p.createElement("div",{className:"participants-container"},r));var u=Store.Chat.get(i.id),d=!!u&&!u.isReadOnly;a.onOK=d?this.onViewGroup:this.onJoinGroup,a.okText=d?l10n.t("group_invite_view"):l10n.t("group_invite_join")}else{var g=void 0;if(t===M.QUERY_ERROR)switch(n){case 401:g=l10n.t("group_invite_query_401");break;case 403:g=l10n.t("group_invite_query_403");break;case 404:g=l10n.t("group_invite_query_404");break;case 406:g=l10n.t("group_invite_query_406");break;case 410:g=l10n.t("group_invite_query_410");break;default:g=l10n.t("group_invite_query_500")}else if(t===M.ACCEPT_ERROR)switch(n){case 401:g=l10n.t("group_invite_accept_401");break;case 404:g=l10n.t("group_invite_accept_404");break;case 410:g=l10n.t("group_invite_accept_410");break;case 419:g=l10n.t("group_invite_accept_419");break;default:g=l10n.t("group_invite_accept_500")}a.cancelText=l10n.t("web_ok"),s=p.createElement("div",null,g)}return p.createElement(h,a,s)}});e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(428),c=n(8),l=r.createClass({displayName:"GroupInviteRevokeModal",propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onConfirm:r.PropTypes.func.isRequired},onCancel:function(){c.closeModal()},onOK:function(){this.props.onConfirm(),c.closeModal()},render:function(){return r.createElement(o,{title:l10n.t("group_invite_drawer_revoke_link"),onOK:this.onOK,okText:l10n.t("group_invite_drawer_revoke_link"),onCancel:this.onCancel,cancelText:l10n.t("web_cancel")},r.createElement("div",{className:"textfield-static"},l10n.t("group_invite_revoke_confirmation_text",{groupName:this.props.chat.contact.name})))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(8),c=n(1310),l=n(140),u=n(1314),d=n(1311),p=n(1313),h=n(1312),f=n(1335),m=n(1577),g=n(1473),v=n(1363),y=n(142),E=n(432),b=n(1629),M=n(14),C=n(45),S=n(83),T=n(10),w=r.createClass({displayName:"GroupMsgInfoDrawer",mixins:[c,l,u],propTypes:{msg:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t.played,"add remove"),e.addObserver(t.read,"add remove"),e.addObserver(t.delivery,"add remove"),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](M.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),o.openToast(r.createElement(E,{msg:l10n.t("msg_info_failed"),id:E.genId("msg_info_failed")}))})},getAnimateEnterClass:function(e){return"animate-enter"+(e===-1?"":e)},componentDidMount:function(){if(this.props.msg.type===s["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return e===this.props.msg.id&&(!!t||this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;if(e)return e.refs.component&&e.refs.component.refs.msg},onClose:function(){this.context.uim.uie.requestDismiss()},render:function(){var e,t=this.props.msg,n=this.state,i=n.msgInfo,a=n.star,o=n.unimplemented,c=-1,l=24,u=26,E=void 0,_=void 0;if(i&&i.isPTT){var M=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),S=i.played.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),w=S.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},S):null,k=i.playedRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.playedRemaining,_plural:i.playedRemaining})):null,P=C(this.getAnimateEnterClass(c),"well-simple-body");_=l10n.t("message_info_seen_by"),e=k?l+u:l,I=b.minHeight(S,e),E=r.createElement(f,{classes:P,key:"played-section",style:I,title:l10n.t("message_info_played_by"),subtitle:M,footer:k},w)}var N=void 0;if(i&&(i.read.length>0||i.playedRemaining>0)){var O=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck-ack"}),D=i.read.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),x=D.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},D):null,R=i.readRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.readRemaining,_plural:i.readRemaining})):null,A=C(this.getAnimateEnterClass(c),"well-simple-body");_=_||l10n.t("message_info_read_by"),e=R?l+u:l;var I=b.minHeight(D,e);N=r.createElement(f,{classes:A,key:"read-section",title:_,style:I,subtitle:O,footer:R},x)}var L=void 0;if(i&&(i.delivery.length>0||i.deliveryRemaining>0)){var U=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck"}),F=i.delivery.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),G=F.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},F):null,j=i.deliveryRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.deliveryRemaining,_plural:i.deliveryRemaining})):null,B=C(this.getAnimateEnterClass(c),"well-simple-body");e=j?l+u:l,I=b.minHeight(F,e),L=r.createElement(f,{classes:B,key:"delivered-section",style:I,title:l10n.t("message_info_delivered_to"),subtitle:U,footer:j},G)}var H=void 0;i||o||(H=r.createElement(f,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(y,{size:50,stroke:4})));var q=C("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":t.type===s["default"].TYPE.PTT||t.type===s["default"].TYPE.IMAGE||t.type===s["default"].TYPE.LOCATION||t.type===s["default"].TYPE.VCARD||t.isGif});return r.createElement(d,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(p,{title:l10n.t("message_info"),type:p.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:q,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(v,{msg:t,key:"star-"+a.toString(),ref:"wrapper",displayType:T.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:v.Position.END}))),r.createElement(h,{classes:"drawer-body-msg-info"},H,E,N,L))}});w.contextTypes={uim:r.PropTypes.instanceOf(S)},e.exports=w},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1308),o=i(r),c=n(1350),l=i(c),u=n(6),d=n(1430),p=n(1324),h=n(1321),f=u.createClass({displayName:"GroupsModal",propTypes:{chats:u.PropTypes.arrayOf(u.PropTypes.instanceOf(o["default"])),filter:u.PropTypes.func,onCancel:u.PropTypes.func.isRequired,onGroup:u.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(){return!0}}},getInitialState:function(){return this.selection=new p,{loading:!0,searchFilter:void 0}},componentWillMount:function(){var e=this,t=this.props.chats;s["default"].delay(300).then(function(){return s["default"].all(_.map(_.filter(t,function(e){return e.groupMetadata.stale}),function(e){return e.groupMetadata.update()["catch"](_.noop)}))}).then(function(){return e.setState({loading:!1})})},onSelect:function(e,t){var n=t.props.chat;this.props.filter(n)===!0&&this.props.onGroup(t.props.chat)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this,t=this.props,n=t.chats,i=t.onGroup,a=t.filter,s=t.onCancel,r=void 0;return this.state.loading?r=u.createElement(h.Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),s=n.filter(function(e){return a(e)&&(!t||t&&e.contact.searchMatch(t))});s.length?(e.selection.init(_.map(s.filter(function(e){return a(e)===!0}),"id")),r=s.map(function(t){var n=void 0,s=void 0;return _.isString(a(t))&&(n=u.createElement("div",{className:"chat-status ellipsify",title:a(t)},a(t)),s="member"),u.createElement(l["default"],{chat:t,mode:c.Mode.INFO,active:e.selection,secondary:n,noContext:!0,className:s,onClick:_.isString(a(t))?void 0:i.bind(null,t),key:t.id})})):r=u.createElement(h.SearchGroups,null)}(),u.createElement(d,{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:s},r)}});e.exports=f},function(e,t,n){"use strict";var i=n(6),a=n(1311),s=n(1313),r=n(1312),o=n(1344),c=n(1594),l=n(8),u=n(224),d=n(67),p="animated-doodle",h=n(1644),f={"class":".animated-doodle",low:{"default":h},high:{"default":h}},m=i.createClass({displayName:"HelpDrawer",propTypes:{onClose:i.PropTypes.func.isRequired},componentWillMount:function(){u.isAssetLoaded(p)||u.loadAsset(f,p)},onTOS:function(){var e="https://www.whatsapp.com/legal/";e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onFAQ:function(){var e="http://www.whatsapp.com/faq/web";e=e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onContactUs:function(){l.openModal(i.createElement(c,null))},render:function(){return i.createElement(a,{onCancel:this.onBack,id:"help"},i.createElement(s,{a8n:"drawer-title-help",title:l10n.t("help_drawer_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,{wide:!0},i.createElement("div",{className:"controls-section animated-doodle"}),i.createElement("div",{className:"chatlist list-icons list-actions"},i.createElement(o,{className:"drawer-list-item",a8n:"li-faq",onClick:this.onFAQ},l10n.t("web_settings_faq")),i.createElement(o,{className:"drawer-list-item",a8n:"li-contact-us",onClick:this.onContactUs},l10n.t("send_logs_title")),i.createElement(o,{className:"drawer-list-item",a8n:"li-tos",onClick:this.onTOS},l10n.t("terms_and_privacy_link")))))}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1308),m=(i(f),n(1307)),g=(i(m),n(6)),v=n(1356),y=n(1491),E=n(1486),_=n(216),b=n(1311),M=n(1313),C=n(1312),S=n(1448),T=n(1320),w=n(104),k=n(217),P=n(139),N=n(31),O=n(45),D={MEDIA:"media",DOCS:"docs",LINKS:"links"},x=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));return e.onSelectMessages=function(){e.state.selectable||e.setState({selectable:!0})},e.onCancelSelection=function(){e.state.selectable&&(e.selectedMessages.unsetAll(),e.setState({selectable:!1}))},e.onMessageSelect=function(t,n){e.onSelectMessages(),e.selectedMessages.setVal(t,n)},e.selectedMessages=new T([],function(e){return e.id.toString()}),e.state={selected:D.MEDIA,direction:null,selectable:!1},e}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onSelectTab",value:function(e){var t=N.values(D).indexOf(this.state.selected),n=N.values(D).indexOf(e),i=n>t?"right":"left";this.setState({selected:e,direction:i})}},{key:"getTabs",value:function(){var e=this;if(!P.supportsFeature(P.F.LINK_DOC_GALLERY))return null;var t=[{tab:D.MEDIA,title:k.t("media")},{tab:D.DOCS,title:k.t("docs")},{tab:D.LINKS,title:k.t("links")}].map(function(t){var n=O("menu-item",{active:e.state.selected===t.tab});return g.createElement("button",{className:n,onClick:e.onSelectTab.bind(e,t.tab),key:t.tab,title:t.title},t.title)});return g.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},t)}},{key:"getContent",value:function(){var e=this.props.chat;if(!P.supportsFeature(P.F.LINK_DOC_GALLERY))return g.createElement(v,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});var t=void 0;switch(this.state.selected){case D.MEDIA:t=g.createElement(v,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});break;case D.LINKS:t=g.createElement(y,{chat:e,linkMsgs:e.getLinkMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages});break;case D.DOCS:t=g.createElement(E,{chat:e,docMsgs:e.getDocMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages})}return t}},{key:"render",value:function(){var e=this.props.chat,t=this.getTabs(),n=this.getContent(),i=this.state.selectable?g.createElement(_,{displayName:"MediaMultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},g.createElement(S,{chat:e,noSortOnForward:!0,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})):null,a="right"===this.state.direction?"slide-forward":"slide-back",s=P.supportsFeature(P.F.LINK_DOC_GALLERY)?" ":k.t("media");return g.createElement(b,{id:"multimedia-gallery",onCancel:this.props.onBack},g.createElement(M,{title:s,onBack:this.props.onBack,type:M.Type.LARGE}),i,t,g.createElement(C,{"data-list-scroll-container":!0},g.createElement(w,{transitionName:a,className:"column"},g.createElement("div",{className:"multimedia-gallery",key:this.state.selected},g.createElement("div",{className:"column"},n)))))}}]),t}(g.Component);e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(6),o=n(1310),c=n(143),l=n(45),u=n(1315),d=n(1309),p=n(139),h=r.createClass({displayName:"MediaPanelHeader",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,onGoToMsgClick:r.PropTypes.func.isRequired,onUnstarClick:r.PropTypes.func.isRequired,onStarClick:r.PropTypes.func.isRequired,openForwardFlow:r.PropTypes.func.isRequired,onDownloadClick:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired},mixins:[o],getInitialState:function(){return{renderableUrl:this.async("msg.mediaData.renderableUrl")}},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,a=null,s="menu-item menu-item-hover";if(t=r.createElement("div",{className:s,onClick:this.props.onGoToMsgClick},r.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),p.supportsFeature(p.F.STARRED)){var o=void 0,c=void 0,u=void 0;e.star?(o=this.props.onUnstarClick,c="icon icon-unstar-btn",u=l10n.t("unstar_message")):(o=this.props.onStarClick,c="icon icon-star-btn",u=l10n.t("star_message")),n=r.createElement("div",{className:s,onClick:o},r.createElement("span",{className:c,title:u}))}return i=r.createElement("div",{className:s,onClick:this.props.openForwardFlow},r.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),a=r.createElement("div",{className:l(s,{disabled:!this.state.renderableUrl}),onClick:this.props.onDownloadClick},r.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:a}},render:function(){var e=this.props.msg,t=e.displayName(!0,!0);e.isGroupMsg&&(t+=" @ "+e.chat.title());var n=this.getMenuBtns(),i=n.btnGoToMsg,a=n.btnStar,s=n.btnForward,o=n.btnDownload,p=l("media-panel-header",{});return r.createElement("div",{className:p},r.createElement("div",{className:"chat media-chat"},r.createElement("div",{className:"chat-avatar"},r.createElement(u,{id:e.sender,size:40})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement(d,{ellipsify:!0,text:t})),r.createElement("div",{className:"chat-secondary"},r.createElement("div",{className:"chat-status ellipsify"},c.relativeDateAndTimeStr(e.t))))),r.createElement("div",{className:"menu menu-horizontal media-panel-tools"},i,a,s,o,r.createElement("div",{className:"menu-item menu-item-hover"},r.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.props.onClose}))))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(1333),o=i(r),c=n(1325),l=n(6),u=n(38),d=n(1310),p=n(141),h=n(1309),f=n(1414),m=n(1403),g=n(1334),v=n(1357),y=n(8),E=n(1385),b=n(428),M=n(1318),C=n(1587),S=n(1349),T=n(139),w=n(1449),k=n(1453),P=n(45),N=n(216),O=500,D=2,x=l.createClass({displayName:"MediaViewerModal",mixins:[d],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired,zoomIn:l.PropTypes.bool,getZoomNode:l.PropTypes.func,onBack:l.PropTypes.func.isRequired,onExitAnimation:l.PropTypes.func,onNext:l.PropTypes.func,onPrev:l.PropTypes.func,onImgZoomIn:l.PropTypes.func},getDefaultProps:function(){return{getZoomNode:_.noop}},getInitialState:function(){return{star:this.async("msg.star"),mediaStage:this.async("msg.mediaData.mediaStage"),imgZoomed:!1}},componentWillMount:function(){if(this.props.msg.mediaData.mediaStage===M.STAGE.RESOLVED&&this.props.zoomIn){var e=this.props.getZoomNode(this.props.msg.id);this.setState({zoomElement:e}),this.style={opacity:0}}},componentDidMount:function(){this.style={}},onImageLoad:function(e){var t=this.state.zoomElement;t&&e&&this.props.zoomIn&&!this.zoomed&&(this.animateZoom(t,e),this.zoomed=!0)},animateZoom:function(e,t){var n=this,i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),s=a.top-i.top,r=a.left-i.left,o=e.clientWidth/t.clientWidth,c=(t.clientHeight-e.clientHeight)/2,l=(t.clientWidth-e.clientWidth)/2;s-=c,r-=l,Velocity(t,{opacity:0,translateX:r,translateY:s,scale:o},{duration:0}).then(function(){Velocity(t,{opacity:[1,0],translateX:[0,r],translateY:[0,s],scale:[1,o]},{duration:O,easing:[.1,.82,.25,1]});var e=u.findDOMNode(n.refs.caption);e&&Velocity(e,{opacity:[1,0]},{duration:O})})},openForwardFlow:function(e){e.stopPropagation();var t=this.props.msg;t.isUnsentMedia?y.openModal(l.createElement(b,{title:l10n.t("err_unsent_forward_title"),onOK:y.closeModal.bind(y),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):y.openModal(l.createElement(E,{msgs:[this.props.msg]}),"modal-flow")},onScroll:function(e){Math.abs(e.deltaY)>7&&this.onClose()},onImgZoomIn:function(e){if(e&&this.refs.media){var t=this.refs.media;this.listenToMouseMove=t.heightOveflow>0||t.widthOveflow>0}this.setState({imgZoomed:e}),this.props.onImgZoomIn(e)},onZoomOut:function(){this.refs.media&&this.state.imgZoomed&&this.refs.media.onImageClick()},onMouseMove:function(e){this.handleMouseMove(e.pageX,e.pageY)},handleMouseMove:_.throttle(function(e,t){var n=this.refs.media&&this.refs.media.refs.image,i=u.findDOMNode(n);if(i){var a=i.parentNode,s=a.parentNode,r=this.refs.media.getTranslatePosition(s,e,t),o=r.translateX,c=r.translateY;Velocity(a,"stop"),Velocity(a,{translateX:o,translateY:c,scale:D},{duration:0})}},42),onDownloadClick:function(e){e.stopPropagation(),S.initDownload(this.props.msg)},onStarClick:function(e){e.stopPropagation(),this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarClick:function(e){e.stopPropagation(),this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onGoToMsgClick:function(e){e.stopPropagation(),this.onClose(),y.existsDrawerRight(function(e){e&&2===w.column&&y.closeDrawerRight()});var t=this.props.msg;y.openChatAt(t.chat,t.chat.getSearchContext(t))},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,a=null,s=P("menu-item menu-item-hover",{disabled:!e.mediaData.renderableUrl});if(t=l.createElement("div",{className:"menu-item menu-item-hover",onClick:this.onGoToMsgClick},l.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),T.supportsFeature(T.F.STARRED)){var r=void 0,o=void 0,c=void 0;e.star?(r=this.onUnstarClick,o="icon icon-unstar-btn",c=l10n.t("unstar_message")):(r=this.onStarClick,o="icon icon-star-btn",c=l10n.t("star_message")),n=l.createElement("div",{className:s,onClick:r},l.createElement("span",{className:o,title:c}))}return i=l.createElement("div",{className:s,onClick:this.openForwardFlow},l.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),a=l.createElement("div",{className:s,onClick:this.onDownloadClick},l.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:a}},onClose:function(){var e=this;if(!this.closing){this.closing=!0,_.isFunction(this.props.onExitAnimation)&&this.props.onExitAnimation();var t=this.props.getZoomNode(this.props.msg.id);if(!t)return this.props.onBack();var n=this.refs.media,i=void 0;if(n&&n.refs){var a=this.props.msg.mediaData.type;a===M.TYPE.IMAGE?i=n.image:this.props.msg.mediaData.isGif&&(i=n.refs.player)}if(!i)return this.props.onBack();i=u.findDOMNode(i);var s=i.getBoundingClientRect(),r=t.getBoundingClientRect(),o=r.top-s.top,c=r.left-s.left,l=t.clientWidth/i.clientWidth,d=(i.clientHeight-t.clientHeight)/2,p=(i.clientWidth-t.clientWidth)/2;o-=d,c-=p,Velocity(i,{translateX:[c,0],translateY:[o,0],scale:[l,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){e.props.onBack()});var h=u.findDOMNode(this.refs.caption);h&&Velocity(h,{opacity:[0,1]},{duration:200,easing:[.1,.82,.25,1]})}},render:function(){var e,t=this.props.msg,n=t.mediaData;
switch(n.type){case M.TYPE.IMAGE:e=l.createElement(R,{msg:t,key:t.id,style:this.style,onLoad:this.onImageLoad,onImgZoomIn:this.onImgZoomIn,ref:"media"});break;case M.TYPE.VIDEO:e=l.createElement(A,{msg:t,key:t.id,onLoad:n.isGif?this.onImageLoad:null,ref:"media"});break;case M.TYPE.AUDIO:e=l.createElement(L,{msg:t,key:t.id})}var i=void 0;if(t.caption){var a=t.mentionMap(),s=this.props.zoomIn&&(n.isGif||n.type===M.TYPE.IMAGE);i=l.createElement(h,{ref:"caption",className:{"media-caption":!0,"caption-hidden":s},linkify:!0,format:!0,mention:a,text:t.caption})}var r=P("media",{"media-with-caption":!!i}),o=l.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")}),c=P("btn btn-round btn-media-next",{"disabled-btn":!this.props.onNext}),u=l.createElement("div",{role:"button",className:c,onClick:this.props.onNext||function(e){return e.stopPropagation()}},o),d=l.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")}),p=P("btn btn-round btn-media-prev",{"disabled-btn":!this.props.onPrev}),f=l.createElement("div",{role:"button",className:p,onClick:this.props.onPrev||function(e){return e.stopPropagation()}},d),m=P("media-viewer",{"media-viewer-animate":this.props.zoomIn,"cursor-zoom-out":this.state.imgZoomed}),g=this.state.imgZoomed?null:this.onScroll,v=this.state.imgZoomed?null:this.onClose,y=this.state.imgZoomed&&this.listenToMouseMove?this.onMouseMove:null,E=this.state.imgZoomed?this.onZoomOut:null;return l.createElement(N,{displayName:"MediaViewer",escapable:!0,requestDismiss:this.onClose},l.createElement("div",{className:m,onClick:E,onMouseMove:y},l.createElement(C,{msg:this.props.msg,onGoToMsgClick:this.onGoToMsgClick,onUnstarClick:this.onUnstarClick,onStarClick:this.onStarClick,openForwardFlow:this.openForwardFlow,onDownloadClick:this.onDownloadClick,onClose:this.onClose}),l.createElement("div",{className:"media-content",dir:"ltr",ref:"container",onWheel:g,onClick:v},f,l.createElement("div",{className:r},l.createElement(U,{msg:t}),e,i),u)))}}),R=l.createClass({displayName:"MediaImage",mixins:[d,p],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired,style:l.PropTypes.object,onLoad:l.PropTypes.func,onImgZoomIn:l.PropTypes.func},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage"),zoomIn:null}},componentDidMount:function(){this.props.msg.forceDownloadMedia()},onImageClick:function(e){if(e&&e.stopPropagation(),this.state.zoomIn)return this.props.onImgZoomIn(!1),void this.setState({zoomIn:null});var t=u.findDOMNode(this.image),n=t.parentNode,i=n.parentNode;this.heightOveflow=n.clientHeight*D-i.clientHeight,this.widthOveflow=n.clientWidth*D-i.clientWidth;var a=this.getTranslatePosition(i,e.pageX,e.pageY),s=a.translateX,r=a.translateY;this.props.onImgZoomIn(!0),this.setState({zoomIn:{factor:D,translateX:s,translateY:r}})},getTranslatePosition:function(e,t,n){var i=window.innerWidth/2-t,a=window.innerHeight/2-n,s=this.widthOveflow>0?1.5*i*this.widthOveflow/e.clientWidth:0,r=this.heightOveflow>0?1.5*a*this.heightOveflow/e.clientHeight:0;return{translateX:s,translateY:r}},render:function(){var e=this,t=this.props.msg,n=t.mediaData,i=this.state.zoomIn,a=P("media-viewer-img",{"cursor-zoom-in":!i});if(n.mediaStage===M.STAGE.RESOLVED){var s={width:n.fullWidth,height:n.fullHeight},r=l.createElement(o["default"],{src:n.renderableUrl,ref:(0,c.GetRef)("image",this),onClick:this.onImageClick,style:this.props.style,className:a});return i&&(r=l.createElement(N,{displayName:"ZoomInImage",ref:"image",escapable:!0,requestDismiss:function(){return e.onImageClick()}},r)),l.createElement(g,{type:g.TYPES.ZOOM_IN,size:s,zoomIn:this.state.zoomIn,onObjectLoad:this.props.onLoad},r)}return l.createElement(I,{msg:t})}}),A=l.createClass({displayName:"MediaVideo",mixins:[d,p],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired,style:l.PropTypes.object,onLoad:l.PropTypes.func},getInitialState:function(){return{played:!1,mediaStage:this.async("msg.mediaData.mediaStage"),size:{width:0,height:0}}},componentWillMount:function(){this.updateSize()},componentWillReceiveProps:function(){this.updateSize()},componentDidMount:function(){var e=this.props.msg;e.forceDownloadMedia()},updateSize:function(){var e=this.props.msg.mediaData;e.mediaStage===M.STAGE.RESOLVED&&e.fullWidth&&e.fullHeight&&this.setState({size:this.getSize()})},onPlayerError:function(e){},onPlayerClick:function(e){e.stopPropagation();var t=u.findDOMNode(this.refs.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},onResize:function(e){this.setState({size:e})},stopPropagation:function(e){e.stopPropagation()},getSize:function(){var e=this.props.msg.mediaData,t=330;return!e.isGif||e.fullWidth>=t?{width:e.fullWidth,height:e.fullHeight}:{width:t,height:e.fullHeight*t/e.fullWidth}},render:function(){var e=this.props.msg,t=e.mediaData,n=t.isGif,i=t.mediaStage===M.STAGE.RESOLVED;return i?l.createElement(g,{type:g.TYPES.SCALE_DOWN,size:this.state.size,onObjectLoad:this.props.onLoad,style:this.props.style},l.createElement(f,{msg:e,ref:"player",className:"media-viewer-img",onError:this.onPlayerError,onClick:n?this.stopPropagation:this.onPlayerClick,autoPlay:!0,controls:!n,loop:n,onResize:this.onResize},l10n.t("video_playback_not_supported"))):l.createElement(I,{msg:e})}}),I=l.createClass({displayName:"BlurredImage",stopPropagation:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t="data:image/jpeg;base64,"+e.body,n=k.boundHeightWidth(10*e.height,10*e.width,500,500),i={width:n.width,height:n.height};return l.createElement("div",{className:"media-viewer-blur-crop",style:i,onClick:this.stopPropagation},l.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),L=l.createClass({displayName:"MediaAudio",mixins:[d],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},render:function(){var e=this.props.msg;return e.mediaData.mediaStage===M.STAGE.RESOLVED?l.createElement(m,{msg:e,className:"media-viewer-img media-viewer-audio",autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported")):l.createElement("div",{className:"image-audio"})}}),U=l.createClass({displayName:"MediaStage",mixins:[d],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},onUnsupportedDownloadClick:function(e){var t=this;e.stopPropagation(),y.openModal(l.createElement(b,{onCancel:y.closeModal.bind(y),onOK:function(){y.closeModal(),S.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},downloadMedia:function(e){e.stopPropagation(),this.props.msg.forceDownloadMedia()},stopPropagation:function(e){e.stopPropagation()},render:function(){var e=this.props.msg.mediaData,t=null;switch(e.mediaStage){case M.STAGE.RESOLVED:case M.STAGE.ERROR_MISSING:return null;case M.STAGE.ERROR_UNSUPPORTED:return t=this.onUnsupportedDownloadClick,l.createElement(v.Download,{filesize:e.size,onClick:t});case M.STAGE.NEED_POKE:return t=this.downloadMedia,l.createElement(v.Download,{filesize:e.size,onClick:t});default:return t=this.stopPropagation,l.createElement("div",{onClick:t},l.createElement(v.Pending,null))}}});e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1307),s=i(a),r=n(103),o=i(r),c=n(6),l=n(1346),u=n(1311),d=n(1313),p=n(1312),h=n(8),f=n(1331),m=n(1434),g=c.createClass({displayName:"MultiVCardModal",propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired},_renderVCard:function(e,t){var n=f.parse(e.vcard);return n?c.createElement(m,{key:t,parsedVCard:n,thumbnail:f.thumbnail(e.vcard),className:"multi-vcard-dialog-contact"}):null},render:function(){var e=this,t=this.props.msg;return c.createElement(l,{type:l.BOX},c.createElement(u,{onCancel:function(){return h.closeModal()}},c.createElement(d,{title:l10n.t("multi_vcard_number_of_contacts",{count:t.vcardList.length,_plural:t.vcardList.length}),type:d.Type.POPUP,onCancel:function(){return h.closeModal()}}),c.createElement(p,null,c.createElement(o["default"],null,c.createElement("div",{className:"multi-vcard-dialog-body"},t.vcardList.map(function(t,n){return e._renderVCard(t,n)}))))))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(6),o=n(38),c=n(8),l=n(1309),u=n(0),d=n(82),p=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},h=r.createClass({displayName:"MutePopup",propTypes:{onCancel:r.PropTypes.func,onMute:r.PropTypes.func.isRequired,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),c.closeModal(),this.props.onMute(3600*this.state.mute+u().unix(),!0)},componentDidMount:function(){d.focus(o.findDOMNode(this.refs.button))},render:function(){var e=this.props.onCancel||function(){c.closeModal()},t=this.state.mute,n=this,i=p().map(function(e){var i=e.duration;return r.createElement("li",{key:"mute-"+i},r.createElement("label",null,r.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===i,onChange:n.onChange}),e.label))});return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title",dir:"auto"},r.createElement(l,{text:l10n.t("mute_time",{name:this.props.chat.title()})})),r.createElement("div",{className:"popup-contents"},r.createElement("form",{ref:"form"},r.createElement("ol",{className:"choices"},i)))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),r.createElement("button",{ref:"button",className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_menuitem_mute"))))))}});e.exports=h},function(e,t,n){"use strict";var i=n(6),a=n(1311),s=n(1313),r=n(1312),o=n(1342),c=n(1377),l=n(104),u=n(1327),d=i.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:i.PropTypes.string,full:i.PropTypes.string,subject:i.PropTypes.string,onBack:i.PropTypes.func.isRequired,onContinue:i.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},componentDidMount:function(){this.refs.emojiInput.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=u.emojify(this.state.text.trim()),t=this.refs.photoPicker;if(t.state.isEditing){var n=this;t.cropImage().then(function(t){n.props.onContinue(e,t.thumb,t.full)})}else this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){var t=e.target.value;this.setState({text:t})},render:function(){var e=this.state.text.trim().length>0,t=e?i.createElement("div",{className:"drawer-section drawer-controls"},i.createElement("button",{className:"btn btn-round",onClick:this.onContinue},i.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return i.createElement(a,{id:"new-group",onCancel:this.props.onBack},i.createElement(s,{title:l10n.t("new_group_flow_title"),type:s.Type.LARGE,onBack:this.props.onBack}),i.createElement(r,{wide:!0},i.createElement("div",{className:"drawer-section"},i.createElement(c,{type:c.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),i.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},i.createElement(o,{ref:"emojiInput",value:this.state.text,maxLength:25,showRemaining:!0,onChange:this.onInputChange,placeholder:l10n.t("group_subject"),onEnter:e?this.onContinue:_.noop,supportsEmoji:!0})),i.createElement(l,{transitionName:"btn"},t)))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(6),o=n(1311),c=n(1313),l=n(1312),u=n(1402),d=n(1482),p=n(140),h=n(10),f=n(8),m=n(432),g=n(82),v=n(104),y=m.genId("max_participant_toast"),E=r.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[p],propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string.isRequired,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){var e=this;return this.props.uimContext&&(this.props.uimContext.uimClose=function(){e.onBack()}),{searchText:"",participants:[],shouldFocus:!0}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,n=t>e?e:t;this.refs.input.style.width=n+"px";var i;i=e-this.refs.input.offsetLeft-n>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=i+"px",this.state.shouldFocus&&this.focus()},onReset:function(){this.setState({searchText:"",shouldFocus:!0})},focus:function(){g.focus(this.refs.input)},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants)},onDelete:function(e,t){var n=_.without(this.state.participants,t);this.setState({participants:n,shouldFocus:!n.length})},onContactClick:function(e,t){var n=this.state.participants;if(_.includes(n,t))this.setState({participants:_.without(n,t),shouldFocus:!0});else if(n.length>=h.MAX_GROUP_SIZE){var i=l10n.t("action_group_create_failed_participant",{max:h.MAX_GROUP_SIZE});f.openToast(r.createElement(m,{msg:i,id:y}))}else this.setState({participants:n.concat(t),searchText:"",shouldFocus:!0})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=Date.now(),this.refs.list.focusFirst())},onFocusParticipants:function(e){e.repeat||0!==this.refs.input.selectionStart||this.refs.participantList&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=null,this.refs.participantList.focusLast())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&this.onContactClick(e,t)},onFocusSearch:function(e){s["default"].flashFocus=Date.now(),g.focus(this.refs.input)},render:function(){var e=_.size(this.state.participants)?r.createElement("button",{className:"btn btn-round",onClick:this.onContinue},r.createElement("span",{className:"icon icon-checkmark-light"})):null,t=_.size(this.state.participants)?" ":l10n.t("group_participant_hint"),n={down:this.onFocusList,enter:this.state.searchText?this.onSelectFirst:_.size(this.state.participants)?this.onContinue:_.noop,up:this.onFocusParticipants};return n[l10n.LR("left","right")]=this.onFocusParticipants,r.createElement(o,{id:"new-group",onCancel:this.onBack},r.createElement(c,{title:l10n.t("add_group_participants_title"),type:c.Type.LARGE,onBack:this.onBack}),r.createElement(l,null,r.createElement("div",{className:"drawer-section new-group-search"},r.createElement("div",{className:"input-clear input-ext"},r.createElement(s["default"],{handlers:n,className:"input input-line"},r.createElement("div",{className:"list-names list-deletable new-group-preview"},r.createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},r.createElement(d,{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),r.createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),r.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),r.createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},r.createElement(u,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),r.createElement(v,{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}});e.exports=E},function(e,t,n){"use strict";var i=n(6),a=n(1311),s=n(1313),r=n(1312),o=n(1576),c=i.createClass({displayName:"NotificationsDrawer",propTypes:{onClose:i.PropTypes.func.isRequired},render:function(){return i.createElement(a,{onCancel:this.onBack,id:"notifications"},i.createElement(s,{a8n:"drawer-title-notifications",title:l10n.t("notifications_drawer_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,{wide:!0},i.createElement(o,{key:"notifications"})))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(103),s=i(a),r=n(6),o=n(144),c=n(428),l=n(8),u=n(1392),d=n(447),p=n(27),h=n(1342),f=n(432),m=320,g=50,v=10,y=500,E=r.createClass({displayName:"SendLogsPopup",mixins:[o],getInitialState:function(){return{email:"",emailError:void 0,confirmEmail:"",confirmEmailError:void 0,subject:l10n.t("send_logs_default_subject"),subjectError:void 0,description:"",descriptionError:void 0}},componentDidMount:function(){this.refs.emailAddr.restoreFocus()},onSend:function(){var e={},t=this.state.email.trim(),n=this.state.confirmEmail.trim();if(this.validateEmail(t)||(e.emailError=l10n.t("send_logs_email_invalid")),this.validateConfirmEmail(n)||(e.confirmEmailError=l10n.t("send_logs_email_nomatch")),this.validateDescription()||(e.descriptionError=l10n.t("send_logs_too_short")),this.validateSubject()||(e.subjectError=l10n.t("send_logs_subject_error")),_.isEmpty(e)){this.setState({email:t,confirmEmail:n,emailError:void 0,confirmEmailError:void 0,descriptionError:void 0,subjectError:void 0});var i=Store.Conn.me?d.format(Store.Conn.me.split("@")[0]):null,a=this.state.subject.trim()||l10n.t("send_logs_default_subject");p.uploadUserReport(i,t,a,this.state.description),l.closeModal(),l.openToast(r.createElement(f,{msg:l10n.t("send_logs_sent"),id:f.genId()}))}else e.email=t,e.confirmEmail=n,this.setState(e)},onCancel:function(){l.closeModal()},onSubjectChange:function(e){var t={subject:e.target.value};this.state.subjectError&&this.validateSubject(t.subject)&&(t.subjectError=void 0),this.setState(t)},onSubjectBlur:function(){var e=void 0;this.validateSubject()||(e=l10n.t("send_logs_subject_error")),this.state.subjectError!==e&&this.setState({subjectError:e})},onDescriptionChange:function(e){var t={description:e.target.value};this.state.descriptionError&&this.validateDescription(t.description)&&(t.descriptionError=void 0),this.setState(t)},onDescriptionBlur:function(){var e=void 0;!this.state.description&&!this.state.descriptionError||this.validateDescription()||(e=l10n.t("send_logs_too_short")),this.state.descriptionError!==e&&this.setState({descriptionError:e})},onEmailChange:function(e){var t={email:e.target.value};this.state.emailError&&this.validateEmail(t.email)&&(t.emailError=void 0),this.setState(t)},onEmailBlur:function(){var e=void 0,t=this.state.email.trim(),n={};!this.state.email&&!this.state.emailError||this.validateEmail(t)||(e=l10n.t("send_logs_email_invalid")),this.state.emailError!==e&&(n.emailError=e),this.state.email!==t&&(n.email=t),_.isEmpty(n)||this.setState(n)},onConfirmEmailChange:function(e){var t={confirmEmail:e.target.value};this.state.confirmEmailError&&this.validateConfirmEmail(t.confirmEmail)&&(t.confirmEmailError=void 0),this.setState(t)},onConfirmEmailBlur:function(){var e=void 0,t=this.state.confirmEmail.trim(),n={};!this.state.confirmEmail&&!this.state.confirmEmailError||this.validateConfirmEmail(t)||(e=l10n.t("send_logs_email_nomatch")),this.state.confirmEmailError!==e&&(n.confirmEmailError=e),this.state.confirmEmail!==t&&(n.confirmEmail=t),_.isEmpty(n)||this.setState(n)},validateEmail:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.email:arguments[0];return u.validateEmail(e)},validateConfirmEmail:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.confirmEmail:arguments[0];return this.state.email===e},validateDescription:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.description:arguments[0];return e.length>v},validateSubject:function(){arguments.length<=0||void 0===arguments[0]?this.state.subject:arguments[0];return!0},stopPropagation:function(e){e.stopPropagation()},render:function(){var e={enter:this.stopPropagation};return r.createElement(c,{title:l10n.t("send_logs_title"),okText:l10n.t("send_logs_confirm"),onOK:this.onSend,onCancel:this.onCancel},r.createElement(s["default"],{handlers:e},r.createElement(h,{className:"send-logs-input",ref:"emailAddr",value:this.state.email,error:this.state.emailError,maxLength:m,onChange:this.onEmailChange,onBlur:this.onEmailBlur,placeholder:l10n.t("send_logs_email_address")}),r.createElement(h,{className:"send-logs-input",editable:!0,value:this.state.confirmEmail,error:this.state.confirmEmailError,maxLength:m,onChange:this.onConfirmEmailChange,onBlur:this.onConfirmEmailBlur,placeholder:l10n.t("send_logs_email_confirm")}),r.createElement(h,{className:"send-logs-input",value:this.state.subject,error:this.state.subjectError,maxLength:g,onChange:this.onSubjectChange,onBlur:this.onSubjectBlur,placeholder:l10n.t("send_logs_email_subject")}),r.createElement(h,{className:"send-logs-input",value:this.state.description,error:this.state.descriptionError,maxLength:y,onChange:this.onDescriptionChange,onBlur:this.onDescriptionBlur,placeholder:l10n.t("describe_logs"),multiline:!0})))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1367),m=(i(f),n(1329)),g=i(m),v=n(6),y=n(1311),E=n(1313),_=n(1312),b=n(1344),M=n(217),C=n(1315),S=n(1309),T=n(10),w=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(c))),i.status=window.Store.Status.gaddUp(i.props.profileId),a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"componentWillMount",value:function(){this.props.addListener(this.status,"change:status")}},{key:"render",value:function(){var e=T.STATUS_V3?null:v.createElement("div",{className:"chat-status"},v.createElement("span",{className:"emojitext ellipsify",dir:"auto"},v.createElement(S,{text:this.status.status||M.t("contact_status_loading"),direction:"auto"})));return v.createElement(y,{id:"settings",onCancel:this.props.onClose},v.createElement(E,{title:M.t("settings_flow_title"),onBack:this.props.onClose,type:E.Type.LARGE}),v.createElement(_,null,v.createElement("div",{className:"chatlist list-identity"},v.createElement("div",{className:"chat",onClick:this.props.onProfile,"data-ignore-capture":"any"},v.createElement("div",{className:"chat-avatar"},v.createElement(C,{id:window.Store.Conn.me,size:82,quality:C.Quality.HIGH})),v.createElement("div",{className:"chat-body"},v.createElement("div",{className:"chat-main"},v.createElement("div",{className:"chat-title"},v.createElement("span",{className:"emojitext ellipsify",dir:"auto"},v.createElement(S,{text:window.Store.Conn.pushname,direction:"auto"})))),e))),v.createElement("div",{className:"chatlist list-icons list-actions"},v.createElement(b,{a8n:"li-notifications",iconClass:"icon-settings-notifications",onClick:this.props.onNotifications},M.t("menuitem_notifications")),v.createElement(b,{a8n:"li-chat_wallpaper",iconClass:"icon-settings-wallpaper",onClick:this.props.onWallpaper},M.t("menuitem_wallpaper")),v.createElement(b,{a8n:"li-blocked",iconClass:"icon-settings-blocked",onClick:this.props.onBlocked},M.t("menuitem_blocked")),v.createElement(b,{a8n:"li-help",iconClass:"icon-settings-help",onClick:this.props.onHelp},M.t("menuitem_help")))))}}]),t}(v.Component);t["default"]=(0,g["default"])(w)},function(e,t,n){"use strict";var i=n(6),a=n(140),s=n(8),r=n(12),o=i.createClass({displayName:"TermsOfServiceModal",mixins:[a],componentDidMount:function(){this.addObserver(Store.Conn,"change:tos",this.close)},close:function(){0===Store.Conn.tos&&s.closeModal()},logout:function(){s.closeModal(),r.logout()},render:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=i.createElement("div",{className:"popup-controls"},i.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:s.closeModal.bind(s)},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2"),t=i.createElement("div",{className:"popup-controls"},i.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.logout},l10n.t("menuitem_logout")))}return i.createElement("div",{className:"backdrop"},i.createElement("div",{className:"popup-container"},i.createElement("div",{className:"popup"},i.createElement("div",{className:"popup-body"},i.createElement("div",{className:"popup-contents"},e)),t)))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1308),s=i(a),r=n(1307),o=i(r),c=n(6),l=n(8),u=n(1309),d=n(428),p=c.createClass({displayName:"UnstarAllPopup",propTypes:{chat:c.PropTypes.instanceOf(s["default"]),msgs:c.PropTypes.arrayOf(c.PropTypes.instanceOf(o["default"]))},onCancel:function(){l.closeModal()},onUnstar:function(){var e=this.props.chat,t=this.props.msgs;e&&e.pendingAction++,Store.Chat.unstarAllMessages(t,e)["finally"](function(){e&&e.pendingAction--}),l.closeModal()},render:function(){return c.createElement(d,{title:l10n.t("are_you_sure"),onOK:this.onUnstar,okText:l10n.t("unstar_all_button"),onCancel:this.onCancel},c.createElement("div",null,c.createElement(u,{text:l10n.t("unstar_all_confirm")})))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(6),m=n(1346),g=n(1311),v=n(1313),y=n(1312),E=n(1429),_=n(26),b=n(1331),M=window._,C=window.l10n,S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"renderContacts",value:function(){var e=this,t=M.filter(this.props.vCard.TEL,function(e){return e.properties.waid});return t.map(function(t){var n=_.numberToWid(M.first(t.properties.waid));return f.createElement(E,{title:_.formattedUser(n),onClick:function(){return e.onSelect(n)},icon:f.createElement("span",{className:e.props.iconClass}),key:"vCard-"+t.index},b.getType(t))})}},{key:"onSelect",value:function(e){this.props.onSelect(e)}},{key:"render",value:function(){return f.createElement(m,{type:m.BOX},f.createElement(g,null,f.createElement(v,{onCancel:this.props.onCancel,type:v.Type.POPUP,title:C.t("choose_phone_number")}),f.createElement(y,null,f.createElement("div",{className:"chatlist column"},f.createElement("div",{className:"drawer-item-container-compact"},this.renderContacts())))))}}]),t}(f.Component);S.defaultProps={iconClass:"icon icon-chat",onCancel:M.noop,onSelect:M.noop},e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=new Uint8Array(e),i=new Uint8Array(t),a=n.length,s=i.length;if(a!==s)return!1;for(var r=0;r<a;r++)if(n[r]!==i[r])return!1;return!0}var s=n(2),r=i(s),o=n(218),c=i(o),l=n(6),u=n(38),d=n(1310),p=n(8),h=n(1625).CombinedFingerprint,f=n(10),m=n(1311),g=n(1335),v=n(1312),y=n(14),E=n(1345),b=n(1),M=n(1371),C=n(1314),S=n(1304),T=n(445),w=n(142),k=n(144),P=n(1413),N=n(83),O=n(141),D=l.createClass({displayName:"VerificationFilePicker",propTypes:{mime:l.PropTypes.string.isRequired,onPick:l.PropTypes.func.isRequired},stopPropagation:function(e){e.stopPropagation()},render:function(){return l.createElement("input",{accept:this.props.mime,type:"file",style:{display:"none"},onChange:this.props.onPick,onClick:this.stopPropagation})}}),x=l.createClass({displayName:"VerificationQRCode",propTypes:{binary:l.PropTypes.object,contact:l.PropTypes.instanceOf(c["default"]).isRequired,visible:l.PropTypes.bool},getDefaultProps:function(){return{binary:null}},getInitialState:function(){return{hover:!1,currentQRBinary:null,currentQRDataURL:null}},componentDidMount:function(){this.props.binary&&this.generateQRCode()},componentDidUpdate:function(e,t){this.generateQRCode()},shouldComponentUpdate:function(e,t){return!(this.compareBinary(e.binary,this.props.binary)&&this.compareBinary(t.currentQRBinary,this.state.currentQRBinary)&&e.visible===this.props.visible&&t.hover===this.state.hover&&t.currentQRDataURL===this.state.currentQRDataURL)},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},fingerprintsMatched:function(e,t){return a(e.publicKey,t.publicKey)&&a(e.identifier,t.identifier)},compareBinary:function(e,t){if(!e&&!t)return!0;var n=h.parse(e),i=h.parse(t);if(!n&&!i)return!0;if(!(n.version||i.version||n.localFingerprint||i.localFingerprint||n.remoteFingerprint||i.remoteFingerprint))return!0;if(n.version!==i.version)return!1;var a=this.fingerprintsMatched(n.localFingerprint,i.localFingerprint),s=this.fingerprintsMatched(n.remoteFingerprint,i.remoteFingerprint);return a&&s},generateQRCode:function(){var e=u.findDOMNode(this.refs.QRCodeContainer),t=this.props.binary;if(!e||!t)return void this.setState({currentQRBinary:null,currentQRDataURL:null});if(!this.compareBinary(this.state.currentQRBinary,t)){this.qr&&delete this.qr,this.qr=new T(e,{text:t,width:f.QR_EDGE/2,height:f.QR_EDGE/2,correctLevel:T.CorrectLevel.L}),this.setState({currentQRBinary:t});var n=e.getElementsByTagName("canvas")[0];if(!n)return void this.setState({currentQRDataURL:null});var i=n.toDataURL("image/png");this.setState({currentQRDataURL:i})}},render:function(){var e=null;if(this.props.visible){var t=null;if(this.state.hover&&this.state.currentQRDataURL){var n=this.props.contact.formattedUser,i=Store.Contact.get(Store.Conn.me).formattedUser,a="Verification Code between "+i+" and "+n+".png";t=l.createElement("a",{href:this.state.currentQRDataURL,download:a},l.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},l.createElement("div",{className:"avatar-overlay-text"},l10n.t("web_verify_download_code"))))}e=l.createElement("div",{onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,l.createElement("div",{className:"verification-circle",ref:"QRCodeContainer"}))}return e}}),R=l.createClass({displayName:"VerificationSpinner",propTypes:{visible:l.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=l.createElement("div",{className:"verification-circle"},l.createElement("div",{className:"spinner"},l.createElement(w,{size:40,stroke:4})))),e}}),A=l.createClass({displayName:"VerificationCircle",propTypes:{binary:l.PropTypes.object,contact:l.PropTypes.instanceOf(c["default"]).isRequired,visible:l.PropTypes.bool},render:function(){var e=null;
return this.props.visible&&(e=l.createElement("div",{className:"verification-circle-container"},l.createElement(x,{visible:!!this.props.binary,binary:this.props.binary,contact:this.props.contact}),l.createElement(R,{visible:!this.props.binary}))),e}}),I=l.createClass({displayName:"VerificationString",NUM_ROWS:3,NUM_BLOCKS_PER_ROW:4,NUM_DIGITS_PER_BLOCK:5,propTypes:{string:l.PropTypes.string},getDefaultProps:function(){return{string:null}},shouldComponentUpdate:function(e,t){return e.string!==this.props.string},numDigitsInVerificationString:function(){return this.NUM_ROWS*this.NUM_BLOCKS_PER_ROW*this.NUM_DIGITS_PER_BLOCK},render:function(){if(!this.props.string)return l.createElement("div",null,l10n.t("loading"));var e=this.props.string;if(e.length!==this.numDigitsInVerificationString())return b.error("verificationString:render this.props.stringshould be "+this.numDigitsInVerificationString()+" characters long instead of "+e.length+".")(),l.createElement("div",null,l10n.t("web_verify_string_error"));for(var t=[],n=0;n<this.NUM_ROWS;n++){for(var i=[],a=0;a<this.NUM_BLOCKS_PER_ROW;a++){for(var s=[],r=0;r<this.NUM_DIGITS_PER_BLOCK;r++){var o=e.charAt(n*this.NUM_DIGITS_PER_BLOCK*this.NUM_BLOCKS_PER_ROW+a*this.NUM_DIGITS_PER_BLOCK+r);s.push(l.createElement("span",{className:"digit",key:r},o))}i.push(l.createElement("span",{className:"block",key:a},s," "))}t.push(l.createElement("div",{className:"row",key:n},i))}return l.createElement("div",{className:"textfield-static selectable-text"},t)}}),L=l.createClass({displayName:"VerificationCheckmark",propTypes:{visible:l.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=l.createElement("div",{className:"verification-checkmark-container"},l.createElement("div",{className:"verification-checkmark"},"✓ "))),e}}),U=l.createClass({displayName:"VerificationError",propTypes:{visible:l.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=l.createElement("div",{className:"verification-error-container"},l.createElement("div",{className:"verification-error"},"!"))),e}}),F=l.createClass({displayName:"VerificationBanner",propTypes:{children:l.PropTypes.node.isRequired},render:function(){return l.createElement("div",{className:"error-banner"},this.props.children)}}),G=l.createClass({displayName:"VerificationWebcam",CAPTURE_INTERVAL:200,propTypes:{stream:l.PropTypes.object.isRequired,onCapture:l.PropTypes.func.isRequired,onClose:l.PropTypes.func.isRequired},mixins:[k,O],getInitialState:function(){return{videoURL:window.URL.createObjectURL(this.props.stream)}},componentDidMount:function(){this.regNativeListener(window,"resize",this.adjustOverlayPosition)},componentWillUnmount:function(){if(this.clearSafeInterval(this.captureInterval),this.state.videoURL){var e=this.props.stream;M.stop(e),window.URL.revokeObjectURL(this.state.videoURL)}},onVideoLoaded:function(e){this.captureInterval||(this.adjustOverlayPosition(),this.captureInterval=this.safeInterval(this.capture,this.CAPTURE_INTERVAL))},capture:function(){var e=this;if(this.refs.verificationVideo){var t=document.createElement("canvas"),n=u.findDOMNode(this.refs.verificationVideo);t.width=n.videoWidth/2,t.height=n.videoHeight/2;var i=t.getContext("2d");i.drawImage(n,t.width/2,t.height/2,t.width,t.height,0,0,t.width,t.height),t.toBlob(function(t){var n=window.URL.createObjectURL(t);b.log(n),e.props.onCapture(n)},"image/jpeg",1)}},adjustOverlayPosition:function(){var e=u.findDOMNode(this.refs.verificationVideo),t=u.findDOMNode(this.refs.verificationOverlay);if(e&&t){var n=e.offsetHeight,i=e.offsetWidth,a=i/3,s=a,r=(i-a)/2,o=(n-s)/2;t.style.width=a+"px",t.style.height=s+"px",t.style.margin=o+"px "+r+"px"}},render:function(){var e=null;return this.state.videoURL&&(e=l.createElement("div",{className:"webcam"},l.createElement(P,{autoPlay:!0,ref:"verificationVideo",onPlay:this.onVideoLoaded,src:this.state.videoURL}),l.createElement("div",{className:"overlay",ref:"verificationOverlay"}),l.createElement("button",{onClick:this.props.onClose},l.createElement("span",{className:"icon icon-x-alt"})))),e}}),j=l.createClass({displayName:"VerificationDrawer",ICON_DELAY:3e3,BANNER_DELAY:5e3,HINT_DELAY:7e3,ERROR_TYPE:{CORRECT:0,PUBLIC_KEY_MISMATCHED:1,REMOTE_MISMATCHED:2,LOCAL_MISMATCHED:3,BOTH_MISMATCHED:4,INVALID_QR_CODE:5},mixins:[d,C,k],propTypes:{contact:l.PropTypes.instanceOf(c["default"]).isRequired,isFirstLevel:l.PropTypes.bool},getInitialState:function(){return this.asyncState({binary:"contact.verificationBinary",string:"contact.verificationString"},{circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,webcamVisible:!1,bannerVisible:!1,bannerText:null,stream:null,isDragging:!1})},componentDidUpdate:function(e,t){(t.binary&&!this.state.binary||t.string&&!this.state.string)&&this.props.contact.queryIdentity()["catch"](function(e){b.error("VerificationDrawer:queryIdentity error: "+e)()})},componentWillMount:function(){this.props.contact.queryIdentity()["catch"](function(e){b.error("verificationDrawer:queryIdentity error: "+e)()})},onDragStart:function(){this.blockDrop=!0},onDragEnd:function(){this.blockDrop=!1},onDragOver:function(){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.state.binary&&this.state.string&&this.onUploadSelect(e))},onDragLeave:function(e){this.setState({isDragging:!1})},showWebcamStream:function(e){this.setState({webcamVisible:!0,circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,stream:e}),this.hintTimer&&(this.clearSafeTimeout(this.hintTimer),delete this.hintTimer),this.hintTimer=this.safeDelay(this.showWebcamHint,this.HINT_DELAY)},showWebcamHint:function(){this.state.webcamVisible&&!this.state.bannerVisible&&this.showBanner(l10n.t("web_verify_webcam_hint"))},onWebcamOpen:function(e){var t=this,n=M.start("camera");r["default"].race([n,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(e){return t.showWebcamStream(e)})["catch"](y.Unmount,function(){n.then(function(e){return M.stop(e)})["catch"](_.noop)})["catch"](y.GUM.PermissionDeniedError,function(){p.openModal(l.createElement(E,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:E.TYPE.GUIDE_UNBLOCK}))})["catch"](y.GUM.GUMError,function(){p.openModal(l.createElement(E,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:E.TYPE.GUIDE_NONE}))})},onWebcamClose:function(e){this.setState({webcamVisible:!1,bannerVisible:!1,stream:null})},onWebcamCapture:function(e){this.verifyImage(e,!0)},onUploadClick:function(){u.findDOMNode(this.refs.verificationFilePicker).click()},onUploadSelect:function(e){e.stopPropagation();var t=e.target.files||e.dataTransfer.files;if(t&&t[0]){var n=t[0],i=URL.createObjectURL(n);this.verifyImage(i,!1);var a=u.findDOMNode(this.refs.verificationFilePickerForm);a&&a.reset()}},componentWillUnmount:function(){clearTimeout(this.iconTimer),clearTimeout(this.bannerTimer),clearTimeout(this.hintTimer)},onClose:function(e){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},getErrorBannerText:function(e){var t=void 0,n=this.props.contact.formattedShortName;switch(e){case this.ERROR_TYPE.REMOTE_MISMATCHED:t=l10n.t("web_verify_error_remote_mismatched",{contact:n});break;case this.ERROR_TYPE.LOCAL_MISMATCHED:case this.ERROR_TYPE.BOTH_MISMATCHED:t=l10n.t("web_verify_error_local_mismatched",{contact:n});break;case this.ERROR_TYPE.INVALID_QR_CODE:default:t=l10n.t("web_verify_error_invalid_upload")}return t},showCheckmark:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!0,errorIconVisible:!1,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideCheckmark,this.ICON_DELAY)},showErrorIcon:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!1,errorIconVisible:!0,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideError,this.ICON_DELAY)},showErrorBanner:function(e){var t=this.getErrorBannerText(e);this.showBanner(t)},showBanner:function(e){this.setState({circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,bannerVisible:!0,bannerText:e}),this.bannerTimer&&(this.clearSafeTimeout(this.bannerTimer),delete this.bannerTimer),this.bannerTimer=this.safeDelay(this.hideBanner,this.BANNER_DELAY)},hideCheckmark:function(){this.state.errorIconVisible||this.setState({circleVisible:!0}),this.setState({checkmarkVisible:!1})},hideError:function(){this.state.checkmarkVisible||this.setState({circleVisible:!0}),this.setState({errorIconVisible:!1})},hideBanner:function(){this.setState({bannerVisible:!1})},validateFingerprint:function(e){if(!e||0===!e.version||!e.localFingerprint||!e.remoteFingerprint)return this.ERROR_TYPE.INVALID_QR_CODE;var t=h.parse(this.state.binary),n=a(e.remoteFingerprint.identifier,t.localFingerprint.identifier),i=a(e.localFingerprint.identifier,t.remoteFingerprint.identifier);if(!n&&!i)return this.ERROR_TYPE.BOTH_MISMATCHED;if(!n)return this.ERROR_TYPE.REMOTE_MISMATCHED;if(!i)return this.ERROR_TYPE.LOCAL_MISMATCHED;var s=a(e.remoteFingerprint.publicKey,t.localFingerprint.publicKey),r=a(e.localFingerprint.publicKey,t.remoteFingerprint.publicKey);return s&&r?this.ERROR_TYPE.CORRECT:this.ERROR_TYPE.PUBLIC_KEY_MISMATCHED},decodeQRCode:function(e){return new r["default"](function(t,n){S.callback=function(e,i){if(i)n(i);else if(e.length<1)n("QR decoder did not return decoded binary");else{var a=new Uint8Array(e[0]);t(a)}},S.decode(e)})},verifyImage:function(e,t){var n=this;this.decodeQRCode(e).then(h.parse).then(function(e){var i=n.validateFingerprint(e);i?t&&i===n.ERROR_TYPE.INVALID_QR_CODE||(n.setState({errorType:i}),i===n.ERROR_TYPE.PUBLIC_KEY_MISMATCHED?n.showErrorIcon():n.showErrorBanner(i)):n.showCheckmark()})["catch"](function(e){t||(n.setState({errorType:n.ERROR_TYPE.INVALID_QR_CODE}),n.showErrorBanner(n.ERROR_TYPE.INVALID_QR_CODE))})["finally"](function(){window.URL.revokeObjectURL(e)})},render:function(){var e=null,t=null,n=null;this.state.binary&&(navigator.getUserMedia&&(e=l.createElement(g,{classes:"animate-enter2"},l.createElement("button",{className:"btn btn-info",onClick:this.state.webcamVisible?this.onWebcamClose:this.onWebcamOpen},this.state.webcamVisible?l10n.t("web_verify_webcam_close_button"):l10n.t("web_verify_webcam_open_button")))),t=l.createElement(g,{classes:"animate-enter2"},l.createElement("button",{className:"btn btn-info",onClick:this.onUploadClick},l10n.t("web_verify_upload_button")),l.createElement("p",{className:"drag-and-drop-explanation"},this.state.isDragging?l10n.t("web_verify_drag_and_drop_dragging"):null)),n=l.createElement("form",{ref:"verificationFilePickerForm"},l.createElement(D,{mime:"image/*",onPick:this.onUploadSelect,ref:"verificationFilePicker"})));var i=null;this.state.webcamVisible&&(i=l.createElement(G,{stream:this.state.stream,onCapture:this.onWebcamCapture,onClose:this.onWebcamClose}));var a=null;this.state.bannerVisible&&(a=l.createElement(F,null,this.state.bannerText));var s="icon icon-";return s+=this.props.isFirstLevel?"x":"back",l.createElement(m,{id:"verification",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onCancel:this.onClose},l.createElement("header",{className:"pane-header"},l.createElement("div",{className:"header-close"},l.createElement("button",{onClick:this.onClose},l.createElement("span",{className:s}))),l.createElement("div",{className:"header-body"},l.createElement("div",{className:"header-main"},l.createElement("div",{className:"header-title"},l10n.t("web_verify_title"))),l.createElement("div",{className:"header-secondary"},l10n.t("web_you"),", ",this.props.contact.formattedUser))),i,a,l.createElement(v,{classes:this.state.webcamVisible?"webcam-visible":null,info:!0,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},l.createElement(g,{classes:"drawer-scale drawer-section-photo"},l.createElement(A,{binary:this.state.binary,contact:this.props.contact,visible:this.state.circleVisible}),l.createElement(L,{visible:this.state.checkmarkVisible}),l.createElement(U,{visible:this.state.errorIconVisible})),l.createElement(g,{classes:"animate-enter2"},l.createElement("div",{className:"verification-string"},l.createElement(I,{string:this.state.string}))),l.createElement(g,{classes:"animate-enter2"},l.createElement("p",{className:"verification-explanation"},l.createElement("span",null,l10n.t("web_verify_explanation")," "),l.createElement("a",{target:"_blank",href:f.E2E_FAQ_LINK},l10n.t("learn_more")))),e,t,n))}});j.contextTypes={uim:l.PropTypes.instanceOf(N)},e.exports=j},function(e,t,n){"use strict";var i=n(6),a=n(1311),s=n(1313),r=n(1312),o=n(1310),c=n(8),l=n(432),u=n(10),d=i.createClass({displayName:"ColorCanvas",propTypes:{colorHex:i.PropTypes.string.isRequired,isSelected:i.PropTypes.bool.isRequired,isDefault:i.PropTypes.bool.isRequired},getInitialState:function(){return{hover:!1}},onClick:function(e){var t=this.encodeColor(this.props.colorHex);t!==Store.ChatPreference.get("defaultPreference").wallpaperColor&&(Store.ChatPreference.get("defaultPreference").set("wallpaperColor",t),c.openToast(i.createElement(l,{msg:l10n.t("wallpaper_color_set"),id:l.genId()})))},onMouseOver:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseEnter:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseLeave:function(e){this.state.hover&&(this.setState({hover:!1}),Store.ChatPreference.trigger("wallpaper_color_preview"))},encodeColor:function(e){return"#ede9e4"===e?u.DEFAULT_CHAT_WALLPAPER:e},render:function(){var e="wallpaper-color-canvas";this.state.hover&&(e+=" canvas-hover"),this.props.isSelected&&(e+=" canvas-active");var t=this.props.isDefault?i.createElement("span",{className:"wallpaper-default-title"},l10n.t("default_wallpaper")):null;return i.createElement("span",{className:e,style:{backgroundColor:this.props.colorHex},onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},t)}}),p=i.createClass({displayName:"ColorGrid",mixins:[o],propTypes:{id:i.PropTypes.string.isRequired,colors:i.PropTypes.array.isRequired},getInitialState:function(){return{wallpaperColor:this.async("id.ChatPreference.wallpaperColor")}},render:function(){for(var e=!0,t=this.state.wallpaperColor,n=this.props.colors.map(function(n){var a=!1,s=!1;return(t===n||t===u.DEFAULT_CHAT_WALLPAPER&&e)&&(a=!0),e&&(s=!0,e=!1),i.createElement(d,{colorHex:n,isSelected:a,isDefault:s,key:n})}),a=0;a<2;a++)n.push(i.createElement("div",{key:"emptyEl"+a,className:"wallpaper-color-empty"}));return i.createElement("div",{className:"wallpaper-color-grid"},n)}}),h=i.createClass({displayName:"WallpaperDrawer",propTypes:{onClose:i.PropTypes.func},render:function(){var e=i.createElement(p,{colors:u.WALLPAPER_COLOR,id:"defaultPreference"});return i.createElement(a,{id:"wallpaper",onCancel:this.props.onClose},i.createElement(s,{title:l10n.t("wallpaper_flow_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,null,e))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(429),o=n(1435),c=n(436),l=n(10),u=n(14),d=o.STATE,p=d.READY,h=d.ERROR,f=c.FILETYPE,m=f.IMAGE,g=f.VIDEO,v=f.DOCUMENT,y=f.AUDIO,E=1,_=r.extend({model:o,initialize:function(){this.errorMsgs=null,this.ignored=0,r.prototype.initialize.call(this)},removeSingleton:function(e,t){e.url&&window.URL.revokeObjectURL(e.url),e.original&&e.original.url&&window.URL.revokeObjectURL(e.original.url)},remove:function(e,t){var n=this;Array.isArray(e)?e.forEach(function(e){return n.removeSingleton(e,t)}):this.removeSingleton(e,t),r.prototype.remove.call(this,e,t)},"delete":function(){var e=this;this.models.forEach(function(t){return e.removeSingleton(t)}),r.prototype["delete"].call(this)},contains:function(e){return this.indexOf(e)>-1},getValidMedias:function(){return this.filter({state:p})},getAfter:function(e){var t=this.getValidMedias(),n=t.indexOf(e);return n<0||n===t.length-1?null:t[n+1]},getBefore:function(e){var t=this.getValidMedias(),n=t.indexOf(e);return n<=0?null:t[n-1]},processFiles:function(e,t){var n=this,i=this.getValidMedias().length,a=e.length+i>l.MAX_FILES?Math.max(l.MAX_FILES-i,0):e.length,r=e.length-a;0===a?r&&this.trigger("max_upload_limit",r):this.ignore(r);var c=e.slice(0,a).map(function(e){var i=E++,a=new o({id:i,file:e,chat:t,uiProcessed:!1});return n.add(a)});return s["default"].map(c,function(e){return e.processPromise})},ignore:function(e){e>0&&(this.ignored+=e)},uiProcessMsgs:function(){var e=[],t=void 0,n=void 0,i=0,a=0,s=0,r=0,o=0,c=!1,d=l.MAX_MEDIA_UPLOAD_SIZE/1024/1024;if(this.forEach(function(e){if(!e.uiProcessed&&(e.uiProcessed=!0,t||e.state!==p||(t=e),e.state===h))if(e.exception instanceof u.MediaFileTooLarge)switch(e.getFileType()){case m:i+=1;break;case g:a+=1;break;case y:s+=1;break;case v:r+=1}else e.exception instanceof u.MediaFileFailedLoad?c=!0:o+=1}),i>0&&e.push(l10n.t("image_too_big",{number:i,_plural:i,maxSize:d+"MB"})),a>0&&e.push(l10n.t("video_too_big",{number:a,_plural:a,maxSize:d+"MB"})),s>0&&e.push(l10n.t("audio_too_big",{number:s,_plural:s,maxSize:d+"MB"})),r>0&&e.push(l10n.t("document_too_big",{number:r,_plural:r,maxSize:d+"MB"})),o>0&&e.push(l10n.t("files_not_supported",{number:o,_plural:o})),c&&(e=[],e.push(l10n.t("media_failed_load"))),e.length>1){e=[];var f=i+a+s+r+o;0===o?e.push(l10n.t("files_too_big",{number:f,_plural:f,maxSize:d+"MB"})):e.push(l10n.t("files_not_added",{number:f,_plural:f}))}return this.errorMsgs=e.join(" "),this.ignore(this.getValidMedias().length-l.MAX_FILES),n=this.ignored,this.ignored=0,n&&this.trigger("max_upload_limit",n),{activeMedia:t,errorMsgs:this.errorMsgs}}});e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1436),s=i(a),r=n(429),o=r.extend({model:s["default"],handle:function(e){var t=e.shift(),n=t.blocklist,i=_.map(n,function(e){return{id:e}});this.set(i)}});e.exports=new o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1437),s=i(a),r=n(440),o=i(r),c=n(429),l=c.extend({model:s["default"],handle:function(e){var t=e.shift();switch(t.type){case"offer":case"offer_video":case"accept":case"reject":case"terminate":o["default"].tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(20),s=i(a),r=n(2),o=i(r),c=n(1308),l=i(c),u=n(6),d=n(10),p=n(1),h=n(429),f=n(66),m=n(51),g=n(39),v=n(8),y=n(14),E=n(105).ActionToast,b=n(105).ActionType,M=n(26),C=n(12),S=h.extend({model:l["default"],comparator:function(e,t){return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){var e=this;h.prototype.initialize.call(this),this.notSpam={},this.promises={sendUnstarAll:null},this.listenTo(this,"change:t change:isVisible",this.sort),this.listenTo(C,"change:stream",function(){C.stream===C.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})})},active:function T(){var T=_.head(this.filter("active"));return T?T.id:void 0},_find:function(e){return o["default"].resolve({id:e,createdLocally:!0})},_findQuery:function(e){var t=this;return f.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?o["default"].reject("chats preempted"):(Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(e)?Store.Msg.trigger(d.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(d.COLLECTION_HAS_SYNCED)},2500)),t.trigger(d.COLLECTION_HAS_SYNCED),o["default"].resolve(e))})},handle:function(e){var t=e.shift(),n=this;if(_.isArray(t)){var i=[],a=[];t.forEach(function(e){if("c.us"===e.id)a.push(e);else{var t=!!n.get(e.id),r=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag"].indexOf(e.type)>-1;r?t&&r?a.push(e):p.log("Model:chat:handle received junk chat record: "+(0,s["default"])(e))():i.push(e)}});var r=_.findIndex(i,function(e){return M.isPSA(e.id)});r>-1&&(i[r].name=l10n.t("whatsapp_psa_contact_name")),n.add(i,{merge:!0}),a.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":p.log("Model:chat:handle:clear:all before:"+e.before+" kind:"+e.kind)(),n.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)});break;case"delete":p.log("Model:chat:handle:delete:all")(),n.forEach(function(e){e["delete"]()});break;case"archive":p.log("Model:chat:handle:archive:all")(),n.forEach(function(e){e.archive=!0});break;case"unarchive":p.log("Model:chat:handle:unarchive:all")(),n.forEach(function(e){e.archive=!1});break;case"unstar":p.log("Model:chat:handle:unstar:all")(),Store.AllStarredMsgs["delete"](),n.forEach(function(e){e.unstarAll()});break;default:p.error("Model:chat:handle unknown "+(0,s["default"])(e),e)()}else{var i=n.get(e.id);if(!i)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var a=e.keys.length,r="star"===t,o=[],c=[],l=[],u=!1,d=0;d<a;d++){var h,f,m,v,y,E=e.keys[d];_.isArray(E)?(h=E[0],f=E[1],m=E[2],v=new g({fromMe:f,remote:e.id,id:h,participant:m}),y=Store.Msg.get(v),y?"clear"===t?y["delete"]():(y.star=r,r&&l.push(y)):r&&(u=!0)):_.isObject(E)&&"star"===t&&(v=E.id,y=Store.Msg.get(E.id),y?(y.star=!0,l.push(y)):c.push(E)),o.push(v.toString())}"star"!==t&&"unstar"!==t||Store.AllStarredMsgs.process(r,c,l,u),p.log("model:Chat:handle:messages:"+[t,e.id,o.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?i.deleteMsgsOlderThan(e.before,e.star,e.kind):i.deleteMsgs(e.star,e.kind),p.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag,e.kind].join())()):"unstar"===t&&(i.unstarAll(),p.log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(i.modifyTag=e.modifyTag);break;case"delete":i["delete"](),p.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":i.archive=!0;break;case"unarchive":i.archive=!1;break;case"spam":i.notSpam=e.notSpam;break;case"modify_tag":i.modifyTag=e.modifyTag}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=n.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(t.response)?Store.Msg.trigger(d.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(d.COLLECTION_HAS_SYNCED)},2500)),this.trigger(d.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var o=t.id,c=t.data;if("create"===c[0]||"introduce"===c[0]){var l=c[1],u=c[2],h=_.map(u.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(u.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:o,creation:u.creation,owner:l,participants:h,stale:!1},{merge:!0}),Store.Contact.add({id:o,name:u.subject},{merge:!0});var f=Store.Chat.get(o);if(!f)return;var m=f.msgs.last();if(!m)return;"gp2"===m.type&&"add"===m.subtype&&_.head(m.recipients)===Store.Conn.me&&v.alertNewMsg(m)}else{var y=Store.Chat.get(t.id);y?y.handleGroupAction.apply(y,t.data):p.error("model:chat: unknown chat for action "+(0,s["default"])(t))()}}else p.error("model:chat: unknown payload: "+(0,s["default"])(t))()},createGroup:function(e,t,n,i,a){var s=this,r=_.map(i,"id"),o=f.createGroup(e,r),c=new b(l10n.t("action_group_creating"));a=a||E.genId();var l=o.then(function(e){return 200===e.status?new b(l10n.t("action_group_created")):406===e.status?new b(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):void 0})["catch"](function(r){return p.error("models:chatCollection:createGroup dropped")(r),new b(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),s.createGroup.bind(s,e,t,n,i,a))});return v.openToast(u.createElement(E,{id:a,initialAction:c,pendingAction:l})),o.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){v.openChatBottom(e).then(function(t){t&&v.focusChatTextInput(e)})}),200===e.status&&!e._duplicate&&t&&n){var i=Store.ProfilePicThumb.gadd(e.gid);return i.setPicture(t,n)}200===e.status&&e._duplicate&&p.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](y.WapDrop,_.noop),o["default"].all([m.waitForBBEvent(this,d.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){p.log("ChatStore:resyncMessages")();var e=Store.Chat.filter(function(e){return e.isVisible}),t=e.map(function(e){var t=e.id,n={wid:t,archive:e.archive,mute:e.mute.expiration,active:e.active,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,unreadCount:e.unreadCount,notSpam:e.notSpam},i=e.lastReceivedKey;if(i){var a=i;n.id=a.id,n.fromMe=a.fromMe.toString(),n.participant=a.participant}return n});return f.resyncMessages(t).then(function(e){return e.status>=400?(p.error("ChatStore:resyncMessages resume error "+e.status)(),o["default"].reject(new Error("ChatStore:resyncMessages resume error "+e.status))):(p.log("ChatStore:resyncMessages resume success")(),e.checksum&&Store.Contact.resyncContacts(e.checksum),e.statusChecksum&&Store.StatusV3.sync(e.statusChecksum),e.data.forEach(function(e){if(e.disableUnreadAnchor=!1,"delete"!==e.type&&!M.isPSA(e.id)){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var n=Store.Chat.get(e.id);return n?void("clear"===e.type?!function(){n.resetMediaMsgs();var t=[];n.msgs.forEach(function(e){return t.push(e)}),n.msgChunks.length&&n.msgChunks.forEach(function(e){e.models.forEach(function(e){return t.push(e)})}),n.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],notSpam:e.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:e.disableUnreadAnchor,pendingMsgs:e.pendingMsgs}),n.mute.setMute(e.muteExpiration),_.each(t,function(e){e["delete"]()}),p.log("model:chat:resume: cleared chat for "+e.id)()}():"delete"===e.type?(n["delete"](),p.log("model:chat:resume: deleted chat for "+e.id)()):(n.set(e,{merge:!0}),n.mute.setMute(e.muteExpiration))):void Store.Chat.add(e)}),o["default"].resolve())})["catch"](y.WapDrop,function(e){return p.error("ChatStore:resyncMessages resume dropped")(),o["default"].reject(e)})},unstarAllMessages:function(e,t){var n=this,i=t?t.promises:this.promises,a=t?t.id:void 0;if(i.sendUnstarAll)return i.sendUnstarAll;i.sendUnstarAll=f.sendUnstarAll(a);var s=new b(l10n.t("action_message_unstarring_all")),r=i.sendUnstarAll.then(function(e){return 200===e.status?new b(l10n.t("action_message_unstarred_all")):e.status>=400?new b(l10n.t("action_message_unstar_all_failed")):void 0})["catch"](function(i){return p.error("models:chat:sendUnstarAll dropped")(i),new b(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function(){return n.unstarAllMessages(e,t)})});return v.openToast(u.createElement(E,{id:E.genId(),initialAction:s,pendingAction:r})),i.sendUnstarAll.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",!1)}),t?Store.AllStarredMsgs.remove(e):(Store.AllStarredMsgs.reset(),Store.StarredGifMsgs.reset()))})["finally"](function(){i.sendUnstarAll=null})}});e.exports=new S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1442),s=i(a),r=n(429),o=n(10),c=r.extend({model:s["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"chat_preference",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){this.get("defaultPreference")||this.add({id:"defaultPreference",wallpaperColor:o.DEFAULT_CHAT_WALLPAPER})},get:function(e,t){return r.prototype.get.call(this,e,t)||r.prototype.get.call(this,"defaultPreference")}});e.exports=new c},function(e,t,n){"use strict";var i=n(10),a=n(1),s=n(27),r=n(14),o={handle:function(e){var t=e.shift();switch(t.type){case"const":i[t.key]=t.value;break;case"read":if(t.isStatus){Store.StatusV3.handle([t]);break}case"unread":var n=Store.Chat.get(t.jid);n&&("read"===t.type?n.markSeen():"unread"===t.type&&n.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":s.upload("server-requested");break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](r.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](r.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](r.WapDrop,_.noop)):a.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":if(t.jid){var o=Store.Contact.get(t.jid);o?o.updateIdentity(t):a.error("Store:Cmd:handle:identity no contact",t)()}else a.error("Store:Cmd:handle:identity no jid",t)();break;default:a.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1443),s=i(a),r=n(429),o=n(433),c=r.extend({model:s["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var n=o.skinToneEmojis[e];if(!n)throw new Error("attempt to store variantless emoji");this.gadd({"char":n,variant:t})},getVariant:function(e){if(o.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1366),o=i(r),c=n(1),l=n(429),u=n(66),d=n(14),p=n(26),h=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](d.WapDrop,_.noop)})},_find:function(e){var t=this;if(p.isGroup(e)){var n=Store.Chat.get(e);return n&&n.isReadOnly?u.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(c.error("model:GroupMetadata:find error "+t.info)(),s["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):u.groupMetadataFind(e).then(function(n){if(n.status>=400)return{id:e,stale:!1};var i=[],a=t.get(e);return a?a.participants.set(n.participants):i=n.participants,t.updateSubject(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,participants:i}})}return p.isBroadcast(e)?u.contactFindBroadcast(e).then(function(t){if(200===t.status){var n=Store.GroupMetadata.get(e);if(n&&!n.stale)return s["default"].resolve(n);var i=[];return n?n.participants.set(t.recipients):i=t.recipients,{id:e,participants:i}}return 404===t.status?s["default"].reject("False broadcast list query."):(c.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),s["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(c.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),s["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new h},function(e,t,n){"use strict";var i=n(1391),a=n(1618);e.exports={Blocklist:n(1602),Call:n(1603),Chat:n(1604),Cmd:n(1606),GroupMetadata:n(1608),Msg:n(1610),MsgInfo:n(1611),AllStarredMsgs:new i,StarredGifMsgs:new a,Mute:n(1612),Presence:n(1613),ProfilePicThumb:n(1614),Props:n(1615),RecentEmoji:n(1617),EmojiVariant:n(1607),Status:n(1619),ChatPreference:n(1605),StatusV3:n(1621),StatusV3Privacy:n(1622)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(!S.supportsFeature(S.F.CONTACT_HAS_PUSHNAME)&&e.notifyName){var t=Store.Contact.get(e.sender);t&&!t.isMe&&(!t._notifyName||t._notifyName.t<e.t)&&(t._notifyName={
name:e.notifyName,t:e.t},t.trigger("change:_notifyName",e.notifyName))}}function s(e,t,n,i){var s=[],r=[];if(t.forEach(function(t,o){t.id instanceof k||(E.error("msgCollection:_processMultipleMessages: el.id is not a MsgKey"+(new Error).stack)(),D.upload("forgot-to-create-msgkey"),t.id=new k({from:t.from,to:t.to,id:t.id,participant:t.participant,self:t.self})),_.isString(e)&&C.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var c=Store.Msg.get(t.id);if(t.type===v["default"].TYPE.PROTOCOL)switch(t.subtype){case"revoke":if(c=Store.Msg.get(t.protocolMessageKey)){var l=new v["default"](t);c.sender===l.sender?c.revoke(l.id):E.warn("model:Msg:processMM revoke sender mismatch "+l.id.toString()+", "+c.id.toString())()}}else if(c){t.ack<c.ack&&delete t.ack;for(var u in t)t.hasOwnProperty(u)&&"undefined"==typeof t[u]&&delete t[u];t.id.fromMe&&!c.clientUrl&&t.clientUrl&&(t.phoneUploading=!1),n.isHistory&&(t.isNewMsg=!1);var d=c.t?_.omit(t,"t"):t;c.set(d),n.isHistory&&(c.recvFresh||i)&&!c.search?(E.warn("model:Msg:handle:processMM:"+(c.recvFresh?"dup:":"overlap:")+c.id)(),r.push(c)):n.isHistory&&c.search?(c.search=!1,E.warn("model:Msg:handle:processMM load search as history "+c.id)(),s.push(c.toJSON())):"search"!==n.add&&"resync"!==n.add||s.push(c.toJSON()),a(c)}else v["default"].typeIsMMS(t.type)&&!t.clientUrl&&(t.phoneUploading=t.id.fromMe&&0===t.ack),"search"===n.add&&(t.search=!0),n.update||s.push(t)}),0===s.length&&0===r.length){if(e&&n.pendingMsgsDone){var o=Store.Chat.get(e);o&&(o.pendingMsgs=!1)}return m["default"].resolve(t.map(function(e){return Store.Msg.get(e.id)}))}var l=m["default"].resolve(s).then(function(e){var t=Store.Msg.add(e,{merge:!0}),n=_.map(t,function(e){return a(e),e.waitForPrep()["catch"](function(e){E.assert(!1,"bad-msg-prep",""+e)(e)})});return m["default"].all(n)["return"](t)});if(e){var d;if(C.isStatusV3(e)){var p=t[0],h=p.id.fromMe?Store.Conn.me:p.author;d=Store.StatusV3.find(h)}else d=Store.Chat.find(e);return m["default"].all([l,d]).spread(function(a,s){var o,l,d="after"===n.add||"last"===n.add,p=!n.isHistory,h=!1;if("unread"===n.add?(o=i,s.msgChunks.push(o),l=n.firstUnreadKey):"last"===n.add&&n.resume?(o=i,h=!0):o="function"==typeof i?i():i,c(t,a,r,s,d,o||s.msgs,l,h),n.pendingMsgsDone&&(s.pendingMsgs=!1),p&&C.isBroadcast(e)&&!C.isStatusV3(e)&&a.forEach(function(t){if("broadcast_notification"===t.type){var n=Store.GroupMetadata.get(e);"add"===t.subtype?n.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&n.participants.remove(t.body),s.groupMetadata.stale=!1}else t.recvFresh&&!t.isNotification&&u(t)}),S.supportsFeature(S.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var f=0;f<a.length;f++){var m=a[f];if(m.isNewMsg&&m.isSentByMe&&m.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})})}return l.then(function(e){return t.map(function(e){return Store.Msg.get(e.id)}).filter(function(e){return!!e.chat})})}function r(e,t,n,i,a,s){var r=i||t.msgs;if(e=_.isArray(e)?e:[e],0!==e.length){var o=r===t.msgs;if(s){o&&E.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")(),o=!0,t.lastReceivedKey=_.last(e).id,r.add(e);var c=new O;c.replace(t.msgs),t.msgChunks.push(c),t.replaceMsgsCollection(r),t.msgs.trigger("change:last",t.msgs.last())}else n?(o&&(t.lastReceivedKey=_.last(e).id),r.add(e)):r.add(e,{at:0,silent:_.every(e,d)});if(n&&o||!Store.Msg.lastReceivedReceipt[t.id])for(var l=e.length,u=l-1;u>=0;u--){var p=e[u],h=p.id;if(h.fromMe&&!p.isNotification){Store.Msg.updateLastReceipt(h.remote,p.t);break}}a&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=_.find(e,function(e){return e.id.toString()===a.toString()}))}}function o(e,t,n,i,a){var s,r,o,c={},l={},u=n.length,d=a;if(0===u)return{msgs:t,collection:d};for(s=0;s<u;s++)r=n[s],l[r.id]=r;for(u=t.length,s=0;s<u;s++)r=t[s],c[r.id]=r;var p=[];for(u=e.length,s=0;s<u;s++)if(r=e[s],o=c[r.id],o&&p.push(o),o=l[r.id])if(o.recvFresh)p.push(o),i.removeMsg(o),o.unset("recvFresh");else{var h=i.getAllCMCs(),f=_.find(h,function(e){return e.get(r.id)});a&&f===a||(f?(f.forEach(function(e){p.push(e),delete l[e.id]}),f===i.msgs?(i.replaceMsgsCollection(a),d=i.msgs):(i.notifyMsgCollectionMerge(a,f,a),i.removeMsgsCollection(f))):(E.error("models:Msg:reorder trying to merge CMC of orphaned message "+r.id,r)(),p.push(l[r.id])))}return{msgs:p,collection:d}}function c(e,t,n,i,a,s,c,l){var u=o(e,t,n,i,s);r(u.msgs,i,a,u.collection,c,l)}function l(e){return _.isObject(e)?JSON.parse((0,h["default"])(e)):e}function u(e){function t(t){var n=new k({from:e.from,to:t,id:i.id});if(!Store.Msg.some(_.matches({id:n}))){var a=l(e);a.to=t,a.id=n,a.broadcast=!0;var s=Store.Msg.add(a,{merge:!0});Store.Chat.find(t).then(function(e){r(s,e,!0)})}}var n,i=e.id;if(!e.invis)if(e.recipients&&0!==e.recipients.length)n=e.recipients,e.recipients.forEach(t);else{var a=Store.GroupMetadata.get(i.remote);a?(n=l(a.participants),_.map(n,"id").forEach(t)):E.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+i.remote)()}return n}function d(e){return"i"===e.eventType}var p=n(20),h=i(p),f=n(2),m=i(f),g=n(1307),v=i(g),y=n(10),E=n(1),b=n(429),M=n(14),C=n(26),S=n(139),T=n(51),w=n(67),k=n(39),P=n(12),N=n(66),O=n(1347),D=n(27),x=6e4,R=b.extend({model:v["default"],initialize:function(){b.prototype.initialize.call(this),this.lastReceivedReceipt={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.listenTo(P,"change:stream",function(){P.stream===P.STREAM.DISCONNECTED&&(this.preAck={})}),this.listenTo(this,"remove",this.removeFromCollection)},removeFromCollection:function(e){e.chat&&e.chat.removeFromCollection(e)},_findQuery:function(e){var t,n=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return N.msgFindQuery(t,e).then(function(i){if(i.status>=400)return E.error("model:Msg:findQuery error "+i.status)(),m["default"].reject(i.status);var a=function(){var t=n.get(e),i=Store.Chat.get(e.remote);return t?t.msgChunk:i?i.msgs:void 0};return i.forEach(function(e){e.invis=!0}),E.log("model:Msg:findQuery:got:"+i.length+":"+e.direction)(),n.processMultipleMessages(e.remote,i,{add:t,isHistory:!0},a)})},resyncChatMsgs:function(e,t){var n=this,i="number"!=typeof t||isNaN(t)?y.PAGE_SIZE:t;return N.msgFindQuery("before",{remote:e,count:i}).then(function(e){return e.status>=400?(E.error("model:Msg:resyncChatMsgs error "+e.status)(),m["default"].reject(e.status)):n.processMultipleMessages(void 0,e,{add:"resync"})})},getStarred:function(e,t,n,i){var a=this,s={count:"number"!=typeof t||isNaN(t)?y.PAGE_SIZE:t,chat:e&&_.isString(e)?e:void 0,remote:n&&n.remote,id:n&&n.id,fromMe:n&&n.fromMe,participant:n&&n.participant,media:i?"gif":void 0};return N.msgFindQuery("star",s).then(function(e){return e.status>=400?(E.error("model:Msg:getStarred error "+e.status)(),m["default"].reject(e.status)):a.processMultipleMessages(void 0,e,{add:"search"})})},incrementalStarredUpdate:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})},search:function A(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=this,i=arguments[2],a=arguments[3];if(1!==t||a)return this._search(e,t,i,a);var s=this.ftsCache[e];if(s)return s;var A=this._search(e,t,i,a);this.ftsCache[e]=A;var r=function(){n.ftsCache[e]=null};return _.delay(r,x),A["catch"](r),A},_search:function(e,t,n,i){var a=this,s={searchTerm:e,page:t&&_.isNumber(t)?t:1,count:n&&_.isNumber(n)?n:y.PAGE_SIZE,remote:i};return N.msgFindQuery("search",s).then(function(e){if(e.status>=400)return E.error("model:Msg:search error "+e.status)(),m["default"].reject(e.status);var t=_.isArray(e)?e:e.messages,n=!!_.isArray(e)||e.eof;return m["default"].props({messages:a.processMultipleMessages(void 0,t,{add:"search"}),eof:n})})},queryMedia:function(e,t,n,i,a){var s=this,r={remote:e,count:t&&_.isNumber(t)?t:y.PAGE_SIZE,id:i&&i.id,fromMe:i&&i.fromMe,participant:i&&i.participant,direction:n||"before",media:a};return N.msgFindQuery("media",r).then(function(e){return e.status>=400?(E.error("model:Msg:media error "+e.status)(),m["default"].reject(e.status)):a?s.processMultipleMessages(void 0,e,{add:"search"}):m["default"].props({docCount:e.docCount,linkCount:e.linkCount,mediaCount:e.mediaCount,messages:s.processMultipleMessages(void 0,e.messages,{add:"search"})})})},getContext:function(e,t){var n=this,i=this.get(e);return i?m["default"].all([N.msgFindQuery("before",e),N.msgFindQuery("after",e)]).spread(function(a,s){return _.isArray(a)&&_.isArray(s)?(i.search=!1,m["default"].all([n.processMultipleMessages(e.remote,a,{add:"before",isHistory:!0},t),n.processMultipleMessages(e.remote,s,{add:"after",isHistory:!0},t)])):(E.error("model:msg:getContext fetch error",a,s)(),m["default"].reject(a.status||s.status))}):N.msgFindQuery("after",e).then(function(i){return _.isArray(i)?C.isStatusV3(i[0].id.remote)?m["default"].reject("statusV3, stop querying before the msg"):n.processMultipleMessages(e.remote,i,{add:"after",isHistory:!0},t):(E.error("model:msg:getContext:after fetch error",i)(),m["default"].reject(i.status))}).then(function(t){var i=t[0],a=i.id.clone();return a.count=e.count+1,m["default"].all([N.msgFindQuery("before",a).then(function(t){if(!_.isArray(t))return E.error("model:msg:getContext:before fetch error",t)(),m["default"].reject(t.status);var a=t[t.length-1],s=a.id;if(!s.equals(e))return E.error("model:msg:getContext:before ctx message mismatch",t)(),m["default"].reject(405);var r=function(){return i.msgChunk};return n.processMultipleMessages(e.remote,t,{add:"before",isHistory:!0},r)}),m["default"].resolve(t)])})},handle:function(e){function t(e,t){var n=new k({from:r.from,to:e,id:t,participant:r.participant,selfDir:r.self||"out"}),i=s.get(n);if(i){i.updateAck(r.ack),s.updateLastReceipt(n.remote,r.t);var a=n.remote;C.isUser(a)&&(Store.MsgInfo.update(t,r.from,e,r.ack,a,r.t),C.isBroadcast(r.broadcast)&&Store.MsgInfo.update(t,r.from,r.broadcast,r.ack,a,r.t))}else E.log("Msg:out of order ack",r)(),s.preAck[n]=r}var n,i,a,s=this,r=e.shift();if("ack"===r.cmd){var o=[r.to];if(C.isBroadcast(r.to)&&1===r.ack){var c=Store.GroupMetadata.get(r.to);c&&Array.prototype.push.apply(o,_.map(c.participants.toArray(),"id"))}return o.forEach(function(e){t(e,r.id)}),!0}if("acks"===r.cmd)return r.id.forEach(function(e){t(r.to,e)}),!0;if(r.msg)return C.isStatusV3(r.chat)&&!Store.StatusV3.handleUpdate(r.msg,r.meta.checksum)||(r.msg.recvFresh=!0,r.msg.isNewMsg=!0,this.processMultipleMessages(r.chat,[r.msg],{add:"after",update:"update"===r.meta.add,isHistory:!1})),!0;if(r.msgs){var l=r.msgs.length;if(!l)return!1;i=r.meta,i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new k({fromMe:i.unreadFromMe,remote:r.chat,id:i.unreadId,participant:i.unreadParticipant}),a=new O);for(var u=0;u<l;u++)n=r.msgs[u],n.invis=!0;return Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&this.trigger(y.COLLECTION_HAS_SYNCED),this.processMultipleMessages(r.chat,r.msgs,i,a),!0}if(r.recent){i=r.meta,delete r.recent,delete r.meta,this.trigger(y.COLLECTION_HAS_SYNCED),i.isHistory=!0;for(var d in r)"last"===i.add&&i.resume&&(a=new O),n=r[d],n.invis=!0,this.processMultipleMessages(d,[n],i,a)}else E.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return T.waitForBBEvent(this,y.COLLECTION_HAS_SYNCED)},"delete":function(){b.prototype["delete"].call(this),this.lastReceivedReceipt={},this.preAck={}},send:function(e){return m["default"].callSynchronously(function(){var t=e.id,n=e.toJSON();if(S.supportsFeature(S.F.SPAM)&&Store.Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](_.noop)}),e.isNewMsg=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return m["default"].reject(new M.ContactBlocked("Contact is blocked"));if(C.isBroadcast(n.to))var i=u(n);delete n.status,delete n.mimetype,delete n.height,delete n.width,delete n.recipients,delete n.chat,delete n.broadcast,delete n.ack,delete n.invis,delete n.filehash,delete n.recvFresh,delete n.mediaData,w.isHttp(e.url)||delete n.url,w.isHttp(e.clientUrl)||delete n.clientUrl;for(var a in n)null!==n[a]&&"undefined"!=typeof n[a]||delete n[a];return e.isMMS&&(n.avparams=e.avParams()),"chat"!==n.type||"url"!==n.subtype||S.supportsFeature(S.F.URL)||delete n.subtype,n.quotedMsg&&!S.supportsFeature(S.F.REPLIES_OUT)&&(delete n.quotedMsg,delete n.quotedStanzaID,delete n.quotedRemoteJid,delete n.quotedParticipant),n.mentionedJidList&&!S.supportsFeature(S.F.MENTIONS_OUT)&&delete n.mentionedJidList,Store.Chat.find(e.id.remote).then(function(t){return t.sendSeen(),m["default"].props({reply:N.msgCreateRecord(n,e.local),chat:t})}).then(function(n){var a=n.reply,s=n.chat;if(200===a.status){var r=t.remote,o=t.fromMe&&t.remote===Store.Conn.me?3:a.data?a.data.ack:1;return e.updateAck(o),s.lastReceivedKey=t,Store.Msg.updateLastReceipt(r,a.t),C.isBroadcast(r)&&(i?i.forEach(function(e){var n=new k({from:Store.Conn.me,to:e.id,id:t.id}),i=Store.Msg.get(n);i&&(i.ack=1,Store.Msg.updateLastReceipt(e,i.t),Store.Chat.find(e).then(function(e){e.lastReceivedKey=n}))}):E.log("model:msg:createRecord bclist server ack, no recipients")()),"success"}return 408!==a.status&&E.assert(!1,"send-not-200","Phone responded "+a.status)(),"dropped"})["catch"](function(e){return E.error("model:msg:createRecord dropped msg: "+n.id)(n.type),E.assert(!1,"send-msg-error","Got error "+e)(e),"dropped"})})},resyncReceipts:function(){E.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var n,i=Store.Chat.get(t);if(n=i?S.gte([0,5])?i.getFirstMsgWithStatus():i.getFirstMsgFromMe():void 0){var a=n.id;a.t=Store.Msg.lastReceivedReceipt[t]||n.t||0,e.push(a)}else E.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?m["default"].resolve():N.resyncReceipts(e).then(function(e){_.isArray(e)?(E.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var n=new k({fromMe:t[1],remote:e.id,id:t[0],participant:t[2]}),i=Store.Msg.get(n);i&&i.updateAck(t[3])}else E.error("Msg:resyncReceipts invalid response: "+(0,h["default"])(t))()})})):E.error("Msg:resyncReceipts error",e)()})["catch"](M.LogoutDrop,M.EphemeralDrop,M.BrowserReplacedDrop,_.noop)["catch"](function(e){throw E.error("Msg:resyncReceipts dropped "+e+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var n=this.lastReceivedReceipt[e];(!n||t>n)&&(this.lastReceivedReceipt[e]=t)},processMultipleMessages:function(e,t,n,i){var a=this,r=function(){return s.call(a,e,t,n,i)};if(e){var o,c=this.pendingAdd[e];return o=c?c.then(r):r(),o["finally"](function(){a.pendingAdd[e]===o&&(a.pendingAdd[e]=null)}),this.pendingAdd[e]=o}return r()}});e.exports=new R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(1446),l=i(c),u=n(1),d=n(26),p=n(39),h=n(429),f=n(12),m=n(66),g=h.extend({model:l["default"],initialize:function(){h.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(f,"change:stream",function(){f.stream===f.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){var t=Store.Msg.get(e);return t?t.isSentByMe?m.queryMsgInfo(t.id).then(function(e){return e.status>=400?(u.log("model:MsgInfo:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.id=t.id,e.isPTT=t.type===o["default"].TYPE.PTT,s["default"].resolve(e))}):s["default"].reject("message not sent by me"):s["default"].reject("No message found for id: "+e)},update:function(e,t,n,i,a,s){var r=new p({from:t,to:n,id:e,participant:a}),o=new p({from:t,to:n,id:e}),c=this.get(r)?this.get(r):this.get(o),l=d.isUser(o.remote),h=void 0,f=void 0;if(c)switch(i){case 4:if(h=c.played.get(a),h||(c.played.add({id:a,t:s}),c.playedRemaining-=1),l)break;case 3:if(f=c.read.filter(function(e){return e.id===a}),c.read.remove(f),3===i&&(c.read.add({id:a,t:s}),0===f.length&&(c.readRemaining-=1)),l)break;case 2:f=c.delivery.filter(function(e){return e.id===a}),c.delivery.remove(f),2===i&&(c.delivery.add({id:a,t:s}),0===f.length&&(c.deliveryRemaining-=1));break;default:u.error("model:MsgInfo:handle ack err: "+i,arguments)()}},handle:function(e){var t=this,n=e.shift();switch(n.cmd){case"ack":this.update(n.id,n.from,n.to,n.ack,n.participant,n.t);break;case"acks":n.id.forEach(function(e){t.update(e,n.from,n.to,n.ack,n.participant,n.t)})}}});e.exports=new g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1389),s=i(a),r=n(1),o=n(429),c=n(19),l="global_mute",u=!0,d=!0,p=!0,h=o.extend({model:s["default"],initialize:function(){o.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:o.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=c.getGlobalSounds();this.setGlobalSounds(e);var t=c.getGlobalNotifications();this.setGlobalNotifications(t);var n=c.getGlobalPreviews();this.setGlobalPreviews(n)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;r.log("models:mute:cache-save: "+e)(),c.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(l);return e?e:this.add({id:l})},getGlobalSounds:function(){return u},setGlobalSounds:function(e){u=e,c.setGlobalSounds(e)},getGlobalNotifications:function(){return d},setGlobalNotifications:function(e){d=e,c.setGlobalNotifications(e)},getGlobalPreviews:function(){return p},setGlobalPreviews:function(e){p=e,c.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=Store.Chat.get(n.id);i&&"mute"===n.type&&i.mute.setMute(n.muteExpiration)}}});e.exports=new h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),c=n(106),l=i(c),u=n(1),d=n(429),p=n(66),h=n(14),f=d.extend({model:o["default"],initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(l["default"],"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,p.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,s["default"].reject(e)})["catch"](h.WapDrop,_.noop),p.lastseenFind(e).then(function(n){return 423===n.status?{id:e,stale:!0,hasData:!1}:401===n.status?(t.handle({id:e,deny:!0}),{id:e}):(n.id=e,t.handle(n),{id:e})})):s["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):u.log('models:presence:handle for self is not "unavailable" !')();else{var n=this.get(t.id);n&&("unsubscribe"===t.type?n.set({isSubscribed:!1,stale:!0}):(n.handle(t),n.stale=!1))}},onPresenceSubscribabilityChange:function(){l["default"].phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](h.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1390),o=i(r),c=n(106),l=i(c),u=n(1),d=n(429),p=n(19),h=n(66),f=n(14),m=n(26),g=n(443),v=n(12),y=d.extend({model:o["default"],initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:d.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(l["default"],"change:phoneActive",function(){l["default"].phoneActive&&this.onPhoneActive()})},get:function(e){var t=d.prototype.get.call(this,e);if(!_.isString(e))return t;var n=d.prototype.get.call(this,g(e));if(n){if(this.remove(n,{silent:!0}),t)return t;var i=n.toJSON();return i.id=e,this.add(i,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return m.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=g(e.id),e}),u.log("models:profilePic:cache-save: "+e)(),p.setCollection(e,t)}},onPhoneActive:function(){if(v.stream===v.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?h.profilePicFindThumbFromPhone(e,this.get(e)):h.profilePicFind(e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e,tag:null}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:null,eurl:t.eurl}:void 0})["catch"](f.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var n=Store.ProfilePicThumb.get(e);n&&("remove"===t?n.unset("tag"):n.tag!==t&&n.update()["catch"](f.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?s["default"].resolve():h.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(e){if(423===e.status)u.warn("ProfilePicThumbStore:resyncPictures blocked")();else{if(e.status>=400)throw u.error("ProfilePicThumbStore:resyncPictures error "+e.status)(e),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw u.error("ProfilePicThumbStore:resyncPictures unknown reply",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");u.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](f.WapDrop,_.noop)["catch"](function(e){u.error("ProfilePicThumbStore:resyncPictures dropped: "+e)()})}});e.exports=new y},function(e,t,n){"use strict";function i(e){return"number"==typeof e&&e>0?e-1:c.MAX_GROUP_SIZE}function a(e){return"number"==typeof e&&e>0?1024*e*1024:c.MAX_MEDIA_UPLOAD_SIZE}function s(e){return"number"==typeof e&&e>0?1024*e*1024:c.MAX_FILE_SIZE}function r(e){return"number"==typeof e&&e>0?1024*e:c.IMG_MAX_BYTES}function o(e){var t;l.Global.webcBucket=e.bucket||null;for(t in p)if("undefined"!=typeof e[t]){var n,i,a=p[t];_.isArray(a)?(n=a[0],i=a[1](e[t])):(n=a,i=e[t]),n&&(c[n]=i)}for(t in d.F)"undefined"!=typeof e[t]&&d.setFeature(t,!!e[t])}var c=n(10),l=n(52),u=n(66),d=n(139),p={bucket:null,gifSearch:"SHOW_GIF_SEARCH",imageMaxEdge:"IMG_MAX_EDGE",imageMaxKBytes:["IMG_MAX_BYTES",r],maxParticipants:["MAX_GROUP_SIZE",i],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",a],maxFileSize:["MAX_FILE_SIZE",s],statusV3:"STATUS_V3"},h={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||o(t)},fetch:function(){return u.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||o(e)})}};e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaProxy=t.ContactProxy=t.StreamProxy=t.ConnProxy=t.ChatPreferenceProxy=t.StatusProxy=t.EmojiVariantProxy=t.RecentEmojiProxy=t.ProfilePicThumbProxy=t.ChatstateProxy=t.PresenceProxy=t.MuteProxy=t.MsgInfoProxy=t.MsgProxy=t.GroupMetadataProxy=t.ChatProxy=t.CallProxy=t.BlocklistProxy=void 0;var a=n(1436);Object.defineProperty(t,"BlocklistProxy",{enumerable:!0,get:function(){return a.BlocklistProxy}});var s=n(1437);Object.defineProperty(t,"CallProxy",{enumerable:!0,get:function(){return s.CallProxy}});var r=n(1308);Object.defineProperty(t,"ChatProxy",{enumerable:!0,get:function(){return r.ChatProxy}});var o=n(1366);Object.defineProperty(t,"GroupMetadataProxy",{enumerable:!0,get:function(){return o.GroupMetadataProxy}});var c=n(1307);Object.defineProperty(t,"MsgProxy",{enumerable:!0,get:function(){return c.MsgProxy}});var l=n(1446);Object.defineProperty(t,"MsgInfoProxy",{enumerable:!0,get:function(){return l.MsgInfoProxy}});var u=n(1389);Object.defineProperty(t,"MuteProxy",{enumerable:!0,get:function(){return u.MuteProxy}});var d=n(1354);Object.defineProperty(t,"PresenceProxy",{enumerable:!0,get:function(){return d.PresenceProxy}}),Object.defineProperty(t,"ChatstateProxy",{enumerable:!0,get:function(){return d.ChatstateProxy}});var p=n(1390);Object.defineProperty(t,"ProfilePicThumbProxy",{enumerable:!0,get:function(){return p.ProfilePicThumbProxy}});var h=n(1447);Object.defineProperty(t,"RecentEmojiProxy",{enumerable:!0,get:function(){return h.RecentEmojiProxy}});var f=n(1443);Object.defineProperty(t,"EmojiVariantProxy",{enumerable:!0,get:function(){return f.EmojiVariantProxy}});var m=n(1367);Object.defineProperty(t,"StatusProxy",{enumerable:!0,get:function(){return m.StatusProxy}});var g=n(1442);Object.defineProperty(t,"ChatPreferenceProxy",{enumerable:!0,get:function(){return g.ChatPreferenceProxy}});var v=n(440);Object.defineProperty(t,"ConnProxy",{enumerable:!0,get:function(){return v.ConnProxy}});var y=n(106);Object.defineProperty(t,"StreamProxy",{enumerable:!0,get:function(){return y.StreamProxy}});var E=n(218);Object.defineProperty(t,"ContactProxy",{enumerable:!0,get:function(){return E.ContactProxy}});var _=n(1318),b=i(_);t.MediaProxy=b["default"].Proxy},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1447),o=i(r),c=n(10),l=n(1),u=n(429),d=n(66),p=n(14),h=n(433),f=n(139),m=u.extend({model:o["default"],comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){u.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:u.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){u.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return f.supportsFeature(f.F.RECENT_EMOJI_SYNC)?d.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=h.normalizeEmoji(e["char"])}),s["default"].resolve(e)):(l.error("models:recentEmoji:findQuery error",e)(),s["default"].reject("recent emoji fetch error"))}):s["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](p.WapDrop,_.isString,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},c.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){f.supportsFeature(f.F.RECENT_EMOJI_SYNC)&&(l.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.head(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,n){t.weight=1+3*((e-n)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(429),l=n(12),u=n(139),d=n(1),p=c.extend({model:o["default"],initialize:function(){var e=this;c.prototype.initialize.call(this,{staleCollection:!0}),this.syncPromise=null,this.isSynced=!1,this.listenTo(l,"change:stream",function(){l.stream===l.STREAM.DISCONNECTED&&(e.isSynced=!1)})},comparator:function(e,t){return t.t-e.t},onResume:function(){this.isSynced=!1,this.sync()},sync:function(){var e=this;return this.isSynced?s["default"].resolve():this.syncPromise?this.syncPromise:u.supportsFeature(u.F.STARRED_GIFS)?(this.syncPromise=Store.Msg.getStarred(void 0,void 0,void 0,!0).then(function(t){var n=[];t&&t.length&&(n=_.filter(t,function(e){return e.isGif})),e.set(n)})["catch"](function(e){499!==e&&d.error("starred gif msgs sync error: ",e)()})["finally"](function(){e.syncPromise=null,e.isSynced=!0}),this.syncPromise):s["default"].resolve()},add:function(e,t){if(e&&u.supportsFeature(u.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&!this.get(e))){var n=_.filter(e,function(e){return e.isGif});c.prototype.add.call(this,n,t)}},remove:function(e,t){if(e&&u.supportsFeature(u.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&this.get(e))){var n=_.filter(e,function(e){return e.isGif});c.prototype.remove.call(this,n,t)}}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1367),o=i(r),c=n(106),l=i(c),u=n(6),d=n(1),p=n(429),h=n(66),f=n(14),m=n(12),g=n(8),v=n(139),y=n(105).ActionToast,E=n(105).ActionType,b=n(10),M=p.extend({model:o["default"],initialize:function(){p.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(l["default"],"change:phoneActive",function(){l["default"].phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){m.stream===m.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](f.WapDrop,_.noop)})},_find:function(e){var t=b.STATUS_V3?s["default"].resolve({id:e,status:""}):h.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](f.WapDrop,function(){return{id:e,stale:!0,status:""}});return t},_handle:function(e){return e},canSetMyStatus:function(){return v.supportsFeature(v.F.SET_STATUS)&&!!b.STATUS_V3},setMyStatus:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return s["default"].reject(new f.ActionError);if(!this.canSetMyStatus())return s["default"].reject(new f.ActionError);var i=h.sendSetStatus(t),a=new E(l10n.t("action_status_setting")),r=this.get(Store.Conn.me).status;n=n||y.genId();var o=i.then(function(t){return 200===t.status?new E(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,r,n)):t.status>=400?new E(l10n.t("action_status_set_failed")):void 0})["catch"](function(i){throw d.error("models:statusCollection:setMyStatus dropped")(i),new E(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,n))});return g.openToast(u.createElement(y,{id:n,initialAction:a,pendingAction:o})),i.bind(this).then(function(e){200!==e.status||e._duplicate||(this.get(Store.Conn.me).status=t)})}});e.exports=new M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1307),o=i(r),c=n(33),l=n(1441),u=n(10),d=n(1),p=n(66),h=l.extend({Collection:"StatusV3",props:{id:"string",t:"number",unreadCount:"number",totalCount:"number",pic:"object",_msgs:{type:"array","default":function(){return[]}}},session:{readKeys:{type:"object","default":function(){return{}}},contact:"object"},derived:{renderedThumbnail:{deps:["msgsChanged","pic","totalCount"],fn:function(){if(this.msgs.length===this.totalCount)for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(t.type===o["default"].TYPE.IMAGE||t.type===o["default"].TYPE.VIDEO)&&t.body)return delete this.pic,c.decode(t.body)}return this.pic}}},initialize:function(){l.prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id)),this._msgs.length>0&&(Store.StatusV3.addStatusMessages(this.id,this._msgs),this._msgs=[])},"delete":function(){l.prototype["delete"].call(this),Store.StatusV3.remove(this.id)},onEmptyMRM:function(){var e=this;d.log("models:StatusV3:removeMsg 0 messages left, querying...")(),this.loadMore()["catch"](function(t){404===t&&e["delete"]()})},loadMore:function(){var e=this;return this.msgs.msgLoadState.noEarlierMsgs?s["default"].resolve():this.msgs.msgLoadState.isLoadingEarlierMsgs?this.msgs.loadEarlierPromise:Store.StatusV3.loadMore(this.id,u.PAGE_SIZE,this.msgs.last()).then(function(t){return _.isArray(t)&&t.length<u.PAGE_SIZE&&(e.msgs.msgLoadState.noEarlierMsgs=!0),
t})["catch"](function(t){404===t&&e["delete"]()})},handleReadStatus:function(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0?this.unreadCount--:d.error("statusv3:"+this.id+":new read key but unreadCount 0")())},sendReadStatus:function(e){var t=this;return p.sendStatusSeen(e).then(function(n){200===n.status&&t.handleReadStatus(e)})},sendMute:function(e){var t=this;return p.sendStatusMute(this.id,e).then(function(n){200===n.status&&(t.contact.statusMute=e)})}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1620),o=i(r),c=n(429),l=n(33),u=n(10),d=n(14),p=n(1),h=n(66),f=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this),this.checksum=void 0},"delete":function(){c.prototype["delete"].call(this),delete this.checksum},_find:function(e){return s["default"].resolve({id:e})},_findQuery:function(e){var t=this;return h.statusQuery().then(function(e){return t.checksum=e.checksum,e.statuses})},loadMore:function(e,t,n){return h.statusQuery(e,t,n&&n.id,"after").then(function(e){return e.status>=400?(p.error("model:statusv3:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.forEach(function(e){e.invis=!0}),p.log("model:statusv3:loadMore:"+e.length)(),Store.Msg.processMultipleMessages(u.STATUS_WID,e,{add:"after",isHistory:!0}))})},sync:function(e){return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()})["catch"](d.WapDrop,_.noop):s["default"].resolve(void 0)},hasSynced:function(){return!!this.checksum},handleUpdate:function(e,t){var n=e.author;if(this.updateChecksum(t),this.hasSynced()){var i=this.get(n);if(i){var a=i.totalCount===i.msgs.length;return e.invis||i.unreadCount++,i.totalCount++,i.t=e.t,!a&&e.body&&(i.pic=l.decode(e.body)),a}return this.add({id:n,t:e.t,unreadCount:e.invis?0:1,totalCount:1,_msgs:[e]}),!1}return!1},updateChecksum:function(e){e?this.hasSynced()&&(this.checksum=e):p.error("models:statusV3:no_checksum")()},handle:function(e){var t=e.shift();if(_.isArray(t))p.warn("models:statusV3:unexpected update")(t);else switch(t.type){case"read":this.updateChecksum(t.checksum);var n=this.get(t.chat);n?n.handleReadStatus(t.key):p.log("models:statusV3:read:no_status:"+[t.chat,t.key].join())(t);break;case"privacy":Store.StatusV3Privacy.update(t);break;default:p.warn("models:statusV3:unknown:"+t.type,t)()}},addStatusMessages:function(e,t){return Store.Msg.processMultipleMessages(u.STATUS_WID,t,{add:"after",isHistory:!0})}});e.exports=new f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(145),o=i(r),c=n(1),l=n(12),u=n(66),d=n(26),p=(0,r.defineState)("StatusPrivacy",{props:{blacklist:{type:"array","default":function(){return[]}},whitelist:{type:"array","default":function(){return[]}},type:"string"},session:{isValid:"boolean"},initialize:function(){var e=this;o["default"].prototype.initialize.call(this),this.isValid=!1,this.listenTo(l,"change:stream",function(){l.stream===l.STREAM.RESUMING&&(e.isValid=!1)})},query:function(){var e=this;return u.getStatusPrivacy().then(function(t){switch(t.status){case 200:e.set({blacklist:t.blacklist,whitelist:t.whitelist,type:t["default"],isValid:!0});break;case 404:e.set({type:"contacts",isValid:!0});break;default:return c.error("statusV3Privacy:query:error:"+t.status,t)(),s["default"].reject(t.status)}})},update:function(e){this.isValid&&(e.whitelist&&this.set({type:"whitelist",whitelist:e.whitelist}),e.blacklist&&this.set({type:"blacklist",blacklist:e.blacklist}),e.contacts&&(this.type="contacts"))},sendSetPrivacy:function(e,t){var n=this;if(!this.isValid)return s["default"].reject("called setPrivacy when isValid false");var i;switch(e){case"blacklist":case"whitelist":if(i=_.isArray(t)?t.filter(function(e){return d.isUser(e)}):void 0,!_.isArray(i)||0===i.length)return s["default"].reject("called setPrivacy blacklist/whitelist with no valid jids");break;case"contacts":break;default:e="contacts"}return u.setStatusPrivacy(e,i).then(function(t){if(200===t.status){var a={};a[e]=i,n.update(a)}return t})["catch"](function(e){})}}),h=p.StatusPrivacy;e.exports=new h({id:1})},function(e,t){"use strict";e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind",ZOOM:"zoom",LAUNCH:"launch"},Actions:{PREFERENCES:"preferences",NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",ZOOM_RESET:"zoom_reset",TOGGLE_UNREAD:"toggle_unread",DELETE_CHAT:"delete_chat",DELETE_GROUP:"delete_group",EXIT_GROUP:"exit_group",TOGGLE_ARCHIVE:"toggle_archive",TOGGLE_MUTE:"toggle_mute",SEARCH_CHAT:"search_chat",NEXT_CHAT:"next_chat",PREV_CHAT:"prev_chat",CONTACT_US:"contact_us",METRIC_UPDATE:"metric_update"},Metrics:{BETA_UPDATES:"beta_updates"}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(106),o=i(r),c=n(6),l=n(10),u=n(84),d=n(140),p=n(141),h=n(26),f=n(14),m=n(1327),g=n(228),v=c.createClass({displayName:"NotificationManager",mixins:[u,d,p],componentWillMount:function(){this.tone=new Audio(l.NOTIFICATION_TONE_PATH),this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:archive change:unreadCount",this.updateUnreadCount),this.addObserver(Store.Chat,"change:hasUnread",this.closeNotifications),this.addObserver(o["default"],"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){g.setTitleAndIcon(0),g.closeAllNotifications()},closeNotifications:function(e,t){t||g.closeChatNotifications(e.id)},updateUnreadCount:function(){var e;e=o["default"].displayInfo===o["default"].INFO.OFFLINE?-1:o["default"].displayInfo===o["default"].INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,g.setTitleAndIcon(e))},alertNewMsg:function(e){var t=e.chat;if(!(document.hasFocus()&&t.get("active")||Store.Mute.globalMute().isMuted)){if(t.mute.isMuted){if(!e.isGroupMsg)return;if(!e.isMentioned(Store.Conn.me)&&!e.isQuoted(Store.Conn.me))return;var n=Store.Chat.get(e.sender);if(n&&n.mute.isMuted)return}if(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds())if(t.isGroup){var i=Date.now(),a=t.squelch||0;i>a&&(this.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var n=e.participants.length,a=1e3*Math.min(120,30+5*n);t.squelch=i+a})["catch"](f.WapDrop,function(){t.squelch=i+6e4}))}else this.playAudioNotification()}},showCallNotification:function(e,t,n){if(window.Notification&&window.Notification.permission===l.PERMISSION_ALLOWED){var i=Store.Contact.get(t),a=i?i.get("formattedName"):h.formattedUser(t),r=n?l10n.t("incoming_video_call_notification_title",{name:a}):l10n.t("incoming_voice_call_notification_title",{name:a}),o=l10n.t("incoming_call_notification_text");Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(n){var i=n&&n.get("img")?n.get("img"):l.USER_DEFAULT_ICON;g.showNotification(t,e,r,o,i,!0)})["catch"](f.WapDrop,s["default"].TimeoutError,function(n){g.showNotification(t,e,r,o,l.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){g.closeNotification(e),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===l.PERMISSION_ALLOWED){var t=e.get("chat"),n=t.get("id"),i=m.asDesktopNotification(e);i&&i.charCodeAt(0)>=128&&(i=" "+i);var a=t.isGroup?l.GROUP_DEFAULT_ICON:l.USER_DEFAULT_ICON,r=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title");Store.ProfilePicThumb.find(n).timeout(1500,"showDesktopNotificationTimeout").then(function(s){var o=t.contact.formattedName||r,c=s?s.img:"";g.showNotification(n,e.id,o,i,c||a,!1)})["catch"](f.WapDrop,s["default"].TimeoutError,function(s){var o=t.contact.formattedName||r;g.showNotification(n,e.id,o,i,a,!1)})}},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=v},function(e,t,n){"use strict";function i(e){o(this,i,e)}function a(e){o(this,a,e)}var s=n(107),r=s.defineProtobufClass,o=s.construct,c=3,l=13,u=14;r(i,{publicKey:[1,l],identifier:[2,l]}),r(a,{version:[1,c],localFingerprint:[2,u,i],remoteFingerprint:[3,u,i]}),e.exports={FingerprintData:i,CombinedFingerprint:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1638),o=n(434),c=n(1),l={enrich:function(e){switch(o.previewType(e.mimetype)){case"pdf":return this.enrichPdf(e);case"msoffice":return this.enrichDoc(e);default:return s["default"].resolve({media:e})}},enrichPdf:function(e){var t,n=e.mediaBlob;return r.fileToPdf(n).then(function(n){return t=n,r.pdfToImg(n,1).then(function(t){var i=t;return i.pdfPages=n.numPages,{media:e,documentPreview:i}})})["catch"](function(t){return c.log("pdf preview generation failed",t)(),{media:e}})["finally"](function(){t&&r.releasePdf(t)})},enrichDoc:function(e){return s["default"].resolve({media:e})}};e.exports=l},function(e,t,n){"use strict";var i=n(1646),a=n(1221),s=null,r={getMatchedEmojiUnicode:function(e){var t=this.getEmojiTrie(),n=_.uniq(_.flatMap(t.getMatches(e),function(e){return e.value}));return n},getEmojiTrie:function(){if(!s){var e=_.map(i,function(e,t){return{value:e,keyword:t}});s=a(e,"keyword")}return s}};e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(23),s=i(a),r=n(25),o=i(r),c=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1322),s=i(a),r=3;e.exports={minHeight:function(e,t){return{minHeight:e.length>r?r*s["default"].DEFAULT_HEIGHT+t:e.length*s["default"].DEFAULT_HEIGHT+t}}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1339),m=n(223),g=n(85),v=n(1338),y=v.matchAll,E=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this));return n._length=e,n._regex=new RegExp("("+m.arabic+"{"+e+"})("+m.arabic+")","g"),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"mutate",value:function(e,t){return t[1]+"​"+t[2]}},{key:"match",value:function(e){return g.isWebkit?e.length<=this._length?null:y(this._regex,e):null}},{key:"isFragment",get:function(){return!0}},{key:"alwaysApply",get:function(){return!0}}]),t}(f);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1217),s=i(a),r=n(37),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(81),h=i(p),f=n(80),m=i(f),g=n(1396),v=n(1219),y=function(e){function t(e){(0,l["default"])(this,t);var n=(0,h["default"])(this,(0,o["default"])(t).call(this,e));return n.handlers=new s["default"],n.defaultHandler=null,n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"onMutatorNode",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0].mutator,a=this.getHandler(i)||this.defaultHandler;return v(a,'Missing handler for "'+i.constructor+'"'),a.call.apply(a,[this].concat(t,[this.args]))}},{key:"addHandler",value:function(e,t){this.handlers.set(e,t)}},{key:"setDefaultHandler",value:function(e){this.defaultHandler=e}},{key:"getHandler",value:function(e){return this.handlers.get(e.constructor)}}]),t}(g);e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(32),m=i(f),g=n(1339),v=n(433),y=n(1338),E=y.matchAll,b={"(y)":"👍","(n)":"👎",":-)":"🙂",":-(":"🙁",":-p":"😛",":-|":"😐",":-\\":"😕",":-d":"😀",":-*":"😘","<3":"❤","^_^":"😁",">_<":"😆",";-)":"😉"},M=(0,m["default"])(b).map(window._.escapeRegExp).join("|"),C=new RegExp("((?:"+M+")+)","ig"),S=new RegExp("("+M+")","i"),T=new RegExp("([*_~\\s]|```)"),w=function(e){function t(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this));return n.skin=e,n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return E(C,e,function(t,n){var i=e.substr(Math.max(0,t.index-3),Math.min(3,t.index));if(t.index&&!T.test(i))return null;var a=e.substr(t.index+t[0].length,3);return a&&!T.test(a)?null:t})}},{key:"mutate",value:function(e){var t=this,n=_.compact(e.split(S)),i=_.map(n,function(e){if(!e)return e;var n=b[e.toLowerCase()];return n?t.skin&&v.skinToneEmojis[n]?Store.EmojiVariant.getVariant(n)||n:n:e});return i.join("")}},{key:"isFragment",get:function(){return!0}}]),t}(g);e.exports=w},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(146),m=i(f),g=n(86),v=i(g),y=n(1631),E=n(1305),_=n(8),b=n(1338),M=b.jsx,C=n(6),S=n(1368),T=S.dir,w=n(1373),k=n(1457),P=n(1393),N=n(1394),O=n(1397),D=n(1398),x=n(1458),R=n(1395),A=n(1489),I=function(e,t){var n=t.match.href;return{href:n,title:n,rel:"noopener noreferrer",target:"_blank"}},L=function(e,t,n){var i=(0,v["default"])(n,1),a=i[0];return{emoji:a}},U=function(){return{className:"matched-text"}},F=function(e,t){var n=t.match.jid,i=Store.Contact.gadd({id:n}),a=function(){var e=Store.Chat.gadd(i.id);_.chatInfoDrawer(e)};return{onClick:a,className:"matched-mention","data-jid":n,"data-display":"@"+i.display}},G=function(e){var t=e.children,n=(0,m["default"])(e,["children"]),i=(0,v["default"])(t,1),a=i[0],s=a.substring(1);return C.createElement("span",n,C.createElement("span",{className:"at-symbol selectable-text"},"@"),C.createElement("span",{dir:T(s)||"auto",className:"selectable-text"},s))},j=function(e){function t(){var e;(0,o["default"])(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];var r=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(i)));return r.addHandler(k,M.make(A,k,L)),r.addHandler(N,M.make("a",N,I)),r.addHandler(w,M.make("code",w)),r.addHandler(D,M.make("strong",D)),r.addHandler(P,M.make("em",P)),r.addHandler(O,M.make("del",O)),r.addHandler(x,M.make("span",x,U)),r.addHandler(R,M.make(G,R,F)),r}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return E(e.reduce(function(e,t,n){return e["root-child-"+n]=t,e},{}))}},{key:"onDelimiter",value:function(){return null}}]),t}(y);e.exports=j},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1396),m=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return e.join("")}},{key:"onMutatorNode",value:function(e,t){return t.join("")}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(37),s=i(a),r=n(23),o=i(r),c=n(25),l=i(c),u=n(81),d=i(u),p=n(80),h=i(p),f=n(1396),m=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return e.join("")}},{key:"onMutatorNode",value:function(e,t){return t.join("")}},{key:"onDelimiter",value:function(){return""}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return v++,g?g:new window.AudioContext}function s(){v--,0===v&&g&&(g.close&&g.close(),g=void 0)}var r=n(2),o=i(r),c=n(23),l=i(c),u=n(25),d=i(u),p=n(1462),h=n(436),f=n(13),m="audio/wav",g=void 0,v=0,y=function(){function e(t){(0,l["default"])(this,e),this.oggBlob=t}return(0,d["default"])(e,[{key:"generateBlob",value:function(){return this.oggBlobToWAVBlob(this.oggBlob,1)}},{key:"oggBlobToWAVBlob",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?2:arguments[1];return new o["default"](function(i,r){var o=new p,c=[],l=[],u=a(),d={outputBufferSampleRate:u.sampleRate,bufferLength:4096};o.onmessage=function(e){if(null===e.data){for(var a=function(e){c.forEach(function(t,n){t=t[e]||t[0];for(var i=0;i<t.length;i++)l.push(t[i])})},r=0;r<n;r++)a(r);var o=t.encodeWAV(l,u,n),d=new Blob([o.readByteArray()],{type:m});s(),i(d)}else c.push(e.data),n=c[0].length},o.postMessage({command:"decode-init",config:d}),h.blobToArrayBuffer(e).then(function(e){o.postMessage({command:"decode",pages:new Uint8Array(e)}),o.postMessage({command:"decode-done"})})})}},{key:"encodeWAV",value:function(e,t,n){var i=new f(44+2*e.length,(!0));i.writeString("RIFF"),i.writeUint32(36+2*e.length),i.writeString("WAVE"),i.writeString("fmt "),i.writeUint32(16),i.writeUint16(1),i.writeUint16(n),i.writeUint32(t.sampleRate),i.writeUint32(t.sampleRate*n*2),i.writeUint16(2*n),i.writeUint16(16),i.writeString("data"),i.writeUint32(2*e.length);for(var a=0;a<e.length;a++){var s=Math.max(-1,Math.min(e[a],1));s*=s>0?32767:32768,i.writeInt16(Math.floor(s))}return i}}]),e}();e.exports=y},function(e,t,n){"use strict";var i=n(1462),a=function s(e){if(!s.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="encode-init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.streamPages=e.streamPages||!1,this.config.leaveStreamOpen=e.leaveStreamOpen||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.storePage=this._storePage.bind(this),this.streamPage=this._streamPage.bind(this),this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};a.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},a.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},a.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),delete this.stream)},a.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},a.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},a.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},a.prototype.initStream=function(e){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));if(e)return this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.sourceNode.connect(this.filterNode||this.scriptProcessorNode),this.sourceNode.connect(this.monitorNode),void this.eventTarget.dispatchEvent(new Event("streamReady"));var t=this;navigator.getUserMedia({audio:this.config.streamOptions},function(e){t.stream=e,t.sourceNode=t.audioContext.createMediaStreamSource(e),t.sourceNode.connect(t.filterNode||t.scriptProcessorNode),t.sourceNode.connect(t.monitorNode),t.eventTarget.dispatchEvent(new Event("streamReady"))},function(e){t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:e}))})},a.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},a.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},a.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},a.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},a.prototype.start=function(){"inactive"===this.state&&this.stream&&(this.encoder=new i,this.config.streamPages?this.encoder.addEventListener("message",this.streamPage):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",this.storePage)),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config))},a.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.audioContext.close&&this.audioContext.close(),this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"encode-done"}))},a.prototype._storePage=function(e){var t=e.data;if(this.recordedPages.push(t),this.totalLength+=t.length,4&t[5]){this.encoder.removeEventListener("message",this.storePage);for(var n=new Uint8Array(this.totalLength),i=0,a=0;a<this.recordedPages.length;a++)n.set(this.recordedPages[a],i),i+=this.recordedPages[a].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([n],{type:"audio/ogg; codecs=opus"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},a.prototype._streamPage=function(e){var t=e.data;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg; codecs=opus"})})),4&t[5]&&(this.encoder.removeEventListener("message",this.streamPage),this.eventTarget.dispatchEvent(new Event("stop")))},e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return u["default"].loop(function(e,t,i){var a=u["default"].delay(p.expBackoff(i,12e4,0,0));return new u["default"](function(t,i){n.e(86).then(function(i){var a=n(1399);a.PDFJS.workerSrc="./pdf.worker.js",e(a),t(a)}.bind(null,n))["catch"](function(e){n.oe(e)})})["catch"](function(e){return a})})}var s=n(23),r=i(s),o=n(25),c=i(o),l=n(2),u=i(l),d=n(1330),p=n(88);n(1648);var h=function(){function e(){(0,r["default"])(this,e)}return(0,c["default"])(e,null,[{key:"fileToPdf",value:function(e){var t=URL.createObjectURL(e);return a().then(function(e){return e.PDFJS.getDocument(t)})}},{key:"releasePdf",value:function(e){return e.destroy()}},{key:"pdfToImg",value:function(e,t){var n=document.createElement("canvas");return e.getPage(t).then(function(e){var t=e.getViewport(1),i=n.getContext("2d");n.height=t.height,n.width=t.width;var a={canvasContext:i,viewport:t};return e.render(a)}).then(function(){return d.canvasToBlob(n)}).then(function(e){var t=n.height,i=n.width,a=URL.createObjectURL(e);return{url:a,thumbUrl:a,width:i,height:t}})}}]),e}();e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(32),s=i(a),r=n(25),o=i(r),c=n(23),l=i(c),u=function p(e){(0,l["default"])(this,p),this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()},d=function(){function e(t,n){var i=n.maxCached,a=void 0===i?10:i,s=n.maxAge,r=void 0===s?1/0:s,o=n.shouldCache;(0,l["default"])(this,e),this._cache={},this._maxCached=a,this._maxAge=r,this._createPromiseFunc=t,this._shouldCacheFunc=o}return(0,o["default"])(e,[{key:"getOrRun",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=n[0],r=this._cache;if(this._maxAge!==1/0)for(var o=Date.now()-this._maxAge,c=(0,s["default"])(r),l=0;l<c.length;l++){var d=c[l];r[d].createdTime<o&&delete r[d]}var p=r[a];if(p)return p.lastUsedTime=+Date.now(),p.promise;var h=(0,s["default"])(r);if(h.length>=this._maxCached){for(var f=void 0,m=void 0,g=0;g<h.length;g++){var v=h[g],y=r[v];(!m||y.lastUsedTime<m)&&(m=y.lastUsedTime,f=v)}delete r[f]}var E=this._createPromiseFunc.apply(void 0,n);return r[a]=new u(E),E.then(function(t){var n=e._shouldCacheFunc;n&&e._cache[a]===E&&!n(t)&&delete e._cache[a]})["catch"](function(){e._cache[a]===E&&delete e._cache[a]}),E}}]),e}();e.exports=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=!1;try{var i=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("test",null,i)}catch(a){}t["default"]=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return new Blob([e.readByteArray()],{type:"application/zip"})}function s(e){var t=void 0;return new o["default"](function(n,i){t=new FileReader,t.addEventListener("loadend",function(){n(l["default"].build(t.result))}),t.addEventListener("error",function(e){return i(e)}),t.readAsArrayBuffer(e)})}var r=n(2),o=i(r),c=n(13),l=i(c),u=n(1643),d=i(u);e.exports=function(e){return o["default"].all(e.map(function(e){var t=e.blob;return s(t)})).then(function(t){var n=new d["default"];return t.forEach(function(t,i){return n.add(t,e[i].name)}),a(n.create())})}},function(e,t){"use strict";function n(e,t){for(r||(r=i());e.size();)t=r[255&(t^e.readUint8())]^t>>>8;return~t>>>0}function i(){for(var e=new Uint32Array(256),t=0,n=0,i=0;t<256;n=++t){for(i=0;i<8;++i)n=1&n?n>>>1^a:n>>>1;e[t]=n}return e}Object.defineProperty(t,"__esModule",{value:!0});var a=3988292384,s=4294967295,r=void 0;t["default"]=function(e){var t=arguments.length<=1||void 0===arguments[1]?s:arguments[1];return e.peek(n,t)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return(t<<6|n)<<5|i/2}function s(e){var t=e.getFullYear()-1980,n=e.getMonth()+1;return(t<<4|n)<<5|e.getDate()}function r(e){var t=(0,m["default"])(e,2),n=t[0],i=t[1],r=i.path,o=i.crc,c=i.date,l=new E["default"](T+r.length,(!0));return l.writeUint32(M),l.writeUint8(P),l.writeUint8(k),l.writeUint16(0),l.writeUint16(w),l.writeUint16(a(c)),l.writeUint16(s(c)),l.writeUint32(o),l.writeUint32(n.size()),l.writeUint32(n.size()),l.writeUint16(r.length),l.writeUint16(0),l.writeString(r),l}function o(e,t){var n=(0,m["default"])(e,2),i=n[0],r=n[1],o=r.path,c=r.crc,l=r.date,u=new E["default"](C+o.length,(!0));return u.writeUint32(_),u.writeUint8(P),u.writeUint8(k),u.writeUint8(P),u.writeUint8(k),u.writeUint16(0),u.writeUint16(w),u.writeUint16(a(l)),u.writeUint16(s(l)),u.writeUint32(c),u.writeUint32(i.size()),u.writeUint32(i.size()),u.writeUint16(o.length),u.writeUint16(0),u.writeUint16(0),u.writeUint16(0),u.writeUint16(0),u.writeUint32(0),u.writeUint32(t),u.writeString(o),u}function c(e,t,n){var i=new E["default"](S,(!0));return i.writeUint32(b),i.writeUint16(0),i.writeUint16(0),i.writeUint16(e),i.writeUint16(e),i.writeUint32(t),i.writeUint32(n),i.writeUint16(0),i}function l(e){return e.replace(/\\/,"/").replace(N,"")}Object.defineProperty(t,"__esModule",{value:!0});var u=n(23),d=i(u),p=n(25),h=i(p),f=n(86),m=i(f),g=n(1642),v=i(g),y=n(13),E=i(y),_=33639248,b=101010256,M=67324752,C=46,S=22,T=30,w=0,k=0,P=10,N=/[^\x00-\x7F]/g,O=function(){function e(){(0,d["default"])(this,e),this.files=[]}return(0,h["default"])(e,[{key:"add",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?new Date:arguments[2];this.files.push([e,{crc:(0,v["default"])(e),path:l(t),date:n}])}},{key:"create",value:function(){var e=0,t=0,n=0,i=[],a=[];this.files.forEach(function(s,c){var l=(0,m["default"])(s,1),u=l[0],d=u.size(),p=r(s),h=o(s,n),f=p.size()+d;n+=f,e+=f+h.size(),t+=h.size(),a.push(p,u),i.push(h)});var s=c(this.files.length,t,n),l=new E["default"](e+s.size(),(!0));return l.write.apply(l,a.concat(i,[s])),l}}]),e}();t["default"]=O},function(e,t,n){e.exports=n.p+"img/600127bdb5f7627ede5cd4ef320f55b0.png"},function(e,t){e.exports=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,7,8,39,40,1,7,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-28,32,-1,10,-1,4,-1,6,-43,46,-135,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,15,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,17,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,25,1,3,2,3,8,9,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,2,3,8,9,3,4,41,43,4,9,3,4,3,4,1,9,1,8,3,7,16,19,7,9,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,3,2,3,1,3,1,7,4,5,7,8,3,4,1,2,1,3,2,3,4,5,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,88,96,41,42,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,51,115,8,19,1,14,1,8,4,5,6,7,2,11,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,41,44,94,95,43,96,45,48,48,64,28,31,50,65,12,16,47,48,119,123,99,101,31,32,6582,6656,20950,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,37,39,8,71,11,12,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,12,14,38,46,25,36,2,13,30,36,48,49,2,6,2,3,17,18,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,54,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,153,45,176,29,32,49,96,36,48,27,32,38,48,30,31,37,41,14,56,158,160,10,96,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-800,831,-385,385,1,2,54,69,7,31,10,28,49,53,2,4,7,21,25,32,10,19,36,41,1,10,14,26,35,36,3,14,52,61,11,14,1,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,291,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,10,10,64,26,32,2,6,1,10,16,368,83,95,1,449,57,1344,922,1024,111,112,5,16,196,2944,1071,5120,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,899,69,80,47,67,13,16493,2,3072,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,434,18,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,3451,-208,215,-1561,1563,-270,542,31,32,58,64,43,118,29,42,43,48,9,16,2,3504,42711,42752,4149,4160,222,224,5762,16352,542,788480,65534,65536,65534];
},function(e,t){e.exports={1:["🕐","🕜"],2:["🕑","🕝"],3:["🕒","🕞"],4:["🍀","🕓","🕟"],5:["🕔","🕠"],6:["🕕","🕡"],7:["🕖","🕢"],8:["🎱","🕗","🕣"],9:["🕘","🕤"],10:["🕙","🕥"],11:["🕚","🕦"],12:["🕛","🕧"],18:["🔞"],30:["🕧","🕜","🕝","🕞","🕟","🕠","🕡","🕢","🕣","🕤","🕥","🕦"],100:["💯"],143:["😍","😘","💗","💖","😗","😙","😚","💝","💏","💑","💟","💙","💚","💛","💜","💞","💘","💓","💕"],1234:["🔢"],"!":["❕","❗"],"+1":["👍"],"-1":["👎"],"...":["😒"],"10:00":["🕙"],"10:30":["🕥"],"11:00":["🕚"],"11:30":["🕦"],"12:00":["🕛"],"12:30":["🕧"],"1:00":["🕐"],"1:30":["🕜"],"2:00":["🕑"],"2:30":["🕝"],"3:00":["🕒"],"3:30":["🕞"],"4:00":["🕓"],"4:30":["🕟"],"5:00":["🕔"],"5:30":["🕠"],"6:00":["🕕"],"6:30":["🕡"],"7:00":["🕖"],"7:30":["🕢"],"8 ball":["🎱"],"8:00":["🕗"],"8:30":["🕣"],"9:00":["🕘"],"9:30":["🕤"],"?":["❔","❓"],"a+":["💯"],abc:["🔤"],abcd:["🔡"],abraham:["🎩"],absolutely:["👊"],accomplished:["✅"],action:["🎬"],actor:["🎭"],actress:["🎭"],admission:["🎫","🎟"],adorbs:["😘","💘","💞","🐶"],aerial:["🚡"],afraid:["😨"],again:["🔄"],agree:["👊"],airplane:["✈","🛩","🛫","🛬"],alarm:["⏰"],alcohol:["🍻","🍺","🍷","🍸","🍹"],alien:["👽","👾"],aliens:["📡"],almond:["🌰"],alphabet:["🔤"],amble:["🚶"],ambulance:["🚑"],amtrak:["🚄","🚅"],"amusement park":["🎡","🎢"],anchor:["⚓","🔱"],angel:["😇","👼"],angelic:["😇"],angels:["😇"],anger:["😡","😤","😠"],angle:["📏","📐"],angry:["😡","😤","😠","💢","🗯"],anguished:["😧"],animal:["🐵","🙈","🙉","🙊","🐱","😸","🐶","🐮","🐷","🐴","🐙","🐳","🐨","🐒","🐯","🐕","🐺","😹","😺","😻","😼","😽","😾","🙀","🐩","😿","🐈","🐋","🐅","🐆","🐎","🐂","🐹","🐃","🐄","🐖","🐗","🐽","🐏","🐑","🐐","🐪","🐫","🐘","🐭","🐁","🐟","🐀","🐰","🐇","🐻","🐼","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🐸","🐊","🐢","🐍","🐲","🐉","🐬","🐠","🐡","🐚","🐌","🐛","🐜","🐝","🐞"],animals:["🐕","🐈","🐖","🐄","🐇","🐏","🐅","🐆","🐂","🐃","🐐","🐁","🐓","🐊"],anniversary:["💝","💐","💕","💏","💑","💞"],ant:["🐜"],antartica:["🐧"],antenna:["📡","📶"],anxious:["😥","😨","😟"],apology:["🙇"],applause:["👏"],apple:["🍎","🍏"],approval:["👏"],aquarius:["♒"],arid:["🌵"],aries:["🐏"],arrived:["🛄","🚆","🚈"],art:["🎭","🎨","🖼"],arty:["🎨"],ask:["🙏"],astonished:["😲"],astronomy:["⭐"],atheist:["⚛"],athletic:["👟"],atm:["🏧"],atom:["⚛"],aubergine:["🍆"],australia:["🐨"],automated:["🏧"],automobile:["🚗","🚘"],autumn:["🍂"],awesome:["👍","😎","😃","👌","🎉","👏","😛","✨"],awful:["😔","😞","😢"],awk:["😐","😑","😬","😳"],awkward:["😐","😑","😬","😳","😶"],aye:["✊"],baa:["🐑"],babies:["👶","🍼"],baby:["👶","👼","🚼","🍼","🐣","🐤","🐥"],back:["🔙"],"back door":["🚪"],backpack:["🎒"],bacon:["🐷","🐖"],bactrian:["🐫"],bad:["👎","😐","😑"],"bad haircut":["👵"],badge:["📛"],bae:["😍","😘","😚","💏","💑","👫","👬","👭"],bag:["👜","🎒","👝","🛍","💰"],baggage:["🛄","🛅"],bags:["🛄"],bald:["👴"],ball:["🏈","🏀","🎱","🏉","🎾","🎳","🔮","🏌","⛹","🍙","🎊","⚽","⚾","🏐","🏏","🏑","🏓"],balling:["😭"],balloon:["🎈","💬","🗯","💭"],ballot:["☑","🗳"],bamboo:["🎍","🐼"],banana:["🍌","🐵","🐒"],bangs:["👧"],bank:["💰","🏧","💵","💸","💳","🏦","💴","💶","💷","💹","💱"],banknote:["💵","💸","💶","💴","💷"],banner:["🎋"],bar:["🍻","🍺","🍹","🍷","🍸","📶","🍫","🍶","🍾","🏮","📊","⏸"],barber:["💇","💈"],barrel:["🍯"],barrier:["🚧"],bars:["📶"],bart:["🚈","🚉","🚊"],baseball:["⚾"],basic:["😐","😑"],basketball:["🏀"],bath:["🛀","🛁"],"bathing suit":["👙"],bathroom:["🚽"],bathtub:["🛀","🛁"],battery:["🔋"],beach:["🌴","🌞","🏄","😎","🍹","🍍","🐚","👙","🐳","🐋","🐬","🏖"],bear:["🐻","🍯","🐨"],beast:["💪"],beauty:["🌹","👄","💇"],bed:["😴","🛏"],bedtime:["😴"],bee:["🐝"],beef:["🍖"],beer:["🍺","🍻"],beetle:["🐞"],befuddled:["😕"],beg:["🙏"],bell:["🔔","🛎","🎐","🔕"],"belmont stakes":["🐴","🐎"],"bench press":["💪"],bento:["🍱"],berry:["🍓"],bestest:["💜"],bestfriend:["👭"],bestfriends:["👭"],bestie:["👭"],bet:["💰"],beyonce:["💍"],bff:["👭","👥","👯"],bible:["😇"],biceps:["💪"],bicycle:["🚲","🚴","🚵","🚳"],bicyclist:["🚴","🚵"],"big cat":["🐯","🐅","🐆"],bike:["🚲","🚴","🚵","🚳"],"bike gang":["🚲"],"bike lock":["🔐"],bikini:["👙"],bill:["💵","💸","💴","💶","💷"],billiard:["🎱"],billion:["💰","💲","💸","💷"],billionaire:["🚤"],biohazard:["☣"],bird:["🐣","🐤","🐦","🕊"],birds:["🐓"],birth:["🍼"],birthday:["🎈","✨","🎉","🎂","💐"],blame:["😠","😞","😨","😳"],bless:["⛪"],blessed:["😇"],blond:["👵","👱"],blonde:["👩","👱"],blondie:["👩","👵","👱"],blossom:["🌸","🌼","🌷"],blouse:["👚"],blowfish:["🐡"],"blu-ray":["💿","📀"],blue:["😰","💙","👕","👖","📘","🔷","🔹","🔵"],blush:["😊","😚"],boar:["🐗"],boat:["⛵","🚣","🚤","⛴","🛥","🚢"],body:["💪","👀","👃","👣","👅","💀","👄","👂","👁"],bolt:["🔩"],bomb:["💣","💥"],bond:["👭"],bonding:["👭"],bone:["🍖","🍗"],book:["📚","📖","📘","📗","📙","📕","📔"],bookbag:["🎒"],bookmark:["🔖","📑"],books:["📚"],boom:["💣","👊","💥","🎆","🎇"],boot:["👢"],booze:["🍷","🍸","🍻","🍺","🍹"],bored:["😒","😔"],born:["🍼"],boss:["😏"],botany:["🌿"],bottle:["🍼","🍶","🍾"],"bottoms up":["🍻"],bouquet:["💐"],bow:["🙏","🙇","🏹"],bowl:["🍜"],bowling:["🎳"],box:["📦","🎁","🍱","📤","📥","🗳","🗃","☑"],boy:["👦","👨","👨‍👩‍👧‍👦","👨‍👩‍👦‍👦","👨‍👨‍👦","👨‍👨‍👧‍👦","👨‍👨‍👦‍👦","👩‍👩‍👦","👩‍👩‍👧‍👦","👩‍👩‍👦‍👦","👨‍👦","👨‍👦‍👦","👨‍👧‍👦","👩‍👦","👩‍👦‍👦","👩‍👧‍👦"],boyfriend:["👨"],boys:["👬"],brb:["🔜"],bread:["🍞"],"break":["💔"],breakfast:["🍴","🍳"],breaky:["🍴"],bride:["👰"],bridge:["🌉"],briefcase:["💼"],bright:["😎","☀","🌝","🌞","🌟","🌠","🔆"],"bright-eyed":["👧"],brightness:["🔆","🔅"],bro:["😎","👨","👊","💪"],broken:["💔"],brown:["👞"],bruh:["👊","💯"],buddhist:["☸"],buffalo:["🐃"],bug:["🐛"],build:["📲"],building:["🏫","🏢","🌆","🌇","🏠","🏡","🏤","🏯","⛪","🏣","🏥","🏦","🏨","🏩","🏪","🏬","🏭","🏰"],bulb:["💡"],bull:["🐂","🎯","♉"],bullet:["🚅"],bullseye:["🎯"],bumblebee:["🐝"],bump:["👊"],bunny:["🐇","🐰","👯"],burger:["🍔"],burn:["🔥"],bus:["🚌","🚋","🚍","🚎","🚐","🚏"],busstop:["🚏"],bust:["👤","👥"],buttercup:["🌼"],butterflies:["😟"],cab:["🚕","🚖"],cabbie:["🚕","🚖"],cable:["🚠","🚡"],caboose:["🚂"],cactus:["🌵"],caffeine:["☕"],cake:["🍰","🎂","🍥"],calendar:["📅","📆","🗓"],calm:["😌"],camcorder:["📹"],camel:["🐪","🐫"],camera:["📷","🎥","🎦","📹","📸"],camp:["🌲"],camping:["⛺","🏕"],"cant even":["😶"],"cant watch":["🙈"],candy:["🍭","🍫","🍬"],cantaloupe:["🍈"],cap:["🎓"],capricorn:["🐐","♑"],car:["🚙","🚘","🚕","🚚","🚛","🏎","🚃","🚞","🚋","🚓","🚔","🚗","🚨","🚡"],carbs:["🍞"],cardiac:["💛"],cardio:["💓"],carousel:["🎠"],cars:["🚘","🚍","🚖"],cartoon:["💭"],"case":["🛄","🛅"],cash:["💰","💸","🏧","💲","💳","💷"],casino:["🎰"],castle:["🏰","🏯"],casual:["👕","👖"],cat:["🐱","🐈","😺","😸","😹","😻","😼","😽","🙀","😿","😾"],cats:["🐈"],"caught off guard":["😦"],cavities:["🍬"],cd:["💿","📀"],celebrate:["🎈","🎉"],celebration:["🎈","🎉","🎂","🎆","🎊","🎇","🎁","🎀","🎅","🎃","🎄","🎏","🎓","🙌","🎋","🎍","🎎","🎐","🎑","🎗","🎖","🎌"],cell:["📱","📳","📲","📶","📵","📴"],chair:["💺"],chapel:["⛪","💒"],charge:["💳","💲"],chart:["📈","📉","📊","💹"],check:["✅","✔","☑"],checked:["🛄","✅"],"checked off":["✅","✔","☑"],checkered:["🏁"],checking:["✅"],cheerful:["😀"],cheers:["🍻"],cheery:["😀"],chef:["🔪"],chequered:["🏁"],cherry:["🍒","🌸"],chestnut:["🌰"],chicken:["🐔","🍗"],child:["👪","🚸"],chocolate:["🍫"],"choo choo":["🚆"],choppy:["🌊"],christ:["✝"],christian:["✝","☦"],christmas:["🎅","🎄"],"christmas tree":["🌲"],church:["⛪","👼"],cigarette:["🚬"],cinema:["🎥","🎦","🎞","📽"],circus:["🎪"],citrus:["🍊","🍋","🍍"],city:["🌆","🏢","🏙"],clap:["👏"],clearly:["👊","💯"],clenched:["✊","👊"],clink:["🍻"],clipboard:["📋"],clock:["⏰","⌚","⏱","⏲","🕰","🕛","🕧","🕐","🕜","🕑","🕝","🕒","🕞","🕓","🕟","🕔","🕠","🕕","🕡","🕖","🕢","🕗","🕣","🕘","🕤","🕙","🕥","🕚","🕦"],clockwise:["🔁","🔂","🔃"],"close call":["😥"],closed:["😚","📕","🔒","📫","📪","🔐"],"closed eyes":["😙"],closet:["🚪","🚾"],clothes:["👕","👖","👗","👒","👟","👞","👚","🎩","👠","👢","👛","👜","👝"],clothing:["👔","👕","👖","👗","👙","👚","👢","👞","👒","🎩","👑","👘","👟","👠","👡","☔","👣","👓","👛","👜","👝","🎓","📿","🌂","☂"],cloud:["💭","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬"],clover:["🍀"],club:["🍷","🍸","🍹","🍻","♣"],clubs:["♣"],coaster:["🎢"],cocktail:["🍸","🍹"],cocoa:["🍫"],coffee:["☕"],coffin:["⚰"],colada:["🍍"],cold:["❄","⛄","😓","😷","😰","💧","😅","🏔","🌨","☃"],collage:["📌"],collar:["👕","👚"],collide:["💥"],collision:["💥"],colorful:["🎨"],comfortable:["👘"],comic:["💭","💥","💣","💪","💨","💩","💦","💫","💬","💡","💤","💢","💧","💠"],communication:["📱","📲","📞","📠","📰","📳","📶","📢","📟","📩","📦","📫","📝"],complete:["✅"],completed:["✅"],complicated:["😥"],computer:["💻","💽","💾","🖥","🖨","⌨","🖱","🖲","💿","📀"],concentrate:["😣"],concentration:["😣"],conch:["🐚"],confectionary:["🍭"],confetti:["🎊"],confounded:["😖"],confused:["😕","😖"],confusing:["😕"],congrats:["👏"],congratulations:["👏"],construction:["👷","🚧","🚩","🏗"],contact:["📡","🔭","🔎"],controller:["🎮"],convenience:["🏪"],cooked:["🍚"],cookie:["🍪"],cooking:["🍴","🍳","🔪","🍽","🏺"],cool:["😎","🆒","😛"],coolstorybro:["😒"],cop:["👮"],copyright:["©"],corn:["🌽"],correct:["👊"],cosmetics:["💄","💅"],cost:["💰","😑","😫","😲"],"country home":["🏠","🏡"],couple:["💏","💑","👫","👬","👭"],cover:["📔"],cow:["🐮","🐄"],cracked:["🔓"],crazy:["😜"],cream:["🍨","🍦"],creative:["🎨"],creature:["👾","👹","👻","👽","🐙","👺"],credit:["💳"],crescent:["🌙","🌒","🌘"],crocodile:["🐊"],crops:["🌽"],crossed:["🔀","⚔","🎌"],crossing:["🚸"],crown:["👑","👸"],cruise:["🚣"],crushed:["💔"],cry:["😢","😭","😿"],crying:["😢","😭","😩","😂"],cubical:["🏢"],cupid:["💘"],"curious george":["🐵"],curls:["💪"],currency:["💲","💵","💴","💶","💷","💹","💱"],current:["🆕"],curry:["🍛"],custard:["🍮"],customs:["🛃"],cut:["✂"],"cutting edge":["🆕"],cya:["👋"],cycle:["🚲"],cycling:["🚲"],cyclist:["🚲","🚴","🚵"],cyclone:["🌀"],dancer:["💃","👯"],dandelion:["🌼"],danger:["⚡"],dangerous:["💣"],dango:["🍡"],dapper:["😏"],dart:["🎯"],data:["📈","📉","📊"],date:["😗","😙","😚","💏","💘","💕","💄","💐","📅"],dating:["😗","😙","😚","💕","👫","👬","👭","💋"],daughter:["👧"],daughters:["👭"],david:["✡"],day:["🌞"],daydream:["💭"],dazed:["😳"],dead:["💀","😐","😑","😳","😵"],deadpan:["😐"],death:["💀","⚰","⚱","☠"],deciduous:["🌳"],decisions:["💭"],decorated:["📔"],dejavu:["🔄"],dejected:["😔","😞"],deleted:["❎"],delicious:["😋","🍑"],delivering:["📨"],delivery:["🚚","📦"],denim:["👖"],dentist:["😷","😬"],department:["🏬"],dermatologist:["😷"],desert:["🐫","🌵","🏜","🏝"],desrt:["🐪"],dessert:["🍪","🍩","🍧","🍦","🍨","🎂","🍰","🍫","🍡","🍬","🍭","🍮"],devil:["👿"],dharma:["☸"],dialog:["💬","🗨"],diamond:["💎","💍","💠","🔶","🔷","🔸","🔹"],dice:["🎲"],died:["😔"],diet:["🍎"],difficult:["☯","✝"],dim:["🔅"],dinner:["🍴","🍗","🍔","🍕","🐟"],dionyses:["🍇"],disappointed:["😞","😥"],disgruntled:["🙍"],dish:["📡"],dislike:["👎"],distraught:["😖"],diva:["💁"],division:["➗"],dizzy:["😵","💫","🌀"],"do not pass":["⛔"],doctor:["😷","🏥","💊","💉"],document:["📃","📄"],dog:["🐶","🐕","🐩"],dogs:["🐕"],dollar:["💸","💲","💵","💰"],dolphin:["🐬"],donatello:["🐢"],done:["✅","☑","✔"],donut:["🍩"],"doo doo":["💩"],door:["🚪"],dope:["👌","👍"],doughnut:["🍩"],"down under":["🐨"],downward:["📉"],dr:["😷"],dragon:["🐲","🐉"],drawing:["✏"],dream:["💭"],dreams:["💭","🌜","✨","🌒"],dress:["👗","👢","👠","👛","👜","👝","👚"],dressage:["🐴"],dressed:["👕","👖","👗","👚"],drink:["🍷","🍸","🍵","🍹","🍺","🍻","🍶","🍼","☕","🍾","🏺"],drinking:["🍷","🍸","🍹","🍺","🍻","🚰"],drinks:["🍷","🍸","🍹","🍺","🍻"],drive:["🚐","🚕","🚙","🚚","🚛"],driving:["😎","🚗"],dromedary:["🐪"],drop:["💧","☔"],droplet:["💧","💦"],droplets:["💦"],drought:["🌵"],drove:["🚘","🚖","🚦"],drugs:["💊"],drunk:["🍹"],dry:["🚱"],dude:["👱"],dul:["✈"],dundy:["🐊"],dung:["💩"],dusk:["🌆","🌇"],dvd:["💿","📀"],"e-mail":["✉","📨","📩","📧"],"e.t.":["🔭"],ear:["👂","🌽","🌾"],earbud:["🎧"],ears:["👂"],earth:["🌻","🌍","🌎","🌏","🌐"],east:["➡"],eat:["🍴","🍔"],education:["🎓","📔","📕","📖","📗","📘","📙","📚","🎒"],eek:["😰"],egg:["🍳","🐣"],eggplant:["🍆"],eight:["🎱","8⃣","🕗","🕣"],elderly:["👴"],electric:["💡","🚃","🔌","⚡","🔦"],electricity:["🔌","⚡"],elegant:["💃","🌹"],elephant:["🐘"],eleven:["🕚","🕦"],email:["✉","📧","📨","📩","📤","📥"],embarassed:["😳","🙈"],emergency:["🚑","🚨"],emotion:["❤","💘","💓","💔","💕","💋","💖","💗","💙","💚","💛","💜","💝","💞","💟","♥"],employed:["👔"],end:["🔚"],engaged:["💍"],engagement:["💍","💎"],engine:["🚂","🚒"],entertainment:["🎸","🎲","🎮","🎯","🎠","🎨","🎢","🎭","🎆","🎣","🃏","🎵","🎤","🎷","🎹","🎺","🎻","📻"],envelope:["✉","📨","📩"],epic:["😜","😯","😱"],equine:["🐴"],eruption:["🌋"],escargot:["🐌"],euro:["💶"],europe:["🌍"],evening:["🌆"],evergreen:["🌲"],everyone:["👥","👫","👬","👭"],evil:["🙈","🙉","🙊"],ewe:["🐑"],exchange:["💱"],excited:["🎉","😅","👏","👻","💖","💗"],exclamation:["❗","❕","⁉","‼","❣"],exercise:["😳","🙆"],experiment:["🔬"],explode:["💥"],explosion:["💣"],expressionless:["😑"],extraterrestrial:["👽","👾"],eye:["👀","😜","😎","😁","😄","😊","😍","😙","😚","😝","😸","😻","😽","👁","👓","🕶","🎯"],eyebrows:["😏"],eyeglasses:["👓"],eyewear:["😎","👓","🕶"],face:["😀","😄","😆","😉","😊","😋","😎","😍","😘","😚","☺","😇","😐","😑","😶","😏","😣","😥","😮","😯","😪","😫","😴","😌","😛","😜","😝","😒","😓","😔","😕","😖","😲","😞","😟","😤","😢","😭","😦","😧","😨","😩","😬","😰","😱","😳","😵","😡","😠","👿","😈","👹","👺","🗿","😁","😂","😃","😅","😗","😙","🙂","🤗","🤔","🙄","🤐","🤓","🙃","🤑","☹","🙁","😷","🤒","🤕","💀","☠","👻","👽","👾","🤖","💩","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","👼","💆","🗣","👀","⛑","🐵","🐶","🐺","🐱","🦁","🐯","🐴","🦄","🐮","🐷","🐽","🐭","🐹","🐰","🐻","🐼","🐸","🐲","🐳","🌚","🌛","🌜","🌝","🌞","🌬"],factory:["🏭"],fail:["😞","😩","⛔"],"fairy tale":["🐲","😇","👿","😈","👸","🎅","👼","👹","👻","💀","👽","👾","🐉","🔮"],faithful:["💯"],family:["👪","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👦‍👦","👨‍👩‍👧‍👧","👨‍👨‍👦","👨‍👨‍👧","👨‍👨‍👧‍👦","👨‍👨‍👦‍👦","👨‍👨‍👧‍👧","👩‍👩‍👦","👩‍👩‍👧","👩‍👩‍👧‍👦","👩‍👩‍👦‍👦","👩‍👩‍👧‍👧","👨‍👦","👨‍👦‍👦","👨‍👧","👨‍👧‍👦","👨‍👧‍👧","👩‍👦","👩‍👦‍👦","👩‍👧","👩‍👧‍👦","👩‍👧‍👧"],fancy:["👗","👛","🎩"],fantasy:["👹","😇","👿","😈","👸","🎅","👼","👺","👻","👽","👾","📖","📗","📘","📙","📚","🔮"],farm:["🐴","🐎","🐮","🐷","🐂","🐄","🐖","🐽","🐑","🐐","🌽"],fart:["💨"],fast:["🏃","👟","💨","⏩"],"fast food":["🍔","🍟"],fat:["🐖"],fax:["📠"],fear:["😨","😱"],fearful:["😨","😱"],feed:["🍴"],feels:["😂","😍","😫","😓","😖","😤","😢","😩","😵","😡","😠"],feet:["👞","🐾"],felicia:["👋"],ferris:["🎡"],fetch:["💁"],fighting:["✊"],file:["📁","📂","🗃","🗄"],film:["🎥","🎦","🎞","📽"],finish:["🏁"],fire:["🔥","🚒"],fireworks:["🎆","🎇"],fish:["🐟","🐠","🐡","🎣","🍥","♓"],fishes:["🐟","🐠"],fishing:["🐟","🚣"],fist:["👊","✌","✊"],five:["✋","5⃣","🕔","🕠"],fixed:["✅"],flag:["🏁","🚩","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇲","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇦🇿","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇷","🇧🇸","🇧🇹","🇧🇼","🇧🇾","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇪","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇪","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇰🇿","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇹","🇱🇺","🇱🇻","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇳","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇺","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇯","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇦","🇺🇬","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"],flags:["🏁"],flair:["💃"],flame:["🔥"],flashlight:["🔦"],"flat top":["👱"],fleek:["👌","👍"],"fleur-de-lis":["⚜"],flex:["💪"],flipper:["🐬"],flirt:["😉","😏","😘","😗","😚","😙","👫"],floppy:["💾"],florida:["🐊","🌞"],flower:["🌻","🌺","🌹","🌸","🌷","🌼","💐","💮","🎴"],"flu shot":["💉"],fluffy:["🐩","🐑"],flushed:["😳"],fly:["✈","😎","💸","🕊"],fml:["💩"],focus:["😣"],fog:["🌁","🌫"],folder:["📁","📂"],food:["🍴","🍎","🍔","🍕","🍌","🍳","🍟","🍒","🍇","🍈","🍉","🍊","🍋","🍍","🍏","🍐","🍝","🍑","🍓","🍅","🍆","😋","🍞","🍖","🍗","🍲","🍱","🍘","🍙","🍚","🍛","🍜","🍠","🍢","🍣","🍤","🍥","🍡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🍫","🍬","🍭","🍮","🍯"],foot:["👞"],football:["🏈","🏉","⚽"],footprint:["👣"],forbidden:["🙊","🚫","🙈","🙉","🙅","🔕","⛔","🚳","🚭","🚯","🚷","📵","🔞"],forest:["🌲","🌳"],forgot:["😮","😧","🙈"],fork:["🍴","🍽"],formal:["🎩"],fortune:["🔮","🔯"],fountain:["⛲","🖋"],four:["🍀","4⃣","🕓","🕟"],frat:["😎"],free:["🆓"],fresh:["🆕"],fried:["🍤"],friend:["👥","👨","👫","👬","👭"],friends:["👫","👬","👭","👥"],friendship:["👭"],fries:["🍟"],frog:["🐸"],"front door":["🚪"],frown:["😦","🙍","☹","🙁"],fruit:["🍎","🍌","🍓","🍒","🍇","🍈","🍉","🍊","🍋","🍍","🍏","🍐","🍑","🍅"],frustrated:["😖","😠"],fry:["🍳"],frying:["🍳"],fuel:["⛽"],fuelpump:["⛽"],fuji:["🗻"],full:["😋","💯","🌝","🌕"],fun:["😜"],funeral:["⚱"],fungus:["🍄"],funny:["😜"],futbol:["⚽"],future:["🔮"],g2g:["👋"],gamble:["🎰"],gambling:["🎰"],game:["👾","🎰","🎯","🎴","🎱","🎳","🎮","🎲","♠","♥","♦","♣","🃏","🏁","🏐","🏏","🏑","🏒","🏓","🏸","🕹","🀄"],"game of thrones":["👑","🐉","🐗"],games:["👾"],garden:["🐞","🐛","🐌","🐜","🏡"],"garden party":["👒"],gas:["⛽"],gasoline:["⛽"],gem:["💎"],germany:["🍺"],germs:["😷"],ghost:["👻"],gift:["🎁"],girl:["👧","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👧‍👧","👨‍👨‍👧","👨‍👨‍👧‍👦","👨‍👨‍👧‍👧","👩‍👩‍👧","👩‍👩‍👧‍👦","👩‍👩‍👧‍👧","👨‍👧","👨‍👧‍👦","👨‍👧‍👧","👩‍👧","👩‍👧‍👦","👩‍👧‍👧"],girls:["👭"],girly:["👭"],glass:["🍷","🍸","🔍","🔎"],glasses:["😎","👓","🕶"],glittery:["🌟"],globe:["🌍","🌐","🌎","🌏"],glow:["🌟"],goat:["🐐","♑"],goblin:["👺"],golf:["⛳","🚩","🏌"],gondola:["🚠","🚡"],gone:["💨"],"goo goo":["👶"],good:["👍"],"good night":["😴","💖"],googley:["👀"],goose:["😎"],gossip:["💁"],gotcha:["👌","👍"],"gotta go":["💨"],graduation:["🎓"],grain:["🍞","🌾"],grains:["🌾"],grape:["🍇"],graph:["📊","📈","📉","💹"],grateful:["✨"],great:["👍","👏"],green:["🍏","🌳","💚","📗","🔰"],grimace:["😬"],grin:["😀","😃","😁","😄","😸"],grizzly:["🐻"],groove:["💃"],gross:["😝"],growing:["💗"],growl:["🐻"],growth:["🌱","🌷","📈","💹"],grub:["🍤"],gtfo:["😲"],gtg:["👋"],guard:["💂"],guardsman:["💂"],guitar:["🎸"],gun:["🔫"],gym:["💪"],habitat:["🌳"],haha:["😂"],"hail a cab":["🚖"],hair:["💇"],haircut:["👩","💇","💈"],halloween:["🎃","👻","🍫","🍬"],halo:["😇"],hamburger:["🍔"],hammer:["🔨","⚒","🛠"],hamster:["🐹"],hand:["✋","👏","🖖","🙋","💁","👌","👍","👊","✊","🙅","🙆","👫","👬","👭","👈","👉","☝","👆","🖕","👇","✌","🤘","🖐","👎","👋","✍","👐","🙌","🙏"],handbag:["👛","👜","👝"],hands:["✋","🙋","🖖"],happy:["😀","😄","😃","😂","😆","🙋"],"happy feet":["🐧"],hardhat:["👷"],hash:["#⃣"],hashtag:["#⃣"],hat:["🎩","👒","👷","👲","🎓","⛑"],hatching:["🐣"],hats:["👒","🎩"],hbd:["💯"],headache:["😣"],headphone:["🎧"],healing:["☮"],health:["🍎"],healthy:["🍏"],hear:["👂","🙉"],"hear no evil":["🙉"],hearing:["👂"],heart:["❤","💖","💗","💓","💞","💕","💙","💚","💛","💜","💘","💟","😍","😘","💏","💑","💝","💋","💌","😻","♥"],heartbeat:["💓"],heartbreaker:["😉"],heartpulse:["💗"],hearts:["💕","😍","♥"],heat:["🌞","😳"],hecka:["👍","👎"],heel:["👠"],hehe:["😂"],helicopter:["🚁"],hella:["👍","👎"],helmet:["💂","⛑"],herb:["🌿"],hibiscus:["🌺"],hide:["🙈"],high:["🔊"],"high five":["✋"],hike:["🚶"],hitched:["💒"],hole:["⛳","🕳"],hollywood:["🎥"],home:["🏠","🏡"],"home improvement":["🔨","🔧","🔩"],homie:["😏","👊","👏","👅","🔝","💯"],honey:["🍯","🐻","🐝"],"honey jar":["🍯"],honeybee:["🐝"],honeypot:["🍯"],hoop:["🏀"],horn:["📯"],horns:["😈","🐏","🤘"],horrible:["😝"],horse:["🐴","🐎","🎠","🏇"],horses:["🐴"],hospital:["🏥"],hot:["☕","😳","💣","♨","🌶"],hotel:["🏨","🏩","🛍","🛎","🛌","🛏","🛋"],hotsprings:["♨"],hourglass:["⌛","⏳"],hours:["⏰","⏳"],house:["🏠","🏡","🏘","🏚"],hrs:["⏰"],hump:["🐪","🐫"],hundred:["💯"],hungry:["🍴","😋","🍉","🍗","🍔","🍕"],hurry:["🏃"],hushed:["😯"],"i dont believe you":["😮"],"i know":["🙋"],icecream:["🍦"],idea:["💡","💭"],ily:["💖","💜","😍","💙","😘","😚","💕","💗","😗","💘","😙","💓","💚","💛","💝"],imp:["👿"],"in love":["😍"],inbox:["📥"],"inbox zero":["📥"],incoming:["📨"],index:["📇","👈","👉","☝","👆","👇","🗂"],inexpressive:["😑"],infant:["👶","🍼"],ink:["🔏"],innocent:["😇"],insect:["🐜","🐞","🐛","🐝","🕷"],instagram:["📷"],instrument:["🎸","🎷","🎹","🎺","🎻"],interesting:["💯"],intersection:["🚥","🚦"],invent:["💭"],invention:["💭"],irish:["🍀"],ironic:["😼"],italian:["🍝"],jack:["🎃"],jacked:["💪"],jar:["🍯"],"jazz hands":["👐"],jealous:["😑","😒","😐"],jeans:["👖"],jel:["😐","😑","😒"],jelly:["😐","😑","😒"],jet:["✈"],jewel:["💎"],jfk:["✈"],job:["🏢"],jockey:["🏇"],joke:["😜"],joker:["🃏"],journey:["🛄"],karaoke:["🎤"],"kentucky derby":["🐎"],key:["🔑","🔐","🗝"],keyboard:["🎹","⌨"],keys:["🔑"],kick:["👞","👟"],kid:["👦"],kidding:["😏","💯"],kimono:["👘"],king:["👑"],kiss:["😘","💋","💏","😗","😙","😚","💑","😽","👄"],kisses:["😘","😗","😙","😚","😍","💕","💖","💗","💝"],kissing:["😗","💋","👄"],kitten:["🐱","🐈"],kitty:["🐱"],knife:["🔪","🍴","🍽","🗡"],knights:["🐉","⚜"],knock:["✊"],knowledge:["📖","📚"],knuckle:["👊"],koala:["🐨"],lab:["🔬","🔍","🔎"],ladies:["👭"],lady:["👧","👩","👵","👚","👜"],"lady beetle":["🐞"],ladybird:["🐞"],ladybug:["🐞"],lake:["🚣","🚤"],landscape:["🌆"],lantern:["🎃","🏮"],las:["✈"],late:["⏰"],later:["👋"],latest:["🆕"],laugh:["😀","😄","😆","😂"],laughing:["😂"],laughter:["😂"],launch:["🚀"],lavatory:["🚾","🚹","🚺","🚻"],lax:["✈"],leaf:["🍁","🌿","🍀","🍃","🍂","🔰"],lebron:["👑"],ledger:["📒"],leer:["😏"],"left luggage":["🛅"],legit:["👌","👍"],lemon:["🍋"],leonardo:["🐢"],leopard:["🐆"],letter:["💌","📩","📨","✉","📧","📤","📥"],lga:["✈"],liberty:["🗽"],library:["📚","📖","📗","📘","📙"],lick:["👅"],light:["💡","🔦","🔆","🚨","🚥","🚦","🕯","🏮"],"light rail":["🚈"],lightning:["⚡","🌩"],like:["👍"],lincoln:["🎩"],link:["🔗","🖇"],links:["🔗"],lips:["👄","💋"],lipstick:["👄","💄"],list:["✅"],listen:["👂","🙉"],listening:["👂"],litter:["🚮","🚯"],lives:["☯"],loaf:["🍞"],location:["📍"],lock:["🔒","🔐","🔓","🔏","🔑","🗝"],locked:["🔒","🔐"],locomotive:["🚂"],lol:["😂","😆","😄"],lollipop:["🍭"],lonely:["💔"],look:["👀"],looking:["👀"],loopy:["😜"],lorry:["🚛"],losing:["😔","😞"],"losing hair":["👴"],loud:["📢","🔊"],loudspeaker:["📢"],love:["💕","💓","💜","💙","😍","😘","💏","💑","😙","🌹","💘","💐","💚","💛","💌","😻","🏩"],"love you":["😘"],lover:["😘"],loving:["😍","💕"],lowercase:["🔡"],lucky:["🍀"],luggage:["🛅"],lunch:["🍴"],luxury:["🚤"],mad:["😡","😠","😖","💢","🗯"],"mad men":["🍸"],maddening:["😡","😠"],magic:["🔮"],magical:["✨"],magnifying:["🔍","🔎"],"mai tai":["🍹"],mail:["📫","💌","📧","📨","📩","📪","📬","📭","📮","📤","📥"],mailbox:["📫","📪","📬","📭","📮"],maize:["🌽"],makeup:["💄","💅"],man:["👫","👬","👨","👴","👲","🕴","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👦‍👦","👨‍👩‍👧‍👧","👨‍👨‍👦","👨‍👨‍👧","👨‍👨‍👧‍👦","👨‍👨‍👦‍👦","👨‍👨‍👧‍👧","👨‍👦","👨‍👦‍👦","👨‍👧","👨‍👧‍👦","👨‍👧‍👧","👞","🚹"],manicure:["💅"],map:["📍","🗺","🗾"],maple:["🍁"],marathon:["🏃"],mario:["🍄"],martini:["🍸"],mask:["🎭","😷"],massage:["💆"],math:["➕","➖","➗","📏","📐"],maverick:["😎"],maze:["🌽"],meat:["🍖"],meatballs:["🍝"],media:["📝"],medicine:["💊","💉","😷","🏥"],medieval:["👑"],meditate:["🙇"],meditation:["🙇"],megaphone:["📣"],melon:["🍈"],memo:["📝"],meridians:["🌐"],message:["💬"],messenger:["⚡"],messi:["⚽"],metro:["🚇"],mia:["✈"],mic:["🎤","🎙"],michelangelo:["🐢"],microphone:["🎤","🎙"],microscope:["🔬"],milk:["🐮","🐄","🐐","🍼"],"milky way":["🌌"],million:["💰","💸","💲"],millionaire:["🚤"],minibus:["🚐"],minidisk:["💽"],minus:["➖"],miss:["😢"],"miss you":["😘"],mobile:["📱","📳","📴","📲","📵","📶"],money:["💰","💸","💵","💲","💎","💶","💷","💳","💴","🤑","💹","💱"],moneybag:["💰"],monkey:["🐵","🙈","🙉","🙊","🐒","🍌"],monorail:["🚈","🚝"],monster:["👹","👺","👻","💀","👽","👾","☠","🤖","💩"],moo:["🐮","🐄"],moon:["🌝","🌛","🌚","🌙","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🎑","🌜"],morning:["🌄","☕","🌅","💖","😘"],mountain:["🗻","🌄","🌋","🚵","🏔","⛰","🚞","🚠"],mouse:["🐭","🐁"],mouth:["👄","😮","😦","😆","😺","😃","😄","😶","🤐","🤑","😰"],mouthless:["😶"],move:["🚛"],movie:["🎥","🎦","🎬","🎞","📽"],moyai:["🗿"],muah:["😘","💗"],mug:["🍺","🍻"],multiplication:["❎","✖","❌"],multiply:["❎","✖","❌"],muscle:["💪"],museum:["🎨","🖼"],mushroom:["🍄"],music:["🎵","🎶","🎼","🎤","🎷","🎸","🎹","🎺","🎻","🔊","🎙","🎚","🎛"],mute:["🔕","😶","🔇"],nail:["💅"],name:["📛"],nap:["😴","😫"],nascar:["🏁"],nature:["🐝","💧","🌞","🌈","🌊","🐌","🐞","🌺","🌻","🌼","🌷","🌴","🌵","🍁","🍃","🌋","🗻","🌄","🌅","⚡","⭐"],necktie:["👔"],nectarine:["🍊"],needle:["💉"],negative:["📉"],neither:["☯"],nerves:["😟"],nervous:["😰","😟","😓","😅","💗"],neutral:["😐"],"new":["🆕"],newborn:["👶","🐥","🍼"],news:["📰","🗞"],newspaper:["📰","🗞"],ng:["🆖"],nice:["👏","😀","😁"],night:["🌠","🌃","🌟","🌉","🌚","😘","😙","🌕","🌙","🌛","🌜","🌝"],nights:["🌜","🌒","🌘"],nine:["9⃣","🕘","🕤"],no:["👎","🙈","🙉","🙊","🙅","🔕","⛔","🚫","🚳","🚭","🚯","🚷","📵","🔞"],"no good":["👎"],nono:["🙈"],noodle:["🍜"],nope:["👎"],north:["⬆"],northeast:["↗"],northwest:["↖"],nose:["👃","🐽"],noses:["👃"],nosey:["👃"],"not amused":["😐"],"not funny":["😐"],"not laughing":["😐"],"not sure":["😕"],"not this time":["😥"],notebook:["📔","📓","📒"],notes:["📝","📋","🎶"],novels:["📖","📚"],numbers:["🔢"],nuptuals:["💒"],nutty:["😜"],ocean:["🌊","🏄","🐳","🐋","🐬","🐙"],octoberfest:["🍺"],octopus:["🐙"],odor:["👃"],off:["📴"],office:["💼","🏢","💻"],officer:["👮"],ogre:["👹"],oh:["🙀"],ok:["🆗","👌"],okay:["👍","🆗","👌"],oktoberfest:["🍺"],"old school":["📼","📇"],omfg:["😲"],omg:["😮","👀","😑","🙈","😯","🙆","😝","😲"],omw:["👣","🔜"],oncoming:["🚍","🚔","🚖","🚘"],one:["1⃣","🕐","🕜"],"one hump":["🐪"],oolong:["🍵"],oops:["🙊"],orange:["🍊","📙","🔶","🔸"],ord:["✈"],ornithology:["🐦"],outbox:["📤"],outdoors:["🌻","🌳"],outgoing:["📩"],outside:["🌞"],outtie:["👋"],"over easy":["🍳"],ox:["🐂","♉"],"package":["📦"],packing:["🛃","🛄"],page:["📄","📃"],pager:["📟"],paid:["💰"],painter:["🎨"],painting:["🎨","🖼","🖌"],palette:["🎨"],palm:["🌴"],pan:["🍳"],panda:["🐼"],pants:["👖"],paper:["📰","📜","✂","🗞"],paperclip:["📎","🖇"],parcel:["📦"],parking:["🅿"],party:["🎉","😛","😜","🍹"],passport:["🛂"],password:["🔑"],pasta:["🍝"],pastry:["🍰","🍥","🎂"],patrol:["🚓"],paw:["🐾"],paws:["🐾"],pay:["💲","💸","💳"],paying:["💰"],peace:["✌","😌","☮","🕊"],peaceful:["☮"],peach:["🍑"],pear:["🍐"],pedestrian:["🚸","🚶","🚷"],pencil:["✏","📝"],penguin:["🐧"],pensive:["😔"],pepperoni:["🍕"],"perfect score":["💯"],performing:["🎭"],persevere:["😣"],pet:["🐶","🐱","🐕","🐈","🐹","🐰","🐇"],pho:["🍜"],phone:["📱","📞","📳","📲","📶","☎","📵","📴"],photo:["📷"],piano:["🎹"],picnic:["🍉"],picturesque:["🌅"],pig:["🐷","🐽","🐖","🐗"],pigtails:["👧"],pill:["💊"],pills:["💊"],pin:["📍","📌"],pina:["🍍"],pinch:["👌"],pine:["🎍"],"pine tree":["🌲"],pineapple:["🍍"],pint:["🍺"],pissed:["😒","😈"],pistol:["🔫"],pizza:["🍕"],plane:["✈","🛄"],plant:["🌻","🌺","🌸","🌹","🌱","🌼","🌷","🎍","💐","🌴","🌵","🌾","🍀","🏵","☘","🌰"],play:["▶","⏯"],please:["🙏"],plug:["🔌"],plus:["➕"],"po po":["👮"],police:["👮","🚓","🚔","🚨"],polish:["💅"],poo:["💩"],poodle:["🐩"],pooh:["🍯"],pool:["👙"],poop:["💩"],popo:["👮"],popper:["🎉"],pork:["🐷","🐖"],poseidon:["🔱"],postbox:["📫","📪","📬","📭","📮"],"pot of gold":["💰"],potassium:["🍌"],poultry:["🍗"],pound:["👊","#⃣","💷"],pounds:["💷"],pouting:["😡","😾","🙎"],prawn:["🍤"],pray:["🙏"],prayed:["👏"],preakness:["🐎"],predator:["🐯","🐅","🐆"],pregnant:["👶"],present:["🎁"],pride:["🌈"],princess:["👸","🐸"],print:["👣","🐾"],"private":["🔒"],prize:["🏆"],progress:["✅"],prohibited:["🚫","⛔","🚭","🙅","🙈","🙉","🙊","🚳","🚯","🚱","🚷","🔕","📵","🔞"],"pub grub":["🍤"],"public address":["📢"],pudding:["🍮"],pulsating:["💓"],pulse:["💓","💗"],pump:["⛽"],punch:["👊","✊"],puppies:["🐶"],puppy:["🐶"],purple:["💜"],purse:["👛","👜","👝"],pushpin:["📌","📍"],queen:["👑"],question:["❓","🙋","⁉","❔"],"question mark":["❓","❔"],quick:["🏃"],quiet:["🙊","😶","🔇","🔕"],rabbit:["🐰","🐇"],race:["🏁"],racehorse:["🐎","🏇"],racing:["🏁","🏇","🐎","🏎","🏍"],rad:["👍","👌","😎"],radio:["📻","🔘"],radioactive:["☢"],rage:["😡","😠"],railway:["🚆","🚉","🚞","🚂","🚃","🚄","🚅","🚈","🚟","🛤"],rain:["☔","🌂","🌈","⛈","🌦","🌧","☂","⛱"],rainbow:["🌈"],raised:["🙋","✋","🙌"],ram:["🐏","♈"],ramen:["🍜"],ranch:["🏠","🏡"],raphael:["🐢"],rat:["🐀"],rays:["☀"],reading:["📖","📚","📗","📘","📙"],ready:["🛄"],realize:["💭"],receive:["📨","📥","📲"],record:["🎥","⏺"],recycle:["♻"],red:["🍎","🌹","😡","🀄","🏮","🔼","🔽","🔺","🔻","🔴"],refresh:["🔄","🔃"],registered:["®"],relaxed:["😎","☺"],relief:["😌"],relieved:["😌","😥"],religion:["✡","☸","☯","✝","☦","☪","📿","⛪","🕌","🕍","⛩","🕋","🛐","🕉","🕎"],"reno 911":["👮"],repairs:["🔨"],repeat:["🔁"],restaurant:["🍴","🍔","🍕","🍗","🍞","🍖","🍟","🍲","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🍡","🍦","🍧","🍨","🍩","🍪","🍰","🍫","🍬","🍭","🍮","🍯","🍶","🍷","🍸","🍹","🍺","🍻","🍳","🏮"],restroom:["🚾","🚹","🚺","🚻"],revolver:["🔫"],rewind:["⏪","🔄"],ribbon:["🎀","💝","🎗"],rice:["🍚","🍙","🌾","🍛","🍘"],rich:["💰","💶"],ride:["🚲"],riding:["🚴","🚵","🏇"],"right handed":["✋"],ring:["💍"],ripe:["🍎","🍐"],ripped:["💪"],river:["🚣"],rock:["👊"],rocket:["🚀"],rofl:["😂","😆"],roflcopter:["🚁"],roflew:["🍴"],rolodex:["📇"],romance:["💏","😘","💑","💋","💐","💘","💙","😍","💌","💍","💎","💒"],romantic:["😘","😍","💚"],ronaldo:["⚽"],rooster:["🐓"],ropeway:["🚡"],rose:["🌹"],row:["🚣"],rowboat:["🚣"],rowing:["🚣"],royal:["👑"],"royal family":["👑"],royalty:["👑"],rugby:["🏉"],ruler:["📏","📐"],runner:["🏃"],running:["🏃","👟","💨","🎽"],rush:["🏃"],rushed:["😰"],sad:["😢","😭","😩","💧","😖","😞","💔","😿"],sailboat:["⛵"],sailing:["⛵"],sake:["🍶"],salud:["🍻"],sandal:["👡"],santa:["🎅"],sapling:["🌱"],sash:["🎽"],sassy:["💁"],satchel:["🎒"],satellite:["📡","🛰"],satisfied:["😊","😆"],saunter:["🚶"],savour:["😋"],savouring:["😋"],sax:["🎷"],saxophone:["🎷"],scared:["😨","😱","😰","🙈","😧","😦","😓"],scary:["😧","😦","👻"],school:["📚","🎒","🚌","🏫","📔"],science:["🔬","🔭","🔎","🔍","📡"],scissors:["✂"],score:["🎼","💯"],scream:["😱"],screamer:["😱"],scroll:["📜"],scrooge:["💰"],search:["🔎","🔍"],seat:["💺"],secret:["🙊","🙈","🙉"],see:["👀","🙈"],"see no evil":["🙈"],seedling:["🌱"],seeing:["👀"],selfie:["📷"],semi:["🚛"],send:["📩"],sent:["✉","📨","📩","📤"],serious:["👔"],serpent:["🐍","⛎"],"settle down":["🏠","🏡"],seven:["7⃣","🕖","🕢"],sexy:["😉","💋"],sfo:["✈"],shade:["👿","😡","😈","😠","😐"],shadow:["👤"],shakespeare:["🎭"],sheep:["🐏","🐑"],shell:["🐚"],shh:["🙉"],shine:["🌞"],shining:["🌟"],shinkansen:["🚄","🚅"],shipping:["📦"],shirt:["👔","👕","👚","🎽"],shocked:["😲"],shoe:["👟","👠","👞","👡","👢"],shoes:["👟","👠","👞","👢"],shooting:["🌠"],
shopping:["👛","👠","👗","👖","👕","👢","👜","👚","👞","👟","🛍"],shortcake:["🍰","🍓"],shot:["💉"],shower:["🚿"],shrimp:["🍤"],sick:["😷","😵","💊","🤒","💉"],"side - saddle":["🐴"],signal:["📶","🚥","🚦"],silence:["😶"],silent:["😶","🔇","🔕"],silhouette:["👤","👥","🗣"],"simple home":["🏠","🏡"],sing:["🎤"],sis:["👭"],sister:["👭"],sisters:["👭"],six:["6⃣","🕕","🕡"],ski:["🎿","🏂","⛷"],"ski lift":["🚠"],skull:["💀","☠"],slay:["🏆","😎","🌟","✨"],sleep:["😴","💤","😪","🛌","🛏"],sleeping:["😴","💤","😪"],sleepy:["😩","💤"],slice:["🍕","🍰"],slick:["😏"],slide:["😉","😏"],"slide rule":["📐"],slot:["🎰"],slots:["🎰"],slug:["🐌"],slurp:["👅"],smel:["🐽"],smell:["👃"],smells:["👃"],smh:["😒","🙈","💩"],smile:["😀","😊","😁","😆","😃","😄","😇","😈","☺","😅","😋","😎","😍","😙","🙂","😺","😸","😻","😼"],smiling:["😁","😆","☺"],smirk:["😏"],smoke:["🚫","🚭"],smoking:["🚭","🚬"],smooch:["😘","😗"],smooches:["😘","😗","😚"],sms:["💬"],smug:["😏"],snail:["🐌"],snake:["🐍","⛎"],snap:["📷"],snapchat:["👻"],sneaker:["👟"],sneeze:["😫"],snicker:["😏"],snout:["🐽"],snow:["❄","⛄","🎿","🏂","⛷","🏔","🌨","☃"],snowboard:["🏂"],snowflake:["❄"],snowman:["⛄","☃"],sob:["😭"],soba:["🍜"],soccer:["⚽"],solidarity:["✊"],soothe:["💆"],sound:["👂","🔇","🔈","🔉","🔊","📢","📣","🔔","🔕","🎵","🎶","🎤","🎧"],sour:["🍋"],sow:["🐖"],space:["👽","👾","🌌","🚀","🌠","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","☀","🌝","🌞","🛰","☄"],spade:["♠"],spaghetti:["🍝"],sparkle:["🌟","💖","🎇","✨","❇"],sparkling:["💖"],speak:["🙊","🗣"],"speak no evil":["🙊"],speech:["💬","🗨"],speechless:["😶"],speed:["🏃","🚄","🚅"],speedboat:["🚤"],speilberg:["🎥"],"spin class":["🚲"],spinning:["🚲"],spiral:["🐚","🗒","🗓"],spirit:["😇"],splashing:["💦"],spock:["🖖"],sport:["🏈","🏀","⚾","⚽","🏉","🎾","🏄","⛳","🎿","🏂","🏊","🚵","🎳","🎣","🏇","🚴","🏆","🏁"],spouting:["🐳"],spring:["🐝","🌸"],springs:["♨"],springtime:["🌸"],sprout:["🌱"],star:["🌟","⭐","🌠","💫","🌃","✨","✡","🔯","✴"],"star trek":["🖖"],starbucks:["☕"],stars:["⭐","💫"],statue:["🗽","🗿"],stealth:["🙊"],steaming:["☕","♨","🍜"],stein:["🍺"],stew:["🍲"],stop:["✋","🚏","⏹"],"stop light":["🚦","🚥"],stoplight:["🚦","🚥"],store:["🏪","🏬"],stradivarius:["🎻"],"straight edge":["📏"],strat:["🎸"],stratocaster:["🎸"],strawberry:["🍓"],streamer:["🎏"],stress:["😟"],stressed:["😟","😧"],stride:["🚶"],strike:["🎳"],stroll:["🚶"],strong:["💪"],study:["📚"],stunned:["😯"],stunner:["😎"],style:["😎"],suave:["😏"],suburban:["🏠","🏡"],suburbia:["🏠","🏡"],subway:["🚇"],sucks:["😔"],summer:["🍉","⛵","🚤"],"summer ale":["🍺"],sun:["☀","🌞","⛅","🌄","🌅","😎","🌻","🌆","🌇","🌤","🌥","🌦","⛱"],sunflower:["🌻"],sunglasses:["😎","🕶"],sunny:["☀","🌞"],"sunny side up":["🍳"],sunrise:["🌄","🌅"],sunset:["🌆","🌇"],sunshine:["🌞"],suprise:["😧","😦"],surf:["🌊"],surfer:["🏄"],surfing:["🏄"],surprised:["😯","🙀"],sushi:["🍣"],swag:["😏","😎"],swagger:["😏","😎","🚶"],sweat:["😅","💦","😥","😰","😓","💧"],sweet:["🍭","🍪","🍦","🍩","🍬","🍫","🍰","🎂","🍯","🍓","🍠","🍡","🍧","🍨","🍮"],"sweet tooth":["🍬","🍫"],swim:["🏊","👙"],swimmer:["🏊"],syringe:["💉"],syrup:["🍁"],tada:["🎉"],talk:["💬"],tangerine:["🍊"],tango:["💃"],tao:["☯"],taoist:["☯"],tape:["📼"],target:["🎯"],taurus:["🐂"],taxi:["🚕","🚖"],tbt:["📻","📷","📹"],tea:["🍵","☕"],teacup:["🍵"],tear:["😢","💧","😿","😭","😂","😹"],tears:["😂"],tease:["😉"],teeth:["😁","😀"],telephone:["📱","☎","📞","📲","📵","📶","📳","📴"],telescope:["🔭"],television:["📺"],tempura:["🍤"],tennis:["🎾","👟"],tent:["⛺","🎪"],text:["💬"],thank:["🙏"],thanks:["🙏"],"that was close":["😓"],theater:["🎭"],theatre:["🎭"],thesbian:["🎭"],think:["💭"],thinking:["💭","🤔"],thought:["💭"],thoughts:["💭"],thumb:["👍","👎"],"thumbs down":["👎"],"thumbs up":["👍"],thx:["🙏"],ticket:["🎫","🎟"],tiger:["🐯","🐅"],time:["⌚","⏰","⌛"],tired:["💤","😪","😴","😵","😫","😩"],titanic:["🚢"],tm:["™"],tmi:["🙉"],"to do list":["📋"],toast:["🍞","🍻"],toilet:["🚽"],tokyo:["🗼"],tomato:["🍅"],tongue:["😜","😛","😝","👅"],tool:["🔨","🔧","🔩","🔦","✂","🔪","🏺","⚓","🔥","🔍","🔎","🔬","🔭","⛏","⚒","🛠","🔫","🏹","⚙","🗜","⚗","⚖","💉","🔮","🔰","🔱"],top:["🎩","🔝"],tophat:["🎩"],toronto:["🍁"],total:["☯"],totally:["😲"],tower:["🗼"],tractor:["🚜"],trademark:["™"],traffic:["🚥","🚦","🚸","⛔"],train:["🚂","🚆","🚄","🚅","🚉","🚃","🛤"],trains:["🚂"],tram:["🚃","🚎","🚊","🚋"],tramway:["🚡"],travel:["✈","🚢","🚃","🚁","🚅","🗿","🚤","⛵","🚀","🛄","🚂","🚇"],tree:["🌳","🌲","🌴","🎄","🎋"],trident:["🔱"],trip:["🚞","📷","🛄"],"triple crown":["🐎"],"triple crown preakness":["🐴"],triste:["😢"],trolley:["🚋","🚎"],trolleybus:["🚃","🚎","🚊","🚋"],trophy:["🏆"],tropical:["🌴","🍹","🍍","🐠"],tropics:["🍹"],trousers:["👖"],truck:["🚛","🚚","🚒"],trumpet:["🎺"],tshirt:["👕"],ttfn:["👋"],ttyl:["👊","👋"],tub:["🛀"],tubular:["👍","👌"],tulip:["🌷"],turkey:["🍗","🦃"],turtle:["🐢"],turtles:["🐢"],tv:["📺"],twelve:["🕛","🕧"],twig:["🌱"],twinsies:["👯"],twister:["🌀"],two:["2⃣","🕑","🕝"],"two hump":["🐫"],typing:["💬"],uber:["🚕","🚖"],udon:["🍜"],ufo:["👾","👽"],ugh:["😒"],uh:["😐","😑"],"uh oh":["😐","😑"],umbrella:["☔","🌂","🏖","☂","⛱"],unamused:["😒"],"under the tuscan sun":["😚"],underage:["🔞"],understood:["✊"],unexpressive:["😑"],unhappy:["😞","😒","😡","😢","😭","😠","😧","😩"],unlock:["🔓","🔑"],unlocked:["🔓"],"up and to the right":["📈"],upset:["🙍"],urn:["⚱"],vacation:["✈","🍹"],vaccination:["💉"],vaccinatoins:["💉"],valentine:["💝","💌","💘"],vampire:["⚰"],van:["🚐"],vegetable:["🍆","🍅"],vehicle:["🚗","🚙","🚘","🚐","🚚","🚕","🚛","🚝","🚌","🚑","🚜","🚁"],versus:["🆚"],vhs:["📼"],video:["📹","📼","📻","📽","📺","📷","📸"],"video game":["🎮"],videocassette:["📼"],violin:["🎻"],"vitamin c":["🍊"],voip:["📞"],volcano:["🌋"],voltage:["⚡"],vulcan:["🖖"],wacky:["😜"],waiting:["⏰","⏳"],walk:["🚶","👣"],walking:["🚶"],warning:["⚠"],watch:["⌚"],water:["💧","🌊","🐃","🚿","🚰","🚾","🚱","♒"],"water dog":["🐩"],watermelon:["🍉"],wave:["👋","🌊"],waves:["🏄"],waving:["👋","🏴","🏳"],wavy:["〰"],wc:["🚾","🚹","🚺"],weary:["😩","🙀"],weather:["☀","⛅","☁","☔","💧","❄","🌞","🌈","🌀","🌡"],wedding:["💍","👰","💎","💒"],weekend:["👕","👖"],weightlift:["💪"],weird:["😒"],weirdo:["😜"],western:["🐴"],whale:["🐳","🐋"],whatever:["😝","😒"],whatsapp:["📱","📲"],wheat:["🍞"],wheelchair:["♿"],"where the heart is":["🏠","🏡"],whitecaps:["🌊"],wilbur:["🐷"],"willy wonka":["🍭"],win:["🏆","👑","🌟","🏁","😎","💰","✨"],wine:["🍷"],wink:["😉","😏","😜"],winking:["😉"],winks:["😉"],"winnie the pooh":["🍯"],winning:["🏆","😎"],woah:["😯","😮"],wolf:["🐺"],wonder:["💭"],wool:["🐑"],"work out":["💦"],workout:["💦"],world:["🌍","🌏","🌎","🌐","🗺"],worried:["😟","😨"],worry:["😟"],wow:["😮"],wrapped:["🎁"],wrapper:["🍬"],wrench:["🔧","🛠"],writing:["✏","📔"],wtf:["😑","😒","😲"],xoxo:["😘","😚","😗","💗","😍","💖","💕","💝"],yacht:["⛵"],yang:["☯"],yay:["😃","👏"],yeah:["👍","😎","✨"],"yellow cab":["🚖"],"yellow taxi":["🚕","🚖"],yen:["💴","💹"],yes:["👍","👊"],yikes:["😰","😓"],yin:["☯"],yolo:["😜","😝","💀","⏳","🎆"],yosemite:["🐻"],yum:["😋","🍇","🍉","🍑","🍟"],zap:["⚡"],zen:["😌"],zoo:["🐅","🐆","🐃","🐏","🐊"],zz:["💤"],zzz:["💤","😴"],zzzz:["💤"],"grinning face":["😀"],"grinning face with smiling eyes":["😁"],"face with tears of joy":["😂"],joy:["😂","😹"],rolling:["🙄"],"smiling face with open mouth":["😃"],open:["😃","😄","😅","😆","😮","😦","😰","😺","👐","📖","📬","📭","📂","🔓"],"smiling face with open mouth & smiling eyes":["😄"],"smiling face with open mouth & cold sweat":["😅"],"smiling face with open mouth & closed eyes":["😆"],"winking face":["😉"],"smiling face with smiling eyes":["😊"],"face savouring delicious food":["😋"],um:["😋"],"smiling face with sunglasses":["😎"],"smiling face with heart-eyes":["😍"],"face blowing a kiss":["😘"],"kissing face":["😗"],"kissing face with smiling eyes":["😙"],"kissing face with closed eyes":["😚"],"smiling face":["☺"],outlined:["☺","❔","❕","🔳"],"slightly smiling face":["🙂"],"hugging face":["🤗"],hug:["🤗"],hugging:["🤗"],"thinking face":["🤔"],"neutral face":["😐"],"expressionless face":["😑"],"face without mouth":["😶"],"face with rolling eyes":["🙄"],eyes:["🙄","👀"],"smirking face":["😏"],"persevering face":["😣"],"disappointed but relieved face":["😥"],whew:["😥"],"face with open mouth":["😮"],sympathy:["😮"],"zipper-mouth face":["🤐"],zipper:["🤐"],"hushed face":["😯"],"sleepy face":["😪"],"tired face":["😫"],"sleeping face":["😴"],"relieved face":["😌"],"nerd face":["🤓"],geek:["🤓"],nerd:["🤓"],"face with stuck-out tongue":["😛"],"face with stuck-out tongue & winking eye":["😜"],"face with stuck-out tongue & closed eyes":["😝"],taste:["😝"],"unamused face":["😒"],"face with cold sweat":["😓"],"pensive face":["😔"],"confused face":["😕"],"upside-down face":["🙃"],"upside-down":["🙃"],"money-mouth face":["🤑"],"astonished face":["😲"],"frowning face":["☹"],"slightly frowning face":["🙁"],"confounded face":["😖"],"disappointed face":["😞"],"worried face":["😟"],"face with steam from nose":["😤"],triumph:["😤"],won:["😤"],"crying face":["😢"],"loudly crying face":["😭"],"frowning face with open mouth":["😦"],"anguished face":["😧"],"fearful face":["😨"],"weary face":["😩"],"grimacing face":["😬"],"face with open mouth & cold sweat":["😰"],"face screaming in fear":["😱"],munch:["😱"],"flushed face":["😳"],"dizzy face":["😵"],"pouting face":["😡"],"angry face":["😠"],"smiling face with halo":["😇"],fairytale:["😇","😈","👿","👹","👺","💀","👻","👽","👾","👼","👸","🐲","🐉","🔮"],"face with medical mask":["😷"],"face with thermometer":["🤒"],ill:["🤒"],thermometer:["🤒","🌡"],"face with head-bandage":["🤕"],bandage:["🤕"],hurt:["🤕"],injury:["🤕"],"smiling face with horns":["😈"],"angry face with horns":["👿"],demon:["👿"],Japanese:["👹","👺","🍙","🍡","🏣","🏯","🎋","🎍","🎎","🎴","🏮","🔰","🈁","🈂","🈷","🈶","🈯","🉐","🈹","🈚","🈲","🉑","🈸","🈴","🈳","㊗","㊙","🈺","🈵","🎌"],"skull and crossbones":["☠"],crossbones:["☠"],"alien monster":["👾"],"robot face":["🤖"],robot:["🤖"],"pile of poo":["💩"],"smiling cat face with open mouth":["😺"],"grinning cat face with smiling eyes":["😸"],"cat face with tears of joy":["😹"],"smiling cat face with heart-eyes":["😻"],"cat face with wry smile":["😼"],wry:["😼"],"kissing cat face with closed eyes":["😽"],"weary cat face":["🙀"],"crying cat face":["😿"],"pouting cat face":["😾"],"see-no-evil monkey":["🙈"],gesture:["🙈","🙉","🙊","🙍","🙎","🙅","🙆","🙋","🙇","🙌","🙏"],not:["🙈","🙉","🙊","🙅","🔕","⛔","🚫","🚳","🚭","🚯","🚷","📵","🔞"],"hear-no-evil monkey":["🙉"],"speak-no-evil monkey":["🙊"],young:["👦","👧","👶","🌱"],Virgo:["👧","♍"],zodiac:["👧","👬","🦁","🐂","🐏","🐐","🐍","🐟","🦀","🦂","🏺","🏹","⚖","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","⛎"],woman:["👩","👵","💃","👫","👭","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👦‍👦","👨‍👩‍👧‍👧","👩‍👩‍👦","👩‍👩‍👧","👩‍👩‍👧‍👦","👩‍👩‍👦‍👦","👩‍👩‍👧‍👧","👩‍👦","👩‍👦‍👦","👩‍👧","👩‍👧‍👦","👩‍👧‍👧","👚","👠","👡","👢","👒","🚺"],"old man":["👴"],old:["👴","👵","🗝"],"old woman":["👵"],"baby angel":["👼"],justice:["⚖","♎"],scales:["⚖","♎"],worker:["👷"],business:["🕴"],"police officer":["👮"],detective:["🕵"],sleuth:["🕵"],spy:["🕵"],"construction worker":["👷"],"person wearing turban":["👳"],turban:["👳"],"blond-haired person":["👱"],"Santa Claus":["🎅"],Christmas:["🎅","🎄"],claus:["🎅"],father:["🎅"],"bride with veil":["👰"],veil:["👰"],"man with Chinese cap":["👲"],guapimao:["👲"],"person frowning":["🙍"],"person pouting":["🙎"],"person gesturing NO":["🙅"],"person gesturing OK":["🙆"],OK:["🙆","👌","🆗"],"person tipping hand":["💁"],help:["💁","🆘"],information:["💁","ℹ"],tipping:["💁"],"person raising hand":["🙋"],"person bowing":["🙇"],sorry:["🙇"],"person getting massage":["💆"],salon:["💆"],"person getting haircut":["💇"],parlor:["💇"],"person walking":["🚶"],"person running":["🏃"],"woman dancing":["💃"],dancing:["💃"],"people with bunny ears partying":["👯"],bunnyear:["👯"],partying:["👯"],"man in business suit levitating":["🕴"],suit:["🕴"],"speaking head":["🗣"],head:["🗣"],speaking:["🗣"],"bust in silhouette":["👤"],"busts in silhouette":["👥"],"horse racing":["🏇"],skier:["⛷"],snowboarder:["🏂"],"person golfing":["🏌"],"person surfing":["🏄"],"person rowing boat":["🚣"],"person swimming":["🏊"],"person bouncing ball":["⛹"],"person lifting weights":["🏋"],lifter:["🏋"],weight:["🏋","⚖"],"person biking":["🚴"],biking:["🚴"],"person mountain biking":["🚵"],"racing car":["🏎"],motorcycle:["🏍"],balance:["⚖","♎"],"man and woman holding hands":["👫"],hold:["👫","👬","👭"],"two men holding hands":["👬"],Gemini:["👬","♊"],twins:["👬","♊"],"two women holding hands":["👭"],"couple with heart":["💑"],"light skin tone":["🏻"],skintone:["🏻","🏼","🏽","🏾","🏿"],"type1–2":["🏻"],"medium-light skin tone":["🏼"],type3:["🏼"],"medium skin tone":["🏽"],type4:["🏽"],"medium-dark skin tone":["🏾"],type5:["🏾"],"dark skin tone":["🏿"],type6:["🏿"],"flexed biceps":["💪"],"backhand index pointing left":["👈"],backhand:["👈","👉","👆","👇"],finger:["👈","👉","☝","👆","🖕","👇","🖖","🤘","🖐"],point:["👈","👉","☝","👆","👇"],"backhand index pointing right":["👉"],"index pointing up":["☝"],up:["☝","👆","👍","🔝","🆙"],"backhand index pointing up":["👆"],"middle finger":["🖕"],"backhand index pointing down":["👇"],down:["👇","👎","📩","📉","⬇","⤵","🔽","⏬","🔻"],"victory hand":["✌"],v:["✌"],victory:["✌"],cross:["⛑","⛪","✝","☦","🎌"],"vulcan salute":["🖖"],"sign of the horns":["🤘"],"rock-on":["🤘"],call:["📲"],"raised hand with fingers splayed":["🖐"],splayed:["🖐"],"raised hand":["✋"],"OK hand":["👌"],"raised fist":["✊"],"oncoming fist":["👊"],"waving hand":["👋"],"clapping hands":["👏"],"writing hand":["✍"],write:["✍"],"open hands":["👐"],"raising hands":["🙌"],hooray:["🙌"],"folded hands":["🙏"],folded:["🙏"],"nail polish":["💅"],care:["💅"],footprints:["👣"],"kiss mark":["💋"],"heart with arrow":["💘"],arrow:["💘","📲","📩","🏹","⬆","↗","➡","↘","⬇","↙","⬅","↖","↕","↔","↩","↪","⤴","⤵","🔃","🔄","🔙","🔚","🔛","🔜","🔝","🔀","🔁","🔂","▶","⏩","⏭","⏯","◀","⏪","⏮","🔼","⏫","🔽","⏬"],"red heart":["❤"],"beating heart":["💓"],beating:["💓"],"broken heart":["💔"],"two hearts":["💕"],"sparkling heart":["💖"],"growing heart":["💗"],"blue heart":["💙"],"green heart":["💚"],"yellow heart":["💛"],yellow:["💛","🔰"],"purple heart":["💜"],"heart with ribbon":["💝"],"revolving hearts":["💞"],revolving:["💞","🚨"],"heart decoration":["💟"],"heavy heart exclamation":["❣"],mark:["❣","📑","🔖","🔛","✅","✔","❌","❎","〽","‼","⁉","❓","❔","❕","❗","™","🆙"],punctuation:["❣","‼","⁉","❓","❔","❕","❗","〰"],"love letter":["💌"],"anger symbol":["💢"],"sweat droplets":["💦"],"dashing away":["💨"],dash:["💨","〰"],"speech balloon":["💬"],bubble:["💬","🗯","💭"],"left speech bubble":["🗨"],"right anger bubble":["🗯"],"thought balloon":["💭"],dark:["🕶","🌑"],"t-shirt":["👕"],"woman’s clothes":["👚"],coin:["👛"],"clutch bag":["👝"],pouch:["👝"],"shopping bags":["🛍"],"school backpack":["🎒"],"man’s shoe":["👞"],"running shoe":["👟"],"high-heeled shoe":["👠"],"woman’s sandal":["👡"],"woman’s boot":["👢"],"woman’s hat":["👒"],"top hat":["🎩"],"graduation cap":["🎓"],"rescue worker’s helmet":["⛑"],aid:["⛑"],"prayer beads":["📿"],beads:["📿"],necklace:["📿"],prayer:["📿"],"gem stone":["💎"],"monkey face":["🐵"],"dog face":["🐶"],"wolf face":["🐺"],"cat face":["🐱"],"lion face":["🦁"],Leo:["🦁","♌"],lion:["🦁","♌"],"tiger face":["🐯"],"horse face":["🐴"],equestrian:["🐎"],"unicorn face":["🦄"],unicorn:["🦄"],"cow face":["🐮"],Taurus:["🐂","♉"],"water buffalo":["🐃"],"pig face":["🐷"],"pig nose":["🐽"],Aries:["🐏","♈"],Capricorn:["🐐","♑"],"two-hump camel":["🐫"],"mouse face":["🐭"],"hamster face":["🐹"],"rabbit face":["🐰"],chipmunk:["🐿"],bat:["🏏","🏓"],"bear face":["🐻"],"panda face":["🐼"],"paw prints":["🐾"],"hatching chick":["🐣"],chick:["🐣","🐤","🐥"],"baby chick":["🐤"],"front-facing baby chick":["🐥"],dove:["🕊"],"frog face":["🐸"],terrapin:["🐢"],tortoise:["🐢"],bearer:["🐍","♒","⛎"],Ophiuchus:["🐍","⛎"],"dragon face":["🐲"],"spouting whale":["🐳"],Pisces:["🐟","♓"],"tropical fish":["🐠"],"spiral shell":["🐚"],crab:["🦀","♋"],Cancer:["🦀","♋"],spider:["🕷","🕸"],"spider web":["🕸"],web:["🕸"],scorpion:["🦂","♏"],scorpio:["🦂","♏"],Scorpius:["🦂","♏"],"cherry blossom":["🌸"],"white flower":["💮"],rosette:["🏵"],"evergreen tree":["🌲"],"deciduous tree":["🌳"],shedding:["🌳"],"palm tree":["🌴"],"sheaf of rice":["🌾"],shamrock:["☘"],"four leaf clover":["🍀"],"maple leaf":["🍁"],falling:["🍁","🍂","🌠"],"fallen leaf":["🍂"],"leaf fluttering in wind":["🍃"],blow:["🍃","🌬"],flutter:["🍃"],wind:["🍃","🌬","🎐"],grapes:["🍇"],"red apple":["🍎"],"green apple":["🍏"],cherries:["🍒"],potato:["🍠"],"ear of corn":["🌽"],"hot pepper":["🌶"],pepper:["🌶"],toadstool:["🍄"],nut:["🔩"],french:["🍟"],"cheese wedge":["🧀"],cheese:["🧀","🍕"],"meat on bone":["🍖"],"poultry leg":["🍗"],leg:["🍗"],"french fries":["🍟"],"hot dog":["🌭"],frankfurter:["🌭"],hotdog:["🌭"],sausage:["🌭"],taco:["🌮"],mexican:["🌮","🌯"],burrito:["🌯"],wrap:["🌯"],kebab:["🍢"],"pot of food":["🍲"],pot:["🍲","🍯"],popcorn:["🍿"],"bento box":["🍱"],"rice cracker":["🍘"],cracker:["🍘"],"rice ball":["🍙"],"cooked rice":["🍚"],"curry rice":["🍛"],"steaming bowl":["🍜"],"roasted sweet potato":["🍠"],roasted:["🍠"],oden:["🍢"],seafood:["🍢"],skewer:["🍢","🍡"],stick:["🍢","🍡","🏑","🏒"],"fried shrimp":["🍤"],"fish cake with swirl":["🍥"],swirl:["🍥"],"soft ice cream":["🍦"],ice:["🍦","🍧","🍨","🏒","⛸"],soft:["🍦","🔈"],"shaved ice":["🍧"],shaved:["🍧"],"ice cream":["🍨"],"birthday cake":["🎂"],"chocolate bar":["🍫"],"honey pot":["🍯"],"baby bottle":["🍼"],"hot beverage":["☕"],beverage:["☕","🍵","🍶","🍷"],"teacup without handle":["🍵"],cup:["🍵","🍶"],"bottle with popping cork":["🍾"],cork:["🍾"],popping:["🍾"],"wine glass":["🍷"],"cocktail glass":["🍸"],"tropical drink":["🍹"],"beer mug":["🍺"],"clinking beer mugs":["🍻"],"fork and knife with plate":["🍽"],plate:["🍽"],"fork and knife":["🍴"],"kitchen knife":["🔪"],hocho:["🔪"],weapon:["🔪","🏺","🗡","⚔","🔫","🏹","🛡"],amphora:["🏺"],Aquarius:["🏺","♒"],jug:["🏺"],"globe showing Europe-Africa":["🌍"],Africa:["🌍"],Europe:["🌍"],"globe showing Americas":["🌎"],Americas:["🌎"],"globe showing Asia-Australia":["🌏"],Asia:["🌏"],Australia:["🌏","🇦🇺"],"globe with meridians":["🌐"],"world map":["🗺"],"map of Japan":["🗾"],Japan:["🗾","🇯🇵"],"snow-capped mountain":["🏔"],"mount fuji":["🗻"],"beach with umbrella":["🏖"],"desert island":["🏝"],island:["🏝"],"national park":["🏞"],park:["🏞"],stadium:["🏟"],"classical building":["🏛"],classical:["🏛"],"building construction":["🏗"],cityscape:["🏙"],"derelict house":["🏚"],derelict:["🏚"],"house with garden":["🏡"],"office building":["🏢"],"Japanese post office":["🏣"],post:["🏣","🏤","📯","🚩"],"post office":["🏤"],European:["🏤","🏰"],"love hotel":["🏩"],"convenience store":["🏪"],"department store":["🏬"],"Japanese castle":["🏯"],"Tokyo tower":["🗼"],Tokyo:["🗼"],"Statue of Liberty":["🗽"],Christian:["⛪","✝","☦"],mosque:["🕌"],islam:["🕌","🕋","☪"],Muslim:["🕌","🕋","☪"],synagogue:["🕍"],Jew:["🕍","✡"],Jewish:["🕍","✡"],temple:["🕍"],"shinto shrine":["⛩"],shinto:["⛩"],shrine:["⛩"],kaaba:["🕋"],foggy:["🌁"],"night with stars":["🌃"],"sunrise over mountains":["🌄"],"cityscape at dusk":["🌆"],"bridge at night":["🌉"],"hot springs":["♨"],"carousel horse":["🎠"],"ferris wheel":["🎡"],amusementpark:["🎡","🎢"],wheel:["🎡","☸"],"roller coaster":["🎢"],roller:["🎢"],"barber pole":["💈"],pole:["💈","🎣"],"circus tent":["🎪"],"performing arts":["🎭"],"framed picture":["🖼"],frame:["🖼"],picture:["🖼"],"artist palette":["🎨"],"slot machine":["🎰"],steam:["🚂"],"railway car":["🚃"],"high-speed train":["🚄"],"high-speed train with bullet nose":["🚅"],station:["🚉","⛽"],"mountain railway":["🚞"],"tram car":["🚋"],"oncoming bus":["🚍"],"fire engine":["🚒"],"police car":["🚓"],"oncoming police car":["🚔"],"oncoming taxi":["🚖"],"oncoming automobile":["🚘"],"sport utility vehicle":["🚙"],recreational:["🚙"],sportutility:["🚙"],"delivery truck":["🚚"],"articulated lorry":["🚛"],"bus stop":["🚏"],motorway:["🛣"],highway:["🛣"],road:["🛣"],"railway track":["🛤"],"fuel pump":["⛽"],"police car light":["🚨"],beacon:["🚨"],"horizontal traffic light":["🚥"],"vertical traffic light":["🚦"],sign:["☢","☣"],ship:["⚓","🛳","🚢","🔱"],resort:["⛵"],sea:["⛵"],"passenger ship":["🛳"],passenger:["🛳","⛴","🚢"],ferry:["⛴"],"motor boat":["🛥"],motorboat:["🛥"],aeroplane:["✈","🛩","🛫","🛬"],"small airplane":["🛩"],"airplane departure":["🛫"],"check-in":["🛫"],departure:["🛫"],departures:["🛫"],"airplane arrival":["🛬"],arrivals:["🛬"],arriving:["🛬"],landing:["🛬"],"suspension railway":["🚟"],suspension:["🚟"],"mountain cableway":["🚠"],"aerial tramway":["🚡"],"bellhop bell":["🛎"],bellhop:["🛎"],"person in bed":["🛌"],"couch and lamp":["🛋"],couch:["🛋"],lamp:["🛋"],"person taking bath":["🛀"],sand:["⌛","⏳"],timer:["⌛","⏳","⏲"],"hourglass with flowing sand":["⏳"],"alarm clock":["⏰"],stopwatch:["⏱"],"timer clock":["⏲"],"mantelpiece clock":["🕰"],"twelve o’clock":["🕛"],"00":["🕛","🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕙","🕚"],"o’clock":["🕛","🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕙","🕚"],"twelve-thirty":["🕧"],thirty:["🕧","🕜","🕝","🕞","🕟","🕠","🕡","🕢","🕣","🕤","🕥","🕦"],"one o’clock":["🕐"],"one-thirty":["🕜"],"two o’clock":["🕑"],"two-thirty":["🕝"],"three o’clock":["🕒"],three:["🕒","🕞"],"three-thirty":["🕞"],"four o’clock":["🕓"],"four-thirty":["🕟"],"five o’clock":["🕔"],"five-thirty":["🕠"],"six o’clock":["🕕"],"six-thirty":["🕡"],"seven o’clock":["🕖"],"seven-thirty":["🕢"],"eight o’clock":["🕗"],"eight-thirty":["🕣"],"nine o’clock":["🕘"],"nine-thirty":["🕤"],"ten o’clock":["🕙"],ten:["🕙","🕥"],"ten-thirty":["🕥"],"eleven o’clock":["🕚"],"eleven-thirty":["🕦"],"new moon":["🌑"],"waxing crescent moon":["🌒"],waxing:["🌒","🌔"],"first quarter moon":["🌓"],quarter:["🌓","🌗","🌛","🌜"],"waxing gibbous moon":["🌔"],gibbous:["🌔","🌖"],"full moon":["🌕"],"waning gibbous moon":["🌖"],waning:["🌖","🌘"],"last quarter moon":["🌗"],"waning crescent moon":["🌘"],"crescent moon":["🌙"],"new moon face":["🌚"],"first quarter moon with face":["🌛"],"last quarter moon with face":["🌜"],"full moon with face":["🌝"],"sun with face":["🌞"],"white medium star":["⭐"],"glowing star":["🌟"],"shooting star":["🌠"],"sun behind cloud":["⛅"],"cloud with lightning and rain":["⛈"],thunder:["⛈"],"sun behind small cloud":["🌤"],"sun behind large cloud":["🌥"],"sun behind rain cloud":["🌦"],"cloud with rain":["🌧"],"cloud with snow":["🌨"],"cloud with lightning":["🌩"],tornado:["🌪"],whirlwind:["🌪"],"wind face":["🌬"],typhoon:["🌀"],"closed umbrella":["🌂"],"umbrella with rain drops":["☔"],"umbrella on ground":["⛱"],"high voltage":["⚡"],"snowman without snow":["⛄"],comet:["☄"],"water wave":["🌊"],"jack-o-lantern":["🎃"],"Christmas tree":["🎄"],sparkler:["🎇"],sparkles:["✨"],"party popper":["🎉"],"confetti ball":["🎊"],"tanabata tree":["🎋"],"pine decoration":["🎍"],"Japanese dolls":["🎎"],doll:["🎎"],festival:["🎎"],"carp streamer":["🎏"],carp:["🎏"],"wind chime":["🎐"],chime:["🎐"],"moon viewing ceremony":["🎑"],ceremony:["🎑"],"wrapped gift":["🎁"],"reminder ribbon":["🎗"],reminder:["🎗"],"admission tickets":["🎟"],"military medal":["🎖"],medal:["🎖","🏅"],military:["🎖"],"sports medal":["🏅"],"soccer ball":["⚽"],volleyball:["🏐"],"american football":["🏈"],american:["🏈"],"rugby football":["🏉"],racquet:["🎾","🏸"],"pool 8 ball":["🎱"],"8ball":["🎱"],cricket:["🏏"],"field hockey":["🏑"],field:["🏑"],hockey:["🏑","🏒"],"ice hockey":["🏒"],puck:["🏒"],"ping pong":["🏓"],paddle:["🏓"],pingpong:["🏓"],tabletennis:["🏓"],badminton:["🏸"],birdie:["🏸"],shuttlecock:["🏸"],"direct hit":["🎯"],hit:["🎯"],"flag in hole":["⛳"],"ice skate":["⛸"],skate:["⛸"],"fishing pole":["🎣"],"running shirt":["🎽"],athletics:["🎽"],skis:["🎿"],joystick:["🕹"],videogame:["🕹"],"game die":["🎲"],die:["🎲"],"spade suit":["♠"],card:["♠","♥","♦","♣","🃏","🎴","💳","🗂","📇","🗃"],"heart suit":["♥"],"diamond suit":["♦"],"club suit":["♣"],wildcard:["🃏"],"mahjong red dragon":["🀄"],mahjong:["🀄"],"flower playing cards":["🎴"],playing:["🎴"],"muted speaker":["🔇"],speaker:["🔇"],"speaker low volume":["🔈"],"speaker medium volume":["🔉"],medium:["🔉"],"speaker high volume":["🔊"],publicaddress:["📢"],cheering:["📣"],"postal horn":["📯"],postal:["📯"],"bell with slash":["🔕"],"musical score":["🎼"],"musical note":["🎵"],note:["🎵","🎶","💴","💵","💶","💷","💸","🗒"],"musical notes":["🎶"],"studio microphone":["🎙"],studio:["🎙"],"level slider":["🎚"],level:["🎚"],slider:["🎚"],"control knobs":["🎛"],control:["🎛","🛂"],knobs:["🎛"],"musical keyboard":["🎹"],drum:["🛢"],"mobile phone":["📱"],"mobile phone with arrow":["📲"],"telephone receiver":["📞"],receiver:["📞"],"fax machine":["📠"],"electric plug":["🔌"],"laptop computer":["💻"],pc:["💻"],personal:["💻"],"desktop computer":["🖥"],desktop:["🖥"],printer:["🖨"],"computer mouse":["🖱"],trackball:["🖲"],"computer disk":["💽"],disk:["💽","💾","💿","📀"],optical:["💽","💿","📀"],"floppy disk":["💾"],"optical disk":["💿"],"movie camera":["🎥"],"film frames":["🎞"],frames:["🎞"],"film projector":["📽"],projector:["📽"],"clapper board":["🎬"],clapper:["🎬"],"camera with flash":["📸"],flash:["📸"],"video camera":["📹"],"left-pointing magnifying glass":["🔍"],"right-pointing magnifying glass":["🔎"],"satellite antenna":["📡"],candle:["🕯"],"light bulb":["💡"],torch:["🔦"],"red paper lantern":["🏮"],"notebook with decorative cover":["📔"],"closed book":["📕"],"open book":["📖"],"green book":["📗"],"blue book":["📘"],"orange book":["📙"],"page with curl":["📃"],curl:["📃","➰","➿"],"page facing up":["📄"],"rolled-up newspaper":["🗞"],rolled:["🗞"],"bookmark tabs":["📑"],marker:["📑"],tabs:["📑"],label:["🏷"],"money bag":["💰"],"yen banknote":["💴"],"dollar banknote":["💵"],"euro banknote":["💶"],"pound banknote":["💷"],"money with wings":["💸"],wings:["💸"],"credit card":["💳"],"chart increasing with yen":["💹"],market:["💹"],rise:["💹"],trend:["💹","📈","📉"],upward:["💹","📈"],"currency exchange":["💱"],"heavy dollar sign":["💲"],"incoming envelope":["📨"],"envelope with arrow":["📩"],"outbox tray":["📤"],tray:["📤","📥"],"inbox tray":["📥"],"closed mailbox with raised flag":["📫"],"closed mailbox with lowered flag":["📪"],lowered:["📪","📭"],"open mailbox with raised flag":["📬"],"open mailbox with lowered flag":["📭"],"ballot box with ballot":["🗳"],"black nib":["✒"],nib:["✒","🔏"],pen:["✒","🖋","🖊","🔏"],"fountain pen":["🖋"],ballpoint:["🖊"],paintbrush:["🖌"],crayon:["🖍"],"file folder":["📁"],"open file folder":["📂"],"card index dividers":["🗂"],dividers:["🗂"],"tear-off calendar":["📆"],"spiral notepad":["🗒"],pad:["🗒","🗓"],"spiral calendar":["🗓"],"card index":["📇"],"chart increasing":["📈"],"chart decreasing":["📉"],"bar chart":["📊"],"round pushpin":["📍"],"linked paperclips":["🖇"],"straight ruler":["📏"],straightedge:["📏"],"triangular ruler":["📐"],set:["📐"],triangle:["📐","▶","⏭","⏯","◀","⏮"],cutting:["✂"],"card file box":["🗃"],"file cabinet":["🗄"],cabinet:["🗄"],filing:["🗄"],wastebasket:["🗑"],"locked with pen":["🔏"],privacy:["🔏"],"locked with key":["🔐"],secure:["🔐"],"old key":["🗝"],clue:["🗝"],pick:["⛏","⚒"],mining:["⛏"],"hammer and pick":["⚒"],"hammer and wrench":["🛠"],spanner:["🛠","🔧"],dagger:["🗡"],"crossed swords":["⚔"],swords:["⚔"],handgun:["🔫"],"bow and arrow":["🏹"],archer:["🏹","♐"],archery:["🏹"],Sagittarius:["🏹","♐"],shield:["🛡"],"nut and bolt":["🔩"],gear:["⚙"],clamp:["🗜"],compress:["🗜"],vice:["🗜"],alembic:["⚗"],chemistry:["⚗"],"balance scale":["⚖"],Libra:["⚖","♎"],chains:["⛓"],chain:["⛓"],"funeral urn":["⚱"],ashes:["⚱"],moai:["🗿"],"oil drum":["🛢"],oil:["🛢"],"crystal ball":["🔮"],crystal:["🔮"],"ATM sign":["🏧"],teller:["🏧"],"litter in bin sign":["🚮"],litterbin:["🚮"],"potable water":["🚰"],potable:["🚰"],"wheelchair symbol":["♿"],access:["♿"],"men’s room":["🚹"],"women’s room":["🚺"],WC:["🚻"],"baby symbol":["🚼"],changing:["🚼"],"water closet":["🚾"],"passport control":["🛂"],"baggage claim":["🛄"],claim:["🛄"],locker:["🛅"],"children crossing":["🚸"],"no entry":["⛔"],entry:["⛔","🚫"],"no bicycles":["🚳"],"no smoking":["🚭"],"no littering":["🚯"],"non-potable water":["🚱"],"non-drinking":["🚱"],"non-potable":["🚱"],"no pedestrians":["🚷"],"no mobile phones":["📵"],"no one under eighteen":["🔞"],agerestriction:["🔞"],eighteen:["🔞"],"up arrow":["⬆"],cardinal:["⬆","➡","⬇","⬅"],direction:["⬆","↗","➡","↘","⬇","↙","⬅","↖"],"up-right arrow":["↗"],intercardinal:["↗","↘","↙","↖"],"right arrow":["➡"],"down-right arrow":["↘"],southeast:["↘"],"down arrow":["⬇"],south:["⬇"],"down-left arrow":["↙"],southwest:["↙"],"left arrow":["⬅"],west:["⬅"],"up-left arrow":["↖"],"up-down arrow":["↕"],"left-right arrow":["↔"],"right arrow curving left":["↩"],"left arrow curving right":["↪"],"right arrow curving up":["⤴"],"right arrow curving down":["⤵"],"clockwise vertical arrows":["🔃"],reload:["🔃"],"anticlockwise arrows button":["🔄"],anticlockwise:["🔄"],counterclockwise:["🔄"],withershins:["🔄"],"BACK arrow":["🔙"],"END arrow":["🔚"],"ON! arrow":["🔛"],on:["🔛"],"SOON arrow":["🔜"],soon:["🔜"],"TOP arrow":["🔝"],"place of worship":["🛐"],worship:["🛐"],"atom symbol":["⚛"],om:["🕉"],Hindu:["🕉"],"star of David":["✡"],David:["✡"],"wheel of dharma":["☸"],Buddhist:["☸"],"yin yang":["☯"],"latin cross":["✝"],"orthodox cross":["☦"],"star and crescent":["☪"],"peace symbol":["☮"],menorah:["🕎"],candelabrum:["🕎"],candlestick:["🕎"],"dotted six-pointed star":["🔯"],"shuffle tracks button":["🔀"],"repeat button":["🔁"],"repeat single button":["🔂"],once:["🔂"],"play button":["▶"],right:["▶","⏯"],"fast-forward button":["⏩"],"double":["⏩","⏪","⏫","⏬","⏸","➿"],forward:["⏩"],"next track button":["⏭"],nextscene:["⏭"],nexttrack:["⏭"],"play or pause button":["⏯"],pause:["⏯","⏸"],"reverse button":["◀"],left:["◀"],reverse:["◀"],"fast reverse button":["⏪"],"last track button":["⏮"],previousscene:["⏮"],previoustrack:["⏮"],"up button":["🔼"],button:["🔼","🔽","🔘","🔲","🔳"],"fast up button":["⏫"],"down button":["🔽"],"fast down button":["⏬"],"pause button":["⏸"],vertical:["⏸"],"stop button":["⏹"],square:["⏹","❎","▪","▫","◻","◼","◽","◾","⬛","⬜","🔲","🔳"],"record button":["⏺"],circle:["⏺","⭕","Ⓜ","⚪","⚫","🔴","🔵"],"dim button":["🔅"],low:["🔅"],"bright button":["🔆"],"antenna bars":["📶"],"vibration mode":["📳"],mode:["📳"],vibration:["📳"],"mobile phone off":["📴"],"recycling symbol":["♻"],"name badge":["📛"],"Japanese symbol for beginner":["🔰"],beginner:["🔰"],chevron:["🔰"],"trident emblem":["🔱"],emblem:["🔱"],"heavy large circle":["⭕"],o:["⭕","🅾"],"white heavy check mark":["✅"],"ballot box with check":["☑"],"heavy check mark":["✔"],"heavy multiplication x":["✖"],cancel:["✖","❌"],x:["✖","❌"],"cross mark":["❌"],"cross mark button":["❎"],"heavy plus sign":["➕"],"heavy minus sign":["➖"],"heavy division sign":["➗"],"curly loop":["➰"],loop:["➰","➿"],"double curly loop":["➿"],"part alternation mark":["〽"],part:["〽"],"eight-spoked asterisk":["✳"],asterisk:["✳"],"eight-pointed star":["✴"],"double exclamation mark":["‼"],bangbang:["‼"],"exclamation question mark":["⁉"],interrobang:["⁉"],"white question mark":["❔"],"white exclamation mark":["❕"],"exclamation mark":["❗"],"wavy dash":["〰"],"trade mark":["™"],keycap:["#️⃣","*️⃣","0️⃣","1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣"],"keycap 10":["🔟"],keycap10:["🔟"],"hundred points":["💯"],"input latin uppercase":["🔠"],ABCD:["🔠"],input:["🔠","🔡","🔢","🔣","🔤"],latin:["🔠","🔡","🔤"],letters:["🔠","🔡","🔤"],uppercase:["🔠"],"input latin lowercase":["🔡"],"input numbers":["🔢"],"input symbols":["🔣"],"〒♪&%":["🔣"],"input latin letters":["🔤"],"A button (blood type)":["🅰"],a:["🅰"],bloodtype:["🅰","🆎","🅱","🅾"],"AB button (blood type)":["🆎"],ab:["🆎"],"B button (blood type)":["🅱"],b:["🅱"],"CL button":["🆑"],cl:["🆑"],"COOL button":["🆒"],"FREE button":["🆓"],i:["ℹ"],"ID button":["🆔"],
id:["🆔"],identity:["🆔"],"circled M":["Ⓜ"],m:["Ⓜ"],"NEW button":["🆕"],"NG button":["🆖"],"O button (blood type)":["🅾"],"OK button":["🆗"],"P button":["🅿"],"SOS button":["🆘"],sos:["🆘"],"UP! button":["🆙"],"VS button":["🆚"],vs:["🆚"],"Japanese “here” button":["🈁"],"“here”":["🈁"],katakana:["🈁","🈂"],"ココ":["🈁"],"Japanese “service charge” button":["🈂"],"“servicecharge”":["🈂"],"サ":["🈂"],"Japanese “monthly amount” button":["🈷"],"“monthlyamount”":["🈷"],ideograph:["🈷","🈶","🈯","🉐","🈹","🈚","🈲","🉑","🈸","🈴","🈳","㊗","㊙","🈺","🈵"],"月":["🈷"],"Japanese “not free of charge” button":["🈶"],"“notfreeofcharge”":["🈶"],"有":["🈶"],"Japanese “reserved” button":["🈯"],"“reserved”":["🈯"],"指":["🈯"],"Japanese “bargain” button":["🉐"],"“bargain”":["🉐"],"得":["🉐"],"Japanese “discount” button":["🈹"],"“discount”":["🈹"],"割":["🈹"],"Japanese “free of charge” button":["🈚"],"“freeofcharge”":["🈚"],"無":["🈚"],"Japanese “prohibited” button":["🈲"],"“prohibited”":["🈲"],"禁":["🈲"],"Japanese “acceptable” button":["🉑"],"“acceptable”":["🉑"],"可":["🉑"],"Japanese “application” button":["🈸"],"“application”":["🈸"],"申":["🈸"],"Japanese “passing grade” button":["🈴"],"“passinggrade”":["🈴"],"合":["🈴"],"Japanese “vacancy” button":["🈳"],"“vacancy”":["🈳"],"空":["🈳"],"Japanese “congratulations” button":["㊗"],"“congratulations”":["㊗"],"祝":["㊗"],"Japanese “secret” button":["㊙"],"“secret”":["㊙"],"秘":["㊙"],"Japanese “open for business” button":["🈺"],"“openforbusiness”":["🈺"],"営":["🈺"],"Japanese “no vacancy” button":["🈵"],"“novacancy”":["🈵"],"満":["🈵"],"black small square":["▪"],geometric:["▪","▫","◻","◼","◽","◾","⬛","⬜","🔶","🔷","🔸","🔹","🔺","🔻","💠","🔘","🔲","🔳","⚪","⚫","🔴","🔵"],"white small square":["▫"],"white medium square":["◻"],"black medium square":["◼"],"white medium-small square":["◽"],"black medium-small square":["◾"],"black large square":["⬛"],"white large square":["⬜"],"large orange diamond":["🔶"],"large blue diamond":["🔷"],"small orange diamond":["🔸"],"small blue diamond":["🔹"],"red triangle pointed up":["🔺"],"red triangle pointed down":["🔻"],"diamond with a dot":["💠"],inside:["💠"],"radio button":["🔘"],"black square button":["🔲"],"white square button":["🔳"],"white circle":["⚪"],"black circle":["⚫"],"red circle":["🔴"],"blue circle":["🔵"],"chequered flag":["🏁"],"triangular flag":["🚩"],"crossed flags":["🎌"],"black flag":["🏴"],"white flag":["🏳"],Andorra:["🇦🇩"],"United Arab Emirates":["🇦🇪"],Afghanistan:["🇦🇫"],"Antigua & Barbuda":["🇦🇬"],Anguilla:["🇦🇮"],Albania:["🇦🇱"],Armenia:["🇦🇲"],Angola:["🇦🇴"],Antarctica:["🇦🇶"],Argentina:["🇦🇷"],"American Samoa":["🇦🇸"],Austria:["🇦🇹"],Aruba:["🇦🇼"],"Åland Islands":["🇦🇽"],Azerbaijan:["🇦🇿"],"Bosnia & Herzegovina":["🇧🇦"],Barbados:["🇧🇧"],Bangladesh:["🇧🇩"],Belgium:["🇧🇪"],"Burkina Faso":["🇧🇫"],Bulgaria:["🇧🇬"],Bahrain:["🇧🇭"],Burundi:["🇧🇮"],Benin:["🇧🇯"],"St. Barthélemy":["🇧🇱"],Bermuda:["🇧🇲"],Brunei:["🇧🇳"],Bolivia:["🇧🇴"],"Caribbean Netherlands":["🇧🇶"],Brazil:["🇧🇷"],Bahamas:["🇧🇸"],Bhutan:["🇧🇹"],Botswana:["🇧🇼"],Belarus:["🇧🇾"],Belize:["🇧🇿"],Canada:["🇨🇦"],"Cocos (Keeling) Islands":["🇨🇨"],"Congo - Kinshasa":["🇨🇩"],"Central African Republic":["🇨🇫"],"Congo - Brazzaville":["🇨🇬"],Switzerland:["🇨🇭"],"Côte d’Ivoire":["🇨🇮"],"Cook Islands":["🇨🇰"],Chile:["🇨🇱"],Cameroon:["🇨🇲"],China:["🇨🇳"],Colombia:["🇨🇴"],"Costa Rica":["🇨🇷"],Cuba:["🇨🇺"],"Cape Verde":["🇨🇻"],"Curaçao":["🇨🇼"],"Christmas Island":["🇨🇽"],Cyprus:["🇨🇾"],"Czech Republic":["🇨🇿"],Germany:["🇩🇪"],Djibouti:["🇩🇯"],Denmark:["🇩🇰"],Dominica:["🇩🇲"],"Dominican Republic":["🇩🇴"],Algeria:["🇩🇿"],Ecuador:["🇪🇨"],Estonia:["🇪🇪"],Egypt:["🇪🇬"],"Western Sahara":["🇪🇭"],Eritrea:["🇪🇷"],Spain:["🇪🇸"],Ethiopia:["🇪🇹"],"European Union":["🇪🇺"],Finland:["🇫🇮"],Fiji:["🇫🇯"],"Falkland Islands":["🇫🇰"],Micronesia:["🇫🇲"],"Faroe Islands":["🇫🇴"],France:["🇫🇷"],Gabon:["🇬🇦"],"United Kingdom":["🇬🇧"],Grenada:["🇬🇩"],Georgia:["🇬🇪"],"French Guiana":["🇬🇫"],Guernsey:["🇬🇬"],Ghana:["🇬🇭"],Gibraltar:["🇬🇮"],Greenland:["🇬🇱"],Gambia:["🇬🇲"],Guinea:["🇬🇳"],Guadeloupe:["🇬🇵"],"Equatorial Guinea":["🇬🇶"],Greece:["🇬🇷"],"South Georgia & South Sandwich Islands":["🇬🇸"],Guatemala:["🇬🇹"],Guam:["🇬🇺"],"Guinea-Bissau":["🇬🇼"],Guyana:["🇬🇾"],"Hong Kong SAR China":["🇭🇰"],Honduras:["🇭🇳"],Croatia:["🇭🇷"],Haiti:["🇭🇹"],Hungary:["🇭🇺"],"Canary Islands":["🇮🇨"],Indonesia:["🇮🇩"],Ireland:["🇮🇪"],Israel:["🇮🇱"],"Isle of Man":["🇮🇲"],India:["🇮🇳"],"British Indian Ocean Territory":["🇮🇴"],Iraq:["🇮🇶"],Iran:["🇮🇷"],Iceland:["🇮🇸"],Italy:["🇮🇹"],Jersey:["🇯🇪"],Jamaica:["🇯🇲"],Jordan:["🇯🇴"],Kenya:["🇰🇪"],Kyrgyzstan:["🇰🇬"],Cambodia:["🇰🇭"],Kiribati:["🇰🇮"],Comoros:["🇰🇲"],"St. Kitts & Nevis":["🇰🇳"],"North Korea":["🇰🇵"],"South Korea":["🇰🇷"],Kuwait:["🇰🇼"],"Cayman Islands":["🇰🇾"],Kazakhstan:["🇰🇿"],Laos:["🇱🇦"],Lebanon:["🇱🇧"],"St. Lucia":["🇱🇨"],Liechtenstein:["🇱🇮"],"Sri Lanka":["🇱🇰"],Liberia:["🇱🇷"],Lesotho:["🇱🇸"],Lithuania:["🇱🇹"],Luxembourg:["🇱🇺"],Latvia:["🇱🇻"],Libya:["🇱🇾"],Morocco:["🇲🇦"],Monaco:["🇲🇨"],Moldova:["🇲🇩"],Montenegro:["🇲🇪"],Madagascar:["🇲🇬"],"Marshall Islands":["🇲🇭"],Macedonia:["🇲🇰"],Mali:["🇲🇱"],"Myanmar (Burma)":["🇲🇲"],Mongolia:["🇲🇳"],"Macau SAR China":["🇲🇴"],"Northern Mariana Islands":["🇲🇵"],Martinique:["🇲🇶"],Mauritania:["🇲🇷"],Montserrat:["🇲🇸"],Malta:["🇲🇹"],Mauritius:["🇲🇺"],Maldives:["🇲🇻"],Malawi:["🇲🇼"],Mexico:["🇲🇽"],Malaysia:["🇲🇾"],Mozambique:["🇲🇿"],Namibia:["🇳🇦"],"New Caledonia":["🇳🇨"],Niger:["🇳🇪"],"Norfolk Island":["🇳🇫"],Nigeria:["🇳🇬"],Nicaragua:["🇳🇮"],Netherlands:["🇳🇱"],Norway:["🇳🇴"],Nepal:["🇳🇵"],Nauru:["🇳🇷"],Niue:["🇳🇺"],"New Zealand":["🇳🇿"],Oman:["🇴🇲"],Panama:["🇵🇦"],Peru:["🇵🇪"],"French Polynesia":["🇵🇫"],"Papua New Guinea":["🇵🇬"],Philippines:["🇵🇭"],Pakistan:["🇵🇰"],Poland:["🇵🇱"],"St. Pierre & Miquelon":["🇵🇲"],"Pitcairn Islands":["🇵🇳"],"Puerto Rico":["🇵🇷"],"Palestinian Territories":["🇵🇸"],Portugal:["🇵🇹"],Palau:["🇵🇼"],Paraguay:["🇵🇾"],Qatar:["🇶🇦"],"Réunion":["🇷🇪"],Romania:["🇷🇴"],Serbia:["🇷🇸"],Russia:["🇷🇺"],Rwanda:["🇷🇼"],"Saudi Arabia":["🇸🇦"],"Solomon Islands":["🇸🇧"],Seychelles:["🇸🇨"],Sudan:["🇸🇩"],Sweden:["🇸🇪"],Singapore:["🇸🇬"],"St. Helena":["🇸🇭"],Slovenia:["🇸🇮"],Slovakia:["🇸🇰"],"Sierra Leone":["🇸🇱"],"San Marino":["🇸🇲"],Senegal:["🇸🇳"],Somalia:["🇸🇴"],Suriname:["🇸🇷"],"South Sudan":["🇸🇸"],"São Tomé & Príncipe":["🇸🇹"],"El Salvador":["🇸🇻"],"Sint Maarten":["🇸🇽"],Syria:["🇸🇾"],Swaziland:["🇸🇿"],"Turks & Caicos Islands":["🇹🇨"],Chad:["🇹🇩"],"French Southern Territories":["🇹🇫"],Togo:["🇹🇬"],Thailand:["🇹🇭"],Tajikistan:["🇹🇯"],Tokelau:["🇹🇰"],"Timor-Leste":["🇹🇱"],Turkmenistan:["🇹🇲"],Tunisia:["🇹🇳"],Tonga:["🇹🇴"],Turkey:["🇹🇷"],"Trinidad & Tobago":["🇹🇹"],Tuvalu:["🇹🇻"],Taiwan:["🇹🇼"],Tanzania:["🇹🇿"],Ukraine:["🇺🇦"],Uganda:["🇺🇬"],"United States":["🇺🇸"],Uruguay:["🇺🇾"],Uzbekistan:["🇺🇿"],"Vatican City":["🇻🇦"],"St. Vincent & Grenadines":["🇻🇨"],Venezuela:["🇻🇪"],"British Virgin Islands":["🇻🇬"],"U.S. Virgin Islands":["🇻🇮"],Vietnam:["🇻🇳"],Vanuatu:["🇻🇺"],"Wallis & Futuna":["🇼🇫"],Samoa:["🇼🇸"],Kosovo:["🇽🇰"],Yemen:["🇾🇪"],Mayotte:["🇾🇹"],"South Africa":["🇿🇦"],Zambia:["🇿🇲"],Zimbabwe:["🇿🇼"]}},function(e,t,n){e.exports=function(){return new Worker(n.p+"fd80ce843d0b3f094582.worker.js")}},function(e,t,n){e.exports=function(){return new Worker(n.p+"pdf.worker.js")}}]));